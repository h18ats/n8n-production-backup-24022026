{
  "name": "DEV - n8n Connected Agent Lee LE - Owner Andy",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "8916778c-68b7-40a9-8886-518c54f0a094",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -1200,
        -512
      ],
      "id": "1666e6f8-4939-432e-a386-0f9e20743069",
      "name": "Webhook",
      "webhookId": "8916778c-68b7-40a9-8886-518c54f0a094",
      "disabled": true
    },
    {
      "parameters": {
        "messages": {
          "message": [
            {
              "content": "={{ $json.body.searchQuery }}"
            }
          ]
        },
        "simplify": true,
        "options": {},
        "requestOptions": {}
      },
      "type": "n8n-nodes-base.perplexity",
      "typeVersion": 1,
      "position": [
        -976,
        -512
      ],
      "id": "0b1b778b-1472-418f-aba8-4000bfbfbeea",
      "name": "Message a model",
      "credentials": {
        "perplexityApi": {
          "id": "pOqM7kFIqiYB3qGU",
          "name": "Perplexity account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.message }}",
        "options": {
          "systemMessage": "=# Overview\nYou are an expert research agent. You will be fed information, and you need to make a concise summary. It should only be about three sentences. "
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -752,
        -512
      ],
      "id": "bf8fafdd-427c-40f4-931d-e6b6f327faa0",
      "name": "AI Agent1",
      "disabled": true
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -400,
        -512
      ],
      "id": "ae36b402-500f-4e88-9dcc-41dcf2e4d5c7",
      "name": "Respond to Webhook",
      "disabled": true
    },
    {
      "parameters": {
        "projectId": {
          "__rl": true,
          "value": "vertex-ai-api-setup-via-cli",
          "mode": "id"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleVertex",
      "typeVersion": 1,
      "position": [
        -688,
        -288
      ],
      "id": "410a5dfc-6355-4a08-99e4-892342820920",
      "name": "Google Vertex Chat Model",
      "credentials": {
        "googleApi": {
          "id": "LQjM9YuYI3HxJBrE",
          "name": "Google Service Account - Edu account Oct 8th"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Request: {{ $('Code in JavaScript').item.json.request }}",
        "options": {
          "systemMessage": "=You're a helpful assistant that helps the user based on their request or questio. \nYou should use your tools to effectively fulfill the requests. You can use the tools as many times as necessary. \n\nToday is {{ $now.format('cccc') }} the {{ $now.setZone('Europe/London').format('yyyy-MM-dd') }} at {{ $now.setZone('Europe/London').toFormat('HH:mm') }}.\n\n\n"
        }
      },
      "id": "d3471c55-cd63-47cf-a49c-ef5da79e8aa3",
      "name": "AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -352,
        16
      ]
    },
    {
      "parameters": {
        "sendTo": "eduardo.aguilarpelaez@gmail.com",
        "subject": "=Calendar: {{ $('webhook').item.json.body.question }}",
        "message": "={{ $json.output }}",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        192,
        16
      ],
      "id": "b842c874-d262-4e22-835a-1aa1df34499f",
      "name": "Gmail",
      "webhookId": "9ede404c-f20a-4155-832b-12dce2d701d5",
      "disabled": true
    },
    {
      "parameters": {
        "toRecipients": "andy@legalengine.co.uk",
        "subject": "=Calendar: {{ $('webhook').item.json.body.question }}",
        "bodyContent": "={{ $json.output }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.microsoftOutlook",
      "typeVersion": 2,
      "position": [
        192,
        208
      ],
      "id": "60878039-73c9-49f0-b860-2cc038b26a57",
      "name": "Microsoft Outlook",
      "webhookId": "9c860f23-28aa-44f1-ab48-8eacc7770d5e",
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "id": "AXPdKzqn2kvc9mOQ",
          "name": "samantha test"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.dateTime",
      "typeVersion": 2,
      "position": [
        -752,
        16
      ],
      "id": "281bb868-4287-454b-998a-88867b75b5ab",
      "name": "Date & Time"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        192,
        -192
      ],
      "id": "60989c8b-c125-495e-acb2-9f9dc977f951",
      "name": "Respond to Webhook1"
    },
    {
      "parameters": {
        "projectId": {
          "__rl": true,
          "value": "vertex-ai-api-setup-via-cli",
          "mode": "id"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleVertex",
      "typeVersion": 1,
      "position": [
        -1200,
        432
      ],
      "id": "563f5824-c6d0-4425-848a-5dfbbd330df7",
      "name": "Google Vertex Chat Model1",
      "credentials": {
        "googleApi": {
          "id": "LQjM9YuYI3HxJBrE",
          "name": "Google Service Account - Edu account Oct 8th"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "toRecipients": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('To', ``, 'string') }}",
        "subject": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Subject', ``, 'string') }}",
        "bodyContent": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Message', ``, 'string') }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.microsoftOutlookTool",
      "typeVersion": 2,
      "position": [
        -400,
        240
      ],
      "id": "0dac1417-a0c3-47ab-a4db-18247e13be7f",
      "name": "Send Email Tool",
      "webhookId": "b7cb1946-ee2e-48a9-a427-6de500a9d178",
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "id": "bLvU6joGotzynHwT",
          "name": "Microsoft Outlook - Lee Jan 2026"
        }
      }
    },
    {
      "parameters": {
        "resource": "event",
        "fromAllCalendars": false,
        "calendarId": {
          "__rl": true,
          "value": "AQMkAGJmN2M2NGFhAC1hYzI4LTRkNjAtOThmYi1iYzFjODZjNGQwMWQARgAAA-aUj-zNalNOpFa6myt4ADMHAIfTtQvn9StGnIa6__JPK6kAAAIBBgAAAIfTtQvn9StGnIa6__JPK6kAAAJVggAAAA==",
          "mode": "list",
          "cachedResultName": "Calendar"
        },
        "limit": 30,
        "filters": {}
      },
      "type": "n8n-nodes-base.microsoftOutlookTool",
      "typeVersion": 2,
      "position": [
        -272,
        240
      ],
      "id": "f3559e55-85ce-4854-aeee-45def95aa374",
      "name": "Get Calendar Event Tool",
      "webhookId": "9a4a350d-3c72-46b4-a06a-88ee385af573",
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "id": "bLvU6joGotzynHwT",
          "name": "Microsoft Outlook - Lee Jan 2026"
        }
      }
    },
    {
      "parameters": {
        "resource": "event",
        "operation": "create",
        "calendarId": {
          "__rl": true,
          "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Calendar', ``, 'string') }}",
          "mode": "id"
        },
        "subject": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Title', ``, 'string') }}",
        "startDateTime": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}",
        "endDateTime": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.microsoftOutlookTool",
      "typeVersion": 2,
      "position": [
        -144,
        240
      ],
      "id": "b14a861f-429d-4315-8470-a0bc369d2ea9",
      "name": "Create Calendar Event Tool",
      "webhookId": "b9062f8e-f852-4d24-bd8b-70134e079ecc",
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "id": "bLvU6joGotzynHwT",
          "name": "Microsoft Outlook - Lee Jan 2026"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "limit": 30,
        "options": {}
      },
      "type": "n8n-nodes-base.microsoftOutlookTool",
      "typeVersion": 2,
      "position": [
        -16,
        240
      ],
      "id": "138f59a6-33ac-448f-ae92-22eee1a44ef1",
      "name": "Get Email Tool",
      "webhookId": "4199bb01-9fd6-4a38-b826-12c8d94dfa86",
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "id": "bLvU6joGotzynHwT",
          "name": "Microsoft Outlook - Lee Jan 2026"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Build a request string from mixed input shapes.\n//\n// Supported:\n// 1) { json: { body: { ... } } }  -> joins non-empty values from body\n// 2) { json: { chatInput: \"...\" } } -> uses chatInput (trimmed)\n\nconst values = items.flatMap((i) => {\n  const j = i.json ?? {};\n  const out = [];\n\n  // New shape: explicit chat input\n  if (typeof j.chatInput === \"string\" && j.chatInput.trim()) {\n    out.push(j.chatInput.trim());\n  }\n\n  // Existing shape: merge of body values\n  const body = j.body;\n  if (body && typeof body === \"object\" && !Array.isArray(body)) {\n    for (const v of Object.values(body)) {\n      if (v !== \"\" && v !== null && v !== undefined) out.push(String(v));\n    }\n  }\n\n  return out;\n});\n\n// Join all values into a single string\nconst request = values.join(\" \").replace(/\\s+/g, \" \").trim();\n\n// Output as a single string called \"request\"\nreturn [{ json: { request } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -976,
        16
      ],
      "id": "ddbc65be-c219-4507-ba3d-2afa4ea606f6",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "06419c46-d77e-4b97-89ac-75978b65fb56",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -1424,
        16
      ],
      "id": "1cbbde66-e8d8-4ca0-9904-6c5b2a025da0",
      "name": "webhook",
      "webhookId": "06419c46-d77e-4b97-89ac-75978b65fb56"
    },
    {
      "parameters": {
        "projectId": {
          "__rl": true,
          "value": "vertex-ai-api-setup-via-cli",
          "mode": "id"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleVertex",
      "typeVersion": 1,
      "position": [
        -560,
        224
      ],
      "id": "259c810b-a2c5-4a65-be44-175f32d1bd6b",
      "name": "Google Vertex Chat Model2",
      "credentials": {
        "googleApi": {
          "id": "LQjM9YuYI3HxJBrE",
          "name": "Google Service Account - Edu account Oct 8th"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -1184,
        0
      ],
      "id": "3a7448f7-49b4-4fb4-80f4-cf192d01a7fc",
      "name": "Merge"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.4,
      "position": [
        -1392,
        160
      ],
      "id": "e3bc0b41-dc67-40ad-b822-74e0e8a5dc5d",
      "name": "When chat message received",
      "webhookId": "c940520d-6ddb-497a-91f0-93c5f04c2939"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -480,
        384
      ],
      "id": "78e3b097-4abe-4f65-a6e3-223de5e56643",
      "name": "Simple Memory"
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Message a model",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message a model": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent1": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Vertex Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Respond to Webhook1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Gmail",
            "type": "main",
            "index": 0
          },
          {
            "node": "Microsoft Outlook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Date & Time": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Vertex Chat Model1": {
      "ai_languageModel": [
        []
      ]
    },
    "Send Email Tool": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get Calendar Event Tool": {
      "ai_tool": [
        []
      ]
    },
    "Create Calendar Event Tool": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get Email Tool": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "webhook": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Date & Time",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Vertex Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "pinData": {
    "webhook": [
      {
        "json": {
          "headers": {
            "host": "leonard-dev.app.n8n.cloud",
            "user-agent": "ElevenLabs/1.0",
            "content-length": "115",
            "accept": "*/*",
            "accept-encoding": "gzip, br",
            "cdn-loop": "cloudflare; loops=1; subreqs=1",
            "cf-connecting-ip": "34.77.234.246",
            "cf-ew-via": "15",
            "cf-ipcountry": "BE",
            "cf-ray": "997d5b38f4f6acc1-CDG",
            "cf-visitor": "{\"scheme\":\"https\"}",
            "cf-worker": "n8n.cloud",
            "content-type": "application/json",
            "x-forwarded-for": "34.77.234.246, 172.71.232.136",
            "x-forwarded-host": "leonard-dev.app.n8n.cloud",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "traefik-prod-users-gwc-52-6c4f4684d5-sbjk8",
            "x-is-trusted": "yes",
            "x-real-ip": "34.77.234.246"
          },
          "params": {},
          "query": {},
          "body": {
            "searchEmail": "",
            "createEmail": "",
            "searchEvent": "What was the last event in my calendar?",
            "createEvent": ""
          },
          "webhookUrl": "https://leonard-dev.app.n8n.cloud/webhook/get_outlook",
          "executionMode": "production"
        }
      }
    ]
  },
  "triggerCount": 2,
  "meta": {
    "templateCredsSetupCompleted": true
  }
}