{
  "name": "DEV - Luke - Find Diary Availability - Andy",
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -944,
        -496
      ],
      "id": "998b21af-c970-4008-b3ae-d9c9b6815ebd",
      "name": "When clicking ‘Execute workflow’"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=User Task: {{ $('Task').item.json.Task }}  {{ $('Task').item.json.Date }} for {{ $('Task').item.json.Starting }}. \n\nThe event needs to start no earlier than {{ $('Task').item.json.Earliest_Start }} and be finished by {{ $('Task').item.json.Latest_Finish }} latest.\n\nCreate a meeting called  {{ $('Task').item.json.Event_Name }} of {{ $('Task').item.json.Event_Length }}m in length and invite {{ $('Task').item.json.Invite }}. Mark the event as {{ $('Task').item.json['Private?'] }}. Set a reminder in my diary {{ $('Task').item.json.Alert_Mins }}m before the event.\n\nIf there is no availability {{ $('Task').item.json.Date }}, find the earliest {{ $('Task').item.json.Event_Length }}m slot after {{ $('Task').item.json.Earliest_Start }} the next working day (Monday - Friday) and book the event for then.\n\nToday's is: {{ $json.formattedDate }}\nTime is now: {{ $json.formattedTime }}",
        "options": {
          "systemMessage": "You are a world class personal assistant to an executive at a tech company. Your role is to manage their diary, looking up details, creating events, accepting or declining events, reminding them what they have coming up.\n\nWhen communicating with the user, the day format should always be in standard  UK formatting so 'DDMMYY' or '12th September 2025' and the time zone should be London. When using the tools date and time should be in ISO 8601 format.\n\nUse the 'calendar_search' tool to look up existing events in the user's calendar.\n\nUse the 'create_event' tool to add new events.\n\nUse the 'update_event' tool to update existing events.\n\nUse the 'calendar_search' tool o delete existing events if needed. You will need to find the event ID using the 'calendar_search' tool before using the 'calendar_search' tool. "
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        336,
        -496
      ],
      "id": "0e8ea8a7-d4de-43bc-bc7c-5f0b92d71198",
      "name": "AI Agent1"
    },
    {
      "parameters": {
        "projectId": {
          "__rl": true,
          "value": "vertex-ai-api-setup-via-cli",
          "mode": "id"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleVertex",
      "typeVersion": 1,
      "position": [
        208,
        -272
      ],
      "id": "45aea7a4-87e1-4b2c-aefc-aa47475f875c",
      "name": "Google Vertex Chat Model1",
      "credentials": {
        "googleApi": {
          "id": "LQjM9YuYI3HxJBrE",
          "name": "Google Service Account - Edu account Oct 8th"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.dateTime",
      "typeVersion": 2,
      "position": [
        -464,
        -496
      ],
      "id": "80a4dd86-91b4-4381-b8b2-fa35803e967d",
      "name": "Date & Time"
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Create events in user's calendar",
        "resource": "event",
        "operation": "create",
        "calendarId": {
          "__rl": true,
          "value": "AAMkAGMxYzIyMDNiLTMwNDQtNDE5OC05OGE2LTgyYmMxZjc0N2MxYgBGAAAAAACBf1OFgphsQr9q5Dg5U1xxBwBDq17NBUT6TZpi2QJ2WTqUAAAAAAEGAABDq17NBUT6TZpi2QJ2WTqUAAAAAIZiAAA=",
          "mode": "list",
          "cachedResultName": "Calendar"
        },
        "subject": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Title', ``, 'string') }}",
        "startDateTime": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}",
        "endDateTime": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.microsoftOutlookTool",
      "typeVersion": 2,
      "position": [
        464,
        -272
      ],
      "id": "0b02ca47-b83f-4cd7-9ff8-42afd2a6c8fe",
      "name": "create_event1",
      "webhookId": "004602a7-3e05-4241-b889-bc4d02c673df",
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "id": "qd4ZgBH04UILcCMZ",
          "name": "Outlook - Andy @ Legal Engine - Dec 2025"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// --- Function node code ---\n\n// Expecting an input item with a field `now`\n// e.g. \"2025-12-02T06:57:39.432+00:00\"\nconst input = $input.first();\nconst inputDate = new Date(input.json.now);\n\n// Helper to zero-pad to two digits\nconst pad = n => n.toString().padStart(2, '0');\n\n// UK date → DDMMYY\nconst dd = pad(inputDate.getDate());\nconst mm = pad(inputDate.getMonth() + 1);\nconst yy = inputDate.getFullYear().toString().slice(-2);\n\nconst formattedDate = `${dd}${mm}${yy}`;\n\n// Time → HH:mm:ss (24-hour clock)\nconst formattedTime = `${pad(inputDate.getHours())}:${pad(inputDate.getMinutes())}:${pad(inputDate.getSeconds())}`;\n\n// Local UK-style date → DD/MM/YYYY\nconst localDate = inputDate.toLocaleDateString(\"en-GB\");\n\n// Local UK-style time → HH:mm:ss (24-hour clock)\nconst localTime = inputDate.toLocaleTimeString(\"en-GB\", {\n  hour12: false\n});\n\nreturn [\n  {\n    json: {\n      now: input.json.now,   // original value from Set node\n      formattedDate,         // \"021225\"\n      formattedTime,         // \"06:57:39\"\n      localDate,             // \"02/12/2025\"\n      localTime              // \"06:57:39\"\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -16,
        -496
      ],
      "id": "5dd6a3b5-0e88-4245-9052-c04f3697d184",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5f981a67-fd06-4687-abcc-29295939493b",
              "name": "now",
              "value": "={{ $json.currentDate }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -240,
        -496
      ],
      "id": "839a1ec1-9b93-4579-b26e-2d2642160dc5",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Get many events in Microsoft Outlook",
        "resource": "event",
        "fromAllCalendars": false,
        "calendarId": {
          "__rl": true,
          "value": "AAMkAGMxYzIyMDNiLTMwNDQtNDE5OC05OGE2LTgyYmMxZjc0N2MxYgBGAAAAAACBf1OFgphsQr9q5Dg5U1xxBwBDq17NBUT6TZpi2QJ2WTqUAAAAAAEGAABDq17NBUT6TZpi2QJ2WTqUAAAAAIZiAAA=",
          "mode": "list",
          "cachedResultName": "Calendar"
        },
        "returnAll": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Return_All', ``, 'boolean') }}",
        "filters": {}
      },
      "type": "n8n-nodes-base.microsoftOutlookTool",
      "typeVersion": 2,
      "position": [
        592,
        -272
      ],
      "id": "e964d077-7867-4432-b237-2324d07e4084",
      "name": "calendar_search1",
      "webhookId": "11233e9c-2433-466c-85c6-1b84671a8595",
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "id": "qd4ZgBH04UILcCMZ",
          "name": "Outlook - Andy @ Legal Engine - Dec 2025"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Date & Time').item.json.currentDate }}",
        "contextWindowLength": 20
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        336,
        -272
      ],
      "id": "c9727904-d006-46c9-a481-0bf4f3ab2b25",
      "name": "Simple Memory1"
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Update an event in Microsoft Outlook",
        "resource": "event",
        "operation": "update",
        "calendarId": {
          "__rl": true,
          "value": "AAMkAGMxYzIyMDNiLTMwNDQtNDE5OC05OGE2LTgyYmMxZjc0N2MxYgBGAAAAAACBf1OFgphsQr9q5Dg5U1xxBwBDq17NBUT6TZpi2QJ2WTqUAAAAAAEGAABDq17NBUT6TZpi2QJ2WTqUAAAAAIZiAAA=",
          "mode": "list",
          "cachedResultName": "Calendar"
        },
        "eventId": {
          "__rl": true,
          "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Event', ``, 'string') }}",
          "mode": "id"
        },
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.microsoftOutlookTool",
      "typeVersion": 2,
      "position": [
        736,
        -272
      ],
      "id": "a05a88d7-9bbb-46ac-a7e1-8c773020869c",
      "name": "update_event1",
      "webhookId": "08d46387-c212-46b9-bdf0-fc2e6cb74c3f",
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "id": "qd4ZgBH04UILcCMZ",
          "name": "Outlook - Andy @ Legal Engine - Dec 2025"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Delete an event in Microsoft Outlook",
        "resource": "event",
        "operation": "delete",
        "calendarId": {
          "__rl": true,
          "value": "AAMkAGMxYzIyMDNiLTMwNDQtNDE5OC05OGE2LTgyYmMxZjc0N2MxYgBGAAAAAACBf1OFgphsQr9q5Dg5U1xxBwBDq17NBUT6TZpi2QJ2WTqUAAAAAAEGAABDq17NBUT6TZpi2QJ2WTqUAAAAAIZiAAA=",
          "mode": "list",
          "cachedResultName": "Calendar"
        },
        "eventId": {
          "__rl": true,
          "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Event', ``, 'string') }}",
          "mode": "id"
        }
      },
      "type": "n8n-nodes-base.microsoftOutlookTool",
      "typeVersion": 2,
      "position": [
        880,
        -272
      ],
      "id": "7d8aef2d-1d00-422a-8051-4a0845d233c4",
      "name": "delete_event1",
      "webhookId": "a3deaeb6-991f-42e1-9618-b0b3ac52739e",
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "id": "qd4ZgBH04UILcCMZ",
          "name": "Outlook - Andy @ Legal Engine - Dec 2025"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5f981a67-fd06-4687-abcc-29295939493b",
              "name": "Task",
              "value": "=Find me the next available free slot in my diary  ",
              "type": "string"
            },
            {
              "id": "e1c34d3d-8e39-402f-a425-29cde0597d15",
              "name": "Event_Name",
              "value": "Lee<>Luke Post Meeting Check in",
              "type": "string"
            },
            {
              "id": "20392a74-7c3d-4e25-9334-7d905ad8ecb4",
              "name": "Event_Length",
              "value": "15",
              "type": "string"
            },
            {
              "id": "2c15d529-20de-4162-89ae-e154d0ee71ea",
              "name": "Invite",
              "value": "Nobody",
              "type": "string"
            },
            {
              "id": "050af3be-9bd0-4f36-95be-52fed5988834",
              "name": "Private?",
              "value": "Not Private",
              "type": "string"
            },
            {
              "id": "12577a6e-5429-4d93-a3fb-5112006411e2",
              "name": "Starting",
              "value": "on the hour, quarter past, half past or quarter to the hour",
              "type": "string"
            },
            {
              "id": "45abb33b-41be-48ca-a457-7ca6915625aa",
              "name": "Date",
              "value": "Today",
              "type": "string"
            },
            {
              "id": "3f12ef22-b095-4a74-847f-fa7a03ff9244",
              "name": "Earliest_Start",
              "value": "8am",
              "type": "string"
            },
            {
              "id": "d837939f-2d8a-4b83-a3d9-be286ab25ba3",
              "name": "Latest_Finish",
              "value": "6pm",
              "type": "string"
            },
            {
              "id": "938f4aa6-3b76-45ed-afc0-af516712ea8d",
              "name": "Alert_Mins",
              "value": "15",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -704,
        -496
      ],
      "id": "3b3f3fbf-8fa5-4470-9c0b-4c9a15c59264",
      "name": "Task"
    }
  ],
  "connections": {
    "When clicking ‘Execute workflow’": {
      "main": [
        [
          {
            "node": "Task",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Vertex Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Date & Time": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "create_event1": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "calendar_search1": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory1": {
      "ai_memory": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "update_event1": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "delete_event1": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Task": {
      "main": [
        [
          {
            "node": "Date & Time",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "pinData": {},
  "triggerCount": 0,
  "meta": {
    "templateCredsSetupCompleted": true
  }
}