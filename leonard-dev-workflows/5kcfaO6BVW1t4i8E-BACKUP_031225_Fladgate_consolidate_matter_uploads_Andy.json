{
  "name": "BACKUP - 031225 - Fladgate consolidate matter uploads - Andy",
  "nodes": [
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "156090cc-9c17-4309-89eb-1171f9745d19",
              "leftValue": "={{ $('Search existing matters').item.json.Attachments[0].id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2880,
        176
      ],
      "id": "9a5cae25-dc55-4617-aee4-2518b3b70a56",
      "name": "If",
      "alwaysOutputData": false,
      "disabled": true
    },
    {
      "parameters": {
        "operation": "create",
        "base": {
          "__rl": true,
          "value": "appUvJyzSky12m4HA",
          "mode": "list",
          "cachedResultName": "Fladgate - Leonard Live Data",
          "cachedResultUrl": "https://airtable.com/appUvJyzSky12m4HA"
        },
        "table": {
          "__rl": true,
          "value": "tbl3ADT2yOV8EJCnZ",
          "mode": "list",
          "cachedResultName": "FG - Conversation History by lawyer",
          "cachedResultUrl": "https://airtable.com/appUvJyzSky12m4HA/tbl3ADT2yOV8EJCnZ"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Email": "={{ $('Search for new matter').item.json.Email }}",
            "Transcript ID": "={{ $('Search for new matter').item.json.id }}",
            "First Name": "={{ $('Search for new matter').item.json[\"First Name\"] }}",
            "Last Name": "={{ $('Search for new matter').item.json[\"Last Name\"] }}",
            "Number of Calls": 0,
            "Call Length": "={{ $('Search for new matter').item.json[\"Call Length (s)\"] }}",
            "Conversation History": "={{ $json.output }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Email",
              "displayName": "Email",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Transcript ID",
              "displayName": "Transcript ID",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Full Name",
              "displayName": "Full Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "First Name",
              "displayName": "First Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Last Name",
              "displayName": "Last Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Created",
              "displayName": "Created",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": false
            },
            {
              "id": "Last Modified",
              "displayName": "Last Modified",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Conversation History",
              "displayName": "Conversation History",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Call Length",
              "displayName": "Call Length",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Number of Calls",
              "displayName": "Number of Calls",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        -2592,
        336
      ],
      "id": "db1d509e-4745-492c-ac5f-04b9657e4fb2",
      "name": "Create new conv summary",
      "alwaysOutputData": true,
      "disabled": true
    },
    {
      "parameters": {
        "projectId": {
          "__rl": true,
          "value": "vertex-ai-api-setup-via-cli",
          "mode": "id"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleVertex",
      "typeVersion": 1,
      "position": [
        -2592,
        160
      ],
      "id": "14bf8414-9365-488f-8b5a-c23fa2922080",
      "name": "Google Vertex Chat Model3",
      "disabled": true
    },
    {
      "parameters": {
        "projectId": {
          "__rl": true,
          "value": "vertex-ai-api-setup-via-cli",
          "mode": "id"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleVertex",
      "typeVersion": 1,
      "position": [
        -1792,
        272
      ],
      "id": "3f80fc1d-b5a1-41dc-acd7-8516e9f2548c",
      "name": "Google Vertex Chat Model",
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=New Matter Summary:{{ $('Set pre IF').item.json[\"New Matter Summary\"] }}\nNew Matter Extract: {{ $('Set pre IF').item.json[\"New Matter Extract\"] }}\nExisting Matter Summary: {{ $('Set pre IF').item.json[\"Existing Matter Summary\"] }}\nExisting Matter Extract: {{ $('Set pre IF').item.json[\"Existing Matter Extract\"] }}\nExisting Matter Lead Lawyer: {{ $('Set pre IF').item.json[\"Existing Matter Lead Lawyer\"] }}\nExisting Matter Client: {{ $('Set pre IF').item.json[\"Existing Matter Client\"] }}\nNew Matter Lead Lawyer: {{ $('Set pre IF').item.json[\"New Matter Lead Lawyer\"] }}\nNew Matter Client: {{ $('Set pre IF').item.json[\"New Matter Client\"] }}\nNew Matter Short Summary: {{ $('Set pre IF').item.json[\"New Matter Short Summary\"] }}\nExisting Matter Short Summary: {{ $('Set pre IF').item.json[\"Existing Matter Short Summary\"] }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=You are an expert in extracting client names from a series of converations ({{ $('Matter history agent').item.json.output }}) ready to act as a knowledge base for a voice AI agent. \n\nThe aim is to ensure the knowledge base has a comprehensive list of all clients, firms and companies this lawyer has worked for or represented.\n\nThe output should be a very concise list of clients separated by commas in a single short text stream, ranked in a weighted order of relevance with the most relevant first."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -1856,
        48
      ],
      "id": "74286b3b-0feb-4078-9d4c-3926ca0aeb0b",
      "name": "Client Extraction",
      "disabled": true
    },
    {
      "parameters": {
        "operation": "upsert",
        "base": {
          "__rl": true,
          "value": "appUvJyzSky12m4HA",
          "mode": "list",
          "cachedResultName": "Fladgate - Leonard Live Data",
          "cachedResultUrl": "https://airtable.com/appUvJyzSky12m4HA"
        },
        "table": {
          "__rl": true,
          "value": "tblFoqBZuazSwqy3m",
          "mode": "list",
          "cachedResultName": "FG - Conslodated Matter History by lawyer",
          "cachedResultUrl": "https://airtable.com/appUvJyzSky12m4HA/tblFoqBZuazSwqy3m"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Email": "={{ $('Search for new matter').item.json.Email }}",
            "Clients": "={{ $json.output }}"
          },
          "matchingColumns": [
            "Email"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Email",
              "displayName": "Email",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Full Name",
              "displayName": "Full Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "First Name",
              "displayName": "First Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Last Name",
              "displayName": "Last Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Created",
              "displayName": "Created",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Last Modified",
              "displayName": "Last Modified",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Matter History",
              "displayName": "Matter History",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Clients",
              "displayName": "Clients",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Matters",
              "displayName": "Matters",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        -1504,
        48
      ],
      "id": "5f18a9e5-e2f3-4bee-84d3-641157d3a0ce",
      "name": "Create new conv summary2",
      "alwaysOutputData": true,
      "disabled": true
    },
    {
      "parameters": {
        "operation": "upsert",
        "base": {
          "__rl": true,
          "value": "appUvJyzSky12m4HA",
          "mode": "list",
          "cachedResultName": "Fladgate - Leonard Live Data",
          "cachedResultUrl": "https://airtable.com/appUvJyzSky12m4HA"
        },
        "table": {
          "__rl": true,
          "value": "tblFoqBZuazSwqy3m",
          "mode": "list",
          "cachedResultName": "FG - Conslodated Matter History by lawyer",
          "cachedResultUrl": "https://airtable.com/appUvJyzSky12m4HA/tblFoqBZuazSwqy3m"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Email": "={{ $('Search for new matter').item.json.Email }}",
            "Matters": "={{ $json.output }}"
          },
          "matchingColumns": [
            "Email"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Email",
              "displayName": "Email",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Full Name",
              "displayName": "Full Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "First Name",
              "displayName": "First Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Last Name",
              "displayName": "Last Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Created",
              "displayName": "Created",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Last Modified",
              "displayName": "Last Modified",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Matter History",
              "displayName": "Matter History",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Clients",
              "displayName": "Clients",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Matters",
              "displayName": "Matters",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        -704,
        48
      ],
      "id": "54708601-11fa-4090-87df-2adb0bd1f8c7",
      "name": "Create new conv summary3",
      "alwaysOutputData": true,
      "disabled": true
    },
    {
      "parameters": {
        "content": "May use an output parser",
        "height": 400,
        "width": 336
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1920,
        16
      ],
      "typeVersion": 1,
      "id": "f80b99e8-5417-4ca5-97c0-4274111b06da",
      "name": "Sticky Note",
      "disabled": true
    },
    {
      "parameters": {
        "operation": "upsert",
        "base": {
          "__rl": true,
          "value": "appUvJyzSky12m4HA",
          "mode": "list",
          "cachedResultName": "Fladgate - Leonard Live Data",
          "cachedResultUrl": "https://airtable.com/appUvJyzSky12m4HA"
        },
        "table": {
          "__rl": true,
          "value": "tblFoqBZuazSwqy3m",
          "mode": "list",
          "cachedResultName": "FG - Conslodated Matter History by lawyer",
          "cachedResultUrl": "https://airtable.com/appUvJyzSky12m4HA/tblFoqBZuazSwqy3m"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Email": "={{ $('Set pre IF').item.json.Email }}",
            "Last Name": "={{ $('Search for new matter').item.json[\"Last Name\"] }}",
            "First Name": "={{ $('Search for new matter').item.json[\"First Name\"] }}",
            "Matter History": "={{ $json.output }}"
          },
          "matchingColumns": [
            "Email"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Email",
              "displayName": "Email",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Full Name",
              "displayName": "Full Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "First Name",
              "displayName": "First Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Last Name",
              "displayName": "Last Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Created",
              "displayName": "Created",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Last Modified",
              "displayName": "Last Modified",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Matter History",
              "displayName": "Matter History",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Clients",
              "displayName": "Clients",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Matters",
              "displayName": "Matters",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        -2304,
        48
      ],
      "id": "5709066c-64a6-4626-81e2-a87cddc0be2a",
      "name": "Create new summary for new conv",
      "alwaysOutputData": true,
      "disabled": true
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "authentication": "airtableTokenApi",
        "baseId": {
          "__rl": true,
          "value": "https://airtable.com/appUvJyzSky12m4HA/tblje0fc5drcChsFR/viwSNFkNswHK2MyyR?blocks=hide",
          "mode": "url"
        },
        "tableId": {
          "__rl": true,
          "value": "https://airtable.com/appUvJyzSky12m4HA/tblje0fc5drcChsFR/viwSNFkNswHK2MyyR?blocks=hide",
          "mode": "url"
        },
        "triggerField": "Created time",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.airtableTrigger",
      "typeVersion": 1,
      "position": [
        -4224,
        288
      ],
      "id": "3d995895-4760-4746-86df-a2e70c5cfd77",
      "name": "On New FG Matter Upload",
      "disabled": true
    },
    {
      "parameters": {
        "base": {
          "__rl": true,
          "value": "https://airtable.com/appUvJyzSky12m4HA/tbl9NJsjg5hJRqpPx/viwImoxUDoxhhVvIx?blocks=hide",
          "mode": "url"
        },
        "table": {
          "__rl": true,
          "value": "https://airtable.com/appUvJyzSky12m4HA/tbl9NJsjg5hJRqpPx/viwImoxUDoxhhVvIx?blocks=hide",
          "mode": "url"
        },
        "id": "={{ $json.id }}",
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        -4000,
        288
      ],
      "id": "e048ea31-e880-445d-b319-4c2491bc4a95",
      "name": "Get new matter",
      "disabled": true
    },
    {
      "parameters": {
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "appUvJyzSky12m4HA",
          "mode": "list",
          "cachedResultName": "Fladgate - Leonard Live Data",
          "cachedResultUrl": "https://airtable.com/appUvJyzSky12m4HA"
        },
        "table": {
          "__rl": true,
          "value": "tblje0fc5drcChsFR",
          "mode": "list",
          "cachedResultName": "FG_Uploaded_matter_log",
          "cachedResultUrl": "https://airtable.com/appUvJyzSky12m4HA/tblje0fc5drcChsFR"
        },
        "filterByFormula": "={Email}='{{ $json.Email }}'",
        "returnAll": false,
        "limit": 1,
        "options": {
          "fields": [
            "Email",
            "Full Name",
            "First Name",
            "Date Last Updated",
            "Last Name"
          ]
        },
        "sort": {
          "property": [
            {
              "field": "Date Last Updated"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        -3552,
        176
      ],
      "id": "9ed9355f-4e9e-4fe7-b3c6-49fcc657bded",
      "name": "Search for new matter",
      "disabled": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "appUvJyzSky12m4HA",
          "mode": "list",
          "cachedResultName": "Fladgate - Leonard Live Data",
          "cachedResultUrl": "https://airtable.com/appUvJyzSky12m4HA"
        },
        "table": {
          "__rl": true,
          "value": "tbl3ADT2yOV8EJCnZ",
          "mode": "list",
          "cachedResultName": "FG - Conversation History by lawyer",
          "cachedResultUrl": "https://airtable.com/appUvJyzSky12m4HA/tbl3ADT2yOV8EJCnZ"
        },
        "filterByFormula": "={Email}='{{ $json.Email }}'",
        "returnAll": false,
        "limit": 1,
        "options": {},
        "sort": {
          "property": [
            {
              "field": "Email"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        -3328,
        176
      ],
      "id": "ca9c22fe-231e-407c-9a4e-6a78a250b153",
      "name": "Search existing matters",
      "alwaysOutputData": true,
      "disabled": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=New Matter Summary:{{ $('Set pre IF').item.json[\"New Matter Summary\"] }}\nNew Matter Extract: {{ $('Set pre IF').item.json[\"New Matter Extract\"] }}\nExisting Matter Summary: {{ $('Set pre IF').item.json[\"Existing Matter Summary\"] }}\nExisting Matter Extract: {{ $('Set pre IF').item.json[\"Existing Matter Extract\"] }}\nExisting Matter Lead Lawyer: {{ $('Set pre IF').item.json[\"Existing Matter Lead Lawyer\"] }}\nExisting Matter Client: {{ $('Set pre IF').item.json[\"Existing Matter Client\"] }}\nNew Matter Lead Lawyer: {{ $('Set pre IF').item.json[\"New Matter Lead Lawyer\"] }}\nNew Matter Client: {{ $('Set pre IF').item.json[\"New Matter Client\"] }}\nNew Matter Short Summary: {{ $('Set pre IF').item.json[\"New Matter Short Summary\"] }}\nExisting Matter Short Summary: {{ $('Set pre IF').item.json[\"Existing Matter Short Summary\"] }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=You are an expert in taking a series of summaries and facts about a legal metter and consolidating them into a single output which ia consolidated version ready to act as a knowledge base for a voice AI agent. \n\nYou should make sure to use as much detail as possible from each conversation. You should keep all structure and output in a way that ensures matters are not mixed or confused if later used by an LLM.\n\nMake sure that the new and existing matters are kept structually separate to ensure the facts are not confused between matters. \n\nKeep the total output to a digestible size for an LLM to avoid excess latency. The content will be machine only readable so make it the most effective and accurate source of information charecter for character. "
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -2656,
        -64
      ],
      "id": "c4dd8c0d-563c-439b-84b2-1163bfeaaa54",
      "name": "Matter history agent",
      "disabled": true
    },
    {
      "parameters": {
        "projectId": {
          "__rl": true,
          "value": "vertex-ai-api-setup-via-cli",
          "mode": "id"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleVertex",
      "typeVersion": 1,
      "position": [
        -992,
        272
      ],
      "id": "8992d475-dac6-44e3-a03b-4609ae957b0c",
      "name": "Google Vertex Chat Model2",
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=New Matter Summary:{{ $('Set pre IF').item.json[\"New Matter Summary\"] }}\nNew Matter Extract: {{ $('Set pre IF').item.json[\"New Matter Extract\"] }}\nExisting Matter Summary: {{ $('Set pre IF').item.json[\"Existing Matter Summary\"] }}\nExisting Matter Extract: {{ $('Set pre IF').item.json[\"Existing Matter Extract\"] }}\nExisting Matter Lead Lawyer: {{ $('Set pre IF').item.json[\"Existing Matter Lead Lawyer\"] }}\nExisting Matter Client: {{ $('Set pre IF').item.json[\"Existing Matter Client\"] }}\nNew Matter Lead Lawyer: {{ $('Set pre IF').item.json[\"New Matter Lead Lawyer\"] }}\nNew Matter Client: {{ $('Set pre IF').item.json[\"New Matter Client\"] }}\nNew Matter Short Summary: {{ $('Set pre IF').item.json[\"New Matter Short Summary\"] }}\nExisting Matter Short Summary: {{ $('Set pre IF').item.json[\"Existing Matter Short Summary\"] }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=You are an expert in extracting short and concise matter summaries from a lawyer's converation history ({{ $('Matter history agent').item.json.output }}) ready to act as a knowledge base for a voice AI agent. \n\nThe aim is to ensure the knowledge base has a comprehensive list of all matters this lawyer has worked on, with a maximum 50 words per matter. Each matter summary should include the name of the client and a brief decription of the matter.\n\nThe output should be a very concise list of matters separated by commas in a single short text stream, ranked in a weighted order of relevance with the most relevant first."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -1056,
        48
      ],
      "id": "d1181397-4393-473e-bc80-5d429138ee1b",
      "name": "Matter Extraction",
      "disabled": true
    },
    {
      "parameters": {
        "operation": "upsert",
        "base": {
          "__rl": true,
          "value": "appUvJyzSky12m4HA",
          "mode": "list",
          "cachedResultName": "Fladgate - Leonard Live Data",
          "cachedResultUrl": "https://airtable.com/appUvJyzSky12m4HA"
        },
        "table": {
          "__rl": true,
          "value": "tbl3ADT2yOV8EJCnZ",
          "mode": "list",
          "cachedResultName": "FG - Conversation History by lawyer",
          "cachedResultUrl": "https://airtable.com/appUvJyzSky12m4HA/tbl3ADT2yOV8EJCnZ"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Email": "={{ $json.fields.Email }}",
            "Previous Submissions": "={{ $json.fields[\"Matter History\"] }}"
          },
          "matchingColumns": [
            "Email"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Email",
              "displayName": "Email",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Transcript ID",
              "displayName": "Transcript ID",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Full Name",
              "displayName": "Full Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "First Name",
              "displayName": "First Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Last Name",
              "displayName": "Last Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Created",
              "displayName": "Created",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Last Modified",
              "displayName": "Last Modified",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Call Length",
              "displayName": "Call Length",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Number of Calls",
              "displayName": "Number of Calls",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Number of Matters Uploaded",
              "displayName": "Number of Matters Uploaded",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Conversation History",
              "displayName": "Conversation History",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Clients",
              "displayName": "Clients",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Matters",
              "displayName": "Matters",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Matters from prior conversations",
              "displayName": "Matters from prior conversations",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Prior Conversation History",
              "displayName": "Prior Conversation History",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Clients from prior conversations",
              "displayName": "Clients from prior conversations",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Previous Matters",
              "displayName": "Previous Matters",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Previous Clients",
              "displayName": "Previous Clients",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Previous Submissions",
              "displayName": "Previous Submissions",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        -2080,
        48
      ],
      "id": "49813638-26c9-44f8-8b19-5d8e909d49d0",
      "name": "Upload Matter History",
      "alwaysOutputData": true,
      "disabled": true
    },
    {
      "parameters": {
        "operation": "upsert",
        "base": {
          "__rl": true,
          "value": "appUvJyzSky12m4HA",
          "mode": "list",
          "cachedResultName": "Fladgate - Leonard Live Data",
          "cachedResultUrl": "https://airtable.com/appUvJyzSky12m4HA"
        },
        "table": {
          "__rl": true,
          "value": "tbl3ADT2yOV8EJCnZ",
          "mode": "list",
          "cachedResultName": "FG - Conversation History by lawyer",
          "cachedResultUrl": "https://airtable.com/appUvJyzSky12m4HA/tbl3ADT2yOV8EJCnZ"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Email": "={{ $json.fields.Email }}",
            "Previous Clients": "={{ $json.fields.Clients }}"
          },
          "matchingColumns": [
            "Email"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Email",
              "displayName": "Email",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Transcript ID",
              "displayName": "Transcript ID",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Full Name",
              "displayName": "Full Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "First Name",
              "displayName": "First Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Last Name",
              "displayName": "Last Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Created",
              "displayName": "Created",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Last Modified",
              "displayName": "Last Modified",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Conversation History",
              "displayName": "Conversation History",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Call Length",
              "displayName": "Call Length",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Number of Calls",
              "displayName": "Number of Calls",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Clients",
              "displayName": "Clients",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Matters",
              "displayName": "Matters",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Previous Matters",
              "displayName": "Previous Matters",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Previous Clients",
              "displayName": "Previous Clients",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Previous Submissions",
              "displayName": "Previous Submissions",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        -1280,
        48
      ],
      "id": "557a66c5-4375-4235-b5d9-8bb10e4f017a",
      "name": "Upload Previous Clients",
      "alwaysOutputData": true,
      "disabled": true
    },
    {
      "parameters": {
        "operation": "upsert",
        "base": {
          "__rl": true,
          "value": "appUvJyzSky12m4HA",
          "mode": "list",
          "cachedResultName": "Fladgate - Leonard Live Data",
          "cachedResultUrl": "https://airtable.com/appUvJyzSky12m4HA"
        },
        "table": {
          "__rl": true,
          "value": "tbl3ADT2yOV8EJCnZ",
          "mode": "list",
          "cachedResultName": "FG - Conversation History by lawyer",
          "cachedResultUrl": "https://airtable.com/appUvJyzSky12m4HA/tbl3ADT2yOV8EJCnZ"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Email": "={{ $json.fields.Email }}",
            "Previous Matters": "={{ $json.fields.Matters }}"
          },
          "matchingColumns": [
            "Email"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Email",
              "displayName": "Email",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Transcript ID",
              "displayName": "Transcript ID",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Full Name",
              "displayName": "Full Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "First Name",
              "displayName": "First Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Last Name",
              "displayName": "Last Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Created",
              "displayName": "Created",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Last Modified",
              "displayName": "Last Modified",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Conversation History",
              "displayName": "Conversation History",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Call Length",
              "displayName": "Call Length",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Number of Calls",
              "displayName": "Number of Calls",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Clients",
              "displayName": "Clients",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Matters",
              "displayName": "Matters",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Previous Matters",
              "displayName": "Previous Matters",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Previous Clients",
              "displayName": "Previous Clients",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Previous Submissions",
              "displayName": "Previous Submissions",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        -480,
        48
      ],
      "id": "d579cd45-055c-40a2-9987-26904b4902e4",
      "name": "Upload Previous Clients1",
      "alwaysOutputData": true,
      "disabled": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "f6051f2f-8330-4e41-84b0-26762da5732e",
              "leftValue": "={{ $json[\"Extracted Data\"].value }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            },
            {
              "id": "ffef5e9f-49fe-4f45-b997-46cb2751b650",
              "leftValue": "={{ $json[\"Extract 1\"].value }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            },
            {
              "id": "f5f94871-cdde-4311-bbf8-9aca0c934c29",
              "leftValue": "={{ $json[\"Client Name\"].value }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3776,
        192
      ],
      "id": "6159bb71-5e5f-4c70-a0f4-b44a44c357df",
      "name": "If1",
      "disabled": true
    },
    {
      "parameters": {
        "amount": 20
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -3552,
        384
      ],
      "id": "01c7229d-edd0-4195-97b2-197d9fd87d78",
      "name": "Wait",
      "webhookId": "958378e8-a463-44eb-b709-248a4758cf18",
      "disabled": true
    },
    {
      "parameters": {
        "content": "Need to build logic for single new matter vs consolodating lots of existing"
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2672,
        -240
      ],
      "typeVersion": 1,
      "id": "c5263985-a463-4802-8d2a-210f7dda2774",
      "name": "Sticky Note2",
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "fac072bc-3a1b-4c03-80e4-d068b36ec5c2",
              "name": "Email",
              "value": "={{ $('Search for new matter').item.json.Email }}",
              "type": "string"
            },
            {
              "id": "abeb6ada-a847-4ccb-b987-37e4ae4877ea",
              "name": "First Name",
              "value": "={{ $('Search for new matter').item.json[\"First Name\"] }}",
              "type": "string"
            },
            {
              "id": "7b3e5846-8258-41ed-97c3-bd46740e71a2",
              "name": "Last Name",
              "value": "={{ $('Search for new matter').item.json[\"Last Name\"] }}",
              "type": "string"
            },
            {
              "id": "17ee2a3f-b44a-408f-8e86-be4f921d1d68",
              "name": "New Matter Summary",
              "value": "={{ $('Get new matter').item.json[\"Extracted Data\"].value }}",
              "type": "string"
            },
            {
              "id": "9c70d49d-7ecc-4688-9482-00eddd0a5b85",
              "name": "New Matter Extract",
              "value": "={{ $('Get new matter').item.json[\"Extract 1\"].value }}",
              "type": "string"
            },
            {
              "id": "36a94abc-4d85-4e5f-aebf-05ea0eac73f4",
              "name": "Existing Matter Summary",
              "value": "={{ $json[\"Previous Submissions\"] }}",
              "type": "string"
            },
            {
              "id": "ba245cec-5921-46f4-93e0-78c68afe68ba",
              "name": "Existing Matter Extract",
              "value": "={{ $json[\"Previous Matters\"] }}",
              "type": "string"
            },
            {
              "id": "40e11599-fab6-4c51-a17c-1703bf605b6f",
              "name": "Existing Matter Client",
              "value": "={{ $json[\"Previous Clients\"] }}",
              "type": "string"
            },
            {
              "id": "26a6d12b-999e-4ef4-9199-845cce45e082",
              "name": "New Matter Lead Lawyer",
              "value": "={{ $('Get new matter').item.json[\"Lead Lawyer\"].value }}",
              "type": "string"
            },
            {
              "id": "3e242243-d2d2-4d3c-b024-12f4867b6c64",
              "name": "New Matter Short Summary",
              "value": "={{ $('Get new matter').item.json[\"Client Name\"].value }}",
              "type": "string"
            },
            {
              "id": "8f7d2ea3-0755-4ba4-8fce-3108d9d1e65c",
              "name": "New Matter Client",
              "value": "={{ $('Get new matter').item.json[\"Client Name\"].value }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3104,
        176
      ],
      "id": "3aaa50db-d27a-4daa-8796-e229c977f3b1",
      "name": "Set pre IF",
      "disabled": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "1cae44cb-3d7e-41ec-a0ef-4106a6f46f3f",
              "leftValue": "={{ $json.Email }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3328,
        -32
      ],
      "id": "b24d9210-f2c6-4552-aa02-6350fcaa82d4",
      "name": "If2",
      "alwaysOutputData": true,
      "disabled": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "appUvJyzSky12m4HA",
          "mode": "list",
          "cachedResultName": "Fladgate - Leonard Live Data",
          "cachedResultUrl": "https://airtable.com/appUvJyzSky12m4HA"
        },
        "table": {
          "__rl": true,
          "value": "tbl3ADT2yOV8EJCnZ",
          "mode": "list",
          "cachedResultName": "FG - Conversation History by lawyer",
          "cachedResultUrl": "https://airtable.com/appUvJyzSky12m4HA/tbl3ADT2yOV8EJCnZ"
        },
        "filterByFormula": "={Email}='{{ $json.Email }}'",
        "returnAll": false,
        "limit": 1,
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        -3552,
        -32
      ],
      "id": "b0500373-b70f-4669-9261-1c77871412f1",
      "name": "Does user exist?",
      "alwaysOutputData": true,
      "disabled": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "upsert",
        "base": {
          "__rl": true,
          "value": "appUvJyzSky12m4HA",
          "mode": "list",
          "cachedResultName": "Fladgate - Leonard Live Data",
          "cachedResultUrl": "https://airtable.com/appUvJyzSky12m4HA"
        },
        "table": {
          "__rl": true,
          "value": "tbl3ADT2yOV8EJCnZ",
          "mode": "list",
          "cachedResultName": "FG - Conversation History by lawyer",
          "cachedResultUrl": "https://airtable.com/appUvJyzSky12m4HA/tbl3ADT2yOV8EJCnZ"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Email": "={{ $('Get new matter').item.json.Email }}",
            "Number of Matters Uploaded": 1,
            "Matters from prior conversations": ".",
            "Prior Conversation History": ".",
            "Clients from prior conversations": ".",
            "Previous Matters": ".",
            "Previous Clients": ".",
            "Previous Submissions": ".",
            "Last Name": "={{ $('Get new matter').item.json[\"Last Name\"] }}",
            "First Name": "={{ $('Get new matter').item.json[\"First Name\"] }}"
          },
          "matchingColumns": [
            "Email"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Email",
              "displayName": "Email",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Transcript ID",
              "displayName": "Transcript ID",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Full Name",
              "displayName": "Full Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "First Name",
              "displayName": "First Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Last Name",
              "displayName": "Last Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Created",
              "displayName": "Created",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Last Modified",
              "displayName": "Last Modified",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Call Length",
              "displayName": "Call Length",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Number of Calls",
              "displayName": "Number of Calls",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Number of Matters Uploaded",
              "displayName": "Number of Matters Uploaded",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Conversation History",
              "displayName": "Conversation History",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Clients",
              "displayName": "Clients",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Matters",
              "displayName": "Matters",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Matters from prior conversations",
              "displayName": "Matters from prior conversations",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Prior Conversation History",
              "displayName": "Prior Conversation History",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Clients from prior conversations",
              "displayName": "Clients from prior conversations",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Previous Matters",
              "displayName": "Previous Matters",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Previous Clients",
              "displayName": "Previous Clients",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Previous Submissions",
              "displayName": "Previous Submissions",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        -3104,
        -32
      ],
      "id": "aa0bfcf5-6079-493c-a0de-4fe9e11936ea",
      "name": "Upload Matter History1",
      "alwaysOutputData": true,
      "disabled": true
    }
  ],
  "connections": {
    "If": {
      "main": [
        [
          {
            "node": "Matter history agent",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Create new conv summary",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Vertex Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "Matter history agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Vertex Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Client Extraction",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Client Extraction": {
      "main": [
        [
          {
            "node": "Create new conv summary2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create new conv summary2": {
      "main": [
        [
          {
            "node": "Upload Previous Clients",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create new summary for new conv": {
      "main": [
        [
          {
            "node": "Upload Matter History",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "On New FG Matter Upload": {
      "main": [
        [
          {
            "node": "Get new matter",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get new matter": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search for new matter": {
      "main": [
        [
          {
            "node": "Search existing matters",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search existing matters": {
      "main": [
        [
          {
            "node": "Set pre IF",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Matter history agent": {
      "main": [
        [
          {
            "node": "Create new summary for new conv",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Vertex Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "Matter Extraction",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Matter Extraction": {
      "main": [
        [
          {
            "node": "Create new conv summary3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload Matter History": {
      "main": [
        [
          {
            "node": "Client Extraction",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload Previous Clients": {
      "main": [
        [
          {
            "node": "Matter Extraction",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create new conv summary3": {
      "main": [
        [
          {
            "node": "Upload Previous Clients1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Search for new matter",
            "type": "main",
            "index": 0
          },
          {
            "node": "Does user exist?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Get new matter",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set pre IF": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Does user exist?": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [],
        [
          {
            "node": "Upload Matter History1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "any",
    "executionTimeout": 300,
    "availableInMCP": false,
    "errorWorkflow": "nSr5syzpgcboR5Da"
  },
  "staticData": {
    "node:On New FG Conversation": {
      "lastTimeChecked": "2025-11-14T19:43:21Z"
    },
    "node:On New FG Matter Upload": {
      "lastTimeChecked": "2026-01-17T17:07:26Z"
    }
  },
  "pinData": {
    "Get new matter": [
      {
        "json": {
          "id": "recv3Lo2ACvi8cwdm",
          "createdTime": "2025-11-24T08:30:21.000Z",
          "Full Name": "Lee Curtis",
          "Last Name": "Curtis",
          "First Name": "Lee",
          "Email": "lee@legalengine.co.uk",
          "Date Last Updated": "2025-11-24T08:33:27.000Z",
          "Date Modified by": {
            "id": "usrAISERVICE00000",
            "email": "aiassist@noreply.airtable.com",
            "name": "AI"
          },
          "Created by": {
            "id": "usrPAGESHARE00000",
            "email": "anonymous+formpage@noreply.airtable.com",
            "name": "Anonymous"
          },
          "Created time": "2025-11-24T08:30:21.000Z",
          "MD - Is Confidential": {
            "state": "error",
            "errorType": "emptyDependency",
            "value": null,
            "isStale": false
          },
          "Last Modified": "2025-11-24T08:33:27.000Z",
          "Attachments": [
            {
              "id": "attxDZfOlDwM16u1n",
              "url": "https://v5.airtableusercontent.com/v3/e/47/47/1763985600000/iXmDEbU0NODjOTVGsMPmSQ/N6lhXIE0e7JKlwc6YOj7VKabv9TGIzTDdBQ1CxIywJEpbYurMcWW6uS2GCcCWyDJ8HXTAYjPjgELXOU_7zHq38yy8f-8IYyRFcWddCrfnKm-H5bJSd0DFsIwed5BEC7qsRGoGVSfaTfd_VMb9lYmOliILy1aeQ08T_06rllo18dQUQPfajUYWe64fiRdln4uXCea-Zvi4V3kywav0YiMJZ0riq61El5uilHbK5bYCGw/dgSsQBUiShGI-XB6V1lo5I46rCMVhFJTJgA5RurKEx0",
              "filename": "FINAL Fladgate Family-Matrimonial Finance 2027 - Hetty Leonard M_520686_17.docx",
              "size": 72690,
              "type": "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
              "thumbnails": {
                "small": {
                  "url": "https://v5.airtableusercontent.com/v3/e/47/47/1763985600000/So9hMGpWof1I5yqlj4GO1A/bGesGtiHDHCt18XkIQGlw8AZTW1iJtsOtEyl5emL79qJjcsheVjkjQpABrOK4SqazZAg0JSDFegLmwq4YooiLYLpSTPYFlsuGwE4f_LYELVP9mcOKiYh1vd4Y6Sc-9MJlWM1_t3_LwthG-9aHjJfYg/fLqeP6bS4ubHjlQSxKjfxJKiyJIsNOmWeYtrXhSgQK4",
                  "width": 25,
                  "height": 35
                },
                "large": {
                  "url": "https://v5.airtableusercontent.com/v3/e/47/47/1763985600000/YuDkqkaZBDT_0wzI0iekWw/y9rjgPI6ci79J3LmQqxtBV28mmwef2kbIe9JvnR5vyhalqYt1uwnnKFkQ7I1DPsdgLfY3rV6ZynDQse4al00TNYTMa-vPC8DhNPonw5L2TBMRyp2y98QjBJNFLFL315IGhYnsdkqEmVjWnP53Ddf0w/EiYtWhvEDfR1poJSPpndboeZ0IMvd54eODTXfd779gc",
                  "width": 512,
                  "height": 724
                }
              }
            }
          ],
          "Summary (Attachments)": {
            "state": "empty",
            "value": null,
            "isStale": true
          },
          "Title (Attachments)": {
            "state": "empty",
            "value": null,
            "isStale": true
          },
          "Extracted Data": {
            "state": "generated",
            "value": "- Matter reference and title: PAM007; Confidential Matter 17.\n- Client: Wife/Hotelier whose husband transitioned from male to female during the proceedings.\n- Overview and department role/importance: Acting for W in divorce and financial proceedings after a 20-year marriage; novel issue on whether matrimonial funds can be used for Hs transitioning costs during the divorce. Assets span the UK, Italy, USA, Switzerland, Germany, Argentina, and Morocco, including a Moroccan hotel business.\n- Key issues:\n  - Forum: H commenced parallel divorce proceedings in Italy.\n  - Interim maintenance, disclosure, valuations (including impact of the Moroccan earthquake on the hotel), and classification of matrimonial vs nonmatrimonial assets.\n- Key disputed positions:\n  - H disputes Ws entitlement to her fair share, asserting he created most family wealth.\n  - H claims entitlement to use matrimonial funds for transitioning; dispute over whether surgery is imperative or elective.\n- Opponent conduct and applications/orders:\n  - Refused to comply with interim maintenance orders; Ws enforcement succeeded and punitive costs were awarded against H.\n  - Refused to contribute to Ws legal expenses.\n  - Issued Italian divorce to run concurrently; Italian court dismissed for lack of jurisdiction and awarded W costs.\n  - Sold company shares and reinvested proceeds without consent; Freezing Order over net proceeds granted after a contested hearing; H is appealing.\n  - Profligate spending increased liabilities; extent and nature of liabilities in issue.\n  - Nondisclosure of US land interests discovered prior to the PTR.\n- Status and forthcoming steps: Approaching final hearing; parties cannot agree the asset schedule for division. Judicial intervention already required on transitioning costs; further transitioning costs may be argued at trial as a niche point of law.\n- Matter value: 34 million.\n- Crossborder elements: Jurisdictions include Italy, Switzerland, US, Germany, Argentina, Morocco; assets/business footprint also includes the UK and a hotel in Morocco.\n- Team:\n  - Lead lawyer: Hetty Gleave (Partner, Fladgate).\n  - Other team members: Patrick Buck (Associate), Isabelle McGregor (Trainee).\n- Other advisers and roles:\n  - Adverse: Susan Apthorp, Keystone Law.\n  - Counsel: Alexis Campbell KC (Band 2), Simon Calhaem (Band 3), Laura Heaton (Band 2)  29 Bedford Row.\n  - For our client (Italian law): Michele Menato, B&M Law.\n- Completion status: Ongoing.\n- Other information (press/links): Not provided.",
            "isStale": false
          },
          "Matter Summary": {
            "state": "generated",
            "value": "Cross-border divorce finance case: gender transition funding, asset freezing, forum disputes, enforcement; assets worth 34m.",
            "isStale": false
          },
          "Client Name": {
            "state": "generated",
            "value": "The client is described as \"Wife (W),\" a wife/hotelier whose husband transitioned from male to female during the proceedings. The matter is confidential, so the high-level client description \"Wife (W)\" is used rather than a personal name.",
            "isStale": false
          },
          "Lead Lawyer": {
            "state": "generated",
            "value": "Hetty Gleave",
            "isStale": false
          },
          "Multiple Matters": {
            "state": "generated",
            "value": "No. It contains only one matter with a single E1 section and no D1/E1 duplication.",
            "isStale": false
          },
          "How Many Matters?": {
            "state": "generated",
            "value": "1",
            "isStale": false
          },
          "Extract 1": {
            "state": "generated",
            "value": "# Confidential Matter 17\nRef: PAM007\n\n## E1 Name of client (for ranking purposes only)\nWife/Hotelier whose husband transitioned from male to female during the proceedings\n\n## E2 Summary of matter and your department's role - Please say why this matter was important. Also, tell us exactly what role your department played\nThis case has raised novel areas of law in relation to the treatment of family assets when acting for a party who requires funds to transition from male to female during the divorce process. We are acting for a wife (W) in divorce and financial proceedings who has been married to her husband (H) for 20 years. The marriage broke down when W was told by H that they wish to transition to a lesbian trans woman. The parties have multiple properties/land which span the globe, including the UK, Italy, USA, Switzerland, Germany, Argentina, Morocco, as well as a hotel business in Morocco.\n\nWhilst the matter is complicated by the number of foreign jurisdictions involved, the matter is further complicated by the fact that H does not believe that our client is entitled to her 'fair share' of the matrimonial pot on the basis he believes he has earned most of the family wealth. H also believes they are entitled to use matrimonial funds for the purpose of transitioning during the divorce process, triggering arguments about whether it was imperative or elective surgery.\n\nThe matter has raised several issues, ranging from the correct forum for the proceedings (the husband immediately commenced parallel proceedings in Italy) interim maintenance, disclosure, valuations, particularly in relation to their hotel in Morocco following the recent earthquake, and the nature of matrimonial and non-matrimonial assets.\n\nH has sought to run our client's finances into the ground by:\n\n1. Refusing to comply with orders for interim maintenance on the basis he had no income, which was demonstrably untrue, requiring the client to issue enforcement proceedings which were successful and resulted in punitive costs orders against H.\n2. Refusing to make any contribution towards our client's legal expenses.\n3. Issuing proceedings for divorce in Italy to run concurrently with the UK proceedings, even though H had submitted to the UK jurisdiction in order to drain our client of cash. The Italian court has recently determined they have no jurisdiction and dismissed the application in Italy and awarded our client costs.\n4. Selling shares in a company and reinvesting some of the proceeds without our client's knowledge or consent, which forced her to apply for a Freezing Order in relation to the net proceeds, which was made following a bitterly fought hearing. H is now appealing the Freezing Order.\n5. H's profligate spending which has significantly increased liabilities and so the nature and extent of those liabilities is in question.\n6. H's non-disclosure of land interests in the US, which have only become apparent prior to the PTR.\n\nThe matter is coming up to a final hearing as the parties have been unable to agree the assets schedule which enables them to agree the accurate division of matrimonial assets. Whether the costs associated with the H's transitioning to female during the proceedings should be paid from the known matrimonial assets was a novel point which required judicial intervention to resolve. It may be that further costs associated with transitioning will form part of the husband's argument at trial and debate about how they are paid for will be a niche point of law.\n\n## E3 Matter value - include currency and amount in figures\n3-4 million\n\n## E4 Is this a cross-border matter? If yes, please indicate the jurisdictions involved.\nItaly, Switzerland, US, Germany, Argentina, Morocco\n\nRef: PAM007\n\n## E5E9\n\n| Field | Details |\n|---|---|\n| E5 Lead lawyer | Hetty Gleave (Partner, Fladgate) |\n| E6 Other team members | Patrick Buck (Associate, Fladgate); Isabelle McGregor (Trainee, Fladgate) |\n| E7 Other firms advising on the matter and their role(s) | Susan Apthorp, Keystone Law (adverse); Alexis Campbell KC, (Band 2 Family: Matrimonial Finance), Simon Calhaem (Band 3 Family: Matrimonial Finance), Laura Heaton (Band 2 Family: Matrimonial Finance) - 29 Beford Row; Michele Menato, B&M Law (Italian law advice for our client) |\n| E8 Date of completion or current status | Ongoing |\n| E9 Other information about this matter - e.g. link to press coverage |  |\n\nRef: PAM007",
            "isStale": false
          },
          "Extract 2": {
            "state": "empty",
            "value": null,
            "isStale": true
          },
          "Extract 3": {
            "state": "empty",
            "value": null,
            "isStale": true
          },
          "Extract 4": {
            "state": "empty",
            "value": null,
            "isStale": true
          }
        }
      }
    ]
  },
  "triggerCount": 1,
  "meta": null
}