{
  "name": "DEV - CMO Contact Search - Owner Andy",
  "nodes": [
    {
      "parameters": {},
      "id": "a405f12b-ba05-4423-a591-8e808299b4e1",
      "name": "When clicking Test workflow1",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -1808,
        1264
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "e7d1318a-3492-4071-b354-c3297ef405a5",
      "name": "Loop Over Emails",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -896,
        1264
      ]
    },
    {
      "parameters": {
        "jsCode": "const inputDate = new Date($input.first().json.currentDate); // replace with actual field name\n\nconst formattedDate = `${inputDate.getMonth() + 1}/${inputDate.getDate()}/${inputDate.getFullYear()}`;\n\nreturn [\n  {\n    json: {\n      formattedDate\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1440,
        1264
      ],
      "id": "7371aa1e-fa46-46e5-ab9b-aaa79bf913e7",
      "name": "Date Format1"
    },
    {
      "parameters": {
        "jsCode": "let content = $json.choices[0].message.content;\n\n// Clean the Markdown formatting\ncontent = content.replace(/```json|```/g, '').trim();\n\nlet parsed;\n\n// Try parsing the content safely\ntry {\n  parsed = JSON.parse(content);\n} catch (error) {\n  parsed = { message: \"No info found\" };\n}\n\n// Check if all values in the expected structure are null, empty arrays, or empty strings\nconst hasUsefulData = Object.values(parsed).some(value => {\n  if (value === null || value === \"\" || (Array.isArray(value) && value.length === 0)) return false;\n  if (typeof value === \"object\" && !Array.isArray(value)) {\n    // Check nested objects (like `rankings`)\n    return Object.values(value).some(sub => {\n      if (typeof sub === \"object\") {\n        return Object.values(sub).some(v => v !== null && v !== \"\");\n      }\n      return sub !== null && sub !== \"\";\n    });\n  }\n  return true;\n});\n\nif (!hasUsefulData) {\n  parsed = { message: \"No info found\" };\n}\n\n// Return a single flat object instead of an array\nreturn parsed;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        144,
        1312
      ],
      "id": "40c69bb9-c8d5-4fc1-9496-ea8e9f5d4d7a",
      "name": "PP Flattening2",
      "disabled": true
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.dateTime",
      "typeVersion": 2,
      "position": [
        -1600,
        1264
      ],
      "id": "1c0ea9fd-7ba6-437e-9394-afc227839963",
      "name": "Date & Time"
    },
    {
      "parameters": {
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "https://airtable.com/appnbpO20uWlcjTf5/tbl0FYAZn2gLFuD4F/viwUXIUqswTOTz16b?blocks=hide",
          "mode": "url"
        },
        "table": {
          "__rl": true,
          "value": "https://airtable.com/appnbpO20uWlcjTf5/tbl0FYAZn2gLFuD4F/viwUXIUqswTOTz16b?blocks=hide",
          "mode": "url"
        },
        "options": {},
        "sort": {
          "property": [
            {
              "field": "Implied Firm Name"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        -1200,
        1264
      ],
      "id": "bf8c3898-003e-4df8-9aff-27d20f00fb77",
      "name": "Airtable Source",
      "credentials": {
        "airtableTokenApi": {
          "id": "LVF892xkQD72QD7v",
          "name": "Airtable - Leonard @ Legal Engine"
        }
      }
    },
    {
      "parameters": {
        "operation": "upsert",
        "base": {
          "__rl": true,
          "value": "https://airtable.com/appnbpO20uWlcjTf5/tbl0FYAZn2gLFuD4F/viwUXIUqswTOTz16b?blocks=hide",
          "mode": "url"
        },
        "table": {
          "__rl": true,
          "value": "https://airtable.com/appnbpO20uWlcjTf5/tbl0FYAZn2gLFuD4F/viwUXIUqswTOTz16b?blocks=hide",
          "mode": "url"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [
            "Company Name"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": false
            },
            {
              "id": "Company Name",
              "displayName": "Company Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Company Domain",
              "displayName": "Company Domain",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Company Website PP",
              "displayName": "Company Website PP",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "CMO",
              "displayName": "CMO",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Head of Busniess Development",
              "displayName": "Head of Busniess Development",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "COO",
              "displayName": "COO",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        304,
        1312
      ],
      "id": "e12a07a2-7061-49df-bd46-2b00f2e569bc",
      "name": "Airtable Write",
      "credentials": {
        "airtableTokenApi": {
          "id": "LVF892xkQD72QD7v",
          "name": "Airtable - Leonard @ Legal Engine"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "69676b6c-2bf4-4312-b916-4316c66421a8",
              "leftValue": "={{ $json.error.message }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -336,
        1008
      ],
      "id": "e90f749e-27e1-4e5c-b723-97bde02ca921",
      "name": "If"
    },
    {
      "parameters": {
        "jsCode": "let content = $json.choices?.[0]?.message?.content || \"\";\n\n// Remove Markdown JSON fences and trim whitespace\ncontent = content.replace(/```(?:json)?/g, '').trim();\n\nlet parsed;\n\n// Try parsing the content safely\ntry {\n  parsed = JSON.parse(content);\n} catch (error) {\n  parsed = { message: \"No info found\" };\n}\n\n// Helper function to recursively check if an object has useful data\nfunction hasUsefulData(obj) {\n  if (obj === null || obj === \"\" || (Array.isArray(obj) && obj.length === 0)) return false;\n\n  if (typeof obj === \"object\" && !Array.isArray(obj)) {\n    return Object.values(obj).some(value => hasUsefulData(value));\n  }\n\n  return true;\n}\n\n// Validate the parsed content\nif (!hasUsefulData(parsed)) {\n  parsed = { message: \"No info found\" };\n}\n\n// Flatten the structure if necessary (avoid arrays)\nif (Array.isArray(parsed)) {\n  parsed = parsed[0] || { message: \"No info found\" };\n}\n\n// Return as a single flat object\nreturn parsed;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        144,
        1008
      ],
      "id": "394da3f1-f4ad-4743-9432-8e0178510fa6",
      "name": "PP Flattening"
    },
    {
      "parameters": {
        "operation": "upsert",
        "base": {
          "__rl": true,
          "value": "https://airtable.com/appnbpO20uWlcjTf5/tbl0FYAZn2gLFuD4F/viwUXIUqswTOTz16b?blocks=hide",
          "mode": "url"
        },
        "table": {
          "__rl": true,
          "value": "https://airtable.com/appnbpO20uWlcjTf5/tbl0FYAZn2gLFuD4F/viwUXIUqswTOTz16b?blocks=hide",
          "mode": "url"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Company Name": "={{ $('Airtable Source').item.json[\"Company Name\"] }}",
            "COO Name": "={{ $json.name }}",
            "COO JD": "={{ $json.role }}",
            "COO Email": "={{ $json.email }}"
          },
          "matchingColumns": [
            "Company Name"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Company Name",
              "displayName": "Company Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Company Domain",
              "displayName": "Company Domain",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Company Website PP",
              "displayName": "Company Website PP",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Implied Firm Name",
              "displayName": "Implied Firm Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "DM1",
              "displayName": "DM1",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "DM1 Email",
              "displayName": "DM1 Email",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "DM1 JT",
              "displayName": "DM1 JT",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "DM1 Relevance",
              "displayName": "DM1 Relevance",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "DM1 Linkedin",
              "displayName": "DM1 Linkedin",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "DM2",
              "displayName": "DM2",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "DM2 Email",
              "displayName": "DM2 Email",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "DM2 JT",
              "displayName": "DM2 JT",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "DM2 Relevance",
              "displayName": "DM2 Relevance",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "DM2 Linkedin",
              "displayName": "DM2 Linkedin",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "DM3",
              "displayName": "DM3",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "DM3 EMail",
              "displayName": "DM3 EMail",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "DM3 JT",
              "displayName": "DM3 JT",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "DM3 Relevance",
              "displayName": "DM3 Relevance",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "DM3 Linkedin",
              "displayName": "DM3 Linkedin",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "DM4",
              "displayName": "DM4",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "DM4 EMail",
              "displayName": "DM4 EMail",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "DM4 JT",
              "displayName": "DM4 JT",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "DM4 Relevance",
              "displayName": "DM4 Relevance",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "DM4 Linkedin",
              "displayName": "DM4 Linkedin",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "DM5",
              "displayName": "DM5",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "DM5 EMail",
              "displayName": "DM5 EMail",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "DM5 JT",
              "displayName": "DM5 JT",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "DM5 Relevance",
              "displayName": "DM5 Relevance",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "DM5 Linkedin",
              "displayName": "DM5 Linkedin",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Marketing Lead",
              "displayName": "Marketing Lead",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Marketing Lead EMail",
              "displayName": "Marketing Lead EMail",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Marketing Lead JT",
              "displayName": "Marketing Lead JT",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "COO Name",
              "displayName": "COO Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "COO JD",
              "displayName": "COO JD",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "COO Email",
              "displayName": "COO Email",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "COO Justification",
              "displayName": "COO Justification",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Linkedin",
              "displayName": "Linkedin",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Source",
              "displayName": "Source",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        304,
        1008
      ],
      "id": "ac9fd9ab-1804-4708-b310-351df78c706f",
      "name": "Airtable Write1",
      "credentials": {
        "airtableTokenApi": {
          "id": "LVF892xkQD72QD7v",
          "name": "Airtable - Leonard @ Legal Engine"
        }
      }
    },
    {
      "parameters": {
        "operation": "upsert",
        "base": {
          "__rl": true,
          "value": "appnbpO20uWlcjTf5",
          "mode": "list",
          "cachedResultName": "Legal Document Automation",
          "cachedResultUrl": "https://airtable.com/appnbpO20uWlcjTf5"
        },
        "table": {
          "__rl": true,
          "value": "tblSST6CxAGR7PBlw",
          "mode": "list",
          "cachedResultName": "TEST - Clients from Ch Scrape",
          "cachedResultUrl": "https://airtable.com/appnbpO20uWlcjTf5/tblSST6CxAGR7PBlw"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Client Name": "={{ $('Airtable Source').item.json[\"Client Name\"] }}",
            "Company Name": "={{ $json.actualCompanyName }}",
            "Address": "={{ $json.location }}",
            "Practice Area": "={{ $('Airtable Source').item.json[\"Practice Area\"] }}",
            "LinkedIn Profile": "={{ $json.bio }}",
            "Chambers Ranking": "={{ $json.rankings.chambers.ranking }}",
            "Legal 500 Ranking": "={{ $json.rankings.legal500.ranking }}",
            "Job Title": "={{ $json.jobTitle }}",
            "Full Name (PP Search)": "={{ $json.fullName }}",
            "Date Joined": "={{ $('Date Format1').item.json.formattedDate }}",
            "Phone Number": "={{ $json.telephone }}",
            "Relevant Experience Clients 1": "={{ $json.expertiseClients[0] }}",
            "Relevant Experience Indiv 1": "={{ $json.expertiseIndividuals[0] }}",
            "Relevant Experience Indiv 2": "={{ $json.expertiseIndividuals[1] }}",
            "Relevant Experience Clients 2": "={{ $json.expertiseClients[1] }}",
            "Relevant Experience Clients 3": "={{ $json.expertiseClients[2] }}",
            "Relevant Experience Clients 4": "={{ $json.expertiseClients[3] }}",
            "Relevant Experience Clients 5": "={{ $json.expertiseClients[4] }}",
            "Relevant Experience Indiv 3": "={{ $json.expertiseIndividuals[2] }}",
            "Relevant Experience Indiv 4": "={{ $json.expertiseIndividuals[3] }}",
            "Relevant Experience Indiv 5": "={{ $json.expertiseIndividuals[4] }}",
            "Publications and Insight 1": "={{ $json.publicationsAndInsights[0] }}",
            "Publications and Insight 2": "={{ $json.publicationsAndInsights[1] }}",
            "News and Client Work 1": "={{ $json.newsAndClientWork[0] }}",
            "News and Client Work 2": "={{ $json.newsAndClientWork[1] }}",
            "Award 1": "={{ $json.awards[0] }}",
            "Award 2": "={{ $json.awards[1] }}",
            "Contact Email": "={{ $json.email }}",
            "id": "={{ $('Airtable Source').item.json.id }}",
            "Practice Area 2": "={{ $json.practiceAreas[1] }}",
            "Practice Area 3": "={{ $json.practiceAreas[2] }}",
            "Practice Area 4": "={{ $json.practiceAreas[3] }}",
            "Practice Area 1": "={{ $json.practiceAreas[0] }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": false
            },
            {
              "id": "Client Name",
              "displayName": "Client Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Contact Email",
              "displayName": "Contact Email",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Phone Number",
              "displayName": "Phone Number",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Address",
              "displayName": "Address",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Company Name",
              "displayName": "Company Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Preferred Contact Method",
              "displayName": "Preferred Contact Method",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "Email",
                  "value": "Email"
                },
                {
                  "name": "Phone",
                  "value": "Phone"
                },
                {
                  "name": "Mail",
                  "value": "Mail"
                }
              ],
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Associated Documents",
              "displayName": "Associated Documents",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "array",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Profile Picture",
              "displayName": "Profile Picture",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "array",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Date Joined",
              "displayName": "Date Joined",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Account Status",
              "displayName": "Account Status",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "Active",
                  "value": "Active"
                },
                {
                  "name": "Inactive",
                  "value": "Inactive"
                },
                {
                  "name": "Pending",
                  "value": "Pending"
                }
              ],
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Matters",
              "displayName": "Matters",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "array",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Practice Area",
              "displayName": "Practice Area",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Practice Area 1",
              "displayName": "Practice Area 1",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Practice Area 2",
              "displayName": "Practice Area 2",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Practice Area 3",
              "displayName": "Practice Area 3",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Practice Area 4",
              "displayName": "Practice Area 4",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "LinkedIn Profile",
              "displayName": "LinkedIn Profile",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Relevant Experience Clients 1",
              "displayName": "Relevant Experience Clients 1",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Relevant Experience Clients 2",
              "displayName": "Relevant Experience Clients 2",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Relevant Experience Clients 3",
              "displayName": "Relevant Experience Clients 3",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Relevant Experience Clients 4",
              "displayName": "Relevant Experience Clients 4",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Relevant Experience Clients 5",
              "displayName": "Relevant Experience Clients 5",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Relevant Experience Indiv 1",
              "displayName": "Relevant Experience Indiv 1",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Relevant Experience Indiv 2",
              "displayName": "Relevant Experience Indiv 2",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Relevant Experience Indiv 3",
              "displayName": "Relevant Experience Indiv 3",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Relevant Experience Indiv 4",
              "displayName": "Relevant Experience Indiv 4",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Relevant Experience Indiv 5",
              "displayName": "Relevant Experience Indiv 5",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Publications and Insight 1",
              "displayName": "Publications and Insight 1",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Publications and Insight 2",
              "displayName": "Publications and Insight 2",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "News and Client Work 1",
              "displayName": "News and Client Work 1",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "News and Client Work 2",
              "displayName": "News and Client Work 2",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Legal 500 Ranking",
              "displayName": "Legal 500 Ranking",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Chambers Ranking",
              "displayName": "Chambers Ranking",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Job Title",
              "displayName": "Job Title",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Full Name (PP Search)",
              "displayName": "Full Name (PP Search)",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Expertise Sectors 1",
              "displayName": "Expertise Sectors 1",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Expertise Sectors 2",
              "displayName": "Expertise Sectors 2",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Expertise Sectors 3",
              "displayName": "Expertise Sectors 3",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Expertise Sectors 4",
              "displayName": "Expertise Sectors 4",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Expertise Sectors 5",
              "displayName": "Expertise Sectors 5",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Expertise Services 1",
              "displayName": "Expertise Services 1",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Expertise Services 2",
              "displayName": "Expertise Services 2",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Expertise Services 3",
              "displayName": "Expertise Services 3",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Expertise Services 4",
              "displayName": "Expertise Services 4",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Expertise Services 5",
              "displayName": "Expertise Services 5",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Award 1",
              "displayName": "Award 1",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Award 2",
              "displayName": "Award 2",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Chambers Band",
              "displayName": "Chambers Band",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Chambers Link",
              "displayName": "Chambers Link",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Company Domain",
              "displayName": "Company Domain",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        336,
        736
      ],
      "id": "8b823ce5-9abf-481b-a7ba-d73d50e779a9",
      "name": "Airtable Write2",
      "credentials": {
        "airtableTokenApi": {
          "id": "LVF892xkQD72QD7v",
          "name": "Airtable - Leonard @ Legal Engine"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.perplexity.ai/chat/completions",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"model\": \"sonar\",\n  \"messages\": [\n    {\n      \"role\": \"system\",\n      \"content\": \"Act as an elite business intelligence analyst for the UK legal sector. Your goal is to return the single most likely operational decision maker at the specified law firm. Output must contain exactly three fields. name, role, email. Use reputable open sources only. Avoid conjecture. If you cannot verify confidently, return 'no info'.\\n\\nRobust search protocol.\\n1) Normalise the firm identity. Resolve brand variants, mergers, trading names, LLP vs Ltd, and the primary legal website. Prefer the firm's leadership pages for confirmation.\\n2) Collect candidates from required sources. Use the firm's site, professional profiles, legal directories, reputable industry databases, legal publications, professional bodies, regional law societies, awards and events pages, and credible press wires. Use at least two independent sources to corroborate title and current employment. One source should be the firm site or a recent press release when available.\\n3) Title taxonomy and priority. Highest. Chief Operating Officer or Chief Administrative Officer. High. Operations Director, Director of Operations, Head of Operations, Director or Head of Business Services. Medium. Managing Director Operations, Director of Administration, General Manager with firm wide remit. Lower. Operations Manager only when no higher operations role exists and they clearly own firm wide operations.\\n4) Exclusions. Do not select roles that are primarily BD or Marketing. Do not select CIO, CTO, IT Director, Facilities only, single office managers, or leaders of unrelated subsidiaries.\\n5) Recency checks. Confirm the person is current within the last 3 months. Prefer dated sources. If LinkedIn is the only dated source, require a second corroborating source naming the role.\\n6) Disambiguation rules. If multiple candidates exist, pick the highest title by the taxonomy. If titles are equal, pick the one with firm wide remit. If still tied, pick the most recently confirmed. If still tied, pick the longest tenured in operations leadership.\\n7) Email rules. Only provide an email if explicitly published on the firm site, press release, PDF, vCard, or a reputable directory that lists individual firm emails. Alternatively infer from a verified pattern demonstrated by at least one published example from the same firm domain. If no verified pattern, return 'no info'. Never guess.\\n8) Geographic scope. If the firm is global, a Global COO outranks a regional COO. If only regional COOs exist, prefer UK wide over single office.\\n\\nOutput rules. Return only the three fields as a flat JSON object. Never include markdown, commentary, or extra fields. Use 'no info' when a value cannot be verified after following the protocol.\"\n    },\n    {\n      \"role\": \"user\",\n      \"content\": \"Firm input.\\n- Name. {{ $('Airtable Source').item.json['Company Name'] }}\\n- Company Domain. {{ $json['Company Domain'] }}\\n- Company Website. {{ $json['Company Website PP'] }}\\n\\nTasks.\\n1) Identify the single most senior operations leader using the protocol. 2) Verify recency and remit. 3) Provide email only if published or pattern verified as described.\\n\\nReturn only this JSON object.\\n{\\n  \\\"name\\\": \\\"string or 'no info'\\\",\\n  \\\"role\\\": \\\"string or 'no info'\\\",\\n  \\\"email\\\": \\\"string or 'no info'\\\"\\n}\"\n    }\n  ],\n  \"max_tokens\": 1400,\n  \"temperature\": 0.0,\n  \"top_p\": 0.3,\n  \"presence_penalty\": 0,\n  \"frequency_penalty\": 0,\n  \"search_recency_filter\": \"year\",\n  \"search_domain_filter\": [\n    \"linkedin.com\",\n    \"legal500.com\",\n    \"chambers.com\",\n    \"companieshouse.gov.uk\",\n    \"find-and-update.company-information.service.gov.uk\",\n    \"thelawyer.com\",\n    \"law.com\",\n    \"lawgazette.co.uk\",\n    \"lawsociety.org.uk\",\n    \"lawsoc-ni.org\",\n    \"lawscot.org.uk\",\n    \"manchesterlawsociety.org.uk\",\n    \"birminghamlawsociety.co.uk\",\n    \"bristollawsociety.com\",\n    \"liverpoollawsociety.org.uk\",\n    \"edinburghlawsoc.org.uk\",\n    \"rollonfriday.com\",\n    \"legalcheek.com\",\n    \"legalbusiness.co.uk\",\n    \"thelawyerawards.com\",\n    \"legalbusinessawards.com\",\n    \"britishlegalawards.com\",\n    \"whoownslaw.com\",\n    \"whoswholegal.com\",\n    \"bestlawyers.com\",\n    \"leadersleague.com\",\n    \"iflr1000.com\",\n    \"psmg.co.uk\",\n    \"netlawmedia.com\",\n    \"britishlegalitforum.com\",\n    \"glocalthoughtleaders.com\",\n    \"ark-group.com\",\n    \"alternativeevents.co.uk\",\n    \"lpm-magazine.co.uk\",\n    \"solicitorsjournal.com\",\n    \"newlawjournal.co.uk\",\n    \"globallegalpost.com\",\n    \"cityam.com\",\n    \"ft.com\",\n    \"bloomberglaw.com\",\n    \"reuters.com\",\n    \"pressreleases.responsesource.com\",\n    \"businesswire.com\",\n    \"prnewswire.com\",\n    \"globenewswire.com\",\n    \"professionalservicesmarketing.co.uk\",\n    \"managingpartnersforum.com\",\n    \"ala-net.org\",\n    \"iltanet.org\",\n    \"uklta.org.uk\",\n    \"cilex.org.uk\",\n    \"icaew.com\",\n    \"acenet.co.uk\",\n    \"rocketreach.co\",\n    \"zoominfo.com\",\n    \"apollo.io\",\n    \"boardex.com\",\n    \"hunter.io\",\n    \"hsfnotes.com\",\n    \"mondaq.com\",\n    \"lexology.com\",\n    \"jdsupra.com\",\n    \"law360.com\",\n    \"lawcareers.net\",\n    \"eventbrite.co.uk\",\n    \"meetup.com\",\n    \"speakerbureau.com\",\n    \"yumpu.com\",\n    \"issuu.com\",\n    \"scribd.com\",\n    \"slideshare.net\",\n    \"researchgate.net\",\n    \"medium.com\",\n    \"x.com\",\n    \"youtube.com\",\n    \"vimeo.com\"\n  ]\n}\n",
        "options": {}
      },
      "id": "3bdbf5a2-4c6b-4fe9-aa30-691bf9c500b7",
      "name": "Perplexity LinkedIn",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -608,
        992
      ],
      "typeVersion": 4.2,
      "credentials": {
        "httpHeaderAuth": {
          "id": "Ok9KPJP4UMw6OLgP",
          "name": "Unnamed credential"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "69676b6c-2bf4-4312-b916-4316c66421a8",
              "leftValue": "={{ $json.error.message }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -336,
        1280
      ],
      "id": "328bcb22-f9e3-46f3-93ff-d6aecf267c7d",
      "name": "If1",
      "disabled": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.perplexity.ai/chat/completions",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"model\": \"sonar\",\n  \"messages\": [\n    {\n      \"role\": \"system\",\n      \"content\": \"Act as an elite business intelligence analyst specializing in the UK legal industry. Your job: Identify the single most senior operations leader at the law firm provided. This is typically the Chief Operating Officer (COO), Head of Operations, Director of Business Services, or equivalent role responsible for firm infrastructure, business operations, administration, and support functions. Use all available, reputable open sources, and cross-check multiple databases for recency and accuracy. Return the ONE most relevant and senior operations leader. Strictly follow output fields and fallback logicnever omit required fields or return partial objects.\"\n    },\n    {\n      \"role\": \"user\",\n      \"content\": \"Research the following law firm to identify the TOP operations leaderthe single most senior person responsible for business operations, firm administration, infrastructure, or business services. Use every professional and open online source possible (see below). WIDEN your search and match on broader or alternative job titles if direct matches are not found. Return the #1 ranked operations leader only.\\n\\nInput:\\n- Company Name: {{ $('Airtable Source').item.json['Company Name'] }}\\n- Company Website: {{ $('Airtable Source').item.json['Company Website PP'] }}\\n- Company Domain: {{ $('Airtable Source').item.json['Company Domain'] }}\\n\\nSOURCES TO SEARCH (must use all available):\\n- LinkedIn (firm page, People tab, individual executive profiles, search for operations roles)\\n- Legal directories: Legal 500, Chambers UK, LawCareers.Net (business services, non-lawyer leadership)\\n- Companies House (officers, directors)\\n- Industry databases: RocketReach, ZoomInfo, Apollo, BoardEx, Hunter.io\\n- Law firm website: Leadership, Team, People, About, Management Team, Business Services pages\\n- Event sites: PSMG, Law Society, legal management conferences, speaking/attendee lists\\n- Press releases, trade publications, legal press (appointments, promotions)\\n- Professional associations: Association of Legal Administrators (ALA), Law Society, Legal Business\\n\\nTITLE PRIORITY for Operations Leader (search in this order, select the most senior match):\\n1. HIGHEST PRIORITY: Chief Operating Officer (COO), Chief Administrative Officer (CAO)\\n2. HIGH PRIORITY: Director of Operations, Head of Operations, Operations Director, Director of Business Services, Head of Business Services\\n3. MEDIUM PRIORITY: Managing Director (Operations), Director of Administration, Head of Firm Operations, Director of Business Operations, General Manager\\n4. LOWER PRIORITY: Director of Business Development (if also handles operations), Head of Client Services (if operational role), Operations Manager (if most senior operations role at firm)\\n5. FALLBACK: Managing Partner (if also handles operations at smaller firm), Senior Partner with operational responsibilities\\n\\nFor the contact found:\\n- Verify they are currently employed at the firm (check recency of sources within last 3 months)\\n- Select the most senior operations-focused role\\n- For email: Only use if publicly available or reliably inferred from confirmed firm email pattern (need at least one published example from the firm)\\n- For LinkedIn: Only use official LinkedIn profile URLs\\n\\nJSON output  Return ONE operations leader (the most senior/relevant found). All fields must be populated. If absolutely no operations leader found after exhausting all sources, return all fields as 'no info':\\n\\n{\\n  \\\"fullName\\\": \\\"string or 'no info'\\\",\\n  \\\"actualCompanyName\\\": \\\"string or 'no info'\\\",\\n  \\\"website\\\": \\\"string or 'no info'\\\",\\n  \\\"lastUpdated\\\": \\\"ISO date or 'no info'\\\",\\n  \\\"operationsLeader\\\": {\\n    \\\"name\\\": \\\"string or 'no info'\\\",\\n    \\\"title\\\": \\\"string or 'no info'\\\",\\n    \\\"email\\\": \\\"string or 'no info'\\\",\\n    \\\"linkedin\\\": \\\"string or 'no info'\\\",\\n    \\\"source\\\": \\\"source URL or platform or 'no info'\\\",\\n    \\\"relevanceReason\\\": \\\"Brief explanation of their operational responsibilities or 'no info'\\\"\\n  }\\n}\\n\\nIMPORTANT RULES:\\n- Return only ONE operations leader (the most senior and relevant)\\n- Prioritize actual operations roles over business development or marketing\\n- Every field must be present and populated\\n- Return ONLY the JSON object, never Markdown, code blocks, or explanatory text\\n- NEVER omit fields, return null, or return partial objects\\n\\nReturn ONLY the raw JSON object as specified above.\"\n    }\n  ],\n  \"max_tokens\": 2500,\n  \"temperature\": 0.15,\n  \"search_domain_filter\": [\n    \"linkedin.com\",\n    \"legal500.com\",\n    \"chambers.com\",\n    \"lawcareers.net\",\n    \"rocketreach.co\",\n    \"zoominfo.com\",\n    \"companieshouse.gov.uk\",\n    \"psmg.co.uk\",\n    \"lawsociety.org.uk\",\n    \"legalbusiness.co.uk\",\n    \"apollow.io\",\n    \"boardex.com\",\n    \"hunter.io\"\n  ],\n  \"search_recency_filter\": \"year\",\n  \"top_p\": 0.95,\n  \"presence_penalty\": 0,\n  \"frequency_penalty\": 1\n}\n",
        "options": {}
      },
      "id": "55f6032e-b9bf-47ab-a2dc-d15c76e09526",
      "name": "Perplexity Research Sonar Pro",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -608,
        1280
      ],
      "typeVersion": 4.2,
      "credentials": {
        "httpHeaderAuth": {
          "id": "Ok9KPJP4UMw6OLgP",
          "name": "Unnamed credential"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.perplexity.ai/chat/completions",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"model\": \"sonar\",\n  \"messages\": [\n    {\n      \"role\": \"system\",\n      \"content\": \"Act as an elite business intelligence analyst specializing in the UK legal industry. Your job: Identify up to 5 senior decision-makers who influence or control legal technology, digital transformation, innovation, IT, operations, business development, and marketing decisions at the law firm provided. Rank them by relevance to legal technology purchasing and implementation. Use all available, reputable open sources, and cross-check multiple databases for recency and accuracy. You MUST always maximize the chance of results for each contact. Strictly follow output fields and fallback logicnever omit required fields or return partial objects.\"\n    },\n    {\n      \"role\": \"user\",\n      \"content\": \"Research the following law firm to identify UP TO 5 key decision makers who influence legal technology, digital strategy, innovation, operations, or business decisions. Prioritize legal tech, IT, and innovation roles first, then operations, business development, and marketing. Use every professional and open online source possible (see below). WIDEN your search and match on broader or alternative job titles if direct matches are not found. Return between 1 and 5 contacts (whichever you can find with confidence), ranked by relevance to legal technology decisions.\\n\\nInput:\\n- Company Name: {{ $('Airtable Source').item.json['Company Name'] }}\\n- Implied Official Firm Name: {{ $('Airtable Source').item.json['Implied Firm Name'] }}\\n- Company Website: {{ $('Airtable Source').item.json['Company Website PP'] }}\\n- Company Domain: {{ $('Airtable Source').item.json['Company Domain'] }}\\n\\nSOURCES TO SEARCH (must use all available):\\n- LinkedIn (firm page, People tab, individual executive profiles, job histories)\\n- Legal directories: Legal 500, Chambers UK, LawCareers.Net (partners, directors, business services)\\n- Companies House (officers, PSCs, directors)\\n- Industry databases: RocketReach, ZoomInfo, Apollo, BoardEx, Hunter.io\\n- Law firm website: Leadership, Team, People, About, News/Press, Blog, Insights, Case Studies\\n- Event sites: LawTech events, PSMG, Legal Geek, ILTA Europe, Law Society, speaking/faculty/attendee lists\\n- Press releases, trade publications, business newswires, legal tech publications\\n- Professional associations: ILTA, Law Society, UK Legal IT Association, Association of Legal Administrators\\n- Twitter/X, conference speaker bios, webinar hosts, podcast appearances\\n\\nTITLE PRIORITY (search in this order, broaden if needed):\\n1. HIGHEST PRIORITY - Legal Tech/IT/Innovation: CTO, CIO, Chief Digital Officer, Chief Innovation Officer, Director/Head of Legal Technology, Director/Head of Innovation, Director/Head of Digital Transformation, IT Director, Director of Knowledge Management, Head of Legal Operations\\n2. HIGH PRIORITY - Operations/Strategy: COO, Chief Operating Officer, Operations Director, Director of Business Services, Chief Administrative Officer, Director of Change, Director of Projects, Managing Partner (Operations), General Counsel (if involved in tech decisions)\\n3. MEDIUM PRIORITY - Business Development/Growth: Chief Business Development Officer, Director of Business Development, Head of Client Services, Growth Director, Director of Strategic Initiatives\\n4. LOWER PRIORITY - Marketing/Communications: CMO, Chief Marketing Officer, Director of Marketing, Head of Marketing, Director of Client Development, Director of Communications\\n5. FALLBACK - Senior Management: Managing Partner, Senior Partner, CEO (if small/mid-sized firm), Finance Director (if involved in tech procurement)\\n\\nFor each contact found:\\n- Verify they are currently employed at the firm (check recency of sources)\\n- Prioritize contacts with public evidence of tech/innovation involvement (e.g., speaking at legal tech events, quoted in tech articles, LinkedIn posts about legal tech)\\n- For email: Only use if publicly available or reliably inferred from confirmed firm email pattern (need at least one example)\\n- For LinkedIn: Only use official LinkedIn profile URLs\\n\\nJSON output  Return an array of 1-5 contacts, ordered by relevance to legal technology decisions (most relevant first). Each contact must have all fields populated. If fewer than 5 contacts can be found with confidence, return only those found (minimum 1). If absolutely no contacts found after exhausting all sources, return an array with one object where all fields are 'no info':\\n\\n{\\n  \\\"fullName\\\": \\\"string or 'no info'\\\",\\n  \\\"actualCompanyName\\\": \\\"string or 'no info'\\\",\\n  \\\"website\\\": \\\"string or 'no info'\\\",\\n  \\\"lastUpdated\\\": \\\"ISO date or 'no info'\\\",\\n  \\\"decisionMakers\\\": [\\n    {\\n      \\\"rank\\\": 1,\\n      \\\"name\\\": \\\"string or 'no info'\\\",\\n      \\\"title\\\": \\\"string or 'no info'\\\",\\n      \\\"area\\\": \\\"One of ['Legal Tech/IT', 'Innovation', 'Digital Transformation', 'Operations', 'Business Development', 'Marketing', 'Senior Management', 'Other'] or 'no info'\\\",\\n      \\\"email\\\": \\\"string or 'no info'\\\",\\n      \\\"linkedin\\\": \\\"string or 'no info'\\\",\\n      \\\"source\\\": \\\"source URL or platform or 'no info'\\\",\\n      \\\"relevanceReason\\\": \\\"Brief explanation why this person is relevant for legal tech decisions or 'no info'\\\"\\n    },\\n    {\\n      \\\"rank\\\": 2,\\n      \\\"name\\\": \\\"string or 'no info'\\\",\\n      \\\"title\\\": \\\"string or 'no info'\\\",\\n      \\\"area\\\": \\\"One of ['Legal Tech/IT', 'Innovation', 'Digital Transformation', 'Operations', 'Business Development', 'Marketing', 'Senior Management', 'Other'] or 'no info'\\\",\\n      \\\"email\\\": \\\"string or 'no info'\\\",\\n      \\\"linkedin\\\": \\\"string or 'no info'\\\",\\n      \\\"source\\\": \\\"source URL or platform or 'no info'\\\",\\n      \\\"relevanceReason\\\": \\\"Brief explanation why this person is relevant for legal tech decisions or 'no info'\\\"\\n    },\\n    {\\n      \\\"rank\\\": 3,\\n      \\\"name\\\": \\\"string or 'no info'\\\",\\n      \\\"title\\\": \\\"string or 'no info'\\\",\\n      \\\"area\\\": \\\"One of ['Legal Tech/IT', 'Innovation', 'Digital Transformation', 'Operations', 'Business Development', 'Marketing', 'Senior Management', 'Other'] or 'no info'\\\",\\n      \\\"email\\\": \\\"string or 'no info'\\\",\\n      \\\"linkedin\\\": \\\"string or 'no info'\\\",\\n      \\\"source\\\": \\\"source URL or platform or 'no info'\\\",\\n      \\\"relevanceReason\\\": \\\"Brief explanation why this person is relevant for legal tech decisions or 'no info'\\\"\\n    },\\n    {\\n      \\\"rank\\\": 4,\\n      \\\"name\\\": \\\"string or 'no info'\\\",\\n      \\\"title\\\": \\\"string or 'no info'\\\",\\n      \\\"area\\\": \\\"One of ['Legal Tech/IT', 'Innovation', 'Digital Transformation', 'Operations', 'Business Development', 'Marketing', 'Senior Management', 'Other'] or 'no info'\\\",\\n      \\\"email\\\": \\\"string or 'no info'\\\",\\n      \\\"linkedin\\\": \\\"string or 'no info'\\\",\\n      \\\"source\\\": \\\"source URL or platform or 'no info'\\\",\\n      \\\"relevanceReason\\\": \\\"Brief explanation why this person is relevant for legal tech decisions or 'no info'\\\"\\n    },\\n    {\\n      \\\"rank\\\": 5,\\n      \\\"name\\\": \\\"string or 'no info'\\\",\\n      \\\"title\\\": \\\"string or 'no info'\\\",\\n      \\\"area\\\": \\\"One of ['Legal Tech/IT', 'Innovation', 'Digital Transformation', 'Operations', 'Business Development', 'Marketing', 'Senior Management', 'Other'] or 'no info'\\\",\\n      \\\"email\\\": \\\"string or 'no info'\\\",\\n      \\\"linkedin\\\": \\\"string or 'no info'\\\",\\n      \\\"source\\\": \\\"source URL or platform or 'no info'\\\",\\n      \\\"relevanceReason\\\": \\\"Brief explanation why this person is relevant for legal tech decisions or 'no info'\\\"\\n    }\\n  ]\\n}\\n\\nIMPORTANT RULES:\\n- Return between 1 and 5 contacts (as many as you can confidently find)\\n- Order by relevance to legal tech decisions (rank 1 = most relevant)\\n- Include 'relevanceReason' for each contact explaining their decision-making influence\\n- Every field must be present in every contact object\\n- If you find fewer than 5, only include those you found (do not pad with empty objects)\\n- Return ONLY the JSON object, never Markdown, code blocks, or explanatory text\\n- NEVER omit fields, return null, or return partial objects\\n\\nReturn ONLY the raw JSON object as specified above.\"\n    }\n  ],\n  \"max_tokens\": 4000,\n  \"temperature\": 0.15,\n  \"search_domain_filter\": [\n    \"linkedin.com\",\n    \"legal500.com\",\n    \"chambers.com\",\n    \"lawcareers.net\",\n    \"rocketreach.co\",\n    \"zoominfo.com\",\n    \"companieshouse.gov.uk\",\n    \"psmg.co.uk\",\n    \"lawsociety.org.uk\",\n    \"legalgeek.co\",\n    \"iltanet.org\",\n    \"apollow.io\",\n    \"boardex.com\",\n    \"hunter.io\"\n  ],\n  \"search_recency_filter\": \"year\",\n  \"top_p\": 0.95,\n  \"presence_penalty\": 0,\n  \"frequency_penalty\": 1\n}\n",
        "options": {}
      },
      "id": "5bd74b9f-5ed8-4ce8-8f1f-8d5e3ef2fcc7",
      "name": "Perplexity LinkedIn1",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -608,
        816
      ],
      "typeVersion": 4.2,
      "credentials": {
        "httpHeaderAuth": {
          "id": "Ok9KPJP4UMw6OLgP",
          "name": "Unnamed credential"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "let content = $json.choices[0].message.content;\n\n// Clean the Markdown formatting\ncontent = content.replace(/```json|```/g, '').trim();\n\nlet parsed;\n\n// Try parsing the content safely\ntry {\n  parsed = JSON.parse(content);\n} catch (error) {\n  parsed = { message: \"No info found\" };\n}\n\n// Check if all values in the expected structure are null, empty arrays, or empty strings\nconst hasUsefulData = Object.values(parsed).some(value => {\n  if (value === null || value === \"\" || (Array.isArray(value) && value.length === 0)) return false;\n  if (typeof value === \"object\" && !Array.isArray(value)) {\n    // Check nested objects (like `rankings`)\n    return Object.values(value).some(sub => {\n      if (typeof sub === \"object\") {\n        return Object.values(sub).some(v => v !== null && v !== \"\");\n      }\n      return sub !== null && sub !== \"\";\n    });\n  }\n  return true;\n});\n\nif (!hasUsefulData) {\n  parsed = { message: \"No info found\" };\n}\n\n// Return a single flat object instead of an array\nreturn parsed;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        128,
        832
      ],
      "id": "5669a129-50b2-4772-9702-c535707c687c",
      "name": "PP Flattening1",
      "disabled": true
    }
  ],
  "connections": {
    "When clicking Test workflow1": {
      "main": [
        [
          {
            "node": "Date & Time",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Emails": {
      "main": [
        [],
        [
          {
            "node": "Perplexity LinkedIn",
            "type": "main",
            "index": 0
          },
          {
            "node": "Perplexity Research Sonar Pro",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Date Format1": {
      "main": [
        [
          {
            "node": "Airtable Source",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PP Flattening2": {
      "main": [
        [
          {
            "node": "Airtable Write",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Date & Time": {
      "main": [
        [
          {
            "node": "Date Format1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Airtable Source": {
      "main": [
        [
          {
            "node": "Loop Over Emails",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Airtable Write": {
      "main": [
        [
          {
            "node": "Loop Over Emails",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Loop Over Emails",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "PP Flattening",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PP Flattening": {
      "main": [
        [
          {
            "node": "Airtable Write1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Airtable Write1": {
      "main": [
        [
          {
            "node": "Loop Over Emails",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Perplexity LinkedIn": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Loop Over Emails",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "PP Flattening2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Perplexity Research Sonar Pro": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "pinData": {},
  "triggerCount": 0,
  "meta": {
    "templateCredsSetupCompleted": true
  }
}