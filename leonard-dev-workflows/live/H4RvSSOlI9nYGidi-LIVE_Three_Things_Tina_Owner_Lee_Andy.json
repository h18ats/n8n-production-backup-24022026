{
  "name": "LIVE - Three Things Tina - Owner Lee/Andy",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "threethingstina",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -3040,
        -448
      ],
      "id": "45502e74-d40c-4a62-8e74-dfb1d8450076",
      "name": "Three Things Tina",
      "webhookId": "e3c9d572-750d-4084-ad4a-361ef8520a7b"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "84f296ec-21cf-476e-8781-1e600dcd7699",
              "leftValue": "={{ $('Three Things Tina').item.json.body.data.conversation_initiation_client_data.dynamic_variables.system__call_duration_secs }}",
              "rightValue": 60,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -2400,
        -448
      ],
      "id": "f29fb3c5-9bd9-4f54-b9c6-9d75144e7660",
      "name": "If1"
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": "01RDSCPONO2CZT22PORNC3PJQ4CAPNY3TD"
      },
      "type": "n8n-nodes-base.microsoftOneDrive",
      "typeVersion": 1,
      "position": [
        -512,
        -448
      ],
      "id": "105e5667-7030-4d47-bad1-54d3fcda30af",
      "name": "Download a file1",
      "credentials": {
        "microsoftOneDriveOAuth2Api": {
          "id": "O6kcuY0URca0xV5I",
          "name": "Lee LINAR - Microsoft Drive account"
        }
      }
    },
    {
      "parameters": {
        "operation": "pdf",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1.1,
      "position": [
        -224,
        -448
      ],
      "id": "d3f51f0e-a4f6-40ef-aec8-bff7c6883a45",
      "name": "Extract from File"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.2",
          "mode": "list",
          "cachedResultName": "gpt-5.2"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        64,
        -240
      ],
      "id": "be0a19b2-65cb-4882-ae19-0a9d5bd07a98",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "A6TzpvpaIyqf4IKq",
          "name": "Lee C chat GPT account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Get the incoming JSON body\nconst input = items[0].json;\n\n// Defensive navigation\nconst data = input.body?.data || {};\nconst transcript = data.transcript || [];\n\n// Build Markdown\nlet md = `# Conversation Transcript\\n\\n`;\n\ntranscript.forEach((turn) => {\n  if (!turn.message) return;\n\n  const role =\n    turn.role === \"agent\" ? \"**Agent**\"\n    : turn.role === \"user\" ? \"**User**\"\n    : \"**System**\";\n\n  const message = turn.message.trim();\n\n  if (message) {\n    md += `${role}:\\n\\n${message}\\n\\n---\\n\\n`;\n  }\n});\n\n// Extract structured analysis data\nconst analysis = data.analysis || {};\nconst collected = analysis.data_collection_results || {};\n\n// Add extracted insights section if anything exists\nif (Object.keys(collected).length > 0) {\n  md += `# Extracted Insights\\n\\n`;\n\n  if (collected[\"Name\"]?.value) {\n    md += `**Name:** ${collected[\"Name\"].value}\\n\\n`;\n  }\n\n  if (collected[\"Challenge\"]?.value) {\n    md += `**Challenge:**\\n\\n${collected[\"Challenge\"].value}\\n\\n`;\n  }\n\n  if (collected[\"Recommendations\"]?.value) {\n    md += `**Recommendations:**\\n\\n${collected[\"Recommendations\"].value}\\n\\n`;\n  }\n\n  if (collected[\"Examples\"]?.value) {\n    md += `**Examples:**\\n\\n${collected[\"Examples\"].value}\\n\\n`;\n  }\n}\n\n// Optional AI summary section\nif (analysis.call_summary_title || analysis.transcript_summary) {\n  md += `# Call Summary\\n\\n`;\n\n  if (analysis.call_summary_title) {\n    md += `**Title:** ${analysis.call_summary_title}\\n\\n`;\n  }\n\n  if (analysis.transcript_summary) {\n    md += `${analysis.transcript_summary}\\n\\n`;\n  }\n}\n\n// Return markdown as output\nreturn [\n  {\n    json: {\n      markdown: md\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2848,
        -448
      ],
      "id": "ad3a5d29-3e40-44c3-91ba-613e79d28f2e",
      "name": "Full Transcript Code Node"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are Tina an AI assistant working for LINAR Consulting Ltd (https://linarconsulting.com). You are a business development and sales coach with knowledge of the complete catalogue of weekly Three Things newsletters that are developed and curated by the LINAR team (https://linarconsulting.com/resources/).\n\nYour task is to provide a summary of the **challenge** the user is facing. \n\nThis summary should be maximum 75 words in length.\n\nThe summary output should begin by acknowledging that the challenge as defined is based on the conversation with the user, and speaking in the second person (i.e. you), and then state the challenge identified.\n\nReturn just the plain-English context \u2014 no headings, no extra explanation.\n\nKeep it professional and clear.\n\nPlease make sure that all outputs are in *UK English* not American English, including all spelling and date formats.\n\n\nHere is the full transcript:\n{{ $json.markdown }}\n\nDo not use em dashes or en dashes. Replace them with full stops or commas.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -2176,
        -448
      ],
      "id": "2734ff1a-5169-45c0-9dc0-dfe6643449a9",
      "name": "Identify Challenge"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are Tina an AI assistant working for LINAR Consulting Ltd (https://linarconsulting.com). You are a business development and sales coach with knowledge of the complete catalogue of weekly Three Things newsletters that are developed and curated by the LINAR team (https://linarconsulting.com/resources/).\n\nYour task is to provide a succinct **recommendation** on how to address the challenge. \n\nThis recommendation should be maximum 100 words in length. \n\nThe tone and format of the recommendation should be a short paragraph which provides potential solutions to the challenge. \n\nBe explicit and make it clear that the proposed solutions are based on what the team at LINAR have seen work well for other people.\n\nUse phrases like \"you might want to consider\", \"have you tried\", \"have you thought about\" etc to generate a real sense of collaboration between Tina and the user. \n\nReturn just the plain-English context \u2014 no headings, no extra explanation.\n\nKeep it professional and clear.\n\nPlease make sure that all outputs are in *UK English* not American English, including all spelling and date formats.\n\nHere is the challenge:\n{{ $json.output }}\n\nDo not use em dashes or en dashes. Replace them with full stops or commas.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -1824,
        -448
      ],
      "id": "e502fb6c-abc0-4ca3-a18e-a5126cece149",
      "name": "Identify Recommendations"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are Tina an AI assistant working for LINAR Consulting Ltd (https://linarconsulting.com). You are a business development and sales coach with knowledge of the complete catalogue of weekly Three Things newsletters that are developed and curated by the LINAR team (https://linarconsulting.com/resources/).\n\nYour task is to provide a list of exactly three **examples** the user could try to remedy their challenge. \n\nEach examples hould be displayed on a separate line. \n\nPlease provide exactly three examples for the user to consider. No more, no less.\n\nExamples should be practical and contain specific actions the user can execute immediately after reading the example.\n\nReturn just the plain-English context \u2014 no headings, no extra explanation.\n\nKeep it professional and clear.\n\nPlease make sure that all outputs are in *UK English* not American English, including all spelling and date formats.\n\n\nHere is a version of the challenge:\n{{ $('Identify Challenge').item.json.output }}\n\nAnd here is a different version of the challenge:\n{{ $('Three Things Tina').item.json.body.data.analysis.data_collection_results.Challenge.value }}\n\nDo not use em dashes or en dashes. Replace them with full stops or commas.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -1264,
        -448
      ],
      "id": "3fac4044-344b-4bff-8c09-e5ca3747ffe3",
      "name": "Examples Next Steps"
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Code / Function node\n * Input: $json.output (single string)\n * Output: html_bullets (<li> items for insertion into an email <ul>)\n * Bullet colour: #b10f2e\n *\n * Outlook desktop fix:\n * - Prevent the native <li> marker from rendering (double bullets) by setting list-style-type:none.\n * - Neutralise Outlook/Word list indentation with mso and margin/padding resets.\n * - Keep your custom red bullet character for consistent cross-client rendering.\n */\n\nvar raw = ($json.output || \"\").toString().trim();\n\n// HTML escape to avoid broken markup\nfunction escapeHtml(s) {\n  return String(s === undefined || s === null ? \"\" : s)\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&#39;\");\n}\n\n// Normalise quotes and spacing\nvar normalised = raw\n  .replace(/[\u201c\u201d]/g, '\"')\n  .replace(/[\u2019]/g, \"'\")\n  .replace(/\\s+/g, \" \")\n  .trim();\n\n// Split into bullet-sized sentences\n// Note: lookbehind can fail in some n8n runtimes. Avoid it for compatibility.\nvar points = [];\nif (normalised) {\n  // Split on sentence end punctuation followed by whitespace and then A-Z or 0-9\n  var parts = normalised.split(/[.!?]\\s+(?=[A-Z0-9])/g);\n\n  // Re-add punctuation to all but last segment where possible by extracting from original.\n  // Simpler: keep segments as-is. Email bullets read fine without the punctuation at the split point.\n  for (var i = 0; i < parts.length; i++) {\n    var p = String(parts[i]).trim();\n    if (p) points.push(p);\n  }\n}\n\n// Build email-safe <li> items (NO <ul> here)\n// Outlook desktop: remove native list marker and indentation, keep custom bullet.\nvar htmlBullets = points\n  .map(function (p) {\n    return (\n      '<li style=\"' +\n        'margin:0 0 8px 0;' +\n        'padding:0;' +\n        'list-style-type:none;' +\n        'mso-special-format:bullet;' +\n        'mso-list:l0 level1 lfo1;' +\n      '\">' +\n        '<span style=\"color:#b10f2e;font-weight:700;\">&#8226;</span> ' +\n        '<span style=\"color:#000000;\">' + escapeHtml(p) + \"</span>\" +\n      \"</li>\"\n    );\n  })\n  .join(\"\");\n\nreturn [\n  {\n    json: {\n      html_bullets: htmlBullets\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1472,
        -448
      ],
      "id": "7d4de0d9-d34d-4624-838d-5531bc419e35",
      "name": "Recco HTML Bullets"
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Code / Function node\n * Input: $json.output (single string)\n * Output:\n *  - intro_text (first line only, escaped)\n *  - html_bullets (<li> items for insertion into an email <ul>)\n * Bullet colour: #b10f2e\n *\n * Outlook desktop fixes:\n * - Remove native <li> marker (prevents double bullets)\n * - Reset Word-engine list indentation\n * - Keep custom bullet for consistent cross-client rendering\n */\n\nvar raw = ($json.output || \"\").toString().trim();\n\n// HTML escape to avoid broken markup\nfunction escapeHtml(s) {\n  return String(s === undefined || s === null ? \"\" : s)\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&#39;\");\n}\n\n// Normalise line endings and literal delimiter /n\nvar normalised = raw\n  .replace(/\\/n\\s*/g, \"\\n\")\n  .replace(/\\r\\n/g, \"\\n\")\n  .replace(/\\r/g, \"\\n\")\n  .trim();\n\n// Split into lines\nvar lines = normalised\n  .split(\"\\n\")\n  .map(function (l) { return l.trim(); })\n  .filter(function (l) { return l.length > 0; });\n\n\n// Remaining lines become bullets\nvar htmlBullets = lines\n  .map(function (p) {\n    return (\n      '<li >' +\n         escapeHtml(p) + \n      \"</li>\"\n    );\n  })\n  .join(\"\");\n\nreturn [\n  {\n    json: {\n      \n      html_bullets: htmlBullets\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -896,
        -448
      ],
      "id": "3c95f945-191d-4238-86d2-cbd763a5ecb7",
      "name": "Next Steps HTML Bullets"
    },
    {
      "parameters": {
        "jsCode": "// n8n Code node (JavaScript) ES5 safe\n// Input: Agent 2 output string with 3 items separated by literal /n\n// Output: cleaned_text, articles[], html_email, debug\n\nvar input = (items && items[0] && items[0].json) ? items[0].json : {};\n\n// ---------- Helpers ----------\nfunction esc(s) {\n  return String(s === undefined || s === null ? \"\" : s)\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&#39;\");\n}\n\nfunction extractHref(s) {\n  var m = String(s === undefined || s === null ? \"\" : s).match(/href=\"([^\"]+)\"/i);\n  return m ? m[1].trim() : \"\";\n}\n\nfunction splitPipes(line) {\n  return String(line === undefined || line === null ? \"\" : line)\n    .split(/\\s*\\|\\s*/g)\n    .map(function (p) { return p.trim(); });\n}\n\nfunction pickFirstString(obj, keys) {\n  for (var i = 0; i < keys.length; i++) {\n    var k = keys[i];\n    var v = obj[k];\n    if (typeof v === \"string\" && v.trim()) return v.trim();\n  }\n  return \"\";\n}\n\nfunction findLikelyOutputString(obj) {\n  for (var k in obj) {\n    if (!Object.prototype.hasOwnProperty.call(obj, k)) continue;\n    var v = obj[k];\n    if (typeof v !== \"string\") continue;\n    var s = v.trim();\n    if (!s) continue;\n\n    var pipes = s.match(/\\|/g);\n    var pipeCount = pipes ? pipes.length : 0;\n    if (pipeCount >= 4) return s;\n  }\n  return \"\";\n}\n\nfunction collapseWhitespace(s) {\n  return String(s === undefined || s === null ? \"\" : s)\n    .replace(/\\r\\n/g, \"\\n\")\n    .replace(/\\r/g, \"\\n\")\n    .replace(/\\s*\\n\\s*/g, \" \")\n    .replace(/\\s+/g, \" \")\n    .trim();\n}\n\nfunction parseTitleAndDate(titleWithDate) {\n  var s = String(titleWithDate === undefined || titleWithDate === null ? \"\" : titleWithDate).trim();\n  var out = { title: s, date: \"\" };\n  var m = s.match(/^(.*)\\((\\d{2}\\/\\d{2}\\/\\d{2})\\)\\s*$/);\n  if (m) {\n    out.title = (m[1] || \"\").trim();\n    out.date = (m[2] || \"\").trim();\n  }\n  return out;\n}\n\n// ---------- 0) Choose raw input ----------\nvar raw = pickFirstString(input, [\"output\", \"message\", \"text\", \"content\", \"result\", \"response\"]);\nif (!raw) raw = findLikelyOutputString(input);\nif (!raw) raw = \"\";\n\n// ---------- 1) Split into items by literal /n (DO NOT replace /n) ----------\nvar parts = raw.split(\"/n\");\nvar entries = [];\nfor (var i = 0; i < parts.length; i++) {\n  var t = String(parts[i] === undefined || parts[i] === null ? \"\" : parts[i]).trim();\n  if (t) entries.push(t);\n}\nif (entries.length > 3) entries = entries.slice(0, 3);\n\n// Collapse internal newlines and excess spaces per entry\nfor (var e = 0; e < entries.length; e++) {\n  entries[e] = collapseWhitespace(entries[e]);\n}\n\n// ---------- 2) Parse entries ----------\nvar articles = [];\n\nfor (var ei = 0; ei < entries.length; ei++) {\n  var entry = entries[ei];\n  var fields = splitPipes(entry);\n\n  if (fields.length < 5) {\n    var td0 = parseTitleAndDate(fields[0] || \"\");\n    articles.push({ title: td0.title, date: td0.date, h2: fields[1] || \"\", action: \"\", explainer: \"\", url: \"\" });\n    continue;\n  }\n\n  var td = parseTitleAndDate(fields[0] || \"\");\n  var h2 = fields[1] || \"\";\n  var action = fields[2] || \"\";\n\n  // find link field from end\n  var linkIndex = -1;\n  for (var j = fields.length - 1; j >= 0; j--) {\n    if (/href\\s*=/.test(fields[j]) || /^https?:\\/\\//i.test(fields[j])) {\n      linkIndex = j;\n      break;\n    }\n  }\n  if (linkIndex === -1) linkIndex = fields.length - 1;\n\n  var linkPart = fields.slice(linkIndex).join(\" | \");\n  var explainer = fields.slice(3, linkIndex).join(\" | \").trim();\n\n  var url = extractHref(linkPart);\n  if (!url) url = extractHref(entry);\n  if (!url && /^https?:\\/\\//i.test(linkPart)) url = linkPart.trim();\n\n  articles.push({ title: td.title, date: td.date, h2: h2, action: action, explainer: explainer, url: url });\n}\n\n// pad to 3\nwhile (articles.length < 3) {\n  articles.push({ title: \"\", date: \"\", h2: \"\", action: \"\", explainer: \"\", url: \"\" });\n}\narticles.length = 3;\n\n// ---------- 3) cleaned_text ----------\nvar cleaned_text = articles\n  .map(function (a) {\n    var titleWithDate = a.date ? (a.title + \" (\" + a.date + \")\") : a.title;\n    var link = a.url ? '<a href=\"' + a.url + '\">Read article</a>' : \"\";\n    return titleWithDate + \" | \" + a.h2 + \" | \" + a.action + \" | \" + a.explainer + \" | \" + link;\n  })\n  .join(\"\\n\");\n\n// ---------- 4) html_email ----------\nvar cards = articles\n  .map(function (a) {\n    var titleWithDate = a.date ? (a.title + \" (\" + a.date + \")\") : a.title;\n\n    var titleEsc = esc(titleWithDate);\n    var h2Esc = esc(a.h2);\n    var actionEsc = esc(a.action);\n    var explainerEsc = esc(a.explainer);\n    var urlEsc = esc(a.url);\n\n    var linkHtml = a.url\n      ? '<div style=\"margin:0; font-size:14px; line-height:20px;\">' +\n          '<a href=\"' + urlEsc + '\" style=\"color:#1155cc; text-decoration:underline;\">Read article</a>' +\n        \"</div>\"\n      : \"\";\n\n    return (\n      '<div style=\"margin:0 0 14px 0; padding:14px; border:1px solid #e6e6e6; border-radius:10px;\">' +\n        '<div style=\"margin:0 0 6px 0; font-size:14px; line-height:20px; color:#111; font-weight:700;\">' +\n          titleEsc +\n        \"</div>\" +\n        '<div style=\"margin:0 0 8px 0; font-size:14px; line-height:20px; color:#333; font-weight:600;\">' +\n          h2Esc +\n        \"</div>\" +\n        '<div style=\"margin:0 0 10px 0; font-size:14px; line-height:20px; color:#444;\">' +\n          actionEsc +\n        \"</div>\" +\n        '<div style=\"margin:0 0 10px 0; font-size:14px; line-height:20px; color:#444;\">' +\n          explainerEsc +\n        \"</div>\" +\n        linkHtml +\n      \"</div>\"\n    );\n  })\n  .join(\"\\n\");\n\nvar html_email =\n  '<div style=\"font-family: Arial, Helvetica, sans-serif; color:#111; font-size:14px; line-height:20px;\">' +\n    '<p style=\"margin:0 0 12px 0;\">Here are three recommended reads tailored to the challenge.</p>' +\n    cards +\n  \"</div>\";\n\n// ---------- Debug ----------\nvar debug = {\n  raw_preview: String(raw).slice(0, 300),\n  entry_count: entries.length,\n  entries_preview: entries\n};\n\nreturn [{ json: { cleaned_text: cleaned_text, articles: articles, html_email: html_email, debug: debug } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        816,
        -448
      ],
      "id": "ccd54857-6150-41dd-9257-cb04dea7d44d",
      "name": "Create Examples HTML List"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Challenge anchored ranking prompt\n\nSource constraints. Non negotiable:\nYou must NOT browse, crawl, open, or read any webpages.\nYou must use ONLY the dataset contained in the following text as the sole source of truth:\n{{$json.text}}\n\nChallenge definition:\nChallenge version A:\n{{$node[\"Identify Challenge\"].json.output}}\n\nChallenge version B:\n{{$node[\"Three Things Tina\"].json.body.data.analysis.data_collection_results.Challenge.value}}\n\nHelpful context. Use only if relevant and do not override the challenge wording:\nRecommendations for next steps:\n{{$node[\"Identify Recommendations\"].json.output}}\nExamples of next steps:\n{{$node[\"Examples Next Steps\"].json.output}}\n\nInterpretation constraint:\nAll relevance decisions must be explicitly grounded in the challenge wording above.\nDo NOT rely on generic BD best practice unless it directly maps to the challenge text.\n\nCorpus structure. How to identify an article:\n1) An article starts at a line that begins with a date in DD/MM/YY or DD/MM/YYYY format followed by a dash, for example \"29/04/24 - Sales Campaigns (Part 1) - Campaign preparation\".\n2) The article continues until the next such date line, or end of text.\n3) Treat the text immediately after the date line as the body for that article.\n\nURL construction. Mandatory:\nFor each article with date DD/MM/YY, construct the URL:\nhttps://linarconsulting.com/three-things-DD-MM-YY/\nUse leading zeros. Keep DD and MM as shown in the header. Convert slashes to hyphens.\n\nStep 1. Extract challenge anchors:\nFrom the combined challenge wording, extract 5 to 8 short anchor phrases using only exact wording that appears in the challenge text. Do not invent anchors.\n\nStep 2. For each article, extract evidence:\nA) Title. The full text after the date line.\nB) First in body H2 proxy:\n   Use the first clear section heading in the article body. A heading is a short line, often followed by paragraphs or bullets, that is not a full sentence. If none exists, leave blank.\nC) Evidence snippets:\n   Extract 2 to 4 short snippets from the article body, each max 25 words, that best match the anchors. If none match, output empty.\n\nStep 3. Score each article:\nScore each dimension from 0 to 5 using only the article body and the anchors.\nA) Anchor coverage\nB) Anchor precision\nC) Under time pressure usefulness\nD) Conversation move quality\nE) Fast win applicability\nTotal score = A+B+C+D+E, max 25\n\nStep 4. Rank and anti duplication:\nReturn the top 8 articles by Total score.\nIf two rely on the same behavioural mechanism, keep the higher score and include the next best distinct lever.\n\nFormatting constraints:\nDo not use em dashes or en dashes. Replace them with full stops or commas.\nCapitalise Titles and H2 lines to improve formatting.\n\nOutput rules. Strict and final. Parser critical:\nYou MUST output valid JSON only.\nYou MUST output exactly one JSON array of up to 8 objects.\nEach object must have exactly these keys, in this order:\ndate, title, url, h2, scores, total, anchors_matched, evidence\n\nField rules:\ndate. \"DD/MM/YY\"\ntitle. Title text only with leading letter capitalisation, without date,\nurl. Constructed URL\nh2. First in body H2 proxy or empty\nscores. An object with keys A,B,C,D,E as integers 0 to 5\ntotal. Integer 0 to 25\nanchors_matched. Array of anchor phrases used, exact text from challenge\nevidence. Array of 0 to 4 strings, each a snippet max 25 words\n\nDo not output any other text outside the JSON.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        64,
        -448
      ],
      "id": "5d4240ce-5601-4928-b184-b14596d7fc83",
      "name": "Identify 3 Relevant Three Things Artciles"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.2",
          "mode": "list",
          "cachedResultName": "gpt-5.2"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        432,
        -240
      ],
      "id": "85012c47-08e3-4323-a2e5-e32ec6594dc3",
      "name": "OpenAI Chat Model2",
      "credentials": {
        "openAiApi": {
          "id": "A6TzpvpaIyqf4IKq",
          "name": "Lee C chat GPT account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Structured output generator. Top 3 only\n\nSource constraints. Non negotiable:\nYou must NOT browse, crawl, open, or read any webpages.\nYou must use ONLY the ranked dataset provided below as the sole source of truth:\n{{ $json.output }}\n\nChallenge definition:\n{{$node[\"Identify Challenge\"].json.output}}\n\nSelection rules:\n1) Select exactly THREE items from the ranked dataset.\n2) Prefer higher total score.\n3) Apply tie breaks strictly in this order:\n   a) Higher Anchor precision (score B)\n   b) Higher Anchor coverage (score A)\n   c) More concrete evidence snippets that clearly map to the challenge wording\n4) Anti duplication check:\n   If two candidates rely on the same behavioural mechanism, keep the higher scoring one and replace the other with the next best that introduces a distinct lever.\n   Anchor precision always outweighs variety.\n\nOutput structure. Mandatory:\nEach item must follow this exact field order, separated by pipe characters:\nTitle (DD/MM/YY) | First in-body H2 | Challenge action | Verbose relevance explainer | <a href=\"URL\">Read article</a>\n\nField instructions:\nTitle (DD/MM/YY).\n- Use the object title.\n- Append the date from the object date field in parentheses, exactly like: Title (DD/MM/YY).\n\nFirst in-body H2.\n- Use the object h2.\n- If missing, leave empty but keep the pipe.\n\nChallenge action.\n- Write one short imperative action.\n- It must be directly grounded in the challenge wording and the article evidence.\n\nVerbose relevance explainer.\n- Write 2 to 4 sentences.\n- Explicitly reference at least two exact anchor phrases from the challenge.\n- Tie each anchor phrase to specific evidence from the article.\n- Newlines are allowed inside this field if needed.\n\nURL.\n- Use the object url.\n- Wrap exactly as: <a href=\"URL\">Read article</a>\n\nDelimiter rules. Strict:\n- Output exactly THREE items.\n- Separate items using the literal token:\n/n\n- You MUST NOT use the token /n anywhere else.\n- Do NOT add extra delimiters, numbering, bullets, headings, or surrounding text.\n- Do NOT output JSON.\n\nPunctuation constraint:\nDo not use em dashes or en dashes.\nReplace them with full stops or commas.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        432,
        -448
      ],
      "id": "f6ca9ae7-2816-403e-98b9-67238164c138",
      "name": "Format selected Articles"
    },
    {
      "parameters": {
        "content": "## Backup Nodes\n",
        "height": 800,
        "width": 4544
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3136,
        16
      ],
      "typeVersion": 1,
      "id": "2eb8edc3-b2dc-4955-92b9-004df6230ec1",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.2",
          "mode": "list",
          "cachedResultName": "gpt-5.2"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -2176,
        -256
      ],
      "id": "d75c0bb7-9f9f-4781-ab1b-295b59939119",
      "name": "OpenAI Chat Model3",
      "credentials": {
        "openAiApi": {
          "id": "A6TzpvpaIyqf4IKq",
          "name": "Lee C chat GPT account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.2",
          "mode": "list",
          "cachedResultName": "gpt-5.2"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -1824,
        -256
      ],
      "id": "77ce1576-d574-42f0-9a5e-53d579da3226",
      "name": "OpenAI Chat Model4",
      "credentials": {
        "openAiApi": {
          "id": "A6TzpvpaIyqf4IKq",
          "name": "Lee C chat GPT account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.2",
          "mode": "list",
          "cachedResultName": "gpt-5.2"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -1264,
        -256
      ],
      "id": "b7aa9cd1-6553-431e-9a2f-4f155e07b8eb",
      "name": "OpenAI Chat Model5",
      "credentials": {
        "openAiApi": {
          "id": "A6TzpvpaIyqf4IKq",
          "name": "Lee C chat GPT account"
        }
      }
    },
    {
      "parameters": {
        "toRecipients": "={{ $('Three Things Tina').item.json.body.data.analysis.data_collection_results['Email address'].value }}\n",
        "subject": "Your conversation with Three Things Tina",
        "bodyContent": "=<html>\n  <body style=\"margin:0; padding:0;\">\n    <div style=\"font-family: Arial, Helvetica, sans-serif; font-size:14px; line-height:1.6; color:#000000;\">\n\n      <!-- Header -->\n      <div style=\"margin:0 0 20px 0; padding:0;\">\n        <img src=\"https://raw.githubusercontent.com/LE-LeeC/LINAR/main/Linar-Wordmark-RGB-Red-optimized.png\"\n             alt=\"LINAR logo\"\n             style=\"height:20px; display:block; border:0; outline:none;\">\n      </div>\n\n      <!-- Greeting -->\n      <p style=\"margin:0 0 12px 0; padding:0;\">\n        Hi {{ $('Three Things Tina').item.json.body.data.analysis.data_collection_results.Name.value }}\n      </p>\n\n      <p style=\"margin:0 0 16px 0; padding:0;\">\n        Thanks for speaking to me. I really enjoyed our conversation and have made some recommendations below which I hope are helpful.\n      </p>\n\n      <!-- Challenge -->\n      <h3 style=\"font-size:18px; font-weight:700; color:#b10f2e; margin:30px 0 10px 0; padding:0;\">\n        Your challenge\n      </h3>\n      <p style=\"margin:0 0 16px 0; padding:0;\">\n        {{ $('Identify Challenge').item.json.output }}\n      </p>\n\n      <!-- Recommendations -->\n      <h3 style=\"font-size:18px; font-weight:700; color:#b10f2e; margin:30px 0 10px 0; padding:0;\">\n        Recommendations\n      </h3>\n      <p style=\"margin:0 0 16px 0; padding:0;\">\n        {{ $('Identify Recommendations').item.json.output }}\n      </p>     \n\n      <!-- What are you waiting for?! -->\n      <h3 style=\"font-size:18px; font-weight:700; color:#b10f2e; margin:30px 0 10px 0; padding:0;\">\n        What are you waiting for?!\n      </h3>\n      <p style=\"margin:0 0 12px 0; padding:0;\">\n        Based on the above, here are three things (there's always three!) you can do right now to get started:\n      </p>\n      <ul >\n        {{ $('Next Steps HTML Bullets').item.json.html_bullets }}\n      </ul>\n\n      <!-- Related articles -->\n      <h3 style=\"font-size:18px; font-weight:700; color:#b10f2e; margin:30px 0 10px 0; padding:0;\">\n        Related articles\n      </h3>\n      <div style=\"margin:0; padding:0;\">\n        {{ $json.html_email }}\n      </div>\n\n      <!-- Footer -->\n      <hr style=\"margin:30px 0; border:0; border-top:1px solid #b10f2e;\">\n\n      <p style=\"margin:0 0 16px 0; padding:0;\">\n        You can find all of our Three Things articles\n        <a href=\"https://linarconsulting.com/resources/\" target=\"_blank\" style=\"color:#b10f2e; text-decoration:none;\">here</a>.\n        We also send out a weekly Three Things newsletter direct to your inbox, sign up\n        <a href=\"https://share-eu1.hsforms.com/1TvoeY-xqRLuJ-8TxHvsw_w2db85y\" target=\"_blank\" style=\"color:#b10f2e; text-decoration:none;\">here</a>.\n      </p>\n\n      <p style=\"margin:0; padding:0;\">Kind regards</p>\n      <p style=\"margin:6px 0 0 0; padding:0; font-weight:700;\">Tina</p>\n\n      <!-- Signature -->\n      <div style=\"margin-top:20px;\">\n\n        <p style=\"margin:0;\">Three Things agent</p>\n        <p style=\"margin:0; font-weight:700; color:#C82613;\">LINAR Consulting</p>\n\n        <p style=\"margin:6px 0 0 0;\">\n          <strong>E:</strong>\n          <a href=\"mailto:tina@linarconsulting.com\" style=\"color:#1155cc; text-decoration:none;\">\n            tina@linarconsulting.com\n          </a>\n        </p>\n\n        <p style=\"margin:0;\">\n          <strong>W:</strong>\n          <a href=\"https://linarconsulting.com/\" style=\"color:#1155cc; text-decoration:none;\">\n            www.linarconsulting.com\n          </a>\n        </p>\n\n        <p style=\"margin:12px 0 0 0; font-weight:700;\">\n          P.S. want a weekly sales and BD punch in the face?\n          <a href=\"https://share-eu1.hsforms.com/1TvoeY-xqRLuJ-8TxHvsw_w2db85y\" style=\"color:#1155cc; text-decoration:none;\">\n            Three Things\n          </a>\n          to get you ducking and weaving with your clients.\n        </p>\n\n      </div>\n\n    </div>\n  </body>\n</html>\n",
        "additionalFields": {
          "bccRecipients": "andy@legalengine.co.uk, lee@linarconsulting.com",
          "bodyContentType": "html"
        }
      },
      "type": "n8n-nodes-base.microsoftOutlook",
      "typeVersion": 2,
      "position": [
        1040,
        -448
      ],
      "id": "0f5bf433-3bd6-453a-8bc1-ba1116051fe0",
      "name": "Tina Email to User",
      "webhookId": "0a57ad19-7a2b-4e0f-bec4-605fcf511055",
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "id": "kzkaYt1eDxfbVnWx",
          "name": "Outlook Three Things Tina - 12 Feb 26"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "186a0490-b611-47ec-99b2-695fa6c0ef0b",
              "leftValue": "={{ $('Three Things Tina').item.json.body.data.analysis.data_collection_results[\"Email address\"].value }}",
              "rightValue": "failure",
              "operator": {
                "type": "string",
                "operation": "notExists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -2624,
        -480
      ],
      "id": "1c0eeffb-d187-41b6-927a-2213199b0f21",
      "name": "If email is NOT captured"
    },
    {
      "parameters": {
        "content": "## With email validation\n",
        "height": 960,
        "width": 4544
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3120,
        -976
      ],
      "typeVersion": 1,
      "id": "81b2d05b-bf9d-4368-8f1e-eaca655d0fbd",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "84f296ec-21cf-476e-8781-1e600dcd7699",
              "leftValue": "={{ $('Three Things Tina').item.json.body.data.conversation_initiation_client_data.dynamic_variables.system__call_duration_secs }}",
              "rightValue": 60,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -2384,
        -880
      ],
      "id": "66064dce-7fc0-4468-a5fd-f08248d8cc18",
      "name": "If2"
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": "01RDSCPONO2CZT22PORNC3PJQ4CAPNY3TD"
      },
      "type": "n8n-nodes-base.microsoftOneDrive",
      "typeVersion": 1,
      "position": [
        -496,
        -880
      ],
      "id": "c3d24826-fe6f-45ae-b0f3-6d1f5cc2a0a7",
      "name": "Download a file2",
      "credentials": {
        "microsoftOneDriveOAuth2Api": {
          "id": "O6kcuY0URca0xV5I",
          "name": "Lee LINAR - Microsoft Drive account"
        }
      }
    },
    {
      "parameters": {
        "operation": "pdf",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1.1,
      "position": [
        -208,
        -880
      ],
      "id": "18de7f04-3f04-4af0-93fa-c30c448fd412",
      "name": "Extract from File2"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.2",
          "mode": "list",
          "cachedResultName": "gpt-5.2"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        80,
        -672
      ],
      "id": "2462d7be-a387-4006-a038-b7f39257261d",
      "name": "OpenAI Chat Model6",
      "credentials": {
        "openAiApi": {
          "id": "A6TzpvpaIyqf4IKq",
          "name": "Lee C chat GPT account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are Tina an AI assistant working for LINAR Consulting Ltd (https://linarconsulting.com). You are a business development and sales coach with knowledge of the complete catalogue of weekly Three Things newsletters that are developed and curated by the LINAR team (https://linarconsulting.com/resources/).\n\nYour task is to provide a summary of the **challenge** the user is facing. \n\nThis summary should be maximum 75 words in length.\n\nThe summary output should begin by acknowledging that the challenge as defined is based on the conversation with the user, and speaking in the second person (i.e. you), and then state the challenge identified.\n\nReturn just the plain-English context \u2014 no headings, no extra explanation.\n\nKeep it professional and clear.\n\nPlease make sure that all outputs are in *UK English* not American English, including all spelling and date formats.\n\n\nHere is the full transcript:\n{{ $json.markdown }}\n\nDo not use em dashes or en dashes. Replace them with full stops or commas.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -2160,
        -880
      ],
      "id": "1eb6d81a-31a1-4378-a7cc-6dc6804b46c3",
      "name": "Identify Challenge1"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are Tina an AI assistant working for LINAR Consulting Ltd (https://linarconsulting.com). You are a business development and sales coach with knowledge of the complete catalogue of weekly Three Things newsletters that are developed and curated by the LINAR team (https://linarconsulting.com/resources/).\n\nYour task is to provide a succinct **recommendation** on how to address the challenge. \n\nThis recommendation should be maximum 100 words in length. \n\nThe tone and format of the recommendation should be a short paragraph which provides potential solutions to the challenge. \n\nBe explicit and make it clear that the proposed solutions are based on what the team at LINAR have seen work well for other people.\n\nUse phrases like \"you might want to consider\", \"have you tried\", \"have you thought about\" etc to generate a real sense of collaboration between Tina and the user. \n\nReturn just the plain-English context \u2014 no headings, no extra explanation.\n\nKeep it professional and clear.\n\nPlease make sure that all outputs are in *UK English* not American English, including all spelling and date formats.\n\nHere is the challenge:\n{{ $json.output }}\n\nDo not use em dashes or en dashes. Replace them with full stops or commas.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -1808,
        -880
      ],
      "id": "175cc083-03cd-44c2-827f-1243a7a5aae7",
      "name": "Identify Recommendations1"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are Tina an AI assistant working for LINAR Consulting Ltd (https://linarconsulting.com). You are a business development and sales coach with knowledge of the complete catalogue of weekly Three Things newsletters that are developed and curated by the LINAR team (https://linarconsulting.com/resources/).\n\nYour task is to provide a list of exactly three **examples** the user could try to remedy their challenge. \n\nEach examples hould be displayed on a separate line. \n\nPlease provide exactly three examples for the user to consider. No more, no less.\n\nExamples should be practical and contain specific actions the user can execute immediately after reading the example.\n\nReturn just the plain-English context \u2014 no headings, no extra explanation.\n\nKeep it professional and clear.\n\nPlease make sure that all outputs are in *UK English* not American English, including all spelling and date formats.\n\n\nHere is a version of the challenge:\n{{ $('Identify Challenge1').item.json.output }}\n\nAnd here is a different version of the challenge:\n{{ $('Three Things Tina').item.json.body.data.analysis.data_collection_results.Challenge.value }}\n\nDo not use em dashes or en dashes. Replace them with full stops or commas.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -1248,
        -880
      ],
      "id": "fe81f510-d65b-4166-976e-7307956c5f5f",
      "name": "Examples Next Steps1"
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Code / Function node\n * Input: $json.output (single string)\n * Output: html_bullets (<li> items for insertion into an email <ul>)\n * Bullet colour: #b10f2e\n *\n * Outlook desktop fix:\n * - Prevent the native <li> marker from rendering (double bullets) by setting list-style-type:none.\n * - Neutralise Outlook/Word list indentation with mso and margin/padding resets.\n * - Keep your custom red bullet character for consistent cross-client rendering.\n */\n\nvar raw = ($json.output || \"\").toString().trim();\n\n// HTML escape to avoid broken markup\nfunction escapeHtml(s) {\n  return String(s === undefined || s === null ? \"\" : s)\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&#39;\");\n}\n\n// Normalise quotes and spacing\nvar normalised = raw\n  .replace(/[\u201c\u201d]/g, '\"')\n  .replace(/[\u2019]/g, \"'\")\n  .replace(/\\s+/g, \" \")\n  .trim();\n\n// Split into bullet-sized sentences\n// Note: lookbehind can fail in some n8n runtimes. Avoid it for compatibility.\nvar points = [];\nif (normalised) {\n  // Split on sentence end punctuation followed by whitespace and then A-Z or 0-9\n  var parts = normalised.split(/[.!?]\\s+(?=[A-Z0-9])/g);\n\n  // Re-add punctuation to all but last segment where possible by extracting from original.\n  // Simpler: keep segments as-is. Email bullets read fine without the punctuation at the split point.\n  for (var i = 0; i < parts.length; i++) {\n    var p = String(parts[i]).trim();\n    if (p) points.push(p);\n  }\n}\n\n// Build email-safe <li> items (NO <ul> here)\n// Outlook desktop: remove native list marker and indentation, keep custom bullet.\nvar htmlBullets = points\n  .map(function (p) {\n    return (\n      '<li style=\"' +\n        'margin:0 0 8px 0;' +\n        'padding:0;' +\n        'list-style-type:none;' +\n        'mso-special-format:bullet;' +\n        'mso-list:l0 level1 lfo1;' +\n      '\">' +\n        '<span style=\"color:#b10f2e;font-weight:700;\">&#8226;</span> ' +\n        '<span style=\"color:#000000;\">' + escapeHtml(p) + \"</span>\" +\n      \"</li>\"\n    );\n  })\n  .join(\"\");\n\nreturn [\n  {\n    json: {\n      html_bullets: htmlBullets\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1456,
        -880
      ],
      "id": "71fbcfc3-35d7-478f-bceb-518e6db2f1bf",
      "name": "Recco HTML Bullets2"
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Code / Function node\n * Input: $json.output (single string)\n * Output:\n *  - intro_text (first line only, escaped)\n *  - html_bullets (<li> items for insertion into an email <ul>)\n * Bullet colour: #b10f2e\n *\n * Outlook desktop fixes:\n * - Remove native <li> marker (prevents double bullets)\n * - Reset Word-engine list indentation\n * - Keep custom bullet for consistent cross-client rendering\n */\n\nvar raw = ($json.output || \"\").toString().trim();\n\n// HTML escape to avoid broken markup\nfunction escapeHtml(s) {\n  return String(s === undefined || s === null ? \"\" : s)\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&#39;\");\n}\n\n// Normalise line endings and literal delimiter /n\nvar normalised = raw\n  .replace(/\\/n\\s*/g, \"\\n\")\n  .replace(/\\r\\n/g, \"\\n\")\n  .replace(/\\r/g, \"\\n\")\n  .trim();\n\n// Split into lines\nvar lines = normalised\n  .split(\"\\n\")\n  .map(function (l) { return l.trim(); })\n  .filter(function (l) { return l.length > 0; });\n\n\n// Remaining lines become bullets\nvar htmlBullets = lines\n  .map(function (p) {\n    return (\n      '<li >' +\n         escapeHtml(p) + \n      \"</li>\"\n    );\n  })\n  .join(\"\");\n\nreturn [\n  {\n    json: {\n      \n      html_bullets: htmlBullets\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -880,
        -880
      ],
      "id": "46ccd5d7-1c61-47ad-837e-ab719de536d3",
      "name": "Next Steps HTML Bullets3"
    },
    {
      "parameters": {
        "jsCode": "// n8n Code node (JavaScript) ES5 safe\n// Input: Agent 2 output string with 3 items separated by literal /n\n// Output: cleaned_text, articles[], html_email, debug\n\nvar input = (items && items[0] && items[0].json) ? items[0].json : {};\n\n// ---------- Helpers ----------\nfunction esc(s) {\n  return String(s === undefined || s === null ? \"\" : s)\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&#39;\");\n}\n\nfunction extractHref(s) {\n  var m = String(s === undefined || s === null ? \"\" : s).match(/href=\"([^\"]+)\"/i);\n  return m ? m[1].trim() : \"\";\n}\n\nfunction splitPipes(line) {\n  return String(line === undefined || line === null ? \"\" : line)\n    .split(/\\s*\\|\\s*/g)\n    .map(function (p) { return p.trim(); });\n}\n\nfunction pickFirstString(obj, keys) {\n  for (var i = 0; i < keys.length; i++) {\n    var k = keys[i];\n    var v = obj[k];\n    if (typeof v === \"string\" && v.trim()) return v.trim();\n  }\n  return \"\";\n}\n\nfunction findLikelyOutputString(obj) {\n  for (var k in obj) {\n    if (!Object.prototype.hasOwnProperty.call(obj, k)) continue;\n    var v = obj[k];\n    if (typeof v !== \"string\") continue;\n    var s = v.trim();\n    if (!s) continue;\n\n    var pipes = s.match(/\\|/g);\n    var pipeCount = pipes ? pipes.length : 0;\n    if (pipeCount >= 4) return s;\n  }\n  return \"\";\n}\n\nfunction collapseWhitespace(s) {\n  return String(s === undefined || s === null ? \"\" : s)\n    .replace(/\\r\\n/g, \"\\n\")\n    .replace(/\\r/g, \"\\n\")\n    .replace(/\\s*\\n\\s*/g, \" \")\n    .replace(/\\s+/g, \" \")\n    .trim();\n}\n\nfunction parseTitleAndDate(titleWithDate) {\n  var s = String(titleWithDate === undefined || titleWithDate === null ? \"\" : titleWithDate).trim();\n  var out = { title: s, date: \"\" };\n  var m = s.match(/^(.*)\\((\\d{2}\\/\\d{2}\\/\\d{2})\\)\\s*$/);\n  if (m) {\n    out.title = (m[1] || \"\").trim();\n    out.date = (m[2] || \"\").trim();\n  }\n  return out;\n}\n\n// ---------- 0) Choose raw input ----------\nvar raw = pickFirstString(input, [\"output\", \"message\", \"text\", \"content\", \"result\", \"response\"]);\nif (!raw) raw = findLikelyOutputString(input);\nif (!raw) raw = \"\";\n\n// ---------- 1) Split into items by literal /n (DO NOT replace /n) ----------\nvar parts = raw.split(\"/n\");\nvar entries = [];\nfor (var i = 0; i < parts.length; i++) {\n  var t = String(parts[i] === undefined || parts[i] === null ? \"\" : parts[i]).trim();\n  if (t) entries.push(t);\n}\nif (entries.length > 3) entries = entries.slice(0, 3);\n\n// Collapse internal newlines and excess spaces per entry\nfor (var e = 0; e < entries.length; e++) {\n  entries[e] = collapseWhitespace(entries[e]);\n}\n\n// ---------- 2) Parse entries ----------\nvar articles = [];\n\nfor (var ei = 0; ei < entries.length; ei++) {\n  var entry = entries[ei];\n  var fields = splitPipes(entry);\n\n  if (fields.length < 5) {\n    var td0 = parseTitleAndDate(fields[0] || \"\");\n    articles.push({ title: td0.title, date: td0.date, h2: fields[1] || \"\", action: \"\", explainer: \"\", url: \"\" });\n    continue;\n  }\n\n  var td = parseTitleAndDate(fields[0] || \"\");\n  var h2 = fields[1] || \"\";\n  var action = fields[2] || \"\";\n\n  // find link field from end\n  var linkIndex = -1;\n  for (var j = fields.length - 1; j >= 0; j--) {\n    if (/href\\s*=/.test(fields[j]) || /^https?:\\/\\//i.test(fields[j])) {\n      linkIndex = j;\n      break;\n    }\n  }\n  if (linkIndex === -1) linkIndex = fields.length - 1;\n\n  var linkPart = fields.slice(linkIndex).join(\" | \");\n  var explainer = fields.slice(3, linkIndex).join(\" | \").trim();\n\n  var url = extractHref(linkPart);\n  if (!url) url = extractHref(entry);\n  if (!url && /^https?:\\/\\//i.test(linkPart)) url = linkPart.trim();\n\n  articles.push({ title: td.title, date: td.date, h2: h2, action: action, explainer: explainer, url: url });\n}\n\n// pad to 3\nwhile (articles.length < 3) {\n  articles.push({ title: \"\", date: \"\", h2: \"\", action: \"\", explainer: \"\", url: \"\" });\n}\narticles.length = 3;\n\n// ---------- 3) cleaned_text ----------\nvar cleaned_text = articles\n  .map(function (a) {\n    var titleWithDate = a.date ? (a.title + \" (\" + a.date + \")\") : a.title;\n    var link = a.url ? '<a href=\"' + a.url + '\">Read article</a>' : \"\";\n    return titleWithDate + \" | \" + a.h2 + \" | \" + a.action + \" | \" + a.explainer + \" | \" + link;\n  })\n  .join(\"\\n\");\n\n// ---------- 4) html_email ----------\nvar cards = articles\n  .map(function (a) {\n    var titleWithDate = a.date ? (a.title + \" (\" + a.date + \")\") : a.title;\n\n    var titleEsc = esc(titleWithDate);\n    var h2Esc = esc(a.h2);\n    var actionEsc = esc(a.action);\n    var explainerEsc = esc(a.explainer);\n    var urlEsc = esc(a.url);\n\n    var linkHtml = a.url\n      ? '<div style=\"margin:0; font-size:14px; line-height:20px;\">' +\n          '<a href=\"' + urlEsc + '\" style=\"color:#1155cc; text-decoration:underline;\">Read article</a>' +\n        \"</div>\"\n      : \"\";\n\n    return (\n      '<div style=\"margin:0 0 14px 0; padding:14px; border:1px solid #e6e6e6; border-radius:10px;\">' +\n        '<div style=\"margin:0 0 6px 0; font-size:14px; line-height:20px; color:#111; font-weight:700;\">' +\n          titleEsc +\n        \"</div>\" +\n        '<div style=\"margin:0 0 8px 0; font-size:14px; line-height:20px; color:#333; font-weight:600;\">' +\n          h2Esc +\n        \"</div>\" +\n        '<div style=\"margin:0 0 10px 0; font-size:14px; line-height:20px; color:#444;\">' +\n          actionEsc +\n        \"</div>\" +\n        '<div style=\"margin:0 0 10px 0; font-size:14px; line-height:20px; color:#444;\">' +\n          explainerEsc +\n        \"</div>\" +\n        linkHtml +\n      \"</div>\"\n    );\n  })\n  .join(\"\\n\");\n\nvar html_email =\n  '<div style=\"font-family: Arial, Helvetica, sans-serif; color:#111; font-size:14px; line-height:20px;\">' +\n    '<p style=\"margin:0 0 12px 0;\">Here are three recommended reads tailored to the challenge.</p>' +\n    cards +\n  \"</div>\";\n\n// ---------- Debug ----------\nvar debug = {\n  raw_preview: String(raw).slice(0, 300),\n  entry_count: entries.length,\n  entries_preview: entries\n};\n\nreturn [{ json: { cleaned_text: cleaned_text, articles: articles, html_email: html_email, debug: debug } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        832,
        -880
      ],
      "id": "98ab045a-509e-4e49-970d-b58b62fc2ec5",
      "name": "Create Examples HTML List3"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Challenge anchored ranking prompt\n\nSource constraints. Non negotiable:\nYou must NOT browse, crawl, open, or read any webpages.\nYou must use ONLY the dataset contained in the following text as the sole source of truth:\n{{$json.text}}\n\nChallenge definition:\nChallenge version A:\n{{$node[\"Identify Challenge1\"].json.output}}\n\nChallenge version B:\n{{$node[\"Three Things Tina\"].json.body.data.analysis.data_collection_results.Challenge.value}}\n\nHelpful context. Use only if relevant and do not override the challenge wording:\nRecommendations for next steps:\n{{$node[\"Identify Recommendations1\"].json.output}}\nExamples of next steps:\n{{$node[\"Examples Next Steps1\"].json.output}}\n\nInterpretation constraint:\nAll relevance decisions must be explicitly grounded in the challenge wording above.\nDo NOT rely on generic BD best practice unless it directly maps to the challenge text.\n\nCorpus structure. How to identify an article:\n1) An article starts at a line that begins with a date in DD/MM/YY or DD/MM/YYYY format followed by a dash, for example \"29/04/24 - Sales Campaigns (Part 1) - Campaign preparation\".\n2) The article continues until the next such date line, or end of text.\n3) Treat the text immediately after the date line as the body for that article.\n\nURL construction. Mandatory:\nFor each article with date DD/MM/YY, construct the URL:\nhttps://linarconsulting.com/three-things-DD-MM-YY/\nUse leading zeros. Keep DD and MM as shown in the header. Convert slashes to hyphens.\n\nStep 1. Extract challenge anchors:\nFrom the combined challenge wording, extract 5 to 8 short anchor phrases using only exact wording that appears in the challenge text. Do not invent anchors.\n\nStep 2. For each article, extract evidence:\nA) Title. The full text after the date line.\nB) First in body H2 proxy:\n   Use the first clear section heading in the article body. A heading is a short line, often followed by paragraphs or bullets, that is not a full sentence. If none exists, leave blank.\nC) Evidence snippets:\n   Extract 2 to 4 short snippets from the article body, each max 25 words, that best match the anchors. If none match, output empty.\n\nStep 3. Score each article:\nScore each dimension from 0 to 5 using only the article body and the anchors.\nA) Anchor coverage\nB) Anchor precision\nC) Under time pressure usefulness\nD) Conversation move quality\nE) Fast win applicability\nTotal score = A+B+C+D+E, max 25\n\nStep 4. Rank and anti duplication:\nReturn the top 8 articles by Total score.\nIf two rely on the same behavioural mechanism, keep the higher score and include the next best distinct lever.\n\nFormatting constraints:\nDo not use em dashes or en dashes. Replace them with full stops or commas.\nCapitalise Titles and H2 lines to improve formatting.\n\nOutput rules. Strict and final. Parser critical:\nYou MUST output valid JSON only.\nYou MUST output exactly one JSON array of up to 8 objects.\nEach object must have exactly these keys, in this order:\ndate, title, url, h2, scores, total, anchors_matched, evidence\n\nField rules:\ndate. \"DD/MM/YY\"\ntitle. Title text only with leading letter capitalisation, without date,\nurl. Constructed URL\nh2. First in body H2 proxy or empty\nscores. An object with keys A,B,C,D,E as integers 0 to 5\ntotal. Integer 0 to 25\nanchors_matched. Array of anchor phrases used, exact text from challenge\nevidence. Array of 0 to 4 strings, each a snippet max 25 words\n\nDo not output any other text outside the JSON.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        80,
        -880
      ],
      "id": "1ce832ee-a527-44fc-ad28-c5fe1fd615ba",
      "name": "Identify 3 Relevant Three Things Artciles3"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.2",
          "mode": "list",
          "cachedResultName": "gpt-5.2"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        448,
        -672
      ],
      "id": "e3b49d0a-12e6-4276-a626-cf0f54172513",
      "name": "OpenAI Chat Model7",
      "credentials": {
        "openAiApi": {
          "id": "A6TzpvpaIyqf4IKq",
          "name": "Lee C chat GPT account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Structured output generator. Top 3 only\n\nSource constraints. Non negotiable:\nYou must NOT browse, crawl, open, or read any webpages.\nYou must use ONLY the ranked dataset provided below as the sole source of truth:\n{{ $json.output }}\n\nChallenge definition:\n{{$node[\"Identify Challenge1\"].json.output}}\n\nSelection rules:\n1) Select exactly THREE items from the ranked dataset.\n2) Prefer higher total score.\n3) Apply tie breaks strictly in this order:\n   a) Higher Anchor precision (score B)\n   b) Higher Anchor coverage (score A)\n   c) More concrete evidence snippets that clearly map to the challenge wording\n4) Anti duplication check:\n   If two candidates rely on the same behavioural mechanism, keep the higher scoring one and replace the other with the next best that introduces a distinct lever.\n   Anchor precision always outweighs variety.\n\nOutput structure. Mandatory:\nEach item must follow this exact field order, separated by pipe characters:\nTitle (DD/MM/YY) | First in-body H2 | Challenge action | Verbose relevance explainer | <a href=\"URL\">Read article</a>\n\nField instructions:\nTitle (DD/MM/YY).\n- Use the object title.\n- Append the date from the object date field in parentheses, exactly like: Title (DD/MM/YY).\n\nFirst in-body H2.\n- Use the object h2.\n- If missing, leave empty but keep the pipe.\n\nChallenge action.\n- Write one short imperative action.\n- It must be directly grounded in the challenge wording and the article evidence.\n\nVerbose relevance explainer.\n- Write 2 to 4 sentences.\n- Explicitly reference at least two exact anchor phrases from the challenge.\n- Tie each anchor phrase to specific evidence from the article.\n- Newlines are allowed inside this field if needed.\n\nURL.\n- Use the object url.\n- Wrap exactly as: <a href=\"URL\">Read article</a>\n\nDelimiter rules. Strict:\n- Output exactly THREE items.\n- Separate items using the literal token:\n/n\n- You MUST NOT use the token /n anywhere else.\n- Do NOT add extra delimiters, numbering, bullets, headings, or surrounding text.\n- Do NOT output JSON.\n\nPunctuation constraint:\nDo not use em dashes or en dashes.\nReplace them with full stops or commas.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        448,
        -880
      ],
      "id": "3b87b9da-4895-457e-a41e-84c38c4107d0",
      "name": "Format selected Articles3"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.2",
          "mode": "list",
          "cachedResultName": "gpt-5.2"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -2160,
        -688
      ],
      "id": "cb4c5780-6b4f-4392-8a4e-344f6af3ebc8",
      "name": "OpenAI Chat Model8",
      "credentials": {
        "openAiApi": {
          "id": "A6TzpvpaIyqf4IKq",
          "name": "Lee C chat GPT account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.2",
          "mode": "list",
          "cachedResultName": "gpt-5.2"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -1808,
        -688
      ],
      "id": "e11a4c8f-c7bb-470f-aea2-d7f4bdc57ab9",
      "name": "OpenAI Chat Model9",
      "credentials": {
        "openAiApi": {
          "id": "A6TzpvpaIyqf4IKq",
          "name": "Lee C chat GPT account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.2",
          "mode": "list",
          "cachedResultName": "gpt-5.2"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -1248,
        -688
      ],
      "id": "dc0ecc46-d4e6-4422-b715-a4137b94af4a",
      "name": "OpenAI Chat Model10",
      "credentials": {
        "openAiApi": {
          "id": "A6TzpvpaIyqf4IKq",
          "name": "Lee C chat GPT account"
        }
      }
    },
    {
      "parameters": {
        "toRecipients": "=lee@linarconsulting.com",
        "subject": "=***No Email captured during a conversation with Three Things Tina for {{ $('Three Things Tina').item.json.body.data.analysis.data_collection_results.Name.value }}",
        "bodyContent": "=<html>\n  <body style=\"margin:0; padding:0;\">\n    <div style=\"font-family: Arial, Helvetica, sans-serif; font-size:14px; line-height:1.6; color:#000000;\">\n\n      <!-- Header -->\n      <div style=\"margin:0 0 20px 0; padding:0;\">\n        <img src=\"https://raw.githubusercontent.com/LE-LeeC/LINAR/main/Linar-Wordmark-RGB-Red-optimized.png\"\n             alt=\"LINAR logo\"\n             style=\"height:20px; display:block; border:0; outline:none;\">\n      </div>\n\n      <!-- Greeting -->\n      <p style=\"margin:0 0 12px 0; padding:0;\">\n        Hi {{ $('Three Things Tina').item.json.body.data.analysis.data_collection_results.Name.value }}\n      </p>\n\n      <p style=\"margin:0 0 16px 0; padding:0;\">\n        Thanks for speaking to me. I really enjoyed our conversation and have made some recommendations below which I hope are helpful.\n      </p>\n\n      <!-- Challenge -->\n      <h3 style=\"font-size:18px; font-weight:700; color:#b10f2e; margin:30px 0 10px 0; padding:0;\">\n        Your challenge\n      </h3>\n      <p style=\"margin:0 0 16px 0; padding:0;\">\n        {{ $('Identify Challenge1').item.json.output }}\n      </p>\n\n      <!-- Recommendations -->\n      <h3 style=\"font-size:18px; font-weight:700; color:#b10f2e; margin:30px 0 10px 0; padding:0;\">\n        Recommendations\n      </h3>\n      <p style=\"margin:0 0 16px 0; padding:0;\">\n        {{ $('Identify Recommendations1').item.json.output }}\n      </p>     \n\n      <!-- What are you waiting for?! -->\n      <h3 style=\"font-size:18px; font-weight:700; color:#b10f2e; margin:30px 0 10px 0; padding:0;\">\n        What are you waiting for?!\n      </h3>\n      <p style=\"margin:0 0 12px 0; padding:0;\">\n        Based on the above, here are three things (there's always three!) you can do right now to get started:\n      </p>\n      <ul >\n        {{ $('Next Steps HTML Bullets3').item.json.html_bullets }}\n      </ul>\n\n      <!-- Related articles -->\n      <h3 style=\"font-size:18px; font-weight:700; color:#b10f2e; margin:30px 0 10px 0; padding:0;\">\n        Related articles\n      </h3>\n      <div style=\"margin:0; padding:0;\">\n        {{ $json.html_email }}\n      </div>\n\n      <!-- Footer -->\n      <hr style=\"margin:30px 0; border:0; border-top:1px solid #b10f2e;\">\n\n      <p style=\"margin:0 0 16px 0; padding:0;\">\n        You can find all of our Three Things articles\n        <a href=\"https://linarconsulting.com/resources/\" target=\"_blank\" style=\"color:#b10f2e; text-decoration:none;\">here</a>.\n        We also send out a weekly Three Things newsletter direct to your inbox, sign up\n        <a href=\"https://share-eu1.hsforms.com/1TvoeY-xqRLuJ-8TxHvsw_w2db85y\" target=\"_blank\" style=\"color:#b10f2e; text-decoration:none;\">here</a>.\n      </p>\n\n      <p style=\"margin:0; padding:0;\">Kind regards</p>\n      <p style=\"margin:6px 0 0 0; padding:0; font-weight:700;\">Tina</p>\n\n      <!-- Signature -->\n      <div style=\"margin-top:20px;\">\n\n        <p style=\"margin:0;\">Three Things agent</p>\n        <p style=\"margin:0; font-weight:700; color:#C82613;\">LINAR Consulting</p>\n\n        <p style=\"margin:6px 0 0 0;\">\n          <strong>E:</strong>\n          <a href=\"mailto:tina@linarconsulting.com\" style=\"color:#1155cc; text-decoration:none;\">\n            tina@linarconsulting.com\n          </a>\n        </p>\n\n        <p style=\"margin:0;\">\n          <strong>W:</strong>\n          <a href=\"https://linarconsulting.com/\" style=\"color:#1155cc; text-decoration:none;\">\n            www.linarconsulting.com\n          </a>\n        </p>\n\n        <p style=\"margin:12px 0 0 0; font-weight:700;\">\n          P.S. want a weekly sales and BD punch in the face?\n          <a href=\"https://share-eu1.hsforms.com/1TvoeY-xqRLuJ-8TxHvsw_w2db85y\" style=\"color:#1155cc; text-decoration:none;\">\n            Three Things\n          </a>\n          to get you ducking and weaving with your clients.\n        </p>\n\n      </div>\n\n    </div>\n  </body>\n</html>\n",
        "additionalFields": {
          "bccRecipients": "andy@legalengine.co.uk",
          "bodyContentType": "html"
        }
      },
      "type": "n8n-nodes-base.microsoftOutlook",
      "typeVersion": 2,
      "position": [
        1056,
        -880
      ],
      "id": "0c06a7c3-7d51-4e0f-8cb8-48a9caf67293",
      "name": "Tina Email - No email",
      "webhookId": "0a57ad19-7a2b-4e0f-bec4-605fcf511055",
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "id": "kzkaYt1eDxfbVnWx",
          "name": "Outlook Three Things Tina - 12 Feb 26"
        }
      }
    }
  ],
  "connections": {
    "Three Things Tina": {
      "main": [
        [
          {
            "node": "Full Transcript Code Node",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Identify Challenge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download a file1": {
      "main": [
        [
          {
            "node": "Extract from File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File": {
      "main": [
        [
          {
            "node": "Identify 3 Relevant Three Things Artciles",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Identify 3 Relevant Three Things Artciles",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Full Transcript Code Node": {
      "main": [
        [
          {
            "node": "If email is NOT captured",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Identify Challenge": {
      "main": [
        [
          {
            "node": "Identify Recommendations",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Identify Recommendations": {
      "main": [
        [
          {
            "node": "Recco HTML Bullets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Examples Next Steps": {
      "main": [
        [
          {
            "node": "Next Steps HTML Bullets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Recco HTML Bullets": {
      "main": [
        [
          {
            "node": "Examples Next Steps",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Next Steps HTML Bullets": {
      "main": [
        [
          {
            "node": "Download a file1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Examples HTML List": {
      "main": [
        [
          {
            "node": "Tina Email to User",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Identify 3 Relevant Three Things Artciles": {
      "main": [
        [
          {
            "node": "Format selected Articles",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "Format selected Articles",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Format selected Articles": {
      "main": [
        [
          {
            "node": "Create Examples HTML List",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model5": {
      "ai_languageModel": [
        [
          {
            "node": "Examples Next Steps",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model4": {
      "ai_languageModel": [
        [
          {
            "node": "Identify Recommendations",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "Identify Challenge",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Tina Email to User": {
      "main": [
        []
      ]
    },
    "If email is NOT captured": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "Identify Challenge1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download a file2": {
      "main": [
        [
          {
            "node": "Extract from File2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File2": {
      "main": [
        [
          {
            "node": "Identify 3 Relevant Three Things Artciles3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model6": {
      "ai_languageModel": [
        [
          {
            "node": "Identify 3 Relevant Three Things Artciles3",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Identify Challenge1": {
      "main": [
        [
          {
            "node": "Identify Recommendations1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Identify Recommendations1": {
      "main": [
        [
          {
            "node": "Recco HTML Bullets2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Examples Next Steps1": {
      "main": [
        [
          {
            "node": "Next Steps HTML Bullets3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Recco HTML Bullets2": {
      "main": [
        [
          {
            "node": "Examples Next Steps1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Next Steps HTML Bullets3": {
      "main": [
        [
          {
            "node": "Download a file2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Examples HTML List3": {
      "main": [
        [
          {
            "node": "Tina Email - No email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Identify 3 Relevant Three Things Artciles3": {
      "main": [
        [
          {
            "node": "Format selected Articles3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model7": {
      "ai_languageModel": [
        [
          {
            "node": "Format selected Articles3",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Format selected Articles3": {
      "main": [
        [
          {
            "node": "Create Examples HTML List3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model8": {
      "ai_languageModel": [
        [
          {
            "node": "Identify Challenge1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model9": {
      "ai_languageModel": [
        [
          {
            "node": "Identify Recommendations1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model10": {
      "ai_languageModel": [
        [
          {
            "node": "Examples Next Steps1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": {
    "node:Microsoft OneDrive Trigger": {
      "LastLink": "https://graph.microsoft.com/v1.0/me/drive/root/delta?token=NDslMjM0OyUyMzE7Mzs4NmQwNjNlOC03OTRlLTQxMDAtOGY0My01ODU3ODRlYjUwMDk7NjM5MDI5ODIyNjY4MTcwMDAwOzYwMjEyODg0OyUyMzslMjM7JTIzMDslMjM",
      "lastTimeChecked": "2026-01-02T20:24:31.611Z"
    }
  },
  "pinData": {
    "Three Things Tina": [
      {
        "json": {
          "headers": {
            "host": "leonard-dev.app.n8n.cloud",
            "user-agent": "ElevenLabs/1.0",
            "content-length": "45016",
            "accept": "*/*",
            "accept-encoding": "gzip, br",
            "cdn-loop": "cloudflare; loops=1; subreqs=1",
            "cf-connecting-ip": "34.77.234.246",
            "cf-ew-via": "15",
            "cf-ipcountry": "BE",
            "cf-ray": "9cca9d5633509ee8-CDG",
            "cf-visitor": "{\"scheme\":\"https\"}",
            "cf-worker": "n8n.cloud",
            "content-type": "application/json",
            "elevenlabs-signature": "t=1770883879,v0=cbc91ec1dbb721a785921256c8c3bd74c62495c19c670412b8eba748e7226cad",
            "x-forwarded-for": "34.77.234.246, 141.101.97.2",
            "x-forwarded-host": "leonard-dev.app.n8n.cloud",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "traefik-prod-users-gwc-52-6c4f4684d5-dxhms",
            "x-is-trusted": "yes",
            "x-real-ip": "34.77.234.246"
          },
          "params": {},
          "query": {},
          "body": {
            "type": "post_call_transcription",
            "event_timestamp": 1770883879,
            "data": {
              "agent_id": "agent_0101kfjpq72afbpt13zwvwb8dz2n",
              "agent_name": "TEST - Tina - Three Things - WhatsApp",
              "status": "done",
              "user_id": null,
              "branch_id": "agtbrch_6401kfjpq79nfy3sfkr7t8w2f2va",
              "version_id": "agtvrsn_1701kftxhe4sfwbawxwnega7h768",
              "transcript": [
                {
                  "role": "user",
                  "agent_metadata": null,
                  "message": "hey tina",
                  "multivoice_message": null,
                  "tool_calls": [],
                  "tool_results": [],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 0,
                  "conversation_turn_metrics": null,
                  "rag_retrieval_info": null,
                  "llm_usage": null,
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": "text"
                },
                {
                  "role": "agent",
                  "agent_metadata": {
                    "agent_id": "agent_0101kfjpq72afbpt13zwvwb8dz2n",
                    "branch_id": "agtbrch_6401kfjpq79nfy3sfkr7t8w2f2va",
                    "workflow_node_id": null
                  },
                  "message": "Hey there! Lovely to hear from you.\n\nSome people like a short written summary with links at the end of these chats. Would that be useful for you?",
                  "multivoice_message": null,
                  "tool_calls": [],
                  "tool_results": [],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 0,
                  "conversation_turn_metrics": {
                    "metrics": {
                      "convai_llm_service_ttf_sentence": {
                        "elapsed_time": 2.0300585119985044
                      },
                      "convai_llm_service_ttfb": {
                        "elapsed_time": 2.0291453629979515
                      },
                      "convai_llm_service_tt_last_sentence": {
                        "elapsed_time": 2.150041011002031
                      }
                    },
                    "convai_asr_provider": null,
                    "convai_tts_model": null
                  },
                  "rag_retrieval_info": {
                    "chunks": [
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "IAAlPqDOA5WFSoGcPs3S",
                        "vector_distance": 0.18451440334320068
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "tpUcP76iqI8EWiTxRrjg",
                        "vector_distance": 0.1854163408279419
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "UFHVselUYxuODPjeupOZ",
                        "vector_distance": 0.1854609251022339
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "uFaOQo34ws65SlvYmaOn",
                        "vector_distance": 0.18740975856781006
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "3WFkgunoU9YtRqXujwiu",
                        "vector_distance": 0.18743550777435303
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "UUVWfOoGGDoVCyyD1r7o",
                        "vector_distance": 0.1877935528755188
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "dQ7QdghhFsRGyOiraoPn",
                        "vector_distance": 0.1881483793258667
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "qpSq3dFsQW0UTM0yfmQ7",
                        "vector_distance": 0.18821728229522705
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "ymI3K25a4xngms8o0vYA",
                        "vector_distance": 0.19083058834075928
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "PcuzMAJkkwg6ybUYfBv9",
                        "vector_distance": 0.19196999073028564
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "DQT0Repwh0jfYClR8cho",
                        "vector_distance": 0.19203907251358032
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "Aqw5fUom4f66azBMxpm0",
                        "vector_distance": 0.19210541248321533
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "uiuz12bfAm4pv8VMcGxO",
                        "vector_distance": 0.1921544075012207
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "Npb11SH4vKjgPntefU3E",
                        "vector_distance": 0.19270706176757812
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "qDee5Figw5Q0YJEgJy8o",
                        "vector_distance": 0.19292980432510376
                      }
                    ],
                    "embedding_model": "e5_mistral_7b_instruct",
                    "retrieval_query": "hi",
                    "rag_latency_secs": 0.31106912300310796
                  },
                  "llm_usage": {
                    "model_usage": {
                      "gemini-2.5-flash": {
                        "input": {
                          "tokens": 15053,
                          "price": 0.00225795
                        },
                        "input_cache_read": {
                          "tokens": 0,
                          "price": 0
                        },
                        "input_cache_write": {
                          "tokens": 0,
                          "price": 0
                        },
                        "output_total": {
                          "tokens": 33,
                          "price": 1.98e-05
                        }
                      }
                    }
                  },
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": null
                },
                {
                  "role": "user",
                  "agent_metadata": null,
                  "message": "yes please",
                  "multivoice_message": null,
                  "tool_calls": [],
                  "tool_results": [],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 11,
                  "conversation_turn_metrics": null,
                  "rag_retrieval_info": null,
                  "llm_usage": null,
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": "text"
                },
                {
                  "role": "agent",
                  "agent_metadata": {
                    "agent_id": "agent_0101kfjpq72afbpt13zwvwb8dz2n",
                    "branch_id": "agtbrch_6401kfjpq79nfy3sfkr7t8w2f2va",
                    "workflow_node_id": null
                  },
                  "message": "No problem. If you want to share it now, just drop your email here. It'll only be used to send you a short summary and some relevant Three Things resources.",
                  "multivoice_message": null,
                  "tool_calls": [],
                  "tool_results": [],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 11,
                  "conversation_turn_metrics": {
                    "metrics": {
                      "convai_llm_service_ttf_sentence": {
                        "elapsed_time": 1.3950770649971673
                      },
                      "convai_llm_service_ttfb": {
                        "elapsed_time": 1.2680432699999074
                      },
                      "convai_llm_service_tt_last_sentence": {
                        "elapsed_time": 1.405631943998742
                      }
                    },
                    "convai_asr_provider": null,
                    "convai_tts_model": null
                  },
                  "rag_retrieval_info": {
                    "chunks": [
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "UUVWfOoGGDoVCyyD1r7o",
                        "vector_distance": 0.14513945579528809
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "dQ7QdghhFsRGyOiraoPn",
                        "vector_distance": 0.15105152130126953
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "tpUcP76iqI8EWiTxRrjg",
                        "vector_distance": 0.1518576741218567
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "eDCtVltT99rNRCANmtpu",
                        "vector_distance": 0.15191566944122314
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "uFaOQo34ws65SlvYmaOn",
                        "vector_distance": 0.15194523334503174
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "UFHVselUYxuODPjeupOZ",
                        "vector_distance": 0.154285728931427
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "IAAlPqDOA5WFSoGcPs3S",
                        "vector_distance": 0.1547558307647705
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "Uk2wa8EWrju2OncyPWQw",
                        "vector_distance": 0.15482378005981445
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "bCxAlqG9C0wzL2kreTXY",
                        "vector_distance": 0.15485763549804688
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "3WFkgunoU9YtRqXujwiu",
                        "vector_distance": 0.15637129545211792
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "qDee5Figw5Q0YJEgJy8o",
                        "vector_distance": 0.15647685527801514
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "PVLLSvwCYYN1d1z6vuUH",
                        "vector_distance": 0.15648329257965088
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "9PDWIGzV9Q3h2nkEGDod",
                        "vector_distance": 0.15746068954467773
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "7tLzC35Jb01HLH6RX6an",
                        "vector_distance": 0.15835988521575928
                      }
                    ],
                    "embedding_model": "e5_mistral_7b_instruct",
                    "retrieval_query": "would you like a short summary with links at the end of our chat?",
                    "rag_latency_secs": 0.23368358299921965
                  },
                  "llm_usage": {
                    "model_usage": {
                      "gemini-2.5-flash": {
                        "input": {
                          "tokens": 14403,
                          "price": 0.00216045
                        },
                        "input_cache_read": {
                          "tokens": 0,
                          "price": 0
                        },
                        "input_cache_write": {
                          "tokens": 0,
                          "price": 0
                        },
                        "output_total": {
                          "tokens": 36,
                          "price": 2.1599999999999996e-05
                        }
                      }
                    }
                  },
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": null
                },
                {
                  "role": "user",
                  "agent_metadata": null,
                  "message": "lee@linarconsulting.com",
                  "multivoice_message": null,
                  "tool_calls": [],
                  "tool_results": [],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 34,
                  "conversation_turn_metrics": null,
                  "rag_retrieval_info": null,
                  "llm_usage": null,
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": "text"
                },
                {
                  "role": "agent",
                  "agent_metadata": {
                    "agent_id": "agent_0101kfjpq72afbpt13zwvwb8dz2n",
                    "branch_id": "agtbrch_6401kfjpq79nfy3sfkr7t8w2f2va",
                    "workflow_node_id": null
                  },
                  "message": "Got it. Thanks, Lee.\n\nSo, what's on your mind today? What's a business development or sales challenge you're grappling with?",
                  "multivoice_message": null,
                  "tool_calls": [],
                  "tool_results": [],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 34,
                  "conversation_turn_metrics": {
                    "metrics": {
                      "convai_llm_service_ttf_sentence": {
                        "elapsed_time": 1.7622576260037022
                      },
                      "convai_llm_service_ttfb": {
                        "elapsed_time": 1.7616916749975644
                      },
                      "convai_llm_service_tt_last_sentence": {
                        "elapsed_time": 1.884638253999583
                      }
                    },
                    "convai_asr_provider": null,
                    "convai_tts_model": null
                  },
                  "rag_retrieval_info": {
                    "chunks": [
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "UUVWfOoGGDoVCyyD1r7o",
                        "vector_distance": 0.14516502618789673
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "gwF7XmxATk0HYwkgDXff",
                        "vector_distance": 0.14627337455749512
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "bCxAlqG9C0wzL2kreTXY",
                        "vector_distance": 0.15099620819091797
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "dQ7QdghhFsRGyOiraoPn",
                        "vector_distance": 0.15170836448669434
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "uFaOQo34ws65SlvYmaOn",
                        "vector_distance": 0.1524287462234497
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "eDCtVltT99rNRCANmtpu",
                        "vector_distance": 0.15283238887786865
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "PcuzMAJkkwg6ybUYfBv9",
                        "vector_distance": 0.15322399139404297
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "tpUcP76iqI8EWiTxRrjg",
                        "vector_distance": 0.15429657697677612
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "7tLzC35Jb01HLH6RX6an",
                        "vector_distance": 0.15444278717041016
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "zoU8WyXq1X3DxTgEoytR",
                        "vector_distance": 0.1548858880996704
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "PVLLSvwCYYN1d1z6vuUH",
                        "vector_distance": 0.15503686666488647
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "qDee5Figw5Q0YJEgJy8o",
                        "vector_distance": 0.155836284160614
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "qpSq3dFsQW0UTM0yfmQ7",
                        "vector_distance": 0.15639996528625488
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "9PDWIGzV9Q3h2nkEGDod",
                        "vector_distance": 0.15829569101333618
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "Uk2wa8EWrju2OncyPWQw",
                        "vector_distance": 0.15842628479003906
                      }
                    ],
                    "embedding_model": "e5_mistral_7b_instruct",
                    "retrieval_query": "do you want a summary with links sent to my email?",
                    "rag_latency_secs": 0.21039094200386899
                  },
                  "llm_usage": {
                    "model_usage": {
                      "gemini-2.5-flash": {
                        "input": {
                          "tokens": 15341,
                          "price": 0.00230115
                        },
                        "input_cache_read": {
                          "tokens": 0,
                          "price": 0
                        },
                        "input_cache_write": {
                          "tokens": 0,
                          "price": 0
                        },
                        "output_total": {
                          "tokens": 33,
                          "price": 1.98e-05
                        }
                      }
                    }
                  },
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": null
                },
                {
                  "role": "user",
                  "agent_metadata": null,
                  "message": "Trying to put together a client plan and don't know where to start?",
                  "multivoice_message": null,
                  "tool_calls": [],
                  "tool_results": [],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 56,
                  "conversation_turn_metrics": null,
                  "rag_retrieval_info": null,
                  "llm_usage": null,
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": "text"
                },
                {
                  "role": "agent",
                  "agent_metadata": {
                    "agent_id": "agent_0101kfjpq72afbpt13zwvwb8dz2n",
                    "branch_id": "agtbrch_6401kfjpq79nfy3sfkr7t8w2f2va",
                    "workflow_node_id": null
                  },
                  "message": "Ah, the client plan. That's a classic. It can feel a bit like staring at a blank canvas, can't it?\n\nA great place to start is by looking at your existing clients. It's often the easiest, most secure revenue you'll find.\n\nHave you had a chance to go back over the clients you billed last year and identify anyone you haven't spoken to since? Sometimes just finding a reason to reconnect with them can uncover opportunities you didn't even know were there.",
                  "multivoice_message": null,
                  "tool_calls": [],
                  "tool_results": [],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 56,
                  "conversation_turn_metrics": {
                    "metrics": {
                      "convai_llm_service_ttf_sentence": {
                        "elapsed_time": 3.9644647640016046
                      },
                      "convai_llm_service_ttfb": {
                        "elapsed_time": 3.963836648996221
                      },
                      "convai_llm_service_tt_last_sentence": {
                        "elapsed_time": 4.105326641998545
                      }
                    },
                    "convai_asr_provider": null,
                    "convai_tts_model": null
                  },
                  "rag_retrieval_info": {
                    "chunks": [
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "b5FIbKpvZZyNZvymppjA",
                        "vector_distance": 0.142153799533844
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "2fC2u6RIkwOEAraW2prG",
                        "vector_distance": 0.14279937744140625
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "SkkEPdwh9RDsWuG1iARp",
                        "vector_distance": 0.14346766471862793
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "RVVr3qoblgXG5d2RAhp4",
                        "vector_distance": 0.1437738537788391
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "jxGJ3j0Lscj2xtzVR3rl",
                        "vector_distance": 0.14472365379333496
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "Yn4PL86XNAD05j1kP9RL",
                        "vector_distance": 0.14504468441009521
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "gjDlLRXUWqFc58wwmaM7",
                        "vector_distance": 0.1453801989555359
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "hn039MHXzxy4JCFa6NE1",
                        "vector_distance": 0.14545178413391113
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "eDCtVltT99rNRCANmtpu",
                        "vector_distance": 0.14561623334884644
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "DwgBpagkI8qupj8YY1Lx",
                        "vector_distance": 0.1456717848777771
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "2Qfv8IRoq4suqeZfpRuX",
                        "vector_distance": 0.14776408672332764
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "DQT0Repwh0jfYClR8cho",
                        "vector_distance": 0.14804112911224365
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "wEFGvL1Io3dSPEc1glpk",
                        "vector_distance": 0.14804846048355103
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "s2ceCS70lyRYdaKOftUN",
                        "vector_distance": 0.14845651388168335
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "IAAlPqDOA5WFSoGcPs3S",
                        "vector_distance": 0.14858853816986084
                      }
                    ],
                    "embedding_model": "e5_mistral_7b_instruct",
                    "retrieval_query": "how do i start creating a client plan?",
                    "rag_latency_secs": 0.20826538300025277
                  },
                  "llm_usage": {
                    "model_usage": {
                      "gemini-2.5-flash": {
                        "input": {
                          "tokens": 15140,
                          "price": 0.002271
                        },
                        "input_cache_read": {
                          "tokens": 0,
                          "price": 0
                        },
                        "input_cache_write": {
                          "tokens": 0,
                          "price": 0
                        },
                        "output_total": {
                          "tokens": 106,
                          "price": 6.36e-05
                        }
                      }
                    }
                  },
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": null
                },
                {
                  "role": "user",
                  "agent_metadata": null,
                  "message": "Hmmm. Not the answer I was expecting. I have an existing client and a client plan already developed. However, it's looking a bit stale. Any thoughts on how to jazz it up?",
                  "multivoice_message": null,
                  "tool_calls": [],
                  "tool_results": [],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 127,
                  "conversation_turn_metrics": null,
                  "rag_retrieval_info": null,
                  "llm_usage": null,
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": "text"
                },
                {
                  "role": "agent",
                  "agent_metadata": {
                    "agent_id": "agent_0101kfjpq72afbpt13zwvwb8dz2n",
                    "branch_id": "agtbrch_6401kfjpq79nfy3sfkr7t8w2f2va",
                    "workflow_node_id": null
                  },
                  "message": "Ah, \"stale\" client plans \u2013 a common affliction! It's easy for them to become a bit of a tick-box exercise. Let's inject some life into it.\n\nHere are a couple of thoughts to make that existing client plan feel fresh and more dynamic:\n\n1.  Go beyond the immediate matter: Instead of just focusing on the current project, try to have conversations about the wider market, their industry, or even their internal strategic challenges. What's keeping them awake at night? What are they hearing about new regulations or economic shifts? These \"non-matter\" conversations can uncover deeper needs and position you as a true compass, not just a service provider.\n\n2.  \"Land, expand \u2013 and bring a mate\": If you have a happy client, dig a little deeper. Ask them what else is on their radar, which other teams are involved in their big initiatives, or if there's anything they wish someone could take off their plate. And don't go it alone! Think about who else in your firm offers a complementary service. Bringing a colleague along to a meeting can strengthen the relationship, show your firm's range, and open doors to new opportunities.\n\n3.  Anticipate their needs: Great service isn't just about responding to requests; it's about predicting what they'll need next. Can you give them a heads-up on upcoming regulatory changes, or offer to streamline a process before it becomes a headache? This shows you're always thinking ahead on their behalf and makes them feel truly special.\n\nDoes that resonate, or spark any ideas for how you might refresh your approach?",
                  "multivoice_message": null,
                  "tool_calls": [],
                  "tool_results": [],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 127,
                  "conversation_turn_metrics": {
                    "metrics": {
                      "convai_llm_service_ttf_sentence": {
                        "elapsed_time": 6.7612590470016585
                      },
                      "convai_llm_service_ttfb": {
                        "elapsed_time": 6.760683854998206
                      },
                      "convai_llm_service_tt_last_sentence": {
                        "elapsed_time": 8.110729346997687
                      }
                    },
                    "convai_asr_provider": null,
                    "convai_tts_model": null
                  },
                  "rag_retrieval_info": {
                    "chunks": [
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "dQ7QdghhFsRGyOiraoPn",
                        "vector_distance": 0.12803196907043457
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "wEFGvL1Io3dSPEc1glpk",
                        "vector_distance": 0.13035064935684204
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "eDCtVltT99rNRCANmtpu",
                        "vector_distance": 0.13184434175491333
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "hn039MHXzxy4JCFa6NE1",
                        "vector_distance": 0.13429546356201172
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "SkkEPdwh9RDsWuG1iARp",
                        "vector_distance": 0.13537585735321045
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "gjDlLRXUWqFc58wwmaM7",
                        "vector_distance": 0.1357783079147339
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "RVVr3qoblgXG5d2RAhp4",
                        "vector_distance": 0.13650178909301758
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "uFaOQo34ws65SlvYmaOn",
                        "vector_distance": 0.13715219497680664
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "e4xvUHhP5LAeVRvqj1o4",
                        "vector_distance": 0.13889437913894653
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "kS9WuwzHRwR8hkvwLtoT",
                        "vector_distance": 0.13909673690795898
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "qcRK6qlwrCk4e2b7Ulbx",
                        "vector_distance": 0.13980716466903687
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "AdUrjIOO7QBjSH4nsVJo",
                        "vector_distance": 0.13981473445892334
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "tpUcP76iqI8EWiTxRrjg",
                        "vector_distance": 0.139897882938385
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "2Qfv8IRoq4suqeZfpRuX",
                        "vector_distance": 0.1401044726371765
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "b5FIbKpvZZyNZvymppjA",
                        "vector_distance": 0.14085417985916138
                      }
                    ],
                    "embedding_model": "e5_mistral_7b_instruct",
                    "retrieval_query": "how can i make my client plan more exciting?",
                    "rag_latency_secs": 0.1993887279968476
                  },
                  "llm_usage": {
                    "model_usage": {
                      "gemini-2.5-flash": {
                        "input": {
                          "tokens": 15438,
                          "price": 0.0023157
                        },
                        "input_cache_read": {
                          "tokens": 0,
                          "price": 0
                        },
                        "input_cache_write": {
                          "tokens": 0,
                          "price": 0
                        },
                        "output_total": {
                          "tokens": 344,
                          "price": 0.0002064
                        }
                      }
                    }
                  },
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": null
                },
                {
                  "role": "user",
                  "agent_metadata": null,
                  "message": "it does. Do you have access to a client planning template?",
                  "multivoice_message": null,
                  "tool_calls": [],
                  "tool_results": [],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 174,
                  "conversation_turn_metrics": null,
                  "rag_retrieval_info": null,
                  "llm_usage": null,
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": "text"
                },
                {
                  "role": "agent",
                  "agent_metadata": {
                    "agent_id": "agent_0101kfjpq72afbpt13zwvwb8dz2n",
                    "branch_id": "agtbrch_6401kfjpq79nfy3sfkr7t8w2f2va",
                    "workflow_node_id": null
                  },
                  "message": "That's a great question, and honestly, a common request! While I don't have a single, rigid \"client planning template\" to hand over (because let's face it, every client and every plan is a bit unique, isn't it?), I can certainly give you a practical framework based on what we've seen work well.\n\nThink of it less as a template to fill in, and more as a set of prompts to guide your thinking and actions. This should help you build out or refresh your plan in a way that's genuinely useful and not just a document for the sake of it.\n\nHere\u2019s a simple framework you can adapt:\n\n1.  Client Overview & Relationship Health Check:\n       Who are the key contacts (and their PAs!)?\n       What's their business strategy and what are their current priorities/challenges?\n       What work have we done for them in the last 12-24 months?\n       When was our last meaningful, non-matter-specific conversation?\n       On a scale of 1-10, how \"sticky\" is our relationship? (Be honest!)\n\n2.  Opportunity Mapping (Beyond the Obvious):\n       What other services could we genuinely offer that align with their challenges?\n       Who else in their organisation could benefit from our expertise? (Think \"land and expand\" \u2013 which other teams are involved in their big initiatives?)\n       Are there any upcoming market changes or regulations that will impact them, where we could proactively offer support?\n       Who in our firm offers complementary services that we could introduce? (The \"bring a mate\" idea).\n\n3.  Engagement & Action Plan:\n       What's the next specific action you'll take? (e.g., \"Send article on X,\" \"Invite to webinar on Y,\" \"Suggest coffee with colleague Z\").\n       What's the purpose of that action? (e.g., \"Gather intelligence,\" \"Introduce new service,\" \"Deepen relationship\").\n       When will you do it? (Give yourself a deadline!)\n       How will you measure success for this client? (Beyond just revenue \u2013 think relationship strength, new introductions, deeper insights).\n\n4.  \"What If\" Scenarios:\n       What if their main contact leaves?\n       What if a competitor makes a move?\n       What if their industry faces a major disruption?\n       How can we be proactive in these situations?\n\nThe key is to keep it alive. It's not a static document; it's a living guide for how you nurture and grow that relationship.\n\nDoes that kind of framework help you get started, or would you like to dive deeper into any of those sections?",
                  "multivoice_message": null,
                  "tool_calls": [],
                  "tool_results": [],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 174,
                  "conversation_turn_metrics": {
                    "metrics": {
                      "convai_llm_service_ttf_sentence": {
                        "elapsed_time": 3.631959704005567
                      },
                      "convai_llm_service_ttfb": {
                        "elapsed_time": 3.631360309002048
                      },
                      "convai_llm_service_tt_last_sentence": {
                        "elapsed_time": 7.868392143005622
                      }
                    },
                    "convai_asr_provider": null,
                    "convai_tts_model": null
                  },
                  "rag_retrieval_info": {
                    "chunks": [
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "eDCtVltT99rNRCANmtpu",
                        "vector_distance": 0.13701117038726807
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "jxGJ3j0Lscj2xtzVR3rl",
                        "vector_distance": 0.14551687240600586
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "dQ7QdghhFsRGyOiraoPn",
                        "vector_distance": 0.1461789608001709
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "hn039MHXzxy4JCFa6NE1",
                        "vector_distance": 0.14686203002929688
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "e4xvUHhP5LAeVRvqj1o4",
                        "vector_distance": 0.14688926935195923
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "IAAlPqDOA5WFSoGcPs3S",
                        "vector_distance": 0.14761078357696533
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "2fC2u6RIkwOEAraW2prG",
                        "vector_distance": 0.1477189064025879
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "gjDlLRXUWqFc58wwmaM7",
                        "vector_distance": 0.1478506326675415
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "RVVr3qoblgXG5d2RAhp4",
                        "vector_distance": 0.14827466011047363
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "b5FIbKpvZZyNZvymppjA",
                        "vector_distance": 0.1485537886619568
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "ymI3K25a4xngms8o0vYA",
                        "vector_distance": 0.14939981698989868
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "zaNCpZIps0xQgruUyXey",
                        "vector_distance": 0.14985477924346924
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "SkkEPdwh9RDsWuG1iARp",
                        "vector_distance": 0.15031838417053223
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "uFaOQo34ws65SlvYmaOn",
                        "vector_distance": 0.15040063858032227
                      }
                    ],
                    "embedding_model": "e5_mistral_7b_instruct",
                    "retrieval_query": "do you have a client planning template i can use?",
                    "rag_latency_secs": 0.19732258500152966
                  },
                  "llm_usage": {
                    "model_usage": {
                      "gemini-2.5-flash": {
                        "input": {
                          "tokens": 15082,
                          "price": 0.0022622999999999996
                        },
                        "input_cache_read": {
                          "tokens": 0,
                          "price": 0
                        },
                        "input_cache_write": {
                          "tokens": 0,
                          "price": 0
                        },
                        "output_total": {
                          "tokens": 610,
                          "price": 0.000366
                        }
                      }
                    }
                  },
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": null
                },
                {
                  "role": "user",
                  "agent_metadata": null,
                  "message": "looks good. Thanks Tina",
                  "multivoice_message": null,
                  "tool_calls": [],
                  "tool_results": [],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 224,
                  "conversation_turn_metrics": null,
                  "rag_retrieval_info": null,
                  "llm_usage": null,
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": "text"
                },
                {
                  "role": "agent",
                  "agent_metadata": {
                    "agent_id": "agent_0101kfjpq72afbpt13zwvwb8dz2n",
                    "branch_id": "agtbrch_6401kfjpq79nfy3sfkr7t8w2f2va",
                    "workflow_node_id": null
                  },
                  "message": "Great! Glad that framework looks helpful, Lee.\n\nSo, just to recap, you were looking for ways to refresh your client plan, and we've talked through a few ideas to make it more dynamic, focusing on going beyond the immediate matter, expanding within the client, and anticipating their needs. We also covered a practical framework to guide your planning.\n\nYou've already given me your email address, so I'll make sure to send you a short written summary with links to some relevant Three Things resources shortly.\n\nThanks for the conversation, Lee. Appreciate you taking the time. Good luck putting those ideas into practice!",
                  "multivoice_message": null,
                  "tool_calls": [],
                  "tool_results": [],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 224,
                  "conversation_turn_metrics": {
                    "metrics": {
                      "convai_llm_service_ttf_sentence": {
                        "elapsed_time": 1.2636919880023925
                      },
                      "convai_llm_service_ttfb": {
                        "elapsed_time": 1.2631572550017154
                      },
                      "convai_llm_service_tt_last_sentence": {
                        "elapsed_time": 1.6236802120038192
                      }
                    },
                    "convai_asr_provider": null,
                    "convai_tts_model": null
                  },
                  "rag_retrieval_info": {
                    "chunks": [
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "eDCtVltT99rNRCANmtpu",
                        "vector_distance": 0.12774640321731567
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "dQ7QdghhFsRGyOiraoPn",
                        "vector_distance": 0.1283508539199829
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "jxGJ3j0Lscj2xtzVR3rl",
                        "vector_distance": 0.13004779815673828
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "hn039MHXzxy4JCFa6NE1",
                        "vector_distance": 0.13052642345428467
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "s2ceCS70lyRYdaKOftUN",
                        "vector_distance": 0.13065874576568604
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "wEFGvL1Io3dSPEc1glpk",
                        "vector_distance": 0.130720853805542
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "RVVr3qoblgXG5d2RAhp4",
                        "vector_distance": 0.13234943151474
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "uFaOQo34ws65SlvYmaOn",
                        "vector_distance": 0.13299381732940674
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "b5FIbKpvZZyNZvymppjA",
                        "vector_distance": 0.1332012414932251
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "2Qfv8IRoq4suqeZfpRuX",
                        "vector_distance": 0.1332772970199585
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "SkkEPdwh9RDsWuG1iARp",
                        "vector_distance": 0.13414990901947021
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "e4xvUHhP5LAeVRvqj1o4",
                        "vector_distance": 0.1348419189453125
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "kS9WuwzHRwR8hkvwLtoT",
                        "vector_distance": 0.13520312309265137
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "PQhSm31Uz1DuJD3yfSpt",
                        "vector_distance": 0.13582634925842285
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "Yn4PL86XNAD05j1kP9RL",
                        "vector_distance": 0.13757562637329102
                      }
                    ],
                    "embedding_model": "e5_mistral_7b_instruct",
                    "retrieval_query": "how can i refresh my stale client plan to make it more dynamic and useful?",
                    "rag_latency_secs": 0.23952762599947164
                  },
                  "llm_usage": null,
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": null
                },
                {
                  "role": "agent",
                  "agent_metadata": {
                    "agent_id": "agent_0101kfjpq72afbpt13zwvwb8dz2n",
                    "branch_id": "agtbrch_6401kfjpq79nfy3sfkr7t8w2f2va",
                    "workflow_node_id": null
                  },
                  "message": null,
                  "multivoice_message": null,
                  "tool_calls": [
                    {
                      "type": "system",
                      "request_id": "end_call_9db7b3521716455fb27ed9f9c8e207f0",
                      "tool_name": "end_call",
                      "params_as_json": "{\"reason\": \"User indicated satisfaction and thanked me. Email captured. Conversation naturally concluded.\", \"system__message_to_speak\": \"Great! Glad that framework looks helpful, Lee. So, just to recap, you were looking for ways to refresh your client plan, and we've talked through a few ideas to make it more dynamic, focusing on going beyond the immediate matter, expanding within the client, and anticipating their needs. We also covered a practical framework to guide your planning. You've already given me your email address, so I'll make sure to send you a short written summary with links to some relevant Three Things resources shortly. Thanks for the conversation, Lee. Appreciate you taking the time. Good luck putting those ideas into practice!\"}",
                      "tool_has_been_called": true,
                      "tool_details": null
                    }
                  ],
                  "tool_results": [],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 226,
                  "conversation_turn_metrics": {
                    "metrics": {
                      "convai_llm_service_ttf_sentence": {
                        "elapsed_time": 1.2636919880023925
                      },
                      "convai_llm_service_ttfb": {
                        "elapsed_time": 1.2631572550017154
                      },
                      "convai_llm_tool_request_generation_latency": {
                        "elapsed_time": 0.43984843399812235
                      },
                      "convai_llm_service_tt_last_sentence": {
                        "elapsed_time": 1.6236802120038192
                      }
                    },
                    "convai_asr_provider": null,
                    "convai_tts_model": null
                  },
                  "rag_retrieval_info": null,
                  "llm_usage": null,
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": null
                },
                {
                  "role": "agent",
                  "agent_metadata": {
                    "agent_id": "agent_0101kfjpq72afbpt13zwvwb8dz2n",
                    "branch_id": "agtbrch_6401kfjpq79nfy3sfkr7t8w2f2va",
                    "workflow_node_id": null
                  },
                  "message": null,
                  "multivoice_message": null,
                  "tool_calls": [],
                  "tool_results": [
                    {
                      "request_id": "end_call_9db7b3521716455fb27ed9f9c8e207f0",
                      "tool_name": "end_call",
                      "result_value": "{\"result_type\":\"end_call_success\",\"status\":\"success\",\"reason\":\"User indicated satisfaction and thanked me. Email captured. Conversation naturally concluded.\",\"message\":null}",
                      "is_error": false,
                      "tool_has_been_called": true,
                      "tool_latency_secs": 0.5028006970023853,
                      "error_type": "",
                      "raw_error_message": "",
                      "dynamic_variable_updates": [],
                      "type": "system",
                      "result": {
                        "result_type": "end_call_success",
                        "status": "success",
                        "reason": "User indicated satisfaction and thanked me. Email captured. Conversation naturally concluded.",
                        "message": null
                      }
                    }
                  ],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 227,
                  "conversation_turn_metrics": null,
                  "rag_retrieval_info": null,
                  "llm_usage": {
                    "model_usage": {
                      "gemini-2.5-flash": {
                        "input": {
                          "tokens": 16271,
                          "price": 0.00244065
                        },
                        "input_cache_read": {
                          "tokens": 0,
                          "price": 0
                        },
                        "input_cache_write": {
                          "tokens": 0,
                          "price": 0
                        },
                        "output_total": {
                          "tokens": 280,
                          "price": 0.000168
                        }
                      }
                    }
                  },
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": null
                }
              ],
              "metadata": {
                "start_time_unix_secs": 1770883640,
                "accepted_time_unix_secs": 1770883640,
                "call_duration_secs": 235,
                "cost": 380,
                "deletion_settings": {
                  "deletion_time_unix_secs": null,
                  "deleted_logs_at_time_unix_secs": null,
                  "deleted_audio_at_time_unix_secs": null,
                  "deleted_transcript_at_time_unix_secs": null,
                  "delete_transcript_and_pii": false,
                  "delete_audio": false
                },
                "feedback": {
                  "type": null,
                  "overall_score": null,
                  "likes": 0,
                  "dislikes": 0,
                  "rating": null,
                  "comment": null
                },
                "authorization_method": "whatsapp",
                "charging": {
                  "dev_discount": false,
                  "is_burst": false,
                  "tier": "enterprise",
                  "llm_usage": {
                    "irreversible_generation": {
                      "model_usage": {
                        "gemini-2.5-flash": {
                          "input": {
                            "tokens": 106728,
                            "price": 0.0160092
                          },
                          "input_cache_read": {
                            "tokens": 0,
                            "price": 0
                          },
                          "input_cache_write": {
                            "tokens": 0,
                            "price": 0
                          },
                          "output_total": {
                            "tokens": 1442,
                            "price": 0.0008652
                          }
                        }
                      }
                    },
                    "initiated_generation": {
                      "model_usage": {
                        "gemini-2.5-flash": {
                          "input": {
                            "tokens": 106728,
                            "price": 0.0160092
                          },
                          "input_cache_read": {
                            "tokens": 0,
                            "price": 0
                          },
                          "input_cache_write": {
                            "tokens": 0,
                            "price": 0
                          },
                          "output_total": {
                            "tokens": 1442,
                            "price": 0.0008652
                          }
                        }
                      }
                    }
                  },
                  "llm_price": 0.0168744,
                  "llm_charge": 170,
                  "call_charge": 210,
                  "free_minutes_consumed": 0,
                  "free_llm_dollars_consumed": 0
                },
                "phone_call": null,
                "batch_call": null,
                "termination_reason": "end_call tool was called.",
                "error": null,
                "warnings": [],
                "main_language": "en",
                "rag_usage": {
                  "usage_count": 7,
                  "embedding_model": "e5_mistral_7b_instruct"
                },
                "text_only": true,
                "features_usage": {
                  "language_detection": {
                    "enabled": false,
                    "used": false
                  },
                  "transfer_to_agent": {
                    "enabled": false,
                    "used": false
                  },
                  "transfer_to_number": {
                    "enabled": false,
                    "used": false
                  },
                  "multivoice": {
                    "enabled": false,
                    "used": false
                  },
                  "dtmf_tones": {
                    "enabled": false,
                    "used": false
                  },
                  "external_mcp_servers": {
                    "enabled": false,
                    "used": false
                  },
                  "pii_zrm_workspace": false,
                  "pii_zrm_agent": false,
                  "tool_dynamic_variable_updates": {
                    "enabled": false,
                    "used": false
                  },
                  "is_livekit": false,
                  "voicemail_detection": {
                    "enabled": false,
                    "used": false
                  },
                  "workflow": {
                    "enabled": false,
                    "tool_node": {
                      "enabled": false,
                      "used": false
                    },
                    "standalone_agent_node": {
                      "enabled": false,
                      "used": false
                    },
                    "phone_number_node": {
                      "enabled": false,
                      "used": false
                    },
                    "end_node": {
                      "enabled": false,
                      "used": false
                    }
                  },
                  "agent_testing": {
                    "enabled": false,
                    "tests_ran_after_last_modification": false,
                    "tests_ran_in_last_7_days": false
                  },
                  "versioning": {
                    "enabled": true,
                    "used": false
                  }
                },
                "eleven_assistant": {
                  "is_eleven_assistant": false
                },
                "initiator_id": null,
                "conversation_initiation_source": "whatsapp",
                "conversation_initiation_source_version": null,
                "timezone": "Europe/London",
                "async_metadata": null,
                "whatsapp": {
                  "direction": "inbound",
                  "whatsapp_phone_number_id": "984896298033377",
                  "whatsapp_user_id": "447889758119",
                  "awaiting_first_user_message": null
                },
                "agent_created_from": "ui",
                "agent_last_updated_from": "ui"
              },
              "analysis": {
                "evaluation_criteria_results": {
                  "name_capture": {
                    "criteria_id": "name_capture",
                    "result": "success",
                    "rationale": "The agent successfully captures the user's name as Lee, as evidenced by the agent addressing the user by name in multiple turns (e.g., \"Got it. Thanks, Lee.\", \"Glad that framework looks helpful, Lee.\", \"Thanks for the conversation, Lee.\")."
                  },
                  "email_capture": {
                    "criteria_id": "email_capture",
                    "result": "success",
                    "rationale": "The agent successfully captures the user's email address as lee@linarconsulting.com, as the user provides this email in response to the agent's request for an email to send a summary."
                  }
                },
                "data_collection_results": {
                  "Name": {
                    "data_collection_id": "Name",
                    "value": "Lee",
                    "json_schema": {
                      "type": "string",
                      "description": "Name of the user",
                      "enum": null,
                      "is_system_provided": false,
                      "dynamic_variable": "",
                      "constant_value": ""
                    },
                    "rationale": "The user's name is mentioned multiple times in the conversation. The agent uses the name \"Lee\" when addressing the user."
                  },
                  "Email address": {
                    "data_collection_id": "Email address",
                    "value": "lee@linarconsulting.com",
                    "json_schema": {
                      "type": "string",
                      "description": "User will input their email address via chat function",
                      "enum": null,
                      "is_system_provided": false,
                      "dynamic_variable": "",
                      "constant_value": ""
                    },
                    "rationale": "The user provided their email address, lee@linarconsulting.com, in response to the agent's request to \"drop your email here\" to receive a summary of the conversation."
                  },
                  "Challenge": {
                    "data_collection_id": "Challenge",
                    "value": "The user is seeking to refresh and improve an existing, but stale, client plan to make it more dynamic and effective.",
                    "json_schema": {
                      "type": "string",
                      "description": "Identify and summarise the problem and/or challenge the user is facing. Describe this in a short summary - maximum 75 words. \n\n",
                      "enum": null,
                      "is_system_provided": false,
                      "dynamic_variable": "",
                      "constant_value": ""
                    },
                    "rationale": "The user initially struggled with creating a client plan but later clarified that they already had one that felt stale. The challenge was to refresh and improve an existing client plan to make it more dynamic and effective."
                  },
                  "Recommendations": {
                    "data_collection_id": "Recommendations",
                    "value": "To refresh a stale client plan, focus on broader industry conversations to uncover deeper needs. \"Land, expand \u2013 and bring a mate\" by involving other teams and colleagues. Anticipate client needs by proactively offering support and heads-ups on upcoming changes. This positions you as a valuable partner, not just a service provider.",
                    "json_schema": {
                      "type": "string",
                      "description": "Your task is to provide a succinct **recommendation** on how to address the challenge. \n\nThis recommendation should be maximum 75 words in length. \n\nReturn just the plain-English context \u2014 no headings, no extra explanation.\n\nKeep it professional and clear.\n\nPlease make sure that all outputs are in *UK English* not American English, including all spelling and date formats.",
                      "enum": null,
                      "is_system_provided": false,
                      "dynamic_variable": "",
                      "constant_value": ""
                    },
                    "rationale": "The agent provides a few suggestions on how to refresh a stale client plan. These include going beyond the immediate matter, expanding within the client, and anticipating their needs. I have summarised these into a recommendation of under 75 words."
                  },
                  "Examples": {
                    "data_collection_id": "Examples",
                    "value": "Go beyond the immediate matter\nLand, expand \u2013 and bring a mate\nAnticipate their needs",
                    "json_schema": {
                      "type": "string",
                      "description": "Your task is to provide a list of **examples** the user could try to remedy their challenge. \n\nEach example should be displayed on a separate line. \n\nThere should be a maximum of three examples.\n\nReturn just the plain-English context \u2014 no headings, no extra explanation.\n\nKeep it professional and clear.\n\nPlease make sure that all outputs are in *UK English* not American English, including all spelling and date formats.",
                      "enum": null,
                      "is_system_provided": false,
                      "dynamic_variable": "",
                      "constant_value": ""
                    },
                    "rationale": "The agent provides three examples of how to refresh a client plan in its response at 2026-02-12T08:09:27+00:00. These examples are:\n\n1. Go beyond the immediate matter\n2. Land, expand \u2013 and bring a mate\n3. Anticipate their needs\n\nI have extracted these examples and formatted them as a plain-English string, with each example on a new line, as requested."
                  }
                },
                "evaluation_criteria_results_list": [
                  {
                    "criteria_id": "name_capture",
                    "result": "success",
                    "rationale": "The agent successfully captures the user's name as Lee, as evidenced by the agent addressing the user by name in multiple turns (e.g., \"Got it. Thanks, Lee.\", \"Glad that framework looks helpful, Lee.\", \"Thanks for the conversation, Lee.\")."
                  },
                  {
                    "criteria_id": "email_capture",
                    "result": "success",
                    "rationale": "The agent successfully captures the user's email address as lee@linarconsulting.com, as the user provides this email in response to the agent's request for an email to send a summary."
                  }
                ],
                "data_collection_results_list": [
                  {
                    "data_collection_id": "Name",
                    "value": "Lee",
                    "json_schema": {
                      "type": "string",
                      "description": "Name of the user",
                      "enum": null,
                      "is_system_provided": false,
                      "dynamic_variable": "",
                      "constant_value": ""
                    },
                    "rationale": "The user's name is mentioned multiple times in the conversation. The agent uses the name \"Lee\" when addressing the user."
                  },
                  {
                    "data_collection_id": "Email address",
                    "value": "lee@linarconsulting.com",
                    "json_schema": {
                      "type": "string",
                      "description": "User will input their email address via chat function",
                      "enum": null,
                      "is_system_provided": false,
                      "dynamic_variable": "",
                      "constant_value": ""
                    },
                    "rationale": "The user provided their email address, lee@linarconsulting.com, in response to the agent's request to \"drop your email here\" to receive a summary of the conversation."
                  },
                  {
                    "data_collection_id": "Challenge",
                    "value": "The user is seeking to refresh and improve an existing, but stale, client plan to make it more dynamic and effective.",
                    "json_schema": {
                      "type": "string",
                      "description": "Identify and summarise the problem and/or challenge the user is facing. Describe this in a short summary - maximum 75 words. \n\n",
                      "enum": null,
                      "is_system_provided": false,
                      "dynamic_variable": "",
                      "constant_value": ""
                    },
                    "rationale": "The user initially struggled with creating a client plan but later clarified that they already had one that felt stale. The challenge was to refresh and improve an existing client plan to make it more dynamic and effective."
                  },
                  {
                    "data_collection_id": "Recommendations",
                    "value": "To refresh a stale client plan, focus on broader industry conversations to uncover deeper needs. \"Land, expand \u2013 and bring a mate\" by involving other teams and colleagues. Anticipate client needs by proactively offering support and heads-ups on upcoming changes. This positions you as a valuable partner, not just a service provider.",
                    "json_schema": {
                      "type": "string",
                      "description": "Your task is to provide a succinct **recommendation** on how to address the challenge. \n\nThis recommendation should be maximum 75 words in length. \n\nReturn just the plain-English context \u2014 no headings, no extra explanation.\n\nKeep it professional and clear.\n\nPlease make sure that all outputs are in *UK English* not American English, including all spelling and date formats.",
                      "enum": null,
                      "is_system_provided": false,
                      "dynamic_variable": "",
                      "constant_value": ""
                    },
                    "rationale": "The agent provides a few suggestions on how to refresh a stale client plan. These include going beyond the immediate matter, expanding within the client, and anticipating their needs. I have summarised these into a recommendation of under 75 words."
                  },
                  {
                    "data_collection_id": "Examples",
                    "value": "Go beyond the immediate matter\nLand, expand \u2013 and bring a mate\nAnticipate their needs",
                    "json_schema": {
                      "type": "string",
                      "description": "Your task is to provide a list of **examples** the user could try to remedy their challenge. \n\nEach example should be displayed on a separate line. \n\nThere should be a maximum of three examples.\n\nReturn just the plain-English context \u2014 no headings, no extra explanation.\n\nKeep it professional and clear.\n\nPlease make sure that all outputs are in *UK English* not American English, including all spelling and date formats.",
                      "enum": null,
                      "is_system_provided": false,
                      "dynamic_variable": "",
                      "constant_value": ""
                    },
                    "rationale": "The agent provides three examples of how to refresh a client plan in its response at 2026-02-12T08:09:27+00:00. These examples are:\n\n1. Go beyond the immediate matter\n2. Land, expand \u2013 and bring a mate\n3. Anticipate their needs\n\nI have extracted these examples and formatted them as a plain-English string, with each example on a new line, as requested."
                  }
                ],
                "call_successful": "success",
                "transcript_summary": "Lee asked Tina for help refreshing a stale client plan. Tina provided advice on expanding the client relationship, anticipating needs, and having broader conversations. Tina then shared a framework for client planning, including relationship health checks, opportunity mapping, and action planning. Lee found the framework helpful. Tina will send a summary and resources to Lee's email.\n",
                "call_summary_title": "Refreshing Client Plan"
              },
              "conversation_initiation_client_data": {
                "conversation_config_override": {
                  "turn": null,
                  "tts": null,
                  "conversation": {
                    "text_only": true
                  },
                  "agent": {
                    "first_message": "",
                    "language": "en",
                    "prompt": {
                      "prompt": "",
                      "llm": "gemini-2.5-flash",
                      "native_mcp_server_ids": []
                    }
                  }
                },
                "custom_llm_extra_body": {},
                "user_id": null,
                "source_info": {
                  "source": null,
                  "version": null
                },
                "dynamic_variables": {
                  "system__agent_id": "agent_0101kfjpq72afbpt13zwvwb8dz2n",
                  "system__agent_turns": 7,
                  "system__current_agent_turns": 7,
                  "system__current_subagent_turns": 7,
                  "system__current_agent_id": "agent_0101kfjpq72afbpt13zwvwb8dz2n",
                  "system__conversation_id": "conv_4501kh8e7v3pfd8ax9jd6z35z0wr",
                  "system__call_duration_secs": 234,
                  "system__time_utc": "2026-02-12T08:11:15.133316+00:00",
                  "system__time": "Thursday, 08:11 12 February 2026",
                  "system__timezone": "Europe/London",
                  "system__caller_id": "447889758119",
                  "system__called_number": "984896298033377",
                  "system__call_sid": null
                }
              },
              "conversation_id": "conv_4501kh8e7v3pfd8ax9jd6z35z0wr"
            }
          },
          "webhookUrl": "https://leonard-dev.app.n8n.cloud/webhook/threethingstina",
          "executionMode": "production"
        }
      }
    ]
  },
  "triggerCount": 1,
  "meta": {
    "templateCredsSetupCompleted": true
  }
}