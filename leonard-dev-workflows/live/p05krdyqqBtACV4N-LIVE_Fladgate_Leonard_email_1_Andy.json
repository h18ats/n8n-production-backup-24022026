{
  "name": "LIVE - Fladgate Leonard email 1 - Andy",
  "nodes": [
    {
      "parameters": {},
      "id": "c0f4e2f9-cd97-4cbc-ae2b-f28f8d859c24",
      "name": "When clicking Test workflow1",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -1200,
        -256
      ]
    },
    {
      "parameters": {
        "amount": "={{ $json.delay }}",
        "unit": "minutes"
      },
      "id": "90a3f2b4-80bf-4372-b1b1-62a771c0d99f",
      "name": "Wait",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1648,
        176
      ],
      "webhookId": "5cd0e654-41ac-403a-add1-487266122903"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "69676b6c-2bf4-4312-b916-4316c66421a8",
              "leftValue": "={{ $json.error.message }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        32,
        -64
      ],
      "id": "24841b6c-bd2d-4205-9b6b-f703e8cca94a",
      "name": "If1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "c6609bda-ba69-4fba-b2e7-98cb627cb30c",
              "leftValue": "={{ $json[\"Fee earner email\"]?.isEmail()}}",
              "rightValue": "true",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "17d0b1fb-86da-4ce2-a1f8-908ea40575e9",
      "name": "Is it an Email ?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -784,
        -80
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "e5f7f530-6e9e-4ddb-bde1-51658a0c8027",
      "name": "Loop Over Emails",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -368,
        -80
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.dateTime",
      "typeVersion": 2,
      "position": [
        640,
        -48
      ],
      "id": "30b569b9-a088-4fcd-90e0-b0b423b434ff",
      "name": "Date & Time1"
    },
    {
      "parameters": {
        "jsCode": "// --- Function node code ---\n// Get the first item (same pattern you used)\nconst inputDate = new Date($input.first().json.currentDate);   // \"2025-05-26T10:22:34.868+01:00\"\n\n// Helper to zero-pad to two digits\nconst pad = n => n.toString().padStart(2, '0');\n\n// Date  \u2192  MM/DD/YYYY\nconst formattedDate = `${pad(inputDate.getMonth() + 1)}/${pad(inputDate.getDate())}/${inputDate.getFullYear()}`;\n\n// Time  \u2192  HH:mm:ss   (24-hour clock)\nconst formattedTime = `${pad(inputDate.getHours())}:${pad(inputDate.getMinutes())}:${pad(inputDate.getSeconds())}`;\n\nreturn [\n  {\n    json: {\n      formattedDate,   // e.g. \"05/26/2025\"\n      formattedTime    // e.g. \"09:22:34\"\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        944,
        -48
      ],
      "id": "30dbf398-9a72-4117-9e9c-51dc8b716557",
      "name": "Date Format2"
    },
    {
      "parameters": {
        "toRecipients": "={{ $json[\"Fee earner email\"] }}",
        "subject": "=Reminder: Please speak to Leonard about your directory submission",
        "bodyContent": "=Hi {{ $json[\"Fee earner first name\"] }},\n\nThis is a reminder that you\u2019ve been invited to speak with me, Leonard, your new AI assistant for directory submissions.\n\nPlease follow this link (https://fladgate.legalengine.co.uk/) to speak with me as soon as possible. I\u2019m available 24/7 and it will take less than 8 minutes to discuss each matter.\n\nIf you\u2019ve already spoken to me, it\u2019s likely I\u2019m waiting for a further matter summary from you. I will continue to remind you to speak to me until all matter summaries that you have been allocated are completed.\n\nLet me know if you need anything more.\n\nKind regards,\n\nLeonard\n\nAI Assistant\nLegal Engine\nE: leonard@legalengine.co.uk\nW: www.legalengine.co.uk",
        "additionalFields": {
          "bodyContentType": "Text"
        }
      },
      "type": "n8n-nodes-base.microsoftOutlook",
      "typeVersion": 2,
      "position": [
        304,
        -48
      ],
      "id": "bfaec303-d72a-4c2e-862f-e28a287928e3",
      "name": "Email from Leonard Wave 1",
      "webhookId": "dba5b59f-aca4-46ad-a57b-801377929e27",
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "id": "OAftwNOqCIYj8Src",
          "name": "Microsoft Outlook - New Dec 2025 Leonard account"
        }
      }
    },
    {
      "parameters": {
        "operation": "upsert",
        "base": {
          "__rl": true,
          "value": "appUvJyzSky12m4HA",
          "mode": "list",
          "cachedResultName": "Fladgate - Leonard Live Data",
          "cachedResultUrl": "https://airtable.com/appUvJyzSky12m4HA"
        },
        "table": {
          "__rl": true,
          "value": "tbl3uoFjmxFM1fr26",
          "mode": "list",
          "cachedResultName": "FG - User Engagement Tracking",
          "cachedResultUrl": "https://airtable.com/appUvJyzSky12m4HA/tbl3uoFjmxFM1fr26"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Email 1 Sent": true,
            "Fee earner email": "={{ $('If1').item.json[\"Fee earner email\"] }}",
            "Email 1 Sent Date/Time": "={{ $('Date & Time1').item.json.currentDate }}"
          },
          "matchingColumns": [
            "Fee earner email"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Fee earner email",
              "displayName": "Fee earner email",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Fee earner first name",
              "displayName": "Fee earner first name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Fee earner surname",
              "displayName": "Fee earner surname",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Created",
              "displayName": "Created",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Last Modified",
              "displayName": "Last Modified",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Submission category",
              "displayName": "Submission category",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Matter name/reference",
              "displayName": "Matter name/reference",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Matter details",
              "displayName": "Matter details",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Previous write up available?",
              "displayName": "Previous write up available?",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Link to previous write up",
              "displayName": "Link to previous write up",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Department",
              "displayName": "Department",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "BD rep 1 email",
              "displayName": "BD rep 1 email",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "BD rep 2 email",
              "displayName": "BD rep 2 email",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Shared inbox",
              "displayName": "Shared inbox",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Submission date",
              "displayName": "Submission date",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "dateTime",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Internal deadline",
              "displayName": "Internal deadline",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "dateTime",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Change requested",
              "displayName": "Change requested",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Change acknowledged by Legal Engine",
              "displayName": "Change acknowledged by Legal Engine",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Change completed",
              "displayName": "Change completed",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Email 1 Sent",
              "displayName": "Email 1 Sent",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "boolean",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Email 1 Sent Date/Time",
              "displayName": "Email 1 Sent Date/Time",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "dateTime",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Email 2 Sent",
              "displayName": "Email 2 Sent",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "boolean",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Email 2 Sent Date/Time",
              "displayName": "Email 2 Sent Date/Time",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "dateTime",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Clicked Email Link",
              "displayName": "Clicked Email Link",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "boolean",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Clicked Email Link Date/Time",
              "displayName": "Clicked Email Link Date/Time",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "dateTime",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "SSO Attempt",
              "displayName": "SSO Attempt",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "boolean",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "SSO Attempt Date/Time",
              "displayName": "SSO Attempt Date/Time",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "dateTime",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "SSO Success",
              "displayName": "SSO Success",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "boolean",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "SSO Success Date/Time",
              "displayName": "SSO Success Date/Time",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "dateTime",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Leonard Conversation Started",
              "displayName": "Leonard Conversation Started",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "boolean",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Conversation Started Date/Time",
              "displayName": "Conversation Started Date/Time",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "dateTime",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Leonard Conversation >75s",
              "displayName": "Leonard Conversation >75s",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "boolean",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Matter Email Sent",
              "displayName": "Matter Email Sent",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "boolean",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Matter Email Sent Date/Time",
              "displayName": "Matter Email Sent Date/Time",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "dateTime",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Matter Completed",
              "displayName": "Matter Completed",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "boolean",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Matter Completed Date/Time",
              "displayName": "Matter Completed Date/Time",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "dateTime",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Notes",
              "displayName": "Notes",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        1168,
        -48
      ],
      "id": "7ff81768-3ba3-4cae-b302-241e6804e7fd",
      "name": "FG - Email 1 Sent",
      "credentials": {
        "airtableTokenApi": {
          "id": "LVF892xkQD72QD7v",
          "name": "Airtable - Leonard @ Legal Engine"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "753fa35a-22c8-4075-972c-015f48f022f6",
              "leftValue": "={{ $json.dayOfWeek }}",
              "rightValue": "Saturday",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "ea8be296-0f82-4863-a299-bfe281ac0d5e",
              "leftValue": "={{ $json.dayOfWeek }}",
              "rightValue": "Sunday",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -1280,
        -80
      ],
      "id": "527ff4c1-9b64-4797-816b-32bfc92c017c",
      "name": "If"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.dateTime",
      "typeVersion": 2,
      "position": [
        -1664,
        -80
      ],
      "id": "9aebde3e-8bf9-4d84-b47b-00a51d5da327",
      "name": "Date & Time"
    },
    {
      "parameters": {
        "jsCode": "// Input: expects $json.currentDate to be an ISO string\nconst iso = ($json.currentDate || '').toString().trim();\nconst d = new Date(iso);\n\nif (Number.isNaN(d.getTime())) {\n  throw new Error(`Invalid date in currentDate: ${iso}`);\n}\n\n// Use UTC because the input is +00:00\nconst day = new Intl.DateTimeFormat('en-GB', {\n  weekday: 'long',\n  timeZone: 'UTC',\n}).format(d);\n\nreturn [{ json: { ...$json, dayOfWeek: day } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1456,
        -80
      ],
      "id": "041013ae-10ec-4b97-9885-b68c2e2444c3",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "jsCode": "// Initialiser le message\nmsg = {};\n\n// Ajouter un d\u00e9lai al\u00e9atoire entre 0 et 5 minutes\nconst randomDelay = Math.floor(Math.random() * 5) ;\n\n// Calculer le d\u00e9lai total\nconst totalDelay = randomDelay;\n\n// Ajouter le d\u00e9lai au message\nmsg.delay = totalDelay;\n\n// Retourner le message\nreturn msg;"
      },
      "id": "8b741cd9-98e0-4ab3-a36c-5be7cf366f39",
      "name": "Randomise to 5min delays",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1392,
        -48
      ]
    },
    {
      "parameters": {
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "appUvJyzSky12m4HA",
          "mode": "list",
          "cachedResultName": "Fladgate - Leonard Live Data",
          "cachedResultUrl": "https://airtable.com/appUvJyzSky12m4HA"
        },
        "table": {
          "__rl": true,
          "value": "tbl3uoFjmxFM1fr26",
          "mode": "list",
          "cachedResultName": "FG - User Engagement Tracking",
          "cachedResultUrl": "https://airtable.com/appUvJyzSky12m4HA/tbl3uoFjmxFM1fr26"
        },
        "options": {},
        "sort": {
          "property": [
            {
              "field": "Fee earner email",
              "direction": "desc"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        -976,
        -80
      ],
      "id": "9de2b01d-f15d-4733-901f-e8cb66c5ff3c",
      "name": "FG - Emails to send from airtable",
      "credentials": {
        "airtableTokenApi": {
          "id": "LVF892xkQD72QD7v",
          "name": "Airtable - Leonard @ Legal Engine"
        }
      }
    }
  ],
  "connections": {
    "When clicking Test workflow1": {
      "main": [
        [
          {
            "node": "FG - Emails to send from airtable",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Loop Over Emails",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Loop Over Emails",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Email from Leonard Wave 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is it an Email ?": {
      "main": [
        [
          {
            "node": "Loop Over Emails",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Emails": {
      "main": [
        [],
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Date & Time1": {
      "main": [
        [
          {
            "node": "Date Format2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Date Format2": {
      "main": [
        [
          {
            "node": "FG - Email 1 Sent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Email from Leonard Wave 1": {
      "main": [
        [
          {
            "node": "Date & Time1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "FG - Email 1 Sent": {
      "main": [
        [
          {
            "node": "Randomise to 5min delays",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [],
        [
          {
            "node": "FG - Emails to send from airtable",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Date & Time": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Randomise to 5min delays": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "FG - Emails to send from airtable": {
      "main": [
        [
          {
            "node": "Is it an Email ?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": {
    "node:8.45am Trigger": {
      "recurrenceRules": [
        26
      ]
    },
    "node:8.35am Trigger": {
      "recurrenceRules": [
        34
      ]
    }
  },
  "pinData": {},
  "triggerCount": 1,
  "meta": {
    "templateCredsSetupCompleted": true
  }
}