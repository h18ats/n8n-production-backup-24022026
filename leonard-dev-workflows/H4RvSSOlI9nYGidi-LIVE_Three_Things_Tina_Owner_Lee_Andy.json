{
  "name": "LIVE - Three Things Tina - Owner Lee/Andy",
  "nodes": [
    {
      "parameters": {
        "projectId": {
          "__rl": true,
          "value": "vertex-ai-api-setup-via-cli",
          "mode": "id"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleVertex",
      "typeVersion": 1,
      "position": [
        -2384,
        1584
      ],
      "id": "59ce33c8-742f-45de-be3f-ee267761832a",
      "name": "Google Vertex Chat Model2",
      "credentials": {
        "googleApi": {
          "id": "LQjM9YuYI3HxJBrE",
          "name": "Google Service Account - Edu account Oct 8th"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "toRecipients": "=lee@legalengine.co.uk",
        "subject": "Your conversation with Three Things Tina",
        "bodyContent": "=<html>\n      <body style=\"font-family: Arial, sans-serif; color: #000000; line-height: 1.6;\">\n\n    <!-- Header logos -->\n    <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;\">\n      \n\n<img src=\"https://raw.githubusercontent.com/LE-LeeC/LINAR/main/Linar-Wordmark-RGB-Red-optimized.png\" alt=\"LINAR logo\" style=\"height: 20px;\">\n    </div>\n\n    <!-- Greeting -->    \n<p style=\"font-size: 15px;\">Hi, {{ $('Three Things Tina').item.json.body.data.analysis.data_collection_results.Name.value }} </p>\n\n    <p style=\"font-size: 15px;\">Thanks for speaking to me. I really enjoyed our conversation and have made some recommendations below which I hope are helpful.</p>\n\n    <!-- Challenge -->\n    <h3 style=\"font-size: 18px; color: #b10f2e;; margin-top: 30px;\">Your challenge</h3>\n    <p style=\"font-size: 14px;\">{{ $('Challenge').item.json.output }}</p>\n\n    <!-- Recommendations -->\n    <h3 style=\"font-size: 18px; color: #b10f2e;; margin-top: 30px;\">Recommendations</h3>\n<ul style=\"font-size:14px; margin:5px 0 0 20px; padding:0; list-style-type:none;\">\n  {{ $('Recommendations').item.json.output }}\n</ul>\n\n<!-- Immediate actions -->\n    <h3 style=\"font-size: 18px; color: #b10f2e;; margin-top: 30px;\">Immediate actions</h3> \n<p style=\"font-size:14px; margin:0 0 20px 0;\">\n      Based on the above, we recommend you take the following actions to address your immediate challenge:\n    </p>\n<ul style=\"font-size:14px; margin:5px 0 0 20px; padding:0; list-style-type:none;\">\n  {{ $json.html_bullets }}\n</ul>\n\n\n\n<!-- Related articles -->\n    <h3 style=\"font-size: 18px; color: #b10f2e; margin-top: 30px;\">Related articles</h3>\n<p style=\"font-size: 14px;\">{{ $json.html_email }}</p>\n\n\n    <!-- Footer -->\n    <hr style=\"margin: 30px 0; border: none; border-top: 1px solid #b10f2e;\" />\n\n    <p style=\"font-size: 14px;\">\n      You can find all of our Three Things articles \n      <a href=\"https://linarconsulting.com/resources/\" target=\"_blank\" style=\"color: #b10f2e; text-decoration: none;\">here</a>. We also send out a weekly Three Things newsletter direct to your inbox - sign up <a href=\"https://share-eu1.hsforms.com/1TvoeY-xqRLuJ-8TxHvsw_w2db85y\" target=\"_blank\" style=\"color: #b10f2e; text-decoration: none;\">here</a>. \n    </p>\n\n    <p style=\"font-size: 14px; margin-top: 20px;\">Kind regards</p>\n\n <p style=\"font-size: 14px; font-style: bold; margin-top: 20px;\">Tina</p>\n\n<div class=\"WordSection1\">\n\n\n<p class=\"MsoNormal\" style=\"margin-bottom:0cm;line-height:normal;vertical-align:\nbaseline\"><span style=\"mso-ascii-font-family:Aptos;mso-fareast-font-family:\n&quot;Times New Roman&quot;;mso-hansi-font-family:Aptos;mso-bidi-font-family:Aptos;\ncolor:black;mso-font-kerning:0pt;mso-ligatures:none;mso-fareast-language:EN-GB;\nmso-no-proof:yes\">Tina</span><span style=\"mso-ascii-font-family:Aptos;\nmso-fareast-font-family:&quot;Times New Roman&quot;;mso-hansi-font-family:Aptos;\nmso-bidi-font-family:Aptos;mso-font-kerning:0pt;mso-ligatures:none;mso-fareast-language:\nEN-GB;mso-no-proof:yes\"><o:p></o:p></span></p>\n\n<p class=\"MsoNormal\" style=\"margin-bottom:0cm;line-height:normal;vertical-align:\nbaseline\"><b><span style=\"mso-ascii-font-family:Aptos;mso-fareast-font-family:\n&quot;Times New Roman&quot;;mso-hansi-font-family:Aptos;mso-bidi-font-family:Aptos;\ncolor:black;mso-font-kerning:0pt;mso-ligatures:none;mso-fareast-language:EN-GB;\nmso-no-proof:yes\">Three Things agent</span></b><span style=\"mso-ascii-font-family:\nAptos;mso-fareast-font-family:&quot;Times New Roman&quot;;mso-hansi-font-family:Aptos;\nmso-bidi-font-family:Aptos;mso-font-kerning:0pt;mso-ligatures:none;mso-fareast-language:\nEN-GB;mso-no-proof:yes\"><o:p></o:p></span></p>\n\n<p class=\"MsoNormal\" style=\"margin-bottom:0cm;line-height:normal;vertical-align:\nbaseline\"><b><span style=\"mso-ascii-font-family:Aptos;mso-fareast-font-family:\n&quot;Times New Roman&quot;;mso-hansi-font-family:Aptos;mso-bidi-font-family:Aptos;\ncolor:#C82613;mso-font-kerning:0pt;mso-ligatures:none;mso-fareast-language:\nEN-GB;mso-no-proof:yes\">LINAR Consulting</span></b><span style=\"mso-ascii-font-family:\nAptos;mso-fareast-font-family:&quot;Times New Roman&quot;;mso-hansi-font-family:Aptos;\nmso-bidi-font-family:Aptos;mso-font-kerning:0pt;mso-ligatures:none;mso-fareast-language:\nEN-GB;mso-no-proof:yes\"><o:p></o:p></span></p>\n\n<p class=\"MsoNormal\" style=\"margin-bottom:0cm;line-height:normal;vertical-align:\nbaseline\"><b><span style=\"mso-ascii-font-family:Aptos;mso-fareast-font-family:\n&quot;Times New Roman&quot;;mso-hansi-font-family:Aptos;mso-bidi-font-family:Aptos;\ncolor:black;mso-font-kerning:0pt;mso-ligatures:none;mso-fareast-language:EN-GB;\nmso-no-proof:yes\">E:</span></b><span style=\"mso-ascii-font-family:Aptos;\nmso-fareast-font-family:&quot;Times New Roman&quot;;mso-hansi-font-family:Aptos;\nmso-bidi-font-family:Aptos;color:black;mso-font-kerning:0pt;mso-ligatures:none;\nmso-fareast-language:EN-GB;mso-no-proof:yes\">&nbsp;</span><span style=\"font-size:11.0pt;mso-ascii-font-family:Aptos;mso-fareast-font-family:\nAptos;mso-hansi-font-family:Aptos;mso-bidi-font-family:&quot;Times New Roman&quot;\"><a href=\"mailto:tina@linarconsulting.com\"><span style=\"font-size:12.0pt;\nmso-fareast-font-family:&quot;Times New Roman&quot;;mso-bidi-font-family:Aptos;\ncolor:blue;mso-font-kerning:0pt;mso-ligatures:none;mso-fareast-language:EN-GB;\nmso-no-proof:yes\">tina@linarconsulting.com</span></a></span><span style=\"mso-ascii-font-family:Aptos;mso-fareast-font-family:&quot;Times New Roman&quot;;\nmso-hansi-font-family:Aptos;mso-bidi-font-family:Aptos;mso-font-kerning:0pt;\nmso-ligatures:none;mso-fareast-language:EN-GB;mso-no-proof:yes\"><o:p></o:p></span></p>\n\n<p class=\"MsoNormal\" style=\"margin-bottom:0cm;line-height:normal;vertical-align:\nbaseline\"><b><span style=\"mso-ascii-font-family:Aptos;mso-fareast-font-family:\n&quot;Times New Roman&quot;;mso-hansi-font-family:Aptos;mso-bidi-font-family:Aptos;\ncolor:black;mso-font-kerning:0pt;mso-ligatures:none;mso-fareast-language:EN-GB;\nmso-no-proof:yes\">W:</span></b><span style=\"mso-ascii-font-family:Aptos;\nmso-fareast-font-family:&quot;Times New Roman&quot;;mso-hansi-font-family:Aptos;\nmso-bidi-font-family:Aptos;color:black;mso-font-kerning:0pt;mso-ligatures:none;\nmso-fareast-language:EN-GB;mso-no-proof:yes\">&nbsp;</span><span style=\"font-size:11.0pt;mso-ascii-font-family:Aptos;mso-fareast-font-family:\nAptos;mso-hansi-font-family:Aptos;mso-bidi-font-family:&quot;Times New Roman&quot;\"><a href=\"https://linarconsulting.com/\"><span style=\"font-size:12.0pt;mso-fareast-font-family:\n&quot;Times New Roman&quot;;mso-bidi-font-family:Aptos;color:blue;mso-font-kerning:0pt;\nmso-ligatures:none;mso-fareast-language:EN-GB;mso-no-proof:yes\">www.linarconsulting.com</span></a></span><span style=\"mso-ascii-font-family:Aptos;mso-fareast-font-family:&quot;Times New Roman&quot;;\nmso-hansi-font-family:Aptos;mso-bidi-font-family:Aptos;color:black;mso-font-kerning:\n0pt;mso-ligatures:none;mso-fareast-language:EN-GB;mso-no-proof:yes\">&nbsp; </span><span style=\"mso-ascii-font-family:Aptos;mso-fareast-font-family:&quot;Times New Roman&quot;;\nmso-hansi-font-family:Aptos;mso-bidi-font-family:Aptos;mso-font-kerning:0pt;\nmso-ligatures:none;mso-fareast-language:EN-GB;mso-no-proof:yes\"><o:p></o:p></span></p>\n\n<p class=\"MsoNormal\" style=\"margin-bottom:0cm;line-height:normal;vertical-align:\nbaseline\"><span style=\"mso-ascii-font-family:Aptos;mso-fareast-font-family:\n&quot;Times New Roman&quot;;mso-hansi-font-family:Aptos;mso-bidi-font-family:Aptos;\ncolor:black;mso-font-kerning:0pt;mso-ligatures:none;mso-fareast-language:EN-GB;\nmso-no-proof:yes\">&nbsp;</span><span style=\"mso-ascii-font-family:Aptos;\nmso-fareast-font-family:&quot;Times New Roman&quot;;mso-hansi-font-family:Aptos;\nmso-bidi-font-family:Aptos;mso-font-kerning:0pt;mso-ligatures:none;mso-fareast-language:\nEN-GB;mso-no-proof:yes\"><o:p></o:p></span></p>\n\n<p class=\"MsoNormal\" style=\"margin-bottom:0cm;line-height:normal\"><b><span style=\"mso-ascii-font-family:Aptos;mso-fareast-font-family:&quot;Times New Roman&quot;;\nmso-hansi-font-family:Aptos;mso-bidi-font-family:Aptos;mso-font-kerning:0pt;\nmso-ligatures:none;mso-fareast-language:EN-GB;mso-no-proof:yes\">P.S. want a\nweekly sales and BD punch in the face? Signup to </span></b><span style=\"font-size:11.0pt;mso-ascii-font-family:Aptos;mso-fareast-font-family:\nAptos;mso-hansi-font-family:Aptos;mso-bidi-font-family:&quot;Times New Roman&quot;\"><a href=\"https://share-eu1.hsforms.com/1TvoeY-xqRLuJ-8TxHvsw_w2db85y\"><b><span style=\"font-size:12.0pt;mso-fareast-font-family:&quot;Times New Roman&quot;;mso-bidi-font-family:\nAptos;color:blue;mso-font-kerning:0pt;mso-ligatures:none;mso-fareast-language:\nEN-GB;mso-no-proof:yes\">Three Things</span></b></a></span><b><span style=\"mso-ascii-font-family:Aptos;mso-fareast-font-family:&quot;Times New Roman&quot;;\nmso-hansi-font-family:Aptos;mso-bidi-font-family:Aptos;mso-font-kerning:0pt;\nmso-ligatures:none;mso-fareast-language:EN-GB;mso-no-proof:yes\"> to get you\nducking and weaving with your clients.</span></b><span style=\"mso-ascii-font-family:\nAptos;mso-fareast-font-family:&quot;Times New Roman&quot;;mso-hansi-font-family:Aptos;\nmso-bidi-font-family:Aptos;mso-font-kerning:0pt;mso-ligatures:none;mso-fareast-language:\nEN-GB;mso-no-proof:yes\"><o:p></o:p></span></p>\n\n\n</div>\n\n  </body>\n</html>",
        "additionalFields": {
          "bodyContentType": "html"
        }
      },
      "type": "n8n-nodes-base.microsoftOutlook",
      "typeVersion": 2,
      "position": [
        -304,
        1504
      ],
      "id": "d0cd043a-bfc7-4013-92d8-c235688498b1",
      "name": "Summary email - INTERNAL1",
      "webhookId": "0a57ad19-7a2b-4e0f-bec4-605fcf511055",
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "id": "kzkaYt1eDxfbVnWx",
          "name": "Outlook Three Things Tina - 12 Feb 26"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "// Get the AI text\nconst text = $json.output || \"\";\n\n// Helper to extract each section by heading name\nfunction extractSection(name) {\n  const regex = new RegExp(`${name}:([\\\\s\\\\S]*?)(?=\\\\n[A-Z][^\\\\n]*:|$)`, \"i\");\n  const match = text.match(regex);\n  return match ? match[1].trim().replace(/^[-•]\\s*/gm, \"\") : \"\";\n}\n\n// Extract each section\nconst areaToExplore = extractSection(\"Area to Explore\");\nconst potentialFormatsRaw = extractSection(\"Potential Formats\");\nconst suggestedUse = extractSection(\"Suggested Use\");\nconst somethingToThinkAbout = extractSection(\"Something to Think About\");\n\n// Split potential formats into array and HTML list\nconst potentialFormats = potentialFormatsRaw\n  .split(/\\n+/)\n  .map(s => s.trim())\n  .filter(Boolean);\n\nconst formattedFormatsHTML = potentialFormats\n  .map(item => `<li>${item}</li>`)\n  .join(\"\");\n\nreturn [\n  {\n    json: {\n      areaToExplore,\n      potentialFormats,\n      formattedFormatsHTML,\n      suggestedUse,\n      somethingToThinkAbout\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2992,
        2672
      ],
      "id": "2421daab-c211-4dd0-8d10-57e012c6639f",
      "name": "Code in JavaScript",
      "disabled": true
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "threethingstina",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -3040,
        -448
      ],
      "id": "45502e74-d40c-4a62-8e74-dfb1d8450076",
      "name": "Three Things Tina",
      "webhookId": "e3c9d572-750d-4084-ad4a-361ef8520a7b"
    },
    {
      "parameters": {
        "url": "https://linarconsulting.com/resources/",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "q",
              "value": "=Search the website link for articles that answer the challenge posed in the transcript summary. Return a maximum of three article and a short sentence on the rationale for choosing these articles. \n\nPut each new article on a new line.\n\nHere is the definition of the challenge:\n{{ $('Challenge').item.json.output }}\n"
            },
            {
              "name": "limit",
              "value": "10"
            }
          ]
        },
        "options": {
          "timeout": 30000
        }
      },
      "id": "c6d341a8-1a1f-43fc-b8d7-ec658e9af859",
      "name": "Search Website Articles",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -3104,
        3264
      ],
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Conversation transcript:\n{{ $json.body.data.analysis.transcript_summary }}\n\nAvailable articles from search:\n{{ $('Search Website Articles').item.json }}\n\nPlease select up to 3 most relevant articles and explain why each was chosen.",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are an AI assistant that analyzes conversation transcripts and selects the most relevant articles from search results.\n\nYour task is to:\n1. Review the conversation transcript and understand the key topics discussed\n2. Analyze the provided article search results\n3. Select a maximum of 3 articles that are most relevant to the conversation\n4. For each selected article, provide a clear rationale explaining why it is relevant to the conversation\n\nBe selective and only choose articles that have strong relevance to the topics discussed in the conversation."
        }
      },
      "id": "f629e847-c359-4e6d-8895-f27086abe630",
      "name": "Article Selector Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -2880,
        3264
      ],
      "disabled": true
    },
    {
      "parameters": {
        "projectId": {
          "__rl": true,
          "mode": "id",
          "value": "vertex-ai-api-setup-via-cli"
        },
        "options": {}
      },
      "id": "53fa0b3f-3917-4f54-9a68-b78506831b18",
      "name": "Google Vertex Chat Model - Article Selector",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleVertex",
      "typeVersion": 1,
      "position": [
        -2880,
        3488
      ],
      "credentials": {
        "googleApi": {
          "id": "LQjM9YuYI3HxJBrE",
          "name": "Google Service Account - Edu account Oct 8th"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"articles\": {\n      \"type\": \"array\",\n      \"maxItems\": 3,\n      \"items\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"title\": {\n            \"type\": \"string\"\n          },\n          \"url\": {\n            \"type\": \"string\"\n          },\n          \"rationale\": {\n            \"type\": \"string\"\n          }\n        },\n        \"required\": [\"title\", \"url\", \"rationale\"]\n      }\n    }\n  },\n  \"required\": [\"articles\"]\n}"
      },
      "id": "645e0ea9-06c7-4514-82f3-76c8a37a820a",
      "name": "Structured Output Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -2752,
        3488
      ],
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "// Extract articles from AI agent output\nconst agentOutput = $json.output || {};\nconst articles = agentOutput.articles || [];\n\n// Format as clean JSON with title, url, and rationale\nconst formattedArticles = articles.map(article => ({\n  title: article.title || '',\n  url: article.url || '',\n  rationale: article.rationale || ''\n}));\n\nreturn [\n  {\n    json: {\n      articles: formattedArticles,\n      count: formattedArticles.length\n    }\n  }\n];"
      },
      "id": "ceca5a18-0939-422a-8341-7e9da4f9c493",
      "name": "Format Article Results",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2528,
        3264
      ],
      "disabled": true
    },
    {
      "parameters": {
        "projectId": {
          "__rl": true,
          "value": "vertex-ai-api-setup-via-cli",
          "mode": "id"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleVertex",
      "typeVersion": 1,
      "position": [
        -2032,
        1584
      ],
      "id": "cb703462-7807-4b91-99b6-ebbcc900d6cd",
      "name": "Google Vertex Chat Model",
      "credentials": {
        "googleApi": {
          "id": "LQjM9YuYI3HxJBrE",
          "name": "Google Service Account - Edu account Oct 8th"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are Tina an AI assistant working for LINAR Consulting Ltd (https://linarconsulting.com). You are a business development and sales coach with knowledge of the complete catalogue of weekly Three Things newsletters that are developed and curated by the LINAR team (https://linarconsulting.com/resources/).\n\nYour task is to provide a succinct **recommendation** on how to address the challenge. \n\nThis recommendation should be maximum 75 words in length. \n\nReturn just the plain-English context — no headings, no extra explanation.\n\nKeep it professional and clear.\n\nPlease make sure that all outputs are in *UK English* not American English, including all spelling and date formats.\n\nHere is the challenge:\n{{ $json.output }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -2096,
        1360
      ],
      "id": "a7585ad8-9cd0-4740-b643-f542fc9d64c1",
      "name": "Recommendations",
      "disabled": true
    },
    {
      "parameters": {
        "projectId": {
          "__rl": true,
          "value": "vertex-ai-api-setup-via-cli",
          "mode": "id"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleVertex",
      "typeVersion": 1,
      "position": [
        -1456,
        1584
      ],
      "id": "6914b420-80a1-482f-8a2b-4f796eb31a80",
      "name": "Google Vertex Chat Model1",
      "credentials": {
        "googleApi": {
          "id": "LQjM9YuYI3HxJBrE",
          "name": "Google Service Account - Edu account Oct 8th"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are Tina an AI assistant working for LINAR Consulting Ltd (https://linarconsulting.com). You are a business development and sales coach with knowledge of the complete catalogue of weekly Three Things newsletters that are developed and curated by the LINAR team (https://linarconsulting.com/resources/).\n\nYour task is to provide a list of **examples** the user could try to remedy their challenge. \n\nEach exampleshould be displayed on a separate line. \n\nThere should be a maximum of three examples.\n\nReturn just the plain-English context — no headings, no extra explanation.\n\nKeep it professional and clear.\n\nPlease make sure that all outputs are in *UK English* not American English, including all spelling and date formats.\n\n\nHere is a version of the challenge:\n{{ $('Challenge').item.json.output }}\n\nAnd here is a different version of the challenge:\n{{ $('Three Things Tina').item.json.body.data.analysis.data_collection_results.Challenge.value }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -1520,
        1360
      ],
      "id": "2b43c234-7090-41d3-be36-d8fd2059e929",
      "name": "Examples",
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are Tina an AI assistant working for LINAR Consulting Ltd (https://linarconsulting.com). You are a business development and sales coach with knowledge of the complete catalogue of weekly Three Things newsletters that are developed and curated by the LINAR team (https://linarconsulting.com/resources/).\n\nYour task is to provide a summary of the **challenge** the user is facing. \n\nThis summary should be maximum 75 words in length.\n\nThe summary output should begin by acknowledging that the challenge as defined is based on the conversation with the user, and speaking in the second person (i.e. you), and then state the challenge identified.\n\nReturn just the plain-English context — no headings, no extra explanation.\n\nKeep it professional and clear.\n\nPlease make sure that all outputs are in *UK English* not American English, including all spelling and date formats.\n\n\nHere is the full transcript:\n{{ $json.markdown }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -2448,
        1360
      ],
      "id": "c73a8ffb-36c2-4de3-959e-7edca73f1ee7",
      "name": "Challenge",
      "disabled": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "84f296ec-21cf-476e-8781-1e600dcd7699",
              "leftValue": "={{ $('Three Things Tina').item.json.body.data.conversation_initiation_client_data.dynamic_variables.system__call_duration_secs }}",
              "rightValue": 60,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -2672,
        1360
      ],
      "id": "72f9fea6-d964-49ed-976a-4616bbdae78f",
      "name": "If",
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "// Get the incoming JSON body\nconst input = items[0].json;\n\n// Defensive navigation\nconst data = input.body?.data || {};\nconst transcript = data.transcript || [];\n\n// Build Markdown\nlet md = `# Conversation Transcript\\n\\n`;\n\ntranscript.forEach((turn) => {\n  if (!turn.message) return;\n\n  const role =\n    turn.role === \"agent\" ? \"**Agent**\"\n    : turn.role === \"user\" ? \"**User**\"\n    : \"**System**\";\n\n  const message = turn.message.trim();\n\n  if (message) {\n    md += `${role}:\\n\\n${message}\\n\\n---\\n\\n`;\n  }\n});\n\n// Extract structured analysis data\nconst analysis = data.analysis || {};\nconst collected = analysis.data_collection_results || {};\n\n// Add extracted insights section if anything exists\nif (Object.keys(collected).length > 0) {\n  md += `# Extracted Insights\\n\\n`;\n\n  if (collected[\"Name\"]?.value) {\n    md += `**Name:** ${collected[\"Name\"].value}\\n\\n`;\n  }\n\n  if (collected[\"Challenge\"]?.value) {\n    md += `**Challenge:**\\n\\n${collected[\"Challenge\"].value}\\n\\n`;\n  }\n\n  if (collected[\"Recommendations\"]?.value) {\n    md += `**Recommendations:**\\n\\n${collected[\"Recommendations\"].value}\\n\\n`;\n  }\n\n  if (collected[\"Examples\"]?.value) {\n    md += `**Examples:**\\n\\n${collected[\"Examples\"].value}\\n\\n`;\n  }\n}\n\n// Optional AI summary section\nif (analysis.call_summary_title || analysis.transcript_summary) {\n  md += `# Call Summary\\n\\n`;\n\n  if (analysis.call_summary_title) {\n    md += `**Title:** ${analysis.call_summary_title}\\n\\n`;\n  }\n\n  if (analysis.transcript_summary) {\n    md += `${analysis.transcript_summary}\\n\\n`;\n  }\n}\n\n// Return markdown as output\nreturn [\n  {\n    json: {\n      markdown: md\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2896,
        1360
      ],
      "id": "67434853-307b-4e02-9167-08141333669b",
      "name": "Code in JavaScript1",
      "disabled": true
    },
    {
      "parameters": {
        "model": "sonar-pro",
        "messages": {
          "message": [
            {
              "content": "=**Perplexity Pro n8n Prompt:**\n\nScope and source control:\nYou must research ONLY content published on linarconsulting.com.\nStart from this page and follow links found on it:\n[https://linarconsulting.com/resources/](https://linarconsulting.com/resources/)\n\nDo not use any external websites, summaries, cached content, or prior knowledge.\nDo not cite or reference any sources outside linarconsulting.com.\n\nChallenge definition:\nHere is a version of the challenge:\n{{ $('Challenge').item.json.output }}\n\nInterpret the challenge in the context of sales and business development, with particular attention to curiosity, questioning quality, discovery conversations, listening, objection handling through better diagnosis, and client engagement under time pressure.\n\nYour goal:\nIdentify the FIFTEEN most relevant articles on linarconsulting.com that would most effectively help someone overcome the stated challenge quickly and practically.\n\nSelection methodology. Be rigorous and auditable:\n\n1. Begin at [https://linarconsulting.com/resources/](https://linarconsulting.com/resources/) and only use links you discover by navigating from that page.\n2. Consider all relevant article formats linked from resources, including recurring formats such as “Three Things”.\n3. Open and read each candidate article in full. Do not rely on previews, excerpts, index descriptions, or snippets.\n4. Score and rank candidates using the criteria below. Select the top ten overall.\n\n   * Directness: the article explicitly addresses behaviours or gaps described in the challenge.\n   * Applicability: guidance clearly maps to real BD or sales conversations, especially discovery and client meetings.\n   * Actionability: includes specific actions, prompts, techniques, conversation moves, or habits that can be applied immediately.\n   * Efficiency: concise enough to be useful for someone with limited time, or structured so key actions are quickly extractable.\n5. Exclude content that is primarily news, announcements, generic opinion, or only loosely related to the challenge.\n6. Prevent duplication: titles must be unique. If two articles are extremely similar, keep only the stronger one and replace the weaker with the next best.\n\nHard validation rules. No exceptions:\nA) Domain validation. Every selected URL must be on the linarconsulting.com domain.\n\n* Before final output, re-check each URL string. If it is not linarconsulting.com, discard and replace the item.\n* Do not output any URL from any other domain, including syndicated versions, tracking links, cached links, or redirects.\n  B) Title validation. The article title must exactly match what is shown on the article page.\n* Do not repeat the title in any other field.\n  C) H2 validation. You must extract the FIRST H2 heading that appears within the main article body.\n* Do not use category labels, page headers, navigation elements, sidebars, author boxes, footers, or related content sections.\n* If an article does not contain a valid in-body H2, discard it and choose another.\n  D) Uniqueness validation. Output must contain exactly ten different articles. No repeats, no near-duplicates.\n\nMandatory extraction for EACH selected article:\n\n* Article title exactly as shown on the article page.\n* The FIRST in-body H2 heading within the main article content.\n* One concrete action that directly helps address the challenge. Maximum 18 words. Must be immediately usable.\n* A very verbose explainer describing why the article is relevant to solving the challenge.\n  Requirements for the explainer:\n\n  * Minimum 120 words.\n  * Explicitly tie the challenge language to specific behaviours the article addresses.\n  * Explain how the article changes what the person does in real conversations (what to say, what to ask, what to listen for, what to notice).\n  * Include at least two practical examples of how to apply the ideas in a BD or client conversation.\n  * Avoid generic praise. Make it specific and practical.\n* The canonical linarconsulting.com article URL.\n\nOutput rules. These are strict:\n\n* Output exactly TEN lines. No more. No less.\n* One article per line.\n* No numbering, bullets, markdown, or extra formatting.\n* No citations, footnotes, reference markers, or bracketed numbers.\n* Use this exact structure for each line:\n  Title | First in-body H2 | Challenge action | Verbose relevance explainer | <a href=\"URL\">Read article</a>\n\nAfter the ten lines:\n\n* Output exactly ONE additional sentence explaining why this set of ten articles, as a combined sequence, best addresses the stated challenge quickly and practically.\n* Do not add any other text before or after.\n"
            }
          ]
        },
        "simplify": true,
        "options": {
          "searchDomainFilter": "https://linarconsulting.com/"
        },
        "requestOptions": {}
      },
      "type": "n8n-nodes-base.perplexity",
      "typeVersion": 1,
      "position": [
        -1168,
        1360
      ],
      "id": "a6d86d05-66a8-4fbe-b59c-4d0b84b6fedc",
      "name": "search linar",
      "credentials": {
        "perplexityApi": {
          "id": "pOqM7kFIqiYB3qGU",
          "name": "Perplexity account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "// n8n Code node (JavaScript)\n// Same as before, but REMOVES the \"Article / Index page\" badge from the HTML\n// All other formatting and behaviour is unchanged.\n\nconst input = items[0].json;\nconst raw = String(input.message ?? \"\");\n\n// ---------- Helpers ----------\nconst esc = (s) =>\n  String(s ?? \"\")\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&#39;\");\n\nconst extractHref = (s) => {\n  const m = String(s ?? \"\").match(/href=\"([^\"]+)\"/i);\n  return m ? m[1].trim() : \"\";\n};\n\nconst isLikelyNonArticleUrl = (url) =>\n  /\\/tag\\//i.test(url) || /\\/page\\/\\d+/i.test(url);\n\n// ---------- 1) Split and remove rationale ----------\nlet lines = raw\n  .split(/\\r?\\n/)\n  .map((l) => l.trim())\n  .filter(Boolean);\n\n// Remove rationale sentence\nlines = lines.filter((l) => !/^these three articles/i.test(l));\n\n// ---------- 2) Parse pipe-delimited article lines ----------\nconst parsed = [];\nfor (const line of lines) {\n  const parts = line.split(\" | \").map((p) => p.trim());\n  if (parts.length < 4) continue;\n\n  const title = parts[0] || \"\";\n  const h2 = parts[1] || \"\";\n  const action = parts[2] || \"\";\n  const url = extractHref(parts.slice(3).join(\" | \"));\n\n  if (!url) continue;\n\n  parsed.push({\n    title,\n    h2,\n    action,\n    url,\n    isArticle: !isLikelyNonArticleUrl(url),\n    rawLine: line,\n  });\n}\n\n// ---------- 3) Deduplicate by URL ----------\nconst byUrl = new Map();\nfor (const item of parsed) {\n  if (!byUrl.has(item.url)) byUrl.set(item.url, item);\n}\n\nconst uniques = Array.from(byUrl.values());\n\n// Prefer article URLs first, then others\nconst preferred = [\n  ...uniques.filter((x) => x.isArticle),\n  ...uniques.filter((x) => !x.isArticle),\n].slice(0, 3);\n\n// Pad to ensure exactly 3\nlet finalArticles = preferred;\nif (finalArticles.length === 0) {\n  finalArticles = [\n    { title: \"\", h2: \"\", action: \"\", url: \"\", isArticle: false },\n    { title: \"\", h2: \"\", action: \"\", url: \"\", isArticle: false },\n    { title: \"\", h2: \"\", action: \"\", url: \"\", isArticle: false },\n  ];\n} else {\n  while (finalArticles.length < 3) {\n    finalArticles.push({ ...finalArticles[finalArticles.length - 1] });\n  }\n}\n\n// ---------- 4) Build cleaned_text ----------\nconst cleaned_text = finalArticles\n  .map(\n    (a) =>\n      `${a.title} | ${a.h2} | ${a.action} | <a href=\"${a.url}\">Read article</a>`\n  )\n  .join(\"\\n\");\n\n// ---------- 5) Build HTML email block (badge removed) ----------\nconst cards = finalArticles\n  .map((a) => {\n    const title = esc(a.title);\n    const h2 = esc(a.h2);\n    const action = esc(a.action);\n    const url = esc(a.url);\n\n    return `\n<div style=\"margin:0 0 14px 0; padding:14px; border:1px solid #e6e6e6; border-radius:10px;\">\n  <div style=\"margin:0 0 6px 0; font-size:14px; line-height:20px; color:#111; font-weight:700;\">\n    ${title}\n  </div>\n  <div style=\"margin:0 0 8px 0; font-size:14px; line-height:20px; color:#333; font-weight:600;\">\n    ${h2}\n  </div>\n  <div style=\"margin:0 0 10px 0; font-size:14px; line-height:20px; color:#444;\">\n    ${action}\n  </div>\n  <div style=\"margin:0; font-size:14px; line-height:20px;\">\n    <a href=\"${url}\" style=\"color:#1155cc; text-decoration:underline;\">Read article</a>\n  </div>\n</div>\n    `.trim();\n  })\n  .join(\"\\n\");\n\nconst html_email = `\n<div style=\"font-family: Arial, Helvetica, sans-serif; color:#111; font-size:14px; line-height:20px;\">\n  <p style=\"margin:0 0 12px 0;\">Here are three recommended reads tailored to the challenge.</p>\n  ${cards}\n</div>\n`.trim();\n\n// ---------- 6) Return ----------\nreturn [\n  {\n    json: {\n      cleaned_text,\n      articles: finalArticles.map(({ rawLine, ...rest }) => rest),\n      html_email,\n      debug: {\n        parsed_count: parsed.length,\n        unique_urls: uniques.length,\n        padded: preferred.length < 3,\n      },\n    },\n  },\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -880,
        1200
      ],
      "id": "8f5acefb-d058-43dc-a24c-11df60872e8b",
      "name": "Code in JavaScript2",
      "disabled": true
    },
    {
      "parameters": {
        "projectId": {
          "__rl": true,
          "value": "vertex-ai-api-setup-via-cli",
          "mode": "id"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleVertex",
      "typeVersion": 1,
      "position": [
        -880,
        1616
      ],
      "id": "629b4004-ae75-4cc6-846e-f42951a1436b",
      "name": "Google Vertex Chat Model3",
      "credentials": {
        "googleApi": {
          "id": "LQjM9YuYI3HxJBrE",
          "name": "Google Service Account - Edu account Oct 8th"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Gemini Prompt (challenge-anchored relevance scoring):\n\nSource constraints. Non-negotiable:\nYou must NOT browse, crawl, open, or read any webpages.\nYou must NOT follow links or infer missing information.\nYou must use ONLY the dataset contained in the following text as the sole source of truth:\n{{ $json.message }}\n\nChallenge definition:\nHere is a version of the challenge:\n{{ $('Challenge').item.json.output }}\n\nAnd here is a different version of the challenge:\n{{ $('Three Things Tina').item.json.body.data.analysis.data_collection_results.Challenge.value }}\n\nUse this information is helpful\nRecommendations for next steps:\n{{ $('Recommendations').item.json.output }}\nExamples of next steps:\n{{ $('Examples').item.json.output }}\n\nInterpretation constraint:\nAll relevance scoring must be explicitly grounded in the challenge text above. You are not allowed to score using generic “BD best practice” unless it directly maps to the challenge wording.\n\nDataset structure:\nEach candidate entry is one line containing fields separated by “ | ” and ending with an anchor tag.\nFields:\n\nTitle\n\nFirst in-body H2\n\nChallenge action\n\nVerbose relevance explainer\n\n<a href=\"URL\">Read article</a>\n\nHard constraints:\n\nDo not modify any titles, H2s, actions, explainers, or URLs.\n\nDo not introduce any article not present in the dataset.\n\nIf an entry does not contain all required fields in the dataset format, it is ineligible.\n\nRobust decision method. Apply exactly:\n\nStep 1. Extract challenge anchors:\n\nFrom the challenge text, identify 5–8 “anchors” (short phrases) that describe the specific gap, behaviour, situation, or outcome.\n\nExamples of anchor types: “time pressure”, “poor discovery”, “not asking enough questions”, “assumption-making”, “weak listening”, “client engagement drops”, “handles objections poorly”.\n\nUse only the actual challenge wording. Do not invent new anchors.\n\nStep 2. Score each article against those anchors using only provided fields:\nFor each candidate article, assign 0–5 on each dimension below. Your scoring must reflect how directly the candidate’s supplied action and explainer address the extracted anchors.\n\nA) Anchor coverage (0–5)\nHow many anchors it addresses and how explicitly it addresses them in the explainer text.\n\nB) Anchor precision (0–5)\nHow tightly the article’s action and explainer map to the challenge anchors. Penalise vague or generic links.\n\nC) Under-time-pressure usefulness (0–5)\nDoes the article provide short, usable moves that fit the “time pressure” or constraint implied by the challenge.\n\nD) Conversation move quality (0–5)\nStrength of concrete dialogue moves: questions to ask, what to listen for, reframes, or objection-diagnosis tactics.\n\nE) “Fast win” applicability (0–5)\nHow likely it is to change behaviour immediately. Prefer specific prompts, scripts, or habits.\n\nTotal Score = A+B+C+D+E (max 25)\n\nStep 3. Force closest-match selection (no theme drifting):\n\nYou must prioritise the three highest total scores where A and B are strongest, even if another article seems generally useful.\n\nIf an article’s explainer does not clearly reference the same kinds of gaps described by the challenge, it must not be selected.\n\nStep 4. Anti-duplication diversity check:\n\nIf two of the top three are near-duplicates in mechanism (e.g., both “curiosity superpower” variants) then keep the higher score and replace the other with the next-highest scoring article that adds a distinct lever that still matches the anchors (e.g., objections as diagnosis, empathy/listening reflection, vulnerability/feedback, preparation).\n\nDo not sacrifice anchor precision for variety. Variety is secondary.\n\nTie-break rules (in order):\n\nHigher B (Anchor precision) wins.\n\nHigher A (Anchor coverage) wins.\n\nMore specific “Challenge action” wins.\n\nExplainer that includes clearer example questions or exact phrases wins.\n\nOutput rules. Strict and final:\n\nOutput exactly THREE lines. No more. No less.\n\nOne article per line.\n\nNo numbering, bullets, markdown, or extra formatting.\n\nUse this exact structure for each line:\nTitle | First in-body H2 | Challenge action | Verbose relevance explainer | <a href=\"URL\">Read article</a>\n\nAfter the three lines:\n\nOutput exactly ONE additional sentence explaining why these three are the closest match to the challenge anchors.\n\nDo not output the anchors, scores, working, or any other text.",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -944,
        1392
      ],
      "id": "d5cfd209-d8e7-4bfb-a36c-3bde8f0681ec",
      "name": "Articles",
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "// n8n Code node (JavaScript)\n// Input: items[0].json.message (or items[0].json.text/output) contains:\n// 3 pipe-delimited lines + 1 rationale sentence.\n// Output: cleaned_text, articles[], html_email (email-ready HTML with inline styles)\n\nconst input = items[0].json;\nconst raw =\n  input.message ??\n  input.text ??\n  input.output ??\n  input.cleaned_text ??\n  \"\";\n\n// ---------- Helpers ----------\nconst esc = (s) =>\n  String(s ?? \"\")\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&#39;\");\n\nconst extractHref = (s) => {\n  const m = String(s ?? \"\").match(/href=\"([^\"]+)\"/i);\n  return m ? m[1].trim() : \"\";\n};\n\n// ---------- 1) Split into lines ----------\nlet lines = String(raw)\n  .split(/\\r?\\n/)\n  .map((l) => l.trim())\n  .filter(Boolean);\n\n// Capture rationale (the line after the 3 article lines, if present)\nlet rationale = \"\";\nconst rationaleIdx = lines.findIndex((l) => /^these three articles/i.test(l));\nif (rationaleIdx !== -1) {\n  rationale = lines.slice(rationaleIdx).join(\" \").trim();\n  lines = lines.slice(0, rationaleIdx);\n}\n\n// Keep only first 3 lines (defensive)\nlines = lines.slice(0, 3);\n\n// ---------- 2) Parse the 3 lines ----------\nconst articles = [];\n\nfor (const line of lines) {\n  const parts = line.split(\" | \").map((p) => p.trim());\n  if (parts.length < 4) continue;\n\n  const title = parts[0] || \"\";\n  const h2 = parts[1] || \"\";\n  const action = parts[2] || \"\";\n\n  // Link part may contain extra pipes in weird cases, so join remainder\n  const linkPart = parts.slice(3).join(\" | \");\n  const url = extractHref(linkPart);\n\n  articles.push({\n    title,\n    h2,\n    action,\n    url,\n  });\n}\n\n// Pad to exactly 3 items to prevent downstream issues\nwhile (articles.length < 3) {\n  articles.push({ title: \"\", h2: \"\", action: \"\", url: \"\" });\n}\n\n// ---------- 3) Build cleaned_text ----------\nconst cleaned_text = articles\n  .map(\n    (a) =>\n      `${a.title} | ${a.h2} | ${a.action} | <a href=\"${a.url}\">Read article</a>`\n  )\n  .join(\"\\n\");\n\n// ---------- 4) Build HTML email block ----------\nconst cards = articles\n  .map((a) => {\n    const title = esc(a.title);\n    const h2 = esc(a.h2);\n    const action = esc(a.action);\n    const url = esc(a.url);\n\n    return `\n<div style=\"margin:0 0 14px 0; padding:14px; border:1px solid #e6e6e6; border-radius:10px;\">\n  <div style=\"margin:0 0 6px 0; font-size:14px; line-height:20px; color:#111; font-weight:700;\">\n    ${title}\n  </div>\n  <div style=\"margin:0 0 8px 0; font-size:14px; line-height:20px; color:#333; font-weight:600;\">\n    ${h2}\n  </div>\n  <div style=\"margin:0 0 10px 0; font-size:14px; line-height:20px; color:#444;\">\n    ${action}\n  </div>\n  <div style=\"margin:0; font-size:14px; line-height:20px;\">\n    <a href=\"${url}\" style=\"color:#1155cc; text-decoration:underline;\">Read article</a>\n  </div>\n</div>\n    `.trim();\n  })\n  .join(\"\\n\");\n\nconst html_email = `\n<div style=\"font-family: Arial, Helvetica, sans-serif; color:#111; font-size:14px; line-height:20px;\">\n  <p style=\"margin:0 0 12px 0;\">Here are three recommended reads tailored to the challenge.</p>\n  ${cards}\n</div>\n`.trim();\n\nreturn [\n  {\n    json: {\n      cleaned_text,\n      articles,\n      rationale,\n      html_email,\n    },\n  },\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -528,
        1504
      ],
      "id": "868a20df-1c39-4fee-aa6a-3f5027c884b9",
      "name": "Code in JavaScript3",
      "disabled": true
    },
    {
      "parameters": {
        "toRecipients": "andy@legalengine.co.uk",
        "subject": "Recommendations",
        "bodyContent": "=<html>\n  <body style=\"font-family: Arial, sans-serif; color:#000000; line-height:1.6;\">\n \n\n\n  <h3 style=\"font-size:18px; color:#b10f2e; margin-top:30px;\">Examples</h3>\n<p style=\"font-size:14px; margin:0 0 20px 0;\">\n      Based on the above, we recommend you take the following actions to address your immediate challenge:\n    </p>\n    <ul style=\"font-size:14px; margin:5px 0 0 20px; padding:0; list-style-type:none;\">\n  {{ $json.html_bullets }}\n</ul>\n      \n    </ul> \n\n\n</body>\n</html>\n",
        "additionalFields": {
          "bodyContentType": "html"
        }
      },
      "type": "n8n-nodes-base.microsoftOutlook",
      "typeVersion": 2,
      "position": [
        -560,
        2448
      ],
      "id": "4535bec9-4675-41bd-abe1-7960fd8d7321",
      "name": "Send a message",
      "webhookId": "b8d67457-6fef-4fbb-b984-1bf25e6f9fab",
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "id": "eweG9vjyeWb4mfPE",
          "name": "Microsoft Outlook - Support @ Legal Engine"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Code / Function node\n * Input: $json.output (single string)\n * Output: html_bullets (<li> items for insertion into an email <ul>)\n * Bullet colour: #b10f2e\n */\n\nconst raw = ($json.output || '').toString().trim();\n\n// HTML escape to avoid broken markup\nconst escapeHtml = (s) =>\n  s\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#39;');\n\n// Normalise quotes and spacing\nconst normalised = raw\n  .replace(/[“”]/g, '\"')\n  .replace(/[’]/g, \"'\")\n  .replace(/\\s+/g, ' ')\n  .trim();\n\n// Split into bullet-sized sentences\nconst points = normalised\n  .split(/(?<=[.!?])\\s+(?=[A-Z0-9])/g)\n  .map(p => p.trim())\n  .filter(Boolean);\n\n// Build email-safe <li> items (NO <ul> here)\nconst htmlBullets = points\n  .map(\n    (p) =>\n      `<li style=\"margin:0 0 8px 0;padding:0;\">` +\n        `<span style=\"color:#b10f2e;font-weight:700;\">•</span> ` +\n        `<span style=\"color:#000000;\">${escapeHtml(p)}</span>` +\n      `</li>`\n  )\n  .join('');\n\nreturn [\n  {\n    json: {\n      html_bullets: htmlBullets,\n    },\n  },\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1744,
        1360
      ],
      "id": "a1f87b66-485a-4cbe-8e53-24985db47a05",
      "name": "Email cleanup",
      "disabled": true
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": "01RDSCPONO2CZT22PORNC3PJQ4CAPNY3TD"
      },
      "type": "n8n-nodes-base.microsoftOneDrive",
      "typeVersion": 1,
      "position": [
        -688,
        1904
      ],
      "id": "fada8a52-a952-4fc1-bcb4-487040a72346",
      "name": "Download a file",
      "credentials": {
        "microsoftOneDriveOAuth2Api": {
          "id": "O6kcuY0URca0xV5I",
          "name": "Lee LINAR - Microsoft Drive account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Challenge-anchored article selection prompt\n\nSource constraints. Non-negotiable:\nYou must NOT browse, crawl, open, or read any webpages.\nYou must NOT follow links or infer missing information beyond the explicit rules below.\nYou must use ONLY the dataset contained in the following text as the sole source of truth:\n{{ $json.text }}\n\nChallenge definition:\nChallenge version A:\n{{ $('Challenge').item.json.output }}\n\nChallenge version B:\n{{ $('Three Things Tina').item.json.body.data.analysis.data_collection_results.Challenge.value }}\n\nHelpful context. Use only if relevant and do not override the challenge wording:\nRecommendations for next steps:\n{{ $('Recommendations').item.json.output }}\nExamples of next steps:\n{{ $('Examples').item.json.output }}\n\nInterpretation constraint:\nAll relevance decisions must be explicitly grounded in the challenge wording above.\nDo NOT rely on generic BD best practice unless it directly maps to the challenge text.\nIf a connection cannot be clearly traced to the challenge wording, it must be treated as weak or irrelevant.\n\nDataset structure:\nEach candidate entry is intended to be one line containing fields separated by “ | ”.\nExpected structure:\nTitle | First in-body H2 | Challenge action | Verbose relevance explainer | <a href=\"URL\">Read article</a>\n\nEligibility and normalisation rules. Apply in order:\n1) Treat any line with at least four “ | ” separators as a candidate.\n2) Map fields as:\n   Field 1 = Title\n   Field 2 = First in-body H2\n   Field 3 = Challenge action\n   Field 4 = Verbose relevance explainer\n   Field 5 = URL field\n3) URL handling:\n   a) If Field 5 contains <a href=\"URL\">Read article</a>, use that URL.\n   b) If Field 5 contains a bare URL starting with http, normalise it to <a href=\"URL\">Read article</a>.\n   c) If no usable URL exists, attempt the URL completion rule below.\n4) If Title, H2, action, or explainer cannot be recovered, the entry is ineligible.\n\nURL completion rule for “Three Things” entries:\n1) Do not browse or validate URLs.\n2) Do not change any URL that is already present and usable.\n3) If the URL is missing or empty, scan the full line for the first DD-MM-YY token.\n4) If found, construct:\n   https://linarconsulting.com/three-things-DD-MM-YY/\n5) If no DD-MM-YY token exists, the entry is ineligible.\n\nDecision method. Apply exactly:\n\nStep 1. Extract challenge anchors:\nFrom the combined challenge wording, extract 5–8 short anchor phrases describing the specific gap, behaviour, constraint, or outcome.\nUse only wording that appears in the challenge text. Do not invent anchors.\n\nStep 2. Score each eligible article:\nUse only the Challenge action and Verbose relevance explainer.\nScore each dimension from 0–5:\nA) Anchor coverage\nB) Anchor precision\nC) Under-time-pressure usefulness\nD) Conversation move quality\nE) Fast-win applicability\nTotal score = A+B+C+D+E (max 25)\n\nStep 3. Closest-match selection:\nSelect the three highest-scoring entries where Anchor precision and Anchor coverage are strongest.\nDo not select broadly useful articles that weakly map to the challenge.\n\nStep 4. Anti-duplication check:\nIf two of the top three rely on the same behavioural mechanism, keep the higher-scoring one.\nReplace the other with the next-highest scoring eligible entry that introduces a distinct lever while still matching the anchors.\nAnchor precision always outweighs variety.\n\nTie-break rules. Apply strictly in this order:\n1) Higher Anchor precision\n2) Higher Anchor coverage\n3) More specific Challenge action\n4) Explainer with clearer example questions or exact phrases\n\nOutput rules. Strict and final. Parser-critical:\nYou MUST output exactly THREE items.\nEach item must be a SINGLE LINE.\nEach line must use this exact structure:\nTitle | First in-body H2 | Challenge action | Verbose relevance explainer | <a href=\"URL\">Read article</a>\n\nDelimiter rules. Mandatory:\nBetween item 1 and item 2 output exactly:\n/n\nBetween item 2 and item 3 output exactly:\n/n\n\nDo NOT output anything before the first item.\nDo NOT output anything after the third item.\nDo NOT add explanations, summaries, numbering, bullets, or extra lines.\n\nFailure handling:\nIf fewer than three eligible entries exist, still output exactly three lines.\nFor any missing fields, use empty text but keep the exact line structure and delimiter usage.\nNever output fewer than three items.\nNever output JSON.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -112,
        1904
      ],
      "id": "48b375d2-7193-45db-ac36-fe8afb0d2cde",
      "name": "Articles1",
      "disabled": true
    },
    {
      "parameters": {
        "operation": "get",
        "fileId": "01RDSCPOOOR4W3NOKKCBFKES2QSPHLKZX2"
      },
      "type": "n8n-nodes-base.microsoftOneDrive",
      "typeVersion": 1,
      "position": [
        -3008,
        2096
      ],
      "id": "21dc42c9-b270-4628-9080-2508de5b4e8c",
      "name": "Get a file",
      "credentials": {
        "microsoftOneDriveOAuth2Api": {
          "id": "O6kcuY0URca0xV5I",
          "name": "Lee LINAR - Microsoft Drive account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "resource": "folder",
        "folderId": "01RDSCPOPMPCU6CLDGBNHZLVMXM6VZAEGX"
      },
      "type": "n8n-nodes-base.microsoftOneDrive",
      "typeVersion": 1,
      "position": [
        -3008,
        1872
      ],
      "id": "2aeb2680-1d96-4818-8653-5f5333e90c7c",
      "name": "Get items in a folder",
      "credentials": {
        "microsoftOneDriveOAuth2Api": {
          "id": "O6kcuY0URca0xV5I",
          "name": "Lee LINAR - Microsoft Drive account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "operation": "pdf",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1.1,
      "position": [
        -400,
        1904
      ],
      "id": "fd6ff5c8-51db-4996-922d-dc9e2583c8d2",
      "name": "Extract from File1",
      "disabled": true
    },
    {
      "parameters": {
        "toRecipients": "=lee@legalengine.co.uk",
        "subject": "Your conversation with Three Things Tina",
        "bodyContent": "=<html>\n  <body style=\"margin:0; padding:0;\">\n    <div style=\"font-family: Arial, Helvetica, sans-serif; font-size:14px; line-height:1.6; color:#000000;\">\n\n      <!-- Header -->\n      <div style=\"margin:0 0 20px 0; padding:0;\">\n        <img src=\"https://raw.githubusercontent.com/LE-LeeC/LINAR/main/Linar-Wordmark-RGB-Red-optimized.png\"\n             alt=\"LINAR logo\"\n             style=\"height:20px; display:block; border:0; outline:none;\">\n      </div>\n\n      <!-- Greeting -->\n      <p style=\"margin:0 0 12px 0; padding:0;\">\n        Hi, {{ $('Three Things Tina').item.json.body.data.analysis.data_collection_results.Name.value }}\n      </p>\n\n      <p style=\"margin:0 0 16px 0; padding:0;\">\n        Thanks for speaking to me. I really enjoyed our conversation and have made some recommendations below which I hope are helpful.\n      </p>\n\n      <!-- Challenge -->\n      <h3 style=\"font-size:18px; font-weight:700; color:#b10f2e; margin:30px 0 10px 0; padding:0;\">\n        Your challenge\n      </h3>\n      <p style=\"margin:0 0 16px 0; padding:0;\">\n        {{ $('Challenge').item.json.output }}\n      </p>\n\n      <!-- Recommendations -->\n      <h3 style=\"font-size:18px; font-weight:700; color:#b10f2e; margin:30px 0 10px 0; padding:0;\">\n        Recommendations\n      </h3>\n      <ul style=\"margin:0 0 16px 0; padding:0; list-style-type:none;\">\n        {{ $('Recommendations').item.json.output }}\n      </ul>\n\n      <!-- Immediate actions -->\n      <h3 style=\"font-size:18px; font-weight:700; color:#b10f2e; margin:30px 0 10px 0; padding:0;\">\n        Immediate actions\n      </h3>\n      <p style=\"margin:0 0 12px 0; padding:0;\">\n        Based on the above, we recommend you take the following actions to address your immediate challenge:\n      </p>\n      <ul style=\"margin:0 0 16px 0; padding:0; list-style-type:none;\">\n        {{ $('Email cleanup').item.json.html_bullets }}\n      </ul>\n\n      <!-- Related articles -->\n      <h3 style=\"font-size:18px; font-weight:700; color:#b10f2e; margin:30px 0 10px 0; padding:0;\">\n        Related articles\n      </h3>\n      <div style=\"margin:0; padding:0;\">\n        {{ $json.html_email }}\n      </div>\n\n      <!-- Footer -->\n      <hr style=\"margin:30px 0; border:0; border-top:1px solid #b10f2e;\">\n\n      <p style=\"margin:0 0 16px 0; padding:0;\">\n        You can find all of our Three Things articles\n        <a href=\"https://linarconsulting.com/resources/\" target=\"_blank\" style=\"color:#b10f2e; text-decoration:none;\">here</a>.\n        We also send out a weekly Three Things newsletter direct to your inbox. sign up\n        <a href=\"https://share-eu1.hsforms.com/1TvoeY-xqRLuJ-8TxHvsw_w2db85y\" target=\"_blank\" style=\"color:#b10f2e; text-decoration:none;\">here</a>.\n      </p>\n\n      <p style=\"margin:0; padding:0;\">Kind regards</p>\n      <p style=\"margin:6px 0 0 0; padding:0; font-weight:700;\">Tina</p>\n\n      <!-- Signature -->\n      <div style=\"margin-top:20px;\">\n\n        <p style=\"margin:0;\">Three Things agent</p>\n        <p style=\"margin:0; font-weight:700; color:#C82613;\">LINAR Consulting</p>\n\n        <p style=\"margin:6px 0 0 0;\">\n          <strong>E:</strong>\n          <a href=\"mailto:tina@linarconsulting.com\" style=\"color:#1155cc; text-decoration:none;\">\n            tina@linarconsulting.com\n          </a>\n        </p>\n\n        <p style=\"margin:0;\">\n          <strong>W:</strong>\n          <a href=\"https://linarconsulting.com/\" style=\"color:#1155cc; text-decoration:none;\">\n            www.linarconsulting.com\n          </a>\n        </p>\n\n        <p style=\"margin:12px 0 0 0; font-weight:700;\">\n          P.S. want a weekly sales and BD punch in the face?\n          <a href=\"https://share-eu1.hsforms.com/1TvoeY-xqRLuJ-8TxHvsw_w2db85y\" style=\"color:#1155cc; text-decoration:none;\">\n            Three Things\n          </a>\n          to get you ducking and weaving with your clients.\n        </p>\n\n      </div>\n\n    </div>\n  </body>\n</html>\n",
        "additionalFields": {
          "bodyContentType": "html"
        }
      },
      "type": "n8n-nodes-base.microsoftOutlook",
      "typeVersion": 2,
      "position": [
        544,
        1904
      ],
      "id": "e47690a9-5d9b-486d-b8fc-1e927bad624e",
      "name": "Summary email - INTERNAL",
      "webhookId": "0a57ad19-7a2b-4e0f-bec4-605fcf511055",
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "id": "ts6NAj26jL1iUdW2",
          "name": "Microsoft Outlook - Info @ Legal Engine"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.2",
          "mode": "list",
          "cachedResultName": "gpt-5.2"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -48,
        2128
      ],
      "id": "dfe87c53-45ef-4476-a268-9ec8c5e4622d",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "A6TzpvpaIyqf4IKq",
          "name": "Lee C chat GPT account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "operation": "search",
        "query": "NEW - Three Things.pdf"
      },
      "type": "n8n-nodes-base.microsoftOneDrive",
      "typeVersion": 1,
      "position": [
        -3008,
        2320
      ],
      "id": "e07a2819-29a7-489f-aa0d-ae76e4a22b88",
      "name": "Search a file",
      "credentials": {
        "microsoftOneDriveOAuth2Api": {
          "id": "O6kcuY0URca0xV5I",
          "name": "Lee LINAR - Microsoft Drive account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "toRecipients": "=lee@legalengine.co.uk",
        "subject": "Your conversation with Three Things Tina - recco amend",
        "bodyContent": "=<html>\n  <body style=\"margin:0; padding:0;\">\n    <div style=\"font-family: Arial, Helvetica, sans-serif; font-size:14px; line-height:1.6; color:#000000;\">\n\n      <!-- Header -->\n      <div style=\"margin:0 0 20px 0; padding:0;\">\n        <img src=\"https://raw.githubusercontent.com/LE-LeeC/LINAR/main/Linar-Wordmark-RGB-Red-optimized.png\"\n             alt=\"LINAR logo\"\n             style=\"height:20px; display:block; border:0; outline:none;\">\n      </div>\n\n      <!-- Greeting -->\n      <p style=\"margin:0 0 12px 0; padding:0;\">\n        Hi, {{ $('Three Things Tina').item.json.body.data.analysis.data_collection_results.Name.value }}\n      </p>\n\n      <p style=\"margin:0 0 16px 0; padding:0;\">\n        Thanks for speaking to me. I really enjoyed our conversation and have made some recommendations below which I hope are helpful.\n      </p>\n\n      <!-- Challenge -->\n      <h3 style=\"font-size:18px; font-weight:700; color:#b10f2e; margin:30px 0 10px 0; padding:0;\">\n        Your challenge\n      </h3>\n      <p style=\"margin:0 0 16px 0; padding:0;\">\n        {{ $('Challenge').item.json.output }}\n      </p>\n\n      <!-- Recommendations -->\n      <h3 style=\"font-size:18px; font-weight:700; color:#b10f2e; margin:30px 0 10px 0; padding:0;\">\n        Recommendations\n      </h3>\n      <ul style=\"margin:0 0 16px 0; padding:0; list-style-type:none;\">\n        {{ $('Recco email cleanup').item.json.html_bullets }}\n      </ul>\n\n      <!-- Immediate actions -->\n      <h3 style=\"font-size:18px; font-weight:700; color:#b10f2e; margin:30px 0 10px 0; padding:0;\">\n        Immediate actions\n      </h3>\n      <p style=\"margin:0 0 12px 0; padding:0;\">\n        Based on the above, we recommend you take the following actions to address your immediate challenge:\n      </p>\n      <ul style=\"margin:0 0 16px 0; padding:0; list-style-type:none;\">\n        {{ $('Email cleanup').item.json.html_bullets }}\n      </ul>\n\n      <!-- Related articles -->\n      <h3 style=\"font-size:18px; font-weight:700; color:#b10f2e; margin:30px 0 10px 0; padding:0;\">\n        Related articles\n      </h3>\n      <div style=\"margin:0; padding:0;\">\n        {{ $json.html_email }}\n      </div>\n\n      <!-- Footer -->\n      <hr style=\"margin:30px 0; border:0; border-top:1px solid #b10f2e;\">\n\n      <p style=\"margin:0 0 16px 0; padding:0;\">\n        You can find all of our Three Things articles\n        <a href=\"https://linarconsulting.com/resources/\" target=\"_blank\" style=\"color:#b10f2e; text-decoration:none;\">here</a>.\n        We also send out a weekly Three Things newsletter direct to your inbox. sign up\n        <a href=\"https://share-eu1.hsforms.com/1TvoeY-xqRLuJ-8TxHvsw_w2db85y\" target=\"_blank\" style=\"color:#b10f2e; text-decoration:none;\">here</a>.\n      </p>\n\n      <p style=\"margin:0; padding:0;\">Kind regards</p>\n      <p style=\"margin:6px 0 0 0; padding:0; font-weight:700;\">Tina</p>\n\n      <!-- Signature -->\n      <div style=\"margin-top:20px;\">\n\n        <p style=\"margin:0;\">Three Things agent</p>\n        <p style=\"margin:0; font-weight:700; color:#C82613;\">LINAR Consulting</p>\n\n        <p style=\"margin:6px 0 0 0;\">\n          <strong>E:</strong>\n          <a href=\"mailto:tina@linarconsulting.com\" style=\"color:#1155cc; text-decoration:none;\">\n            tina@linarconsulting.com\n          </a>\n        </p>\n\n        <p style=\"margin:0;\">\n          <strong>W:</strong>\n          <a href=\"https://linarconsulting.com/\" style=\"color:#1155cc; text-decoration:none;\">\n            www.linarconsulting.com\n          </a>\n        </p>\n\n        <p style=\"margin:12px 0 0 0; font-weight:700;\">\n          P.S. want a weekly sales and BD punch in the face?\n          <a href=\"https://share-eu1.hsforms.com/1TvoeY-xqRLuJ-8TxHvsw_w2db85y\" style=\"color:#1155cc; text-decoration:none;\">\n            Three Things\n          </a>\n          to get you ducking and weaving with your clients.\n        </p>\n\n      </div>\n\n    </div>\n  </body>\n</html>\n",
        "additionalFields": {
          "bodyContentType": "html"
        }
      },
      "type": "n8n-nodes-base.microsoftOutlook",
      "typeVersion": 2,
      "position": [
        544,
        2112
      ],
      "id": "8d134bb8-8b00-43d6-979d-b26e266fe060",
      "name": "Summary email - INTERNAL2",
      "webhookId": "0a57ad19-7a2b-4e0f-bec4-605fcf511055",
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "id": "ts6NAj26jL1iUdW2",
          "name": "Microsoft Outlook - Info @ Legal Engine"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Code / Function node\n * Input: $json.output (string with newline-separated points)\n * Output: html_bullets (HTML <li> items ready to insert into an email <ul>)\n * Bullet colour: #b10f2e\n */\n\nconst raw = ($json.output || '').toString().trim();\n\n// Normalise line endings\nconst normalised = raw.replace(/\\r\\n/g, '\\n').replace(/\\r/g, '\\n');\n\n// Escape to prevent broken HTML / injection\nconst escapeHtml = (s) =>\n  s\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#39;');\n\n// Strip existing bullets / numbering if present\nconst stripPrefix = (s) =>\n  s\n    .replace(/^\\s*[-•*]\\s+/, '')\n    .replace(/^\\s*\\d+[\\).\\]]\\s+/, '')\n    .trim();\n\n// Split into lines, clean up, and keep non-empty\nconst points = normalised\n  .split('\\n')\n  .map(stripPrefix)\n  .filter(Boolean);\n\n// Build <li> items (insert into your template’s <ul>…</ul>)\nconst htmlBullets = points\n  .map(\n    (p) =>\n      `<li style=\"margin:0 0 8px 0;padding:0;color:#b10f2e;\">` +\n        \n        `<span style=\"color:#000000;\">${escapeHtml(p)}</span>` +\n      `</li>`\n  )\n  .join('');\n\nreturn [\n  {\n    json: {\n      html_bullets: htmlBullets,\n    },\n  },\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -912,
        1904
      ],
      "id": "7357f3ac-16a5-428d-b1f3-619f3b5e7d38",
      "name": "Recco email cleanup",
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "// n8n Code node (JavaScript)\n// Input: items[0].json.message (or items[0].json.text/output) contains:\n// 3 pipe-delimited entries separated by the literal token /n (slash+n), sometimes followed by a real newline.\n// Output: cleaned_text, articles[], html_email\n\nconst input = items[0].json;\nconst raw =\n  input.message ??\n  input.text ??\n  input.output ??\n  input.cleaned_text ??\n  \"\";\n\n// ---------- Helpers ----------\nconst esc = (s) =>\n  String(s ?? \"\")\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&#39;\");\n\nconst extractHref = (s) => {\n  const m = String(s ?? \"\").match(/href=\"([^\"]+)\"/i);\n  return m ? m[1].trim() : \"\";\n};\n\n// ---------- 0) Normalise separators ----------\nconst normalisedRaw = String(raw)\n  // Convert the literal delimiter /n into a real newline\n  .replace(/\\/n\\s*/g, \"\\n\")\n  // Normalise CRLF\n  .replace(/\\r\\n/g, \"\\n\")\n  .replace(/\\r/g, \"\\n\")\n  .trim();\n\n// ---------- 1) Split into lines ----------\nlet lines = normalisedRaw\n  .split(\"\\n\")\n  .map((l) => l.trim())\n  .filter(Boolean);\n\n// If the model ever jammed multiple entries onto one line, split on /n again defensively\nlines = lines.flatMap((l) => l.split(/\\/n/).map((x) => x.trim()).filter(Boolean));\n\n// Keep only first 3 lines (defensive)\nlines = lines.slice(0, 3);\n\n// ---------- 2) Parse the 3 lines ----------\nconst articles = [];\n\nfor (const line of lines) {\n  const parts = line.split(\" | \").map((p) => p.trim());\n\n  // We expect at least: title, h2, action, explainer, link\n  if (parts.length < 5) continue;\n\n  const title = parts[0] || \"\";\n  const h2 = parts[1] || \"\";\n  const action = parts[2] || \"\";\n  const explainer = parts[3] || \"\";\n\n  // Link part may contain extra pipes in weird cases, so join remainder\n  const linkPart = parts.slice(4).join(\" | \");\n  const url = extractHref(linkPart) || extractHref(line);\n\n  articles.push({\n    title,\n    h2,\n    action,\n    explainer,\n    url,\n  });\n}\n\n// Pad to exactly 3 items to prevent downstream issues\nwhile (articles.length < 3) {\n  articles.push({ title: \"\", h2: \"\", action: \"\", explainer: \"\", url: \"\" });\n}\n\n// ---------- 3) Build cleaned_text ----------\nconst cleaned_text = articles\n  .map(\n    (a) =>\n      `${a.title} | ${a.h2} | ${a.action} | ${a.explainer} | <a href=\"${a.url}\">Read article</a>`\n  )\n  .join(\"\\n\");\n\n// ---------- 4) Build HTML email block ----------\nconst cards = articles\n  .map((a) => {\n    const title = esc(a.title);\n    const h2 = esc(a.h2);\n    const action = esc(a.action);\n    const explainer = esc(a.explainer);\n    const url = esc(a.url);\n\n    return `\n<div style=\"margin:0 0 14px 0; padding:14px; border:1px solid #e6e6e6; border-radius:10px;\">\n  <div style=\"margin:0 0 6px 0; font-size:14px; line-height:20px; color:#111; font-weight:700;\">\n    ${title}\n  </div>\n  <div style=\"margin:0 0 8px 0; font-size:14px; line-height:20px; color:#333; font-weight:600;\">\n    ${h2}\n  </div>\n  <div style=\"margin:0 0 10px 0; font-size:14px; line-height:20px; color:#444;\">\n    ${action}\n  </div>\n  <div style=\"margin:0 0 10px 0; font-size:14px; line-height:20px; color:#444;\">\n    ${explainer}\n  </div>\n  <div style=\"margin:0; font-size:14px; line-height:20px;\">\n    <a href=\"${url}\" style=\"color:#1155cc; text-decoration:underline;\">Read article</a>\n  </div>\n</div>\n    `.trim();\n  })\n  .join(\"\\n\");\n\nconst html_email = `\n<div style=\"font-family: Arial, Helvetica, sans-serif; color:#111; font-size:14px; line-height:20px;\">\n  <p style=\"margin:0 0 12px 0;\">Here are three recommended reads tailored to the challenge.</p>\n  ${cards}\n</div>\n`.trim();\n\nreturn [\n  {\n    json: {\n      cleaned_text,\n      articles,\n      html_email,\n    },\n  },\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        320,
        1904
      ],
      "id": "975fa188-0119-4ab1-8e97-6f41c0d8e7b6",
      "name": "Create Examples HTML",
      "disabled": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "84f296ec-21cf-476e-8781-1e600dcd7699",
              "leftValue": "={{ $('Three Things Tina').item.json.body.data.conversation_initiation_client_data.dynamic_variables.system__call_duration_secs }}",
              "rightValue": 60,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -2400,
        -448
      ],
      "id": "f29fb3c5-9bd9-4f54-b9c6-9d75144e7660",
      "name": "If1"
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": "01RDSCPONO2CZT22PORNC3PJQ4CAPNY3TD"
      },
      "type": "n8n-nodes-base.microsoftOneDrive",
      "typeVersion": 1,
      "position": [
        -512,
        -448
      ],
      "id": "105e5667-7030-4d47-bad1-54d3fcda30af",
      "name": "Download a file1",
      "credentials": {
        "microsoftOneDriveOAuth2Api": {
          "id": "O6kcuY0URca0xV5I",
          "name": "Lee LINAR - Microsoft Drive account"
        }
      }
    },
    {
      "parameters": {
        "operation": "pdf",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1.1,
      "position": [
        -224,
        -448
      ],
      "id": "d3f51f0e-a4f6-40ef-aec8-bff7c6883a45",
      "name": "Extract from File"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.2",
          "mode": "list",
          "cachedResultName": "gpt-5.2"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        64,
        -240
      ],
      "id": "be0a19b2-65cb-4882-ae19-0a9d5bd07a98",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "A6TzpvpaIyqf4IKq",
          "name": "Lee C chat GPT account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Get the incoming JSON body\nconst input = items[0].json;\n\n// Defensive navigation\nconst data = input.body?.data || {};\nconst transcript = data.transcript || [];\n\n// Build Markdown\nlet md = `# Conversation Transcript\\n\\n`;\n\ntranscript.forEach((turn) => {\n  if (!turn.message) return;\n\n  const role =\n    turn.role === \"agent\" ? \"**Agent**\"\n    : turn.role === \"user\" ? \"**User**\"\n    : \"**System**\";\n\n  const message = turn.message.trim();\n\n  if (message) {\n    md += `${role}:\\n\\n${message}\\n\\n---\\n\\n`;\n  }\n});\n\n// Extract structured analysis data\nconst analysis = data.analysis || {};\nconst collected = analysis.data_collection_results || {};\n\n// Add extracted insights section if anything exists\nif (Object.keys(collected).length > 0) {\n  md += `# Extracted Insights\\n\\n`;\n\n  if (collected[\"Name\"]?.value) {\n    md += `**Name:** ${collected[\"Name\"].value}\\n\\n`;\n  }\n\n  if (collected[\"Challenge\"]?.value) {\n    md += `**Challenge:**\\n\\n${collected[\"Challenge\"].value}\\n\\n`;\n  }\n\n  if (collected[\"Recommendations\"]?.value) {\n    md += `**Recommendations:**\\n\\n${collected[\"Recommendations\"].value}\\n\\n`;\n  }\n\n  if (collected[\"Examples\"]?.value) {\n    md += `**Examples:**\\n\\n${collected[\"Examples\"].value}\\n\\n`;\n  }\n}\n\n// Optional AI summary section\nif (analysis.call_summary_title || analysis.transcript_summary) {\n  md += `# Call Summary\\n\\n`;\n\n  if (analysis.call_summary_title) {\n    md += `**Title:** ${analysis.call_summary_title}\\n\\n`;\n  }\n\n  if (analysis.transcript_summary) {\n    md += `${analysis.transcript_summary}\\n\\n`;\n  }\n}\n\n// Return markdown as output\nreturn [\n  {\n    json: {\n      markdown: md\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2848,
        -448
      ],
      "id": "ad3a5d29-3e40-44c3-91ba-613e79d28f2e",
      "name": "Full Transcript Code Node"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are Tina an AI assistant working for LINAR Consulting Ltd (https://linarconsulting.com). You are a business development and sales coach with knowledge of the complete catalogue of weekly Three Things newsletters that are developed and curated by the LINAR team (https://linarconsulting.com/resources/).\n\nYour task is to provide a summary of the **challenge** the user is facing. \n\nThis summary should be maximum 75 words in length.\n\nThe summary output should begin by acknowledging that the challenge as defined is based on the conversation with the user, and speaking in the second person (i.e. you), and then state the challenge identified.\n\nReturn just the plain-English context — no headings, no extra explanation.\n\nKeep it professional and clear.\n\nPlease make sure that all outputs are in *UK English* not American English, including all spelling and date formats.\n\n\nHere is the full transcript:\n{{ $json.markdown }}\n\nDo not use em dashes or en dashes. Replace them with full stops or commas.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -2176,
        -448
      ],
      "id": "2734ff1a-5169-45c0-9dc0-dfe6643449a9",
      "name": "Identify Challenge"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are Tina an AI assistant working for LINAR Consulting Ltd (https://linarconsulting.com). You are a business development and sales coach with knowledge of the complete catalogue of weekly Three Things newsletters that are developed and curated by the LINAR team (https://linarconsulting.com/resources/).\n\nYour task is to provide a succinct **recommendation** on how to address the challenge. \n\nThis recommendation should be maximum 100 words in length. \n\nThe tone and format of the recommendation should be a short paragraph which provides potential solutions to the challenge. \n\nBe explicit and make it clear that the proposed solutions are based on what the team at LINAR have seen work well for other people.\n\nUse phrases like \"you might want to consider\", \"have you tried\", \"have you thought about\" etc to generate a real sense of collaboration between Tina and the user. \n\nReturn just the plain-English context — no headings, no extra explanation.\n\nKeep it professional and clear.\n\nPlease make sure that all outputs are in *UK English* not American English, including all spelling and date formats.\n\nHere is the challenge:\n{{ $json.output }}\n\nDo not use em dashes or en dashes. Replace them with full stops or commas.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -1824,
        -448
      ],
      "id": "e502fb6c-abc0-4ca3-a18e-a5126cece149",
      "name": "Identify Recommendations"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are Tina an AI assistant working for LINAR Consulting Ltd (https://linarconsulting.com). You are a business development and sales coach with knowledge of the complete catalogue of weekly Three Things newsletters that are developed and curated by the LINAR team (https://linarconsulting.com/resources/).\n\nYour task is to provide a list of exactly three **examples** the user could try to remedy their challenge. \n\nEach examples hould be displayed on a separate line. \n\nPlease provide exactly three examples for the user to consider. No more, no less.\n\nExamples should be practical and contain specific actions the user can execute immediately after reading the example.\n\nReturn just the plain-English context — no headings, no extra explanation.\n\nKeep it professional and clear.\n\nPlease make sure that all outputs are in *UK English* not American English, including all spelling and date formats.\n\n\nHere is a version of the challenge:\n{{ $('Identify Challenge').item.json.output }}\n\nAnd here is a different version of the challenge:\n{{ $('Three Things Tina').item.json.body.data.analysis.data_collection_results.Challenge.value }}\n\nDo not use em dashes or en dashes. Replace them with full stops or commas.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -1264,
        -448
      ],
      "id": "3fac4044-344b-4bff-8c09-e5ca3747ffe3",
      "name": "Examples Next Steps"
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Code / Function node\n * Input: $json.output (single string)\n * Output: html_bullets (<li> items for insertion into an email <ul>)\n * Bullet colour: #b10f2e\n *\n * Outlook desktop fix:\n * - Prevent the native <li> marker from rendering (double bullets) by setting list-style-type:none.\n * - Neutralise Outlook/Word list indentation with mso and margin/padding resets.\n * - Keep your custom red bullet character for consistent cross-client rendering.\n */\n\nvar raw = ($json.output || \"\").toString().trim();\n\n// HTML escape to avoid broken markup\nfunction escapeHtml(s) {\n  return String(s === undefined || s === null ? \"\" : s)\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&#39;\");\n}\n\n// Normalise quotes and spacing\nvar normalised = raw\n  .replace(/[“”]/g, '\"')\n  .replace(/[’]/g, \"'\")\n  .replace(/\\s+/g, \" \")\n  .trim();\n\n// Split into bullet-sized sentences\n// Note: lookbehind can fail in some n8n runtimes. Avoid it for compatibility.\nvar points = [];\nif (normalised) {\n  // Split on sentence end punctuation followed by whitespace and then A-Z or 0-9\n  var parts = normalised.split(/[.!?]\\s+(?=[A-Z0-9])/g);\n\n  // Re-add punctuation to all but last segment where possible by extracting from original.\n  // Simpler: keep segments as-is. Email bullets read fine without the punctuation at the split point.\n  for (var i = 0; i < parts.length; i++) {\n    var p = String(parts[i]).trim();\n    if (p) points.push(p);\n  }\n}\n\n// Build email-safe <li> items (NO <ul> here)\n// Outlook desktop: remove native list marker and indentation, keep custom bullet.\nvar htmlBullets = points\n  .map(function (p) {\n    return (\n      '<li style=\"' +\n        'margin:0 0 8px 0;' +\n        'padding:0;' +\n        'list-style-type:none;' +\n        'mso-special-format:bullet;' +\n        'mso-list:l0 level1 lfo1;' +\n      '\">' +\n        '<span style=\"color:#b10f2e;font-weight:700;\">&#8226;</span> ' +\n        '<span style=\"color:#000000;\">' + escapeHtml(p) + \"</span>\" +\n      \"</li>\"\n    );\n  })\n  .join(\"\");\n\nreturn [\n  {\n    json: {\n      html_bullets: htmlBullets\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1472,
        -448
      ],
      "id": "7d4de0d9-d34d-4624-838d-5531bc419e35",
      "name": "Recco HTML Bullets"
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Code / Function node\n * Input: $json.output (single string)\n * Output:\n *  - intro_text (first line only, escaped)\n *  - html_bullets (<li> items for insertion into an email <ul>)\n * Bullet colour: #b10f2e\n *\n * Outlook desktop fixes:\n * - Remove native <li> marker (prevents double bullets)\n * - Reset Word-engine list indentation\n * - Keep custom bullet for consistent cross-client rendering\n */\n\nvar raw = ($json.output || \"\").toString().trim();\n\n// HTML escape to avoid broken markup\nfunction escapeHtml(s) {\n  return String(s === undefined || s === null ? \"\" : s)\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&#39;\");\n}\n\n// Normalise line endings and literal delimiter /n\nvar normalised = raw\n  .replace(/\\/n\\s*/g, \"\\n\")\n  .replace(/\\r\\n/g, \"\\n\")\n  .replace(/\\r/g, \"\\n\")\n  .trim();\n\n// Split into lines\nvar lines = normalised\n  .split(\"\\n\")\n  .map(function (l) { return l.trim(); })\n  .filter(function (l) { return l.length > 0; });\n\n\n// Remaining lines become bullets\nvar htmlBullets = lines\n  .map(function (p) {\n    return (\n      '<li >' +\n         escapeHtml(p) + \n      \"</li>\"\n    );\n  })\n  .join(\"\");\n\nreturn [\n  {\n    json: {\n      \n      html_bullets: htmlBullets\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -896,
        -448
      ],
      "id": "3c95f945-191d-4238-86d2-cbd763a5ecb7",
      "name": "Next Steps HTML Bullets"
    },
    {
      "parameters": {
        "jsCode": "// n8n Code node (JavaScript) ES5 safe\n// Input: Agent 2 output string with 3 items separated by literal /n\n// Output: cleaned_text, articles[], html_email, debug\n\nvar input = (items && items[0] && items[0].json) ? items[0].json : {};\n\n// ---------- Helpers ----------\nfunction esc(s) {\n  return String(s === undefined || s === null ? \"\" : s)\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&#39;\");\n}\n\nfunction extractHref(s) {\n  var m = String(s === undefined || s === null ? \"\" : s).match(/href=\"([^\"]+)\"/i);\n  return m ? m[1].trim() : \"\";\n}\n\nfunction splitPipes(line) {\n  return String(line === undefined || line === null ? \"\" : line)\n    .split(/\\s*\\|\\s*/g)\n    .map(function (p) { return p.trim(); });\n}\n\nfunction pickFirstString(obj, keys) {\n  for (var i = 0; i < keys.length; i++) {\n    var k = keys[i];\n    var v = obj[k];\n    if (typeof v === \"string\" && v.trim()) return v.trim();\n  }\n  return \"\";\n}\n\nfunction findLikelyOutputString(obj) {\n  for (var k in obj) {\n    if (!Object.prototype.hasOwnProperty.call(obj, k)) continue;\n    var v = obj[k];\n    if (typeof v !== \"string\") continue;\n    var s = v.trim();\n    if (!s) continue;\n\n    var pipes = s.match(/\\|/g);\n    var pipeCount = pipes ? pipes.length : 0;\n    if (pipeCount >= 4) return s;\n  }\n  return \"\";\n}\n\nfunction collapseWhitespace(s) {\n  return String(s === undefined || s === null ? \"\" : s)\n    .replace(/\\r\\n/g, \"\\n\")\n    .replace(/\\r/g, \"\\n\")\n    .replace(/\\s*\\n\\s*/g, \" \")\n    .replace(/\\s+/g, \" \")\n    .trim();\n}\n\nfunction parseTitleAndDate(titleWithDate) {\n  var s = String(titleWithDate === undefined || titleWithDate === null ? \"\" : titleWithDate).trim();\n  var out = { title: s, date: \"\" };\n  var m = s.match(/^(.*)\\((\\d{2}\\/\\d{2}\\/\\d{2})\\)\\s*$/);\n  if (m) {\n    out.title = (m[1] || \"\").trim();\n    out.date = (m[2] || \"\").trim();\n  }\n  return out;\n}\n\n// ---------- 0) Choose raw input ----------\nvar raw = pickFirstString(input, [\"output\", \"message\", \"text\", \"content\", \"result\", \"response\"]);\nif (!raw) raw = findLikelyOutputString(input);\nif (!raw) raw = \"\";\n\n// ---------- 1) Split into items by literal /n (DO NOT replace /n) ----------\nvar parts = raw.split(\"/n\");\nvar entries = [];\nfor (var i = 0; i < parts.length; i++) {\n  var t = String(parts[i] === undefined || parts[i] === null ? \"\" : parts[i]).trim();\n  if (t) entries.push(t);\n}\nif (entries.length > 3) entries = entries.slice(0, 3);\n\n// Collapse internal newlines and excess spaces per entry\nfor (var e = 0; e < entries.length; e++) {\n  entries[e] = collapseWhitespace(entries[e]);\n}\n\n// ---------- 2) Parse entries ----------\nvar articles = [];\n\nfor (var ei = 0; ei < entries.length; ei++) {\n  var entry = entries[ei];\n  var fields = splitPipes(entry);\n\n  if (fields.length < 5) {\n    var td0 = parseTitleAndDate(fields[0] || \"\");\n    articles.push({ title: td0.title, date: td0.date, h2: fields[1] || \"\", action: \"\", explainer: \"\", url: \"\" });\n    continue;\n  }\n\n  var td = parseTitleAndDate(fields[0] || \"\");\n  var h2 = fields[1] || \"\";\n  var action = fields[2] || \"\";\n\n  // find link field from end\n  var linkIndex = -1;\n  for (var j = fields.length - 1; j >= 0; j--) {\n    if (/href\\s*=/.test(fields[j]) || /^https?:\\/\\//i.test(fields[j])) {\n      linkIndex = j;\n      break;\n    }\n  }\n  if (linkIndex === -1) linkIndex = fields.length - 1;\n\n  var linkPart = fields.slice(linkIndex).join(\" | \");\n  var explainer = fields.slice(3, linkIndex).join(\" | \").trim();\n\n  var url = extractHref(linkPart);\n  if (!url) url = extractHref(entry);\n  if (!url && /^https?:\\/\\//i.test(linkPart)) url = linkPart.trim();\n\n  articles.push({ title: td.title, date: td.date, h2: h2, action: action, explainer: explainer, url: url });\n}\n\n// pad to 3\nwhile (articles.length < 3) {\n  articles.push({ title: \"\", date: \"\", h2: \"\", action: \"\", explainer: \"\", url: \"\" });\n}\narticles.length = 3;\n\n// ---------- 3) cleaned_text ----------\nvar cleaned_text = articles\n  .map(function (a) {\n    var titleWithDate = a.date ? (a.title + \" (\" + a.date + \")\") : a.title;\n    var link = a.url ? '<a href=\"' + a.url + '\">Read article</a>' : \"\";\n    return titleWithDate + \" | \" + a.h2 + \" | \" + a.action + \" | \" + a.explainer + \" | \" + link;\n  })\n  .join(\"\\n\");\n\n// ---------- 4) html_email ----------\nvar cards = articles\n  .map(function (a) {\n    var titleWithDate = a.date ? (a.title + \" (\" + a.date + \")\") : a.title;\n\n    var titleEsc = esc(titleWithDate);\n    var h2Esc = esc(a.h2);\n    var actionEsc = esc(a.action);\n    var explainerEsc = esc(a.explainer);\n    var urlEsc = esc(a.url);\n\n    var linkHtml = a.url\n      ? '<div style=\"margin:0; font-size:14px; line-height:20px;\">' +\n          '<a href=\"' + urlEsc + '\" style=\"color:#1155cc; text-decoration:underline;\">Read article</a>' +\n        \"</div>\"\n      : \"\";\n\n    return (\n      '<div style=\"margin:0 0 14px 0; padding:14px; border:1px solid #e6e6e6; border-radius:10px;\">' +\n        '<div style=\"margin:0 0 6px 0; font-size:14px; line-height:20px; color:#111; font-weight:700;\">' +\n          titleEsc +\n        \"</div>\" +\n        '<div style=\"margin:0 0 8px 0; font-size:14px; line-height:20px; color:#333; font-weight:600;\">' +\n          h2Esc +\n        \"</div>\" +\n        '<div style=\"margin:0 0 10px 0; font-size:14px; line-height:20px; color:#444;\">' +\n          actionEsc +\n        \"</div>\" +\n        '<div style=\"margin:0 0 10px 0; font-size:14px; line-height:20px; color:#444;\">' +\n          explainerEsc +\n        \"</div>\" +\n        linkHtml +\n      \"</div>\"\n    );\n  })\n  .join(\"\\n\");\n\nvar html_email =\n  '<div style=\"font-family: Arial, Helvetica, sans-serif; color:#111; font-size:14px; line-height:20px;\">' +\n    '<p style=\"margin:0 0 12px 0;\">Here are three recommended reads tailored to the challenge.</p>' +\n    cards +\n  \"</div>\";\n\n// ---------- Debug ----------\nvar debug = {\n  raw_preview: String(raw).slice(0, 300),\n  entry_count: entries.length,\n  entries_preview: entries\n};\n\nreturn [{ json: { cleaned_text: cleaned_text, articles: articles, html_email: html_email, debug: debug } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        816,
        -448
      ],
      "id": "ccd54857-6150-41dd-9257-cb04dea7d44d",
      "name": "Create Examples HTML List"
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Code / Function node\n * Input: $json.output (string with newline-separated points)\n * Output: html_bullets (HTML <li> items ready to insert into an email <ul>)\n * Bullet colour: #b10f2e\n */\n\nconst raw = ($json.output || '').toString().trim();\n\n// Normalise line endings\nconst normalised = raw.replace(/\\r\\n/g, '\\n').replace(/\\r/g, '\\n');\n\n// Escape to prevent broken HTML / injection\nconst escapeHtml = (s) =>\n  s\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#39;');\n\n// Strip existing bullets / numbering if present\nconst stripPrefix = (s) =>\n  s\n    .replace(/^\\s*[-•*]\\s+/, '')\n    .replace(/^\\s*\\d+[\\).\\]]\\s+/, '')\n    .trim();\n\n// Split into lines, clean up, and keep non-empty\nconst points = normalised\n  .split('\\n')\n  .map(stripPrefix)\n  .filter(Boolean);\n\n// Build <li> items (insert into your template’s <ul>…</ul>)\nconst htmlBullets = points\n  .map(\n    (p) =>\n      `<li style=\"margin:0 0 8px 0;padding:0;color:#b10f2e;\">` +\n        \n        `<span style=\"color:#000000;\">${escapeHtml(p)}</span>` +\n      `</li>`\n  )\n  .join('');\n\nreturn [\n  {\n    json: {\n      html_bullets: htmlBullets,\n    },\n  },\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1152,
        592
      ],
      "id": "fb34704b-edd7-4487-9bee-08cae3bb4908",
      "name": "Next Steps HTML Bullets1",
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Challenge-anchored article selection prompt\n\nSource constraints. Non-negotiable:\nYou must NOT browse, crawl, open, or read any webpages.\nYou must NOT follow links or infer missing information beyond the explicit rules below.\nYou must use ONLY the dataset contained in the following text as the sole source of truth:\n{{ $json.text }}\n\nChallenge definition:\nChallenge version A:\n{{ $('Identify Challenge').item.json.output }}\n\nChallenge version B:\n{{ $('Three Things Tina').item.json.body.data.analysis.data_collection_results.Challenge.value }}\n\nHelpful context. Use only if relevant and do not override the challenge wording:\nRecommendations for next steps:\n{{ $('Identify Recommendations').item.json.output }}\nExamples of next steps:\n{{ $('Examples Next Steps').item.json.output }}\n\nInterpretation constraint:\nAll relevance decisions must be explicitly grounded in the challenge wording above.\nDo NOT rely on generic BD best practice unless it directly maps to the challenge text.\nIf a connection cannot be clearly traced to the challenge wording, it must be treated as weak or irrelevant.\n\nDataset structure:\nEach candidate entry is intended to be one line containing fields separated by “ | ”.\nExpected structure:\nTitle | First in-body H2 | Challenge action | Verbose relevance explainer | <a href=\"URL\">Read article</a>\n\nEligibility and normalisation rules. Apply in order:\n1) Treat any line with at least four “ | ” separators as a candidate.\n2) Map fields as:\n   Field 1 = Title\n   Field 2 = First in-body H2\n   Field 3 = Challenge action\n   Field 4 = Verbose relevance explainer\n   Field 5 = URL field\n3) URL handling:\n   a) If Field 5 contains <a href=\"URL\">Read article</a>, use that URL.\n   b) If Field 5 contains a bare URL starting with http, normalise it to <a href=\"URL\">Read article</a>.\n   c) If no usable URL exists, attempt the URL completion rule below.\n4) If Title, H2, action, or explainer cannot be recovered, the entry is ineligible.\n\nURL completion rule for “Three Things” entries:\n1) Do not browse or validate URLs.\n2) Do not change any URL that is already present and usable.\n3) If the URL is missing or empty, scan the full line for the first DD-MM-YY token.\n4) If found, construct:\n   https://linarconsulting.com/three-things-DD-MM-YY/\n5) If no DD-MM-YY token exists, the entry is ineligible.\n\nDecision method. Apply exactly:\n\nStep 1. Extract challenge anchors:\nFrom the combined challenge wording, extract 5–8 short anchor phrases describing the specific gap, behaviour, constraint, or outcome.\nUse only wording that appears in the challenge text. Do not invent anchors.\n\nStep 2. Score each eligible article:\nUse only the Challenge action and Verbose relevance explainer.\nScore each dimension from 0–5:\nA) Anchor coverage\nB) Anchor precision\nC) Under-time-pressure usefulness\nD) Conversation move quality\nE) Fast-win applicability\nTotal score = A+B+C+D+E (max 25)\n\nStep 3. Closest-match selection:\nSelect the three highest-scoring entries where Anchor precision and Anchor coverage are strongest.\nDo not select broadly useful articles that weakly map to the challenge.\n\nStep 4. Anti-duplication check:\nIf two of the top three rely on the same behavioural mechanism, keep the higher-scoring one.\nReplace the other with the next-highest scoring eligible entry that introduces a distinct lever while still matching the anchors.\nAnchor precision always outweighs variety.\n\nTie-break rules. Apply strictly in this order:\n1) Higher Anchor precision\n2) Higher Anchor coverage\n3) More specific Challenge action\n4) Explainer with clearer example questions or exact phrases\n\nOutput rules. Strict and final. Parser-critical:\nYou MUST output exactly THREE items.\nEach item must be a SINGLE LINE.\nEach line must use this exact structure:\nTitle | First in-body H2 | Challenge action | Verbose relevance explainer | <a href=\"URL\">Read article</a>\n\nDelimiter rules. Mandatory:\nBetween item 1 and item 2 output exactly:\n/n\nBetween item 2 and item 3 output exactly:\n/n\n\nDo NOT output anything before the first item.\nDo NOT output anything after the third item.\nDo NOT add explanations, summaries, numbering, bullets, or extra lines.\n\nFailure handling:\nIf fewer than three eligible entries exist, still output exactly three lines.\nFor any missing fields, use empty text but keep the exact line structure and delimiter usage.\nNever output fewer than three items.\nNever output JSON.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -528,
        592
      ],
      "id": "21ed5870-2933-49da-a624-31efc431e735",
      "name": "Articles4",
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Challenge anchored ranking prompt\n\nSource constraints. Non negotiable:\nYou must NOT browse, crawl, open, or read any webpages.\nYou must use ONLY the dataset contained in the following text as the sole source of truth:\n{{$json.text}}\n\nChallenge definition:\nChallenge version A:\n{{$node[\"Identify Challenge\"].json.output}}\n\nChallenge version B:\n{{$node[\"Three Things Tina\"].json.body.data.analysis.data_collection_results.Challenge.value}}\n\nHelpful context. Use only if relevant and do not override the challenge wording:\nRecommendations for next steps:\n{{$node[\"Identify Recommendations\"].json.output}}\nExamples of next steps:\n{{$node[\"Examples Next Steps\"].json.output}}\n\nInterpretation constraint:\nAll relevance decisions must be explicitly grounded in the challenge wording above.\nDo NOT rely on generic BD best practice unless it directly maps to the challenge text.\n\nCorpus structure. How to identify an article:\n1) An article starts at a line that begins with a date in DD/MM/YY or DD/MM/YYYY format followed by a dash, for example \"29/04/24 - Sales Campaigns (Part 1) - Campaign preparation\".\n2) The article continues until the next such date line, or end of text.\n3) Treat the text immediately after the date line as the body for that article.\n\nURL construction. Mandatory:\nFor each article with date DD/MM/YY, construct the URL:\nhttps://linarconsulting.com/three-things-DD-MM-YY/\nUse leading zeros. Keep DD and MM as shown in the header. Convert slashes to hyphens.\n\nStep 1. Extract challenge anchors:\nFrom the combined challenge wording, extract 5 to 8 short anchor phrases using only exact wording that appears in the challenge text. Do not invent anchors.\n\nStep 2. For each article, extract evidence:\nA) Title. The full text after the date line.\nB) First in body H2 proxy:\n   Use the first clear section heading in the article body. A heading is a short line, often followed by paragraphs or bullets, that is not a full sentence. If none exists, leave blank.\nC) Evidence snippets:\n   Extract 2 to 4 short snippets from the article body, each max 25 words, that best match the anchors. If none match, output empty.\n\nStep 3. Score each article:\nScore each dimension from 0 to 5 using only the article body and the anchors.\nA) Anchor coverage\nB) Anchor precision\nC) Under time pressure usefulness\nD) Conversation move quality\nE) Fast win applicability\nTotal score = A+B+C+D+E, max 25\n\nStep 4. Rank and anti duplication:\nReturn the top 8 articles by Total score.\nIf two rely on the same behavioural mechanism, keep the higher score and include the next best distinct lever.\n\nFormatting constraints:\nDo not use em dashes or en dashes. Replace them with full stops or commas.\nCapitalise Titles and H2 lines to improve formatting.\n\nOutput rules. Strict and final. Parser critical:\nYou MUST output valid JSON only.\nYou MUST output exactly one JSON array of up to 8 objects.\nEach object must have exactly these keys, in this order:\ndate, title, url, h2, scores, total, anchors_matched, evidence\n\nField rules:\ndate. \"DD/MM/YY\"\ntitle. Title text only with leading letter capitalisation, without date,\nurl. Constructed URL\nh2. First in body H2 proxy or empty\nscores. An object with keys A,B,C,D,E as integers 0 to 5\ntotal. Integer 0 to 25\nanchors_matched. Array of anchor phrases used, exact text from challenge\nevidence. Array of 0 to 4 strings, each a snippet max 25 words\n\nDo not output any other text outside the JSON.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        64,
        -448
      ],
      "id": "5d4240ce-5601-4928-b184-b14596d7fc83",
      "name": "Identify 3 Relevant Three Things Artciles"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.2",
          "mode": "list",
          "cachedResultName": "gpt-5.2"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        432,
        -240
      ],
      "id": "85012c47-08e3-4323-a2e5-e32ec6594dc3",
      "name": "OpenAI Chat Model2",
      "credentials": {
        "openAiApi": {
          "id": "A6TzpvpaIyqf4IKq",
          "name": "Lee C chat GPT account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Structured output generator. Top 3 only\n\nSource constraints. Non negotiable:\nYou must NOT browse, crawl, open, or read any webpages.\nYou must use ONLY the ranked dataset provided below as the sole source of truth:\n{{ $json.output }}\n\nChallenge definition:\n{{$node[\"Identify Challenge\"].json.output}}\n\nSelection rules:\n1) Select exactly THREE items from the ranked dataset.\n2) Prefer higher total score.\n3) Apply tie breaks strictly in this order:\n   a) Higher Anchor precision (score B)\n   b) Higher Anchor coverage (score A)\n   c) More concrete evidence snippets that clearly map to the challenge wording\n4) Anti duplication check:\n   If two candidates rely on the same behavioural mechanism, keep the higher scoring one and replace the other with the next best that introduces a distinct lever.\n   Anchor precision always outweighs variety.\n\nOutput structure. Mandatory:\nEach item must follow this exact field order, separated by pipe characters:\nTitle (DD/MM/YY) | First in-body H2 | Challenge action | Verbose relevance explainer | <a href=\"URL\">Read article</a>\n\nField instructions:\nTitle (DD/MM/YY).\n- Use the object title.\n- Append the date from the object date field in parentheses, exactly like: Title (DD/MM/YY).\n\nFirst in-body H2.\n- Use the object h2.\n- If missing, leave empty but keep the pipe.\n\nChallenge action.\n- Write one short imperative action.\n- It must be directly grounded in the challenge wording and the article evidence.\n\nVerbose relevance explainer.\n- Write 2 to 4 sentences.\n- Explicitly reference at least two exact anchor phrases from the challenge.\n- Tie each anchor phrase to specific evidence from the article.\n- Newlines are allowed inside this field if needed.\n\nURL.\n- Use the object url.\n- Wrap exactly as: <a href=\"URL\">Read article</a>\n\nDelimiter rules. Strict:\n- Output exactly THREE items.\n- Separate items using the literal token:\n/n\n- You MUST NOT use the token /n anywhere else.\n- Do NOT add extra delimiters, numbering, bullets, headings, or surrounding text.\n- Do NOT output JSON.\n\nPunctuation constraint:\nDo not use em dashes or en dashes.\nReplace them with full stops or commas.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        432,
        -448
      ],
      "id": "f6ca9ae7-2816-403e-98b9-67238164c138",
      "name": "Format selected Articles"
    },
    {
      "parameters": {
        "jsCode": "// n8n Code node (JavaScript)\n// Input: items[0].json.message (or items[0].json.text/output) contains:\n// 3 pipe-delimited entries separated by the literal token /n (slash+n), sometimes followed by a real newline.\n// Output: cleaned_text, articles[], html_email\n\nconst input = items[0].json;\nconst raw =\n  input.message ??\n  input.text ??\n  input.output ??\n  input.cleaned_text ??\n  \"\";\n\n// ---------- Helpers ----------\nconst esc = (s) =>\n  String(s ?? \"\")\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&#39;\");\n\nconst extractHref = (s) => {\n  const m = String(s ?? \"\").match(/href=\"([^\"]+)\"/i);\n  return m ? m[1].trim() : \"\";\n};\n\n// ---------- 0) Normalise separators ----------\nconst normalisedRaw = String(raw)\n  // Convert the literal delimiter /n into a real newline\n  .replace(/\\/n\\s*/g, \"\\n\")\n  // Normalise CRLF\n  .replace(/\\r\\n/g, \"\\n\")\n  .replace(/\\r/g, \"\\n\")\n  .trim();\n\n// ---------- 1) Split into lines ----------\nlet lines = normalisedRaw\n  .split(\"\\n\")\n  .map((l) => l.trim())\n  .filter(Boolean);\n\n// If the model ever jammed multiple entries onto one line, split on /n again defensively\nlines = lines.flatMap((l) => l.split(/\\/n/).map((x) => x.trim()).filter(Boolean));\n\n// Keep only first 3 lines (defensive)\nlines = lines.slice(0, 3);\n\n// ---------- 2) Parse the 3 lines ----------\nconst articles = [];\n\nfor (const line of lines) {\n  const parts = line.split(\" | \").map((p) => p.trim());\n\n  // We expect at least: title, h2, action, explainer, link\n  if (parts.length < 5) continue;\n\n  const title = parts[0] || \"\";\n  const h2 = parts[1] || \"\";\n  const action = parts[2] || \"\";\n  const explainer = parts[3] || \"\";\n\n  // Link part may contain extra pipes in weird cases, so join remainder\n  const linkPart = parts.slice(4).join(\" | \");\n  const url = extractHref(linkPart) || extractHref(line);\n\n  articles.push({\n    title,\n    h2,\n    action,\n    explainer,\n    url,\n  });\n}\n\n// Pad to exactly 3 items to prevent downstream issues\nwhile (articles.length < 3) {\n  articles.push({ title: \"\", h2: \"\", action: \"\", explainer: \"\", url: \"\" });\n}\n\n// ---------- 3) Build cleaned_text ----------\nconst cleaned_text = articles\n  .map(\n    (a) =>\n      `${a.title} | ${a.h2} | ${a.action} | ${a.explainer} | <a href=\"${a.url}\">Read article</a>`\n  )\n  .join(\"\\n\");\n\n// ---------- 4) Build HTML email block ----------\nconst cards = articles\n  .map((a) => {\n    const title = esc(a.title);\n    const h2 = esc(a.h2);\n    const action = esc(a.action);\n    const explainer = esc(a.explainer);\n    const url = esc(a.url);\n\n    return `\n<div style=\"margin:0 0 14px 0; padding:14px; border:1px solid #e6e6e6; border-radius:10px;\">\n  <div style=\"margin:0 0 6px 0; font-size:14px; line-height:20px; color:#111; font-weight:700;\">\n    ${title}\n  </div>\n  <div style=\"margin:0 0 8px 0; font-size:14px; line-height:20px; color:#333; font-weight:600;\">\n    ${h2}\n  </div>\n  <div style=\"margin:0 0 10px 0; font-size:14px; line-height:20px; color:#444;\">\n    ${action}\n  </div>\n  <div style=\"margin:0 0 10px 0; font-size:14px; line-height:20px; color:#444;\">\n    ${explainer}\n  </div>\n  <div style=\"margin:0; font-size:14px; line-height:20px;\">\n    <a href=\"${url}\" style=\"color:#1155cc; text-decoration:underline;\">Read article</a>\n  </div>\n</div>\n    `.trim();\n  })\n  .join(\"\\n\");\n\nconst html_email = `\n<div style=\"font-family: Arial, Helvetica, sans-serif; color:#111; font-size:14px; line-height:20px;\">\n  <p style=\"margin:0 0 12px 0;\">Here are three recommended reads tailored to the challenge.</p>\n  ${cards}\n</div>\n`.trim();\n\nreturn [\n  {\n    json: {\n      cleaned_text,\n      articles,\n      html_email,\n    },\n  },\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        592,
        592
      ],
      "id": "bb4c2890-ecde-4b36-9afc-fda158205beb",
      "name": "Create Examples HTML List1",
      "disabled": true
    },
    {
      "parameters": {
        "content": "## Original\n",
        "height": 2816,
        "width": 4576
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3152,
        928
      ],
      "typeVersion": 1,
      "id": "b3ab5ab8-5407-468c-8fc1-d90673912baa",
      "name": "Sticky Note",
      "disabled": true
    },
    {
      "parameters": {
        "content": "## Backup Nodes\n",
        "height": 800,
        "width": 4544
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3136,
        16
      ],
      "typeVersion": 1,
      "id": "2eb8edc3-b2dc-4955-92b9-004df6230ec1",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.2",
          "mode": "list",
          "cachedResultName": "gpt-5.2"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -2176,
        -256
      ],
      "id": "d75c0bb7-9f9f-4781-ab1b-295b59939119",
      "name": "OpenAI Chat Model3",
      "credentials": {
        "openAiApi": {
          "id": "A6TzpvpaIyqf4IKq",
          "name": "Lee C chat GPT account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.2",
          "mode": "list",
          "cachedResultName": "gpt-5.2"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -1824,
        -256
      ],
      "id": "77ce1576-d574-42f0-9a5e-53d579da3226",
      "name": "OpenAI Chat Model4",
      "credentials": {
        "openAiApi": {
          "id": "A6TzpvpaIyqf4IKq",
          "name": "Lee C chat GPT account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.2",
          "mode": "list",
          "cachedResultName": "gpt-5.2"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -1264,
        -256
      ],
      "id": "b7aa9cd1-6553-431e-9a2f-4f155e07b8eb",
      "name": "OpenAI Chat Model5",
      "credentials": {
        "openAiApi": {
          "id": "A6TzpvpaIyqf4IKq",
          "name": "Lee C chat GPT account"
        }
      }
    },
    {
      "parameters": {
        "toRecipients": "={{ $('Three Things Tina').item.json.body.data.analysis.data_collection_results['Email address'].value }}\n",
        "subject": "Your conversation with Three Things Tina",
        "bodyContent": "=<html>\n  <body style=\"margin:0; padding:0;\">\n    <div style=\"font-family: Arial, Helvetica, sans-serif; font-size:14px; line-height:1.6; color:#000000;\">\n\n      <!-- Header -->\n      <div style=\"margin:0 0 20px 0; padding:0;\">\n        <img src=\"https://raw.githubusercontent.com/LE-LeeC/LINAR/main/Linar-Wordmark-RGB-Red-optimized.png\"\n             alt=\"LINAR logo\"\n             style=\"height:20px; display:block; border:0; outline:none;\">\n      </div>\n\n      <!-- Greeting -->\n      <p style=\"margin:0 0 12px 0; padding:0;\">\n        Hi {{ $('Three Things Tina').item.json.body.data.analysis.data_collection_results.Name.value }}\n      </p>\n\n      <p style=\"margin:0 0 16px 0; padding:0;\">\n        Thanks for speaking to me. I really enjoyed our conversation and have made some recommendations below which I hope are helpful.\n      </p>\n\n      <!-- Challenge -->\n      <h3 style=\"font-size:18px; font-weight:700; color:#b10f2e; margin:30px 0 10px 0; padding:0;\">\n        Your challenge\n      </h3>\n      <p style=\"margin:0 0 16px 0; padding:0;\">\n        {{ $('Identify Challenge').item.json.output }}\n      </p>\n\n      <!-- Recommendations -->\n      <h3 style=\"font-size:18px; font-weight:700; color:#b10f2e; margin:30px 0 10px 0; padding:0;\">\n        Recommendations\n      </h3>\n      <p style=\"margin:0 0 16px 0; padding:0;\">\n        {{ $('Identify Recommendations').item.json.output }}\n      </p>     \n\n      <!-- What are you waiting for?! -->\n      <h3 style=\"font-size:18px; font-weight:700; color:#b10f2e; margin:30px 0 10px 0; padding:0;\">\n        What are you waiting for?!\n      </h3>\n      <p style=\"margin:0 0 12px 0; padding:0;\">\n        Based on the above, here are three things (there's always three!) you can do right now to get started:\n      </p>\n      <ul >\n        {{ $('Next Steps HTML Bullets').item.json.html_bullets }}\n      </ul>\n\n      <!-- Related articles -->\n      <h3 style=\"font-size:18px; font-weight:700; color:#b10f2e; margin:30px 0 10px 0; padding:0;\">\n        Related articles\n      </h3>\n      <div style=\"margin:0; padding:0;\">\n        {{ $json.html_email }}\n      </div>\n\n      <!-- Footer -->\n      <hr style=\"margin:30px 0; border:0; border-top:1px solid #b10f2e;\">\n\n      <p style=\"margin:0 0 16px 0; padding:0;\">\n        You can find all of our Three Things articles\n        <a href=\"https://linarconsulting.com/resources/\" target=\"_blank\" style=\"color:#b10f2e; text-decoration:none;\">here</a>.\n        We also send out a weekly Three Things newsletter direct to your inbox, sign up\n        <a href=\"https://share-eu1.hsforms.com/1TvoeY-xqRLuJ-8TxHvsw_w2db85y\" target=\"_blank\" style=\"color:#b10f2e; text-decoration:none;\">here</a>.\n      </p>\n\n      <p style=\"margin:0; padding:0;\">Kind regards</p>\n      <p style=\"margin:6px 0 0 0; padding:0; font-weight:700;\">Tina</p>\n\n      <!-- Signature -->\n      <div style=\"margin-top:20px;\">\n\n        <p style=\"margin:0;\">Three Things agent</p>\n        <p style=\"margin:0; font-weight:700; color:#C82613;\">LINAR Consulting</p>\n\n        <p style=\"margin:6px 0 0 0;\">\n          <strong>E:</strong>\n          <a href=\"mailto:tina@linarconsulting.com\" style=\"color:#1155cc; text-decoration:none;\">\n            tina@linarconsulting.com\n          </a>\n        </p>\n\n        <p style=\"margin:0;\">\n          <strong>W:</strong>\n          <a href=\"https://linarconsulting.com/\" style=\"color:#1155cc; text-decoration:none;\">\n            www.linarconsulting.com\n          </a>\n        </p>\n\n        <p style=\"margin:12px 0 0 0; font-weight:700;\">\n          P.S. want a weekly sales and BD punch in the face?\n          <a href=\"https://share-eu1.hsforms.com/1TvoeY-xqRLuJ-8TxHvsw_w2db85y\" style=\"color:#1155cc; text-decoration:none;\">\n            Three Things\n          </a>\n          to get you ducking and weaving with your clients.\n        </p>\n\n      </div>\n\n    </div>\n  </body>\n</html>\n",
        "additionalFields": {
          "bccRecipients": "andy@legalengine.co.uk, lee@linarconsulting.com",
          "bodyContentType": "html"
        }
      },
      "type": "n8n-nodes-base.microsoftOutlook",
      "typeVersion": 2,
      "position": [
        1040,
        -448
      ],
      "id": "0f5bf433-3bd6-453a-8bc1-ba1116051fe0",
      "name": "Tina Email to User",
      "webhookId": "0a57ad19-7a2b-4e0f-bec4-605fcf511055",
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "id": "kzkaYt1eDxfbVnWx",
          "name": "Outlook Three Things Tina - 12 Feb 26"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Challenge anchored ranking prompt\n\nSource constraints. Non negotiable:\nYou must NOT browse, crawl, open, or read any webpages.\nYou must use ONLY the dataset contained in the following text as the sole source of truth:\n{{$json.text}}\n\nChallenge definition:\nChallenge version A:\n{{$node[\"Identify Challenge\"].json.output}}\n\nChallenge version B:\n{{$node[\"Three Things Tina\"].json.body.data.analysis.data_collection_results.Challenge.value}}\n\nHelpful context. Use only if relevant and do not override the challenge wording:\nRecommendations for next steps:\n{{$node[\"Identify Recommendations\"].json.output}}\nExamples of next steps:\n{{$node[\"Examples Next Steps\"].json.output}}\n\nInterpretation constraint:\nAll relevance decisions must be explicitly grounded in the challenge wording above.\nDo NOT rely on generic BD best practice unless it directly maps to the challenge text.\n\nCorpus structure. How to identify an article:\n1) An article starts at a line that begins with a date in DD/MM/YY or DD/MM/YYYY format followed by a dash, for example \"29/04/24 - Sales Campaigns (Part 1) - Campaign preparation\".\n2) The article continues until the next such date line, or end of text.\n3) Treat the text immediately after the date line as the body for that article.\n\nURL construction. Mandatory:\nFor each article with date DD/MM/YY, construct the URL:\nhttps://linarconsulting.com/three-things-DD-MM-YY/\nUse leading zeros. Keep DD and MM as shown in the header. Convert slashes to hyphens.\n\nStep 1. Extract challenge anchors:\nFrom the combined challenge wording, extract 5 to 8 short anchor phrases using only exact wording that appears in the challenge text. Do not invent anchors.\n\nStep 2. For each article, extract evidence:\nA) Title. The full text after the date line.\nB) First in body H2 proxy:\n   Use the first clear section heading in the article body. A heading is a short line, often followed by paragraphs or bullets, that is not a full sentence. If none exists, leave blank.\nC) Evidence snippets:\n   Extract 2 to 4 short snippets from the article body, each max 25 words, that best match the anchors. If none match, output empty.\n\nStep 3. Score each article:\nScore each dimension from 0 to 5 using only the article body and the anchors.\nA) Anchor coverage\nB) Anchor precision\nC) Under time pressure usefulness\nD) Conversation move quality\nE) Fast win applicability\nTotal score = A+B+C+D+E, max 25\n\nStep 4. Rank and anti duplication:\nReturn the top 8 articles by Total score.\nIf two rely on the same behavioural mechanism, keep the higher score and include the next best distinct lever.\n\nOutput rules. Strict and final. Parser critical:\nYou MUST output valid JSON only.\nYou MUST output exactly one JSON array of up to 8 objects.\nEach object must have exactly these keys, in this order:\ndate, title, url, h2, scores, total, anchors_matched, evidence\n\nField rules:\ndate. \"DD/MM/YY\"\ntitle. Title text only, without date, capitalised as required\nurl. Constructed URL\nh2. First in body H2 proxy or empty\nscores. An object with keys A,B,C,D,E as integers 0 to 5\ntotal. Integer 0 to 25\nanchors_matched. Array of anchor phrases used, exact text from challenge\nevidence. Array of 0 to 4 strings, each a snippet max 25 words\n\nDo not output any other text outside the JSON.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -144,
        592
      ],
      "id": "6e591b20-99fd-4b35-af38-9ec1beb97663",
      "name": "Identify 3 Relevant Three Things Artciles1",
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Structured output generator. Top 3 only\n\nSource constraints. Non negotiable:\nYou must NOT browse, crawl, open, or read any webpages.\nYou must use ONLY the ranked dataset provided below as the sole source of truth:\n{{ $json.output }}\n\nChallenge definition:\n{{$node[\"Identify Challenge\"].json.output}}\n\nRules:\n1) Select exactly THREE items from the ranked dataset.\n2) Prefer higher total score. Apply tie breaks in this order:\n   a) Higher Anchor precision. Use score B\n   b) Higher Anchor coverage. Use score A\n   c) Stronger evidence specificity. More concrete snippets that clearly map to challenge wording\n3) Anti duplication check:\n   If two of your chosen three rely on the same behavioural mechanism, keep the higher total and replace the other with the next best that introduces a distinct lever. Anchor precision outweighs variety.\n\nField construction rules:\nEach output item must be a SINGLE LINE with this exact structure:\nTitle | First in-body H2 | Challenge action | Verbose relevance explainer | <a href=\"URL\">Read article</a>\n\nHow to fill each field:\nTitle. Use the object title\nFirst in-body H2. Use the object h2, or empty if missing\nChallenge action. Write one short imperative action that a reader should do, grounded in both the challenge text and the article evidence. Keep it practical.\nVerbose relevance explainer. 2 to 4 sentences. Must explicitly reference at least two anchor phrases from the challenge and connect them to the evidence snippets. No generic advice.\nURL. Use the object url and wrap as <a href=\"URL\">Read article</a>\n\nOutput rules. Strict and final. Parser critical:\nYou MUST output exactly THREE items.\nEach item must be a SINGLE LINE.\nBetween item 1 and item 2 output exactly:\n/n\nBetween item 2 and item 3 output exactly:\n/n\nDo NOT output anything before the first item.\nDo NOT output anything after the third item.\nDo NOT output JSON.\nDo NOT add bullets, numbering, headings, or extra lines.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        224,
        592
      ],
      "id": "31991e99-92be-4ac8-b438-2b61d8a72002",
      "name": "Format selected Articles1",
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "// n8n Code node (JavaScript)\n// Input: tries multiple common fields for LLM output.\n// Output: cleaned_text, articles[], html_email, debug\n\nconst input = items[0].json || {};\n\n// ---------- Helpers ----------\nconst esc = (s) =>\n  String(s === undefined || s === null ? \"\" : s)\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&#39;\");\n\nconst extractHref = (s) => {\n  const m = String(s === undefined || s === null ? \"\" : s).match(/href=\"([^\"]+)\"/i);\n  return m ? m[1].trim() : \"\";\n};\n\nconst splitPipes = (line) =>\n  String(line === undefined || line === null ? \"\" : line)\n    .split(/\\s*\\|\\s*/g)\n    .map((p) => p.trim());\n\n// Grab first non-empty string from a list of candidate fields\nconst pickFirstString = (obj, keys) => {\n  for (const k of keys) {\n    const v = obj[k];\n    if (typeof v === \"string\" && v.trim()) return v.trim();\n  }\n  return \"\";\n};\n\n// Fallback: find any string field that looks like the agent output (contains pipes)\nconst findLikelyOutputString = (obj) => {\n  for (const [k, v] of Object.entries(obj)) {\n    if (typeof v === \"string\") {\n      const s = v.trim();\n      if (!s) continue;\n      // Heuristic: at least 4 pipes suggests our structured lines exist\n      const pipeCount = (s.match(/\\|/g) || []).length;\n      if (pipeCount >= 4) return s;\n    }\n  }\n  return \"\";\n};\n\n// ---------- 0) Choose raw input ----------\nlet raw = pickFirstString(input, [\n  \"output\",\n  \"message\",\n  \"text\",\n  \"content\",\n  \"result\",\n  \"response\",\n  \"cleaned_text\",\n]);\n\nif (!raw) raw = findLikelyOutputString(input);\n\n// ---------- 1) Normalise separators ----------\nconst normalisedRaw = String(raw || \"\")\n  .replace(/\\/n\\s*/g, \"\\n\") // literal /n to newline\n  .replace(/\\r\\n/g, \"\\n\")\n  .replace(/\\r/g, \"\\n\")\n  .trim();\n\n// ---------- 2) Split into lines ----------\nlet lines = normalisedRaw\n  .split(\"\\n\")\n  .map((l) => l.trim())\n  .filter(Boolean);\n\n// Defensive: split any remaining /n tokens\nlines = lines.flatMap((l) => l.split(/\\/n/).map((x) => x.trim()).filter(Boolean));\n\n// If the model returned everything on one line separated by \"/n\" with no newlines\nif (lines.length <= 1 && normalisedRaw.includes(\"/n\")) {\n  lines = normalisedRaw\n    .split(\"/n\")\n    .map((x) => x.trim())\n    .filter(Boolean);\n}\n\n// Keep only first 3 entries (defensive)\nlines = lines.slice(0, 3);\n\n// ---------- 3) Parse lines into articles ----------\nconst articles = [];\n\nfor (const line of lines) {\n  const parts = splitPipes(line);\n\n  // Need at least 5 parts. If not, store what we can.\n  if (parts.length < 5) {\n    articles.push({ title: parts[0] || \"\", h2: parts[1] || \"\", action: \"\", explainer: \"\", url: \"\" });\n    continue;\n  }\n\n  // Title, H2, Action are stable\n  const title = parts[0] || \"\";\n  const h2 = parts[1] || \"\";\n  const a\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        544,
        160
      ],
      "id": "9f01529a-b0e3-4909-bd49-a59f17acb887",
      "name": "Create Examples HTML List2",
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Challenge anchored ranking prompt\n\nSource constraints. Non negotiable:\nYou must NOT browse, crawl, open, or read any webpages.\nYou must use ONLY the dataset contained in the following text as the sole source of truth:\n{{$json.text}}\n\nChallenge definition:\nChallenge version A:\n{{$node[\"Identify Challenge\"].json.output}}\n\nChallenge version B:\n{{$node[\"Three Things Tina\"].json.body.data.analysis.data_collection_results.Challenge.value}}\n\nHelpful context. Use only if relevant and do not override the challenge wording:\nRecommendations for next steps:\n{{$node[\"Identify Recommendations\"].json.output}}\nExamples of next steps:\n{{$node[\"Examples Next Steps\"].json.output}}\n\nInterpretation constraint:\nAll relevance decisions must be explicitly grounded in the challenge wording above.\nDo NOT rely on generic BD best practice unless it directly maps to the challenge text.\n\nCorpus structure. How to identify an article:\n1) An article starts at a line that begins with a date in DD/MM/YY or DD/MM/YYYY format followed by a dash, for example \"29/04/24 - Sales Campaigns (Part 1) - Campaign preparation\".\n2) The article continues until the next such date line, or end of text.\n3) Treat the text immediately after the date line as the body for that article.\n\nURL construction. Mandatory:\nFor each article with date DD/MM/YY, construct the URL:\nhttps://linarconsulting.com/three-things-DD-MM-YY/\nUse leading zeros. Keep DD and MM as shown in the header. Convert slashes to hyphens.\n\nStep 1. Extract challenge anchors:\nFrom the combined challenge wording, extract 5 to 8 short anchor phrases using only exact wording that appears in the challenge text. Do not invent anchors.\n\nStep 2. For each article, extract evidence:\nA) Title. The full text after the date line.\nB) First in body H2 proxy:\n   Use the first clear section heading in the article body. A heading is a short line, often followed by paragraphs or bullets, that is not a full sentence. If none exists, leave blank.\nC) Evidence snippets:\n   Extract 2 to 4 short snippets from the article body, each max 25 words, that best match the anchors. If none match, output empty.\n\nStep 3. Score each article:\nScore each dimension from 0 to 5 using only the article body and the anchors.\nA) Anchor coverage\nB) Anchor precision\nC) Under time pressure usefulness\nD) Conversation move quality\nE) Fast win applicability\nTotal score = A+B+C+D+E, max 25\n\nStep 4. Rank and anti duplication:\nReturn the top 8 articles by Total score.\nIf two rely on the same behavioural mechanism, keep the higher score and include the next best distinct lever.\n\nOutput rules. Strict and final. Parser critical:\nYou MUST output valid JSON only.\nYou MUST output exactly one JSON array of up to 8 objects.\nEach object must have exactly these keys, in this order:\ndate, title, url, h2, scores, total, anchors_matched, evidence\n\nField rules:\ndate. \"DD/MM/YY\"\ntitle. Title text only, without date\nurl. Constructed URL\nh2. First in body H2 proxy or empty\nscores. An object with keys A,B,C,D,E as integers 0 to 5\ntotal. Integer 0 to 25\nanchors_matched. Array of anchor phrases used, exact text from challenge\nevidence. Array of 0 to 4 strings, each a snippet max 25 words\n\nDo not output any other text outside the JSON.\n\nDo not use em dashes or en dashes. Replace them with full stops or commas.\n\nCapitalise headers and titles and h2 to improve formatting \n\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -208,
        160
      ],
      "id": "6afa455f-b7d7-4666-a146-25dc57cd1892",
      "name": "Identify 3 Relevant Three Things Artciles2",
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Structured output generator. Top 3 only\n\nSource constraints. Non negotiable:\nYou must NOT browse, crawl, open, or read any webpages.\nYou must use ONLY the ranked dataset provided below as the sole source of truth:\n{{ $json.output }}\n\nChallenge definition:\n{{$node[\"Identify Challenge\"].json.output}}\n\nRules:\n1) Select exactly THREE items from the ranked dataset.\n2) Prefer higher total score. Apply tie breaks in this order:\n   a) Higher Anchor precision. Use score B\n   b) Higher Anchor coverage. Use score A\n   c) Stronger evidence specificity. More concrete snippets that clearly map to challenge wording\n3) Anti duplication check:\n   If two of your chosen three rely on the same behavioural mechanism, keep the higher total and replace the other with the next best that introduces a distinct lever. Anchor precision outweighs variety.\n\nField construction rules:\nEach output item must be a SINGLE LINE with this exact structure:\nTitle (DD/MM/YY) | First in-body H2 | Challenge action | Verbose relevance explainer | <a href=\"URL\">Read article</a>\n\nHow to fill each field:\nTitle (DD/MM/YY).\n- Use the object title, then append a space, then the date in parentheses, exactly like: Title (DD/MM/YY)\n- The date must come from the object date field.\n- Do not alter the title text other than appending the date.\n\nFirst in-body H2. Use the object h2, or empty if missing\nChallenge action. Write one short imperative action that a reader should do, grounded in both the challenge text and the article evidence. Keep it practical.\nVerbose relevance explainer. 2 to 4 sentences. Must explicitly reference at least two anchor phrases from the challenge and connect them to the evidence snippets. No generic advice.\nURL. Use the object url and wrap as <a href=\"URL\">Read article</a>\n\nOutput rules. Strict and final. Parser critical:\nYou MUST output exactly THREE items.\nEach item must be a SINGLE LINE.\nBetween item 1 and item 2 output exactly:\n/n\nBetween item 2 and item 3 output exactly:\n/n\nDo NOT output anything before the first item.\nDo NOT output anything after the third item.\nDo NOT output JSON.\nDo NOT add explanations, summaries, numbering, bullets, headings, or extra lines.\n\nDo not use em dashes or en dashes. Replace them with full stops or commas.\n\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        160,
        160
      ],
      "id": "4661fd28-bdc0-4149-ad50-2a5081ae5211",
      "name": "Format selected Articles2",
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Code / Function node\n * Input: $json.output (single string)\n * Output: html_bullets (<li> items for insertion into an email <ul>)\n * Bullet colour: #b10f2e\n */\n\nconst raw = ($json.output || '').toString().trim();\n\n// HTML escape to avoid broken markup\nconst escapeHtml = (s) =>\n  s\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#39;');\n\n// Normalise quotes and spacing\nconst normalised = raw\n  .replace(/[“”]/g, '\"')\n  .replace(/[’]/g, \"'\")\n  .replace(/\\s+/g, ' ')\n  .trim();\n\n// Split into bullet-sized sentences\nconst points = normalised\n  .split(/(?<=[.!?])\\s+(?=[A-Z0-9])/g)\n  .map(p => p.trim())\n  .filter(Boolean);\n\n// Build email-safe <li> items (NO <ul> here)\nconst htmlBullets = points\n  .map(\n    (p) =>\n      `<li style=\"margin:0 0 8px 0;padding:0;\">` +\n        `<span style=\"color:#b10f2e;font-weight:700;\">•</span> ` +\n        `<span style=\"color:#000000;\">${escapeHtml(p)}</span>` +\n      `</li>`\n  )\n  .join('');\n\nreturn [\n  {\n    json: {\n      html_bullets: htmlBullets,\n    },\n  },\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1712,
        432
      ],
      "id": "b5236b3c-6985-490a-86e9-7ada407c6fc6",
      "name": "Recco HTML Bullets1",
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Code / Function node\n * Input: $json.output (single string)\n * Output:\n *  - intro_text (first line only, escaped)\n *  - html_bullets (<li> items for insertion into an email <ul>)\n * Bullet colour: #b10f2e\n */\n\nconst raw = ($json.output || '').toString().trim();\n\n// HTML escape to avoid broken markup\nconst escapeHtml = (s) =>\n  String(s ?? '')\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#39;');\n\n// Normalise line endings and the literal delimiter /n\nconst normalised = raw\n  .replace(/\\/n\\s*/g, '\\n')   // handle literal /n from the model\n  .replace(/\\r\\n/g, '\\n')\n  .replace(/\\r/g, '\\n')\n  .trim();\n\n// Split into lines\nconst lines = normalised\n  .split('\\n')\n  .map(l => l.trim())\n  .filter(Boolean);\n\n// First line stays as intro text\nconst introText = lines.shift() || '';\n\n// Remaining lines become bullets, replicating your exact formatting\nconst htmlBullets = lines\n  .map(\n    (p) =>\n      `<li style=\"margin:0 0 8px 0;padding:0;\">` +\n        `<span style=\"color:#b10f2e;font-weight:700;\">•</span> ` +\n        `<span style=\"color:#000000;\">${escapeHtml(p)}</span>` +\n      `</li>`\n  )\n  .join('');\n\nreturn [\n  {\n    json: {\n      intro_text: escapeHtml(introText),\n      html_bullets: htmlBullets,\n    },\n  },\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1152,
        432
      ],
      "id": "b02c1a8a-9f70-440b-a88f-34672107f679",
      "name": "Next Steps HTML Bullets2",
      "disabled": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 3
          },
          "conditions": [
            {
              "id": "91a460e5-bf8b-4569-87e6-9c362466d4c2",
              "leftValue": "={{ $('Three Things Tina').item.json.body.data.analysis.data_collection_results['Email address'].value }}",
              "rightValue": "null",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -2960,
        160
      ],
      "id": "81b07732-ae99-41da-b0cc-ad3faeb06a0a",
      "name": "If email is null",
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "334dfb6d-3446-4b9f-b268-6afafe83165e",
              "name": "body.data.analysis.data_collection_results['Email address'].value",
              "value": "={{ $('Three Things Tina').item.json.body.data.analysis.data_collection_results['Email address'].value }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2752,
        128
      ],
      "id": "2641fd81-92a2-4101-bbbd-8f8fa9dfe057",
      "name": "Edit Fields",
      "disabled": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "186a0490-b611-47ec-99b2-695fa6c0ef0b",
              "leftValue": "={{ $('Three Things Tina').item.json.body.data.analysis.data_collection_results[\"Email address\"].value }}",
              "rightValue": "failure",
              "operator": {
                "type": "string",
                "operation": "notExists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -2624,
        -480
      ],
      "id": "1c0eeffb-d187-41b6-927a-2213199b0f21",
      "name": "If email is NOT captured"
    },
    {
      "parameters": {
        "content": "## With email validation\n",
        "height": 960,
        "width": 4544
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3120,
        -976
      ],
      "typeVersion": 1,
      "id": "81b2d05b-bf9d-4368-8f1e-eaca655d0fbd",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "84f296ec-21cf-476e-8781-1e600dcd7699",
              "leftValue": "={{ $('Three Things Tina').item.json.body.data.conversation_initiation_client_data.dynamic_variables.system__call_duration_secs }}",
              "rightValue": 60,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -2384,
        -880
      ],
      "id": "66064dce-7fc0-4468-a5fd-f08248d8cc18",
      "name": "If2"
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": "01RDSCPONO2CZT22PORNC3PJQ4CAPNY3TD"
      },
      "type": "n8n-nodes-base.microsoftOneDrive",
      "typeVersion": 1,
      "position": [
        -496,
        -880
      ],
      "id": "c3d24826-fe6f-45ae-b0f3-6d1f5cc2a0a7",
      "name": "Download a file2",
      "credentials": {
        "microsoftOneDriveOAuth2Api": {
          "id": "O6kcuY0URca0xV5I",
          "name": "Lee LINAR - Microsoft Drive account"
        }
      }
    },
    {
      "parameters": {
        "operation": "pdf",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1.1,
      "position": [
        -208,
        -880
      ],
      "id": "18de7f04-3f04-4af0-93fa-c30c448fd412",
      "name": "Extract from File2"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.2",
          "mode": "list",
          "cachedResultName": "gpt-5.2"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        80,
        -672
      ],
      "id": "2462d7be-a387-4006-a038-b7f39257261d",
      "name": "OpenAI Chat Model6",
      "credentials": {
        "openAiApi": {
          "id": "A6TzpvpaIyqf4IKq",
          "name": "Lee C chat GPT account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are Tina an AI assistant working for LINAR Consulting Ltd (https://linarconsulting.com). You are a business development and sales coach with knowledge of the complete catalogue of weekly Three Things newsletters that are developed and curated by the LINAR team (https://linarconsulting.com/resources/).\n\nYour task is to provide a summary of the **challenge** the user is facing. \n\nThis summary should be maximum 75 words in length.\n\nThe summary output should begin by acknowledging that the challenge as defined is based on the conversation with the user, and speaking in the second person (i.e. you), and then state the challenge identified.\n\nReturn just the plain-English context — no headings, no extra explanation.\n\nKeep it professional and clear.\n\nPlease make sure that all outputs are in *UK English* not American English, including all spelling and date formats.\n\n\nHere is the full transcript:\n{{ $json.markdown }}\n\nDo not use em dashes or en dashes. Replace them with full stops or commas.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -2160,
        -880
      ],
      "id": "1eb6d81a-31a1-4378-a7cc-6dc6804b46c3",
      "name": "Identify Challenge1"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are Tina an AI assistant working for LINAR Consulting Ltd (https://linarconsulting.com). You are a business development and sales coach with knowledge of the complete catalogue of weekly Three Things newsletters that are developed and curated by the LINAR team (https://linarconsulting.com/resources/).\n\nYour task is to provide a succinct **recommendation** on how to address the challenge. \n\nThis recommendation should be maximum 100 words in length. \n\nThe tone and format of the recommendation should be a short paragraph which provides potential solutions to the challenge. \n\nBe explicit and make it clear that the proposed solutions are based on what the team at LINAR have seen work well for other people.\n\nUse phrases like \"you might want to consider\", \"have you tried\", \"have you thought about\" etc to generate a real sense of collaboration between Tina and the user. \n\nReturn just the plain-English context — no headings, no extra explanation.\n\nKeep it professional and clear.\n\nPlease make sure that all outputs are in *UK English* not American English, including all spelling and date formats.\n\nHere is the challenge:\n{{ $json.output }}\n\nDo not use em dashes or en dashes. Replace them with full stops or commas.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -1808,
        -880
      ],
      "id": "175cc083-03cd-44c2-827f-1243a7a5aae7",
      "name": "Identify Recommendations1"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are Tina an AI assistant working for LINAR Consulting Ltd (https://linarconsulting.com). You are a business development and sales coach with knowledge of the complete catalogue of weekly Three Things newsletters that are developed and curated by the LINAR team (https://linarconsulting.com/resources/).\n\nYour task is to provide a list of exactly three **examples** the user could try to remedy their challenge. \n\nEach examples hould be displayed on a separate line. \n\nPlease provide exactly three examples for the user to consider. No more, no less.\n\nExamples should be practical and contain specific actions the user can execute immediately after reading the example.\n\nReturn just the plain-English context — no headings, no extra explanation.\n\nKeep it professional and clear.\n\nPlease make sure that all outputs are in *UK English* not American English, including all spelling and date formats.\n\n\nHere is a version of the challenge:\n{{ $('Identify Challenge1').item.json.output }}\n\nAnd here is a different version of the challenge:\n{{ $('Three Things Tina').item.json.body.data.analysis.data_collection_results.Challenge.value }}\n\nDo not use em dashes or en dashes. Replace them with full stops or commas.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -1248,
        -880
      ],
      "id": "fe81f510-d65b-4166-976e-7307956c5f5f",
      "name": "Examples Next Steps1"
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Code / Function node\n * Input: $json.output (single string)\n * Output: html_bullets (<li> items for insertion into an email <ul>)\n * Bullet colour: #b10f2e\n *\n * Outlook desktop fix:\n * - Prevent the native <li> marker from rendering (double bullets) by setting list-style-type:none.\n * - Neutralise Outlook/Word list indentation with mso and margin/padding resets.\n * - Keep your custom red bullet character for consistent cross-client rendering.\n */\n\nvar raw = ($json.output || \"\").toString().trim();\n\n// HTML escape to avoid broken markup\nfunction escapeHtml(s) {\n  return String(s === undefined || s === null ? \"\" : s)\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&#39;\");\n}\n\n// Normalise quotes and spacing\nvar normalised = raw\n  .replace(/[“”]/g, '\"')\n  .replace(/[’]/g, \"'\")\n  .replace(/\\s+/g, \" \")\n  .trim();\n\n// Split into bullet-sized sentences\n// Note: lookbehind can fail in some n8n runtimes. Avoid it for compatibility.\nvar points = [];\nif (normalised) {\n  // Split on sentence end punctuation followed by whitespace and then A-Z or 0-9\n  var parts = normalised.split(/[.!?]\\s+(?=[A-Z0-9])/g);\n\n  // Re-add punctuation to all but last segment where possible by extracting from original.\n  // Simpler: keep segments as-is. Email bullets read fine without the punctuation at the split point.\n  for (var i = 0; i < parts.length; i++) {\n    var p = String(parts[i]).trim();\n    if (p) points.push(p);\n  }\n}\n\n// Build email-safe <li> items (NO <ul> here)\n// Outlook desktop: remove native list marker and indentation, keep custom bullet.\nvar htmlBullets = points\n  .map(function (p) {\n    return (\n      '<li style=\"' +\n        'margin:0 0 8px 0;' +\n        'padding:0;' +\n        'list-style-type:none;' +\n        'mso-special-format:bullet;' +\n        'mso-list:l0 level1 lfo1;' +\n      '\">' +\n        '<span style=\"color:#b10f2e;font-weight:700;\">&#8226;</span> ' +\n        '<span style=\"color:#000000;\">' + escapeHtml(p) + \"</span>\" +\n      \"</li>\"\n    );\n  })\n  .join(\"\");\n\nreturn [\n  {\n    json: {\n      html_bullets: htmlBullets\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1456,
        -880
      ],
      "id": "71fbcfc3-35d7-478f-bceb-518e6db2f1bf",
      "name": "Recco HTML Bullets2"
    },
    {
      "parameters": {
        "jsCode": "/**\n * n8n Code / Function node\n * Input: $json.output (single string)\n * Output:\n *  - intro_text (first line only, escaped)\n *  - html_bullets (<li> items for insertion into an email <ul>)\n * Bullet colour: #b10f2e\n *\n * Outlook desktop fixes:\n * - Remove native <li> marker (prevents double bullets)\n * - Reset Word-engine list indentation\n * - Keep custom bullet for consistent cross-client rendering\n */\n\nvar raw = ($json.output || \"\").toString().trim();\n\n// HTML escape to avoid broken markup\nfunction escapeHtml(s) {\n  return String(s === undefined || s === null ? \"\" : s)\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&#39;\");\n}\n\n// Normalise line endings and literal delimiter /n\nvar normalised = raw\n  .replace(/\\/n\\s*/g, \"\\n\")\n  .replace(/\\r\\n/g, \"\\n\")\n  .replace(/\\r/g, \"\\n\")\n  .trim();\n\n// Split into lines\nvar lines = normalised\n  .split(\"\\n\")\n  .map(function (l) { return l.trim(); })\n  .filter(function (l) { return l.length > 0; });\n\n\n// Remaining lines become bullets\nvar htmlBullets = lines\n  .map(function (p) {\n    return (\n      '<li >' +\n         escapeHtml(p) + \n      \"</li>\"\n    );\n  })\n  .join(\"\");\n\nreturn [\n  {\n    json: {\n      \n      html_bullets: htmlBullets\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -880,
        -880
      ],
      "id": "46ccd5d7-1c61-47ad-837e-ab719de536d3",
      "name": "Next Steps HTML Bullets3"
    },
    {
      "parameters": {
        "jsCode": "// n8n Code node (JavaScript) ES5 safe\n// Input: Agent 2 output string with 3 items separated by literal /n\n// Output: cleaned_text, articles[], html_email, debug\n\nvar input = (items && items[0] && items[0].json) ? items[0].json : {};\n\n// ---------- Helpers ----------\nfunction esc(s) {\n  return String(s === undefined || s === null ? \"\" : s)\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&#39;\");\n}\n\nfunction extractHref(s) {\n  var m = String(s === undefined || s === null ? \"\" : s).match(/href=\"([^\"]+)\"/i);\n  return m ? m[1].trim() : \"\";\n}\n\nfunction splitPipes(line) {\n  return String(line === undefined || line === null ? \"\" : line)\n    .split(/\\s*\\|\\s*/g)\n    .map(function (p) { return p.trim(); });\n}\n\nfunction pickFirstString(obj, keys) {\n  for (var i = 0; i < keys.length; i++) {\n    var k = keys[i];\n    var v = obj[k];\n    if (typeof v === \"string\" && v.trim()) return v.trim();\n  }\n  return \"\";\n}\n\nfunction findLikelyOutputString(obj) {\n  for (var k in obj) {\n    if (!Object.prototype.hasOwnProperty.call(obj, k)) continue;\n    var v = obj[k];\n    if (typeof v !== \"string\") continue;\n    var s = v.trim();\n    if (!s) continue;\n\n    var pipes = s.match(/\\|/g);\n    var pipeCount = pipes ? pipes.length : 0;\n    if (pipeCount >= 4) return s;\n  }\n  return \"\";\n}\n\nfunction collapseWhitespace(s) {\n  return String(s === undefined || s === null ? \"\" : s)\n    .replace(/\\r\\n/g, \"\\n\")\n    .replace(/\\r/g, \"\\n\")\n    .replace(/\\s*\\n\\s*/g, \" \")\n    .replace(/\\s+/g, \" \")\n    .trim();\n}\n\nfunction parseTitleAndDate(titleWithDate) {\n  var s = String(titleWithDate === undefined || titleWithDate === null ? \"\" : titleWithDate).trim();\n  var out = { title: s, date: \"\" };\n  var m = s.match(/^(.*)\\((\\d{2}\\/\\d{2}\\/\\d{2})\\)\\s*$/);\n  if (m) {\n    out.title = (m[1] || \"\").trim();\n    out.date = (m[2] || \"\").trim();\n  }\n  return out;\n}\n\n// ---------- 0) Choose raw input ----------\nvar raw = pickFirstString(input, [\"output\", \"message\", \"text\", \"content\", \"result\", \"response\"]);\nif (!raw) raw = findLikelyOutputString(input);\nif (!raw) raw = \"\";\n\n// ---------- 1) Split into items by literal /n (DO NOT replace /n) ----------\nvar parts = raw.split(\"/n\");\nvar entries = [];\nfor (var i = 0; i < parts.length; i++) {\n  var t = String(parts[i] === undefined || parts[i] === null ? \"\" : parts[i]).trim();\n  if (t) entries.push(t);\n}\nif (entries.length > 3) entries = entries.slice(0, 3);\n\n// Collapse internal newlines and excess spaces per entry\nfor (var e = 0; e < entries.length; e++) {\n  entries[e] = collapseWhitespace(entries[e]);\n}\n\n// ---------- 2) Parse entries ----------\nvar articles = [];\n\nfor (var ei = 0; ei < entries.length; ei++) {\n  var entry = entries[ei];\n  var fields = splitPipes(entry);\n\n  if (fields.length < 5) {\n    var td0 = parseTitleAndDate(fields[0] || \"\");\n    articles.push({ title: td0.title, date: td0.date, h2: fields[1] || \"\", action: \"\", explainer: \"\", url: \"\" });\n    continue;\n  }\n\n  var td = parseTitleAndDate(fields[0] || \"\");\n  var h2 = fields[1] || \"\";\n  var action = fields[2] || \"\";\n\n  // find link field from end\n  var linkIndex = -1;\n  for (var j = fields.length - 1; j >= 0; j--) {\n    if (/href\\s*=/.test(fields[j]) || /^https?:\\/\\//i.test(fields[j])) {\n      linkIndex = j;\n      break;\n    }\n  }\n  if (linkIndex === -1) linkIndex = fields.length - 1;\n\n  var linkPart = fields.slice(linkIndex).join(\" | \");\n  var explainer = fields.slice(3, linkIndex).join(\" | \").trim();\n\n  var url = extractHref(linkPart);\n  if (!url) url = extractHref(entry);\n  if (!url && /^https?:\\/\\//i.test(linkPart)) url = linkPart.trim();\n\n  articles.push({ title: td.title, date: td.date, h2: h2, action: action, explainer: explainer, url: url });\n}\n\n// pad to 3\nwhile (articles.length < 3) {\n  articles.push({ title: \"\", date: \"\", h2: \"\", action: \"\", explainer: \"\", url: \"\" });\n}\narticles.length = 3;\n\n// ---------- 3) cleaned_text ----------\nvar cleaned_text = articles\n  .map(function (a) {\n    var titleWithDate = a.date ? (a.title + \" (\" + a.date + \")\") : a.title;\n    var link = a.url ? '<a href=\"' + a.url + '\">Read article</a>' : \"\";\n    return titleWithDate + \" | \" + a.h2 + \" | \" + a.action + \" | \" + a.explainer + \" | \" + link;\n  })\n  .join(\"\\n\");\n\n// ---------- 4) html_email ----------\nvar cards = articles\n  .map(function (a) {\n    var titleWithDate = a.date ? (a.title + \" (\" + a.date + \")\") : a.title;\n\n    var titleEsc = esc(titleWithDate);\n    var h2Esc = esc(a.h2);\n    var actionEsc = esc(a.action);\n    var explainerEsc = esc(a.explainer);\n    var urlEsc = esc(a.url);\n\n    var linkHtml = a.url\n      ? '<div style=\"margin:0; font-size:14px; line-height:20px;\">' +\n          '<a href=\"' + urlEsc + '\" style=\"color:#1155cc; text-decoration:underline;\">Read article</a>' +\n        \"</div>\"\n      : \"\";\n\n    return (\n      '<div style=\"margin:0 0 14px 0; padding:14px; border:1px solid #e6e6e6; border-radius:10px;\">' +\n        '<div style=\"margin:0 0 6px 0; font-size:14px; line-height:20px; color:#111; font-weight:700;\">' +\n          titleEsc +\n        \"</div>\" +\n        '<div style=\"margin:0 0 8px 0; font-size:14px; line-height:20px; color:#333; font-weight:600;\">' +\n          h2Esc +\n        \"</div>\" +\n        '<div style=\"margin:0 0 10px 0; font-size:14px; line-height:20px; color:#444;\">' +\n          actionEsc +\n        \"</div>\" +\n        '<div style=\"margin:0 0 10px 0; font-size:14px; line-height:20px; color:#444;\">' +\n          explainerEsc +\n        \"</div>\" +\n        linkHtml +\n      \"</div>\"\n    );\n  })\n  .join(\"\\n\");\n\nvar html_email =\n  '<div style=\"font-family: Arial, Helvetica, sans-serif; color:#111; font-size:14px; line-height:20px;\">' +\n    '<p style=\"margin:0 0 12px 0;\">Here are three recommended reads tailored to the challenge.</p>' +\n    cards +\n  \"</div>\";\n\n// ---------- Debug ----------\nvar debug = {\n  raw_preview: String(raw).slice(0, 300),\n  entry_count: entries.length,\n  entries_preview: entries\n};\n\nreturn [{ json: { cleaned_text: cleaned_text, articles: articles, html_email: html_email, debug: debug } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        832,
        -880
      ],
      "id": "98ab045a-509e-4e49-970d-b58b62fc2ec5",
      "name": "Create Examples HTML List3"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Challenge anchored ranking prompt\n\nSource constraints. Non negotiable:\nYou must NOT browse, crawl, open, or read any webpages.\nYou must use ONLY the dataset contained in the following text as the sole source of truth:\n{{$json.text}}\n\nChallenge definition:\nChallenge version A:\n{{$node[\"Identify Challenge1\"].json.output}}\n\nChallenge version B:\n{{$node[\"Three Things Tina\"].json.body.data.analysis.data_collection_results.Challenge.value}}\n\nHelpful context. Use only if relevant and do not override the challenge wording:\nRecommendations for next steps:\n{{$node[\"Identify Recommendations1\"].json.output}}\nExamples of next steps:\n{{$node[\"Examples Next Steps1\"].json.output}}\n\nInterpretation constraint:\nAll relevance decisions must be explicitly grounded in the challenge wording above.\nDo NOT rely on generic BD best practice unless it directly maps to the challenge text.\n\nCorpus structure. How to identify an article:\n1) An article starts at a line that begins with a date in DD/MM/YY or DD/MM/YYYY format followed by a dash, for example \"29/04/24 - Sales Campaigns (Part 1) - Campaign preparation\".\n2) The article continues until the next such date line, or end of text.\n3) Treat the text immediately after the date line as the body for that article.\n\nURL construction. Mandatory:\nFor each article with date DD/MM/YY, construct the URL:\nhttps://linarconsulting.com/three-things-DD-MM-YY/\nUse leading zeros. Keep DD and MM as shown in the header. Convert slashes to hyphens.\n\nStep 1. Extract challenge anchors:\nFrom the combined challenge wording, extract 5 to 8 short anchor phrases using only exact wording that appears in the challenge text. Do not invent anchors.\n\nStep 2. For each article, extract evidence:\nA) Title. The full text after the date line.\nB) First in body H2 proxy:\n   Use the first clear section heading in the article body. A heading is a short line, often followed by paragraphs or bullets, that is not a full sentence. If none exists, leave blank.\nC) Evidence snippets:\n   Extract 2 to 4 short snippets from the article body, each max 25 words, that best match the anchors. If none match, output empty.\n\nStep 3. Score each article:\nScore each dimension from 0 to 5 using only the article body and the anchors.\nA) Anchor coverage\nB) Anchor precision\nC) Under time pressure usefulness\nD) Conversation move quality\nE) Fast win applicability\nTotal score = A+B+C+D+E, max 25\n\nStep 4. Rank and anti duplication:\nReturn the top 8 articles by Total score.\nIf two rely on the same behavioural mechanism, keep the higher score and include the next best distinct lever.\n\nFormatting constraints:\nDo not use em dashes or en dashes. Replace them with full stops or commas.\nCapitalise Titles and H2 lines to improve formatting.\n\nOutput rules. Strict and final. Parser critical:\nYou MUST output valid JSON only.\nYou MUST output exactly one JSON array of up to 8 objects.\nEach object must have exactly these keys, in this order:\ndate, title, url, h2, scores, total, anchors_matched, evidence\n\nField rules:\ndate. \"DD/MM/YY\"\ntitle. Title text only with leading letter capitalisation, without date,\nurl. Constructed URL\nh2. First in body H2 proxy or empty\nscores. An object with keys A,B,C,D,E as integers 0 to 5\ntotal. Integer 0 to 25\nanchors_matched. Array of anchor phrases used, exact text from challenge\nevidence. Array of 0 to 4 strings, each a snippet max 25 words\n\nDo not output any other text outside the JSON.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        80,
        -880
      ],
      "id": "1ce832ee-a527-44fc-ad28-c5fe1fd615ba",
      "name": "Identify 3 Relevant Three Things Artciles3"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.2",
          "mode": "list",
          "cachedResultName": "gpt-5.2"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        448,
        -672
      ],
      "id": "e3b49d0a-12e6-4276-a626-cf0f54172513",
      "name": "OpenAI Chat Model7",
      "credentials": {
        "openAiApi": {
          "id": "A6TzpvpaIyqf4IKq",
          "name": "Lee C chat GPT account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Structured output generator. Top 3 only\n\nSource constraints. Non negotiable:\nYou must NOT browse, crawl, open, or read any webpages.\nYou must use ONLY the ranked dataset provided below as the sole source of truth:\n{{ $json.output }}\n\nChallenge definition:\n{{$node[\"Identify Challenge1\"].json.output}}\n\nSelection rules:\n1) Select exactly THREE items from the ranked dataset.\n2) Prefer higher total score.\n3) Apply tie breaks strictly in this order:\n   a) Higher Anchor precision (score B)\n   b) Higher Anchor coverage (score A)\n   c) More concrete evidence snippets that clearly map to the challenge wording\n4) Anti duplication check:\n   If two candidates rely on the same behavioural mechanism, keep the higher scoring one and replace the other with the next best that introduces a distinct lever.\n   Anchor precision always outweighs variety.\n\nOutput structure. Mandatory:\nEach item must follow this exact field order, separated by pipe characters:\nTitle (DD/MM/YY) | First in-body H2 | Challenge action | Verbose relevance explainer | <a href=\"URL\">Read article</a>\n\nField instructions:\nTitle (DD/MM/YY).\n- Use the object title.\n- Append the date from the object date field in parentheses, exactly like: Title (DD/MM/YY).\n\nFirst in-body H2.\n- Use the object h2.\n- If missing, leave empty but keep the pipe.\n\nChallenge action.\n- Write one short imperative action.\n- It must be directly grounded in the challenge wording and the article evidence.\n\nVerbose relevance explainer.\n- Write 2 to 4 sentences.\n- Explicitly reference at least two exact anchor phrases from the challenge.\n- Tie each anchor phrase to specific evidence from the article.\n- Newlines are allowed inside this field if needed.\n\nURL.\n- Use the object url.\n- Wrap exactly as: <a href=\"URL\">Read article</a>\n\nDelimiter rules. Strict:\n- Output exactly THREE items.\n- Separate items using the literal token:\n/n\n- You MUST NOT use the token /n anywhere else.\n- Do NOT add extra delimiters, numbering, bullets, headings, or surrounding text.\n- Do NOT output JSON.\n\nPunctuation constraint:\nDo not use em dashes or en dashes.\nReplace them with full stops or commas.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        448,
        -880
      ],
      "id": "3b87b9da-4895-457e-a41e-84c38c4107d0",
      "name": "Format selected Articles3"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.2",
          "mode": "list",
          "cachedResultName": "gpt-5.2"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -2160,
        -688
      ],
      "id": "cb4c5780-6b4f-4392-8a4e-344f6af3ebc8",
      "name": "OpenAI Chat Model8",
      "credentials": {
        "openAiApi": {
          "id": "A6TzpvpaIyqf4IKq",
          "name": "Lee C chat GPT account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.2",
          "mode": "list",
          "cachedResultName": "gpt-5.2"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -1808,
        -688
      ],
      "id": "e11a4c8f-c7bb-470f-aea2-d7f4bdc57ab9",
      "name": "OpenAI Chat Model9",
      "credentials": {
        "openAiApi": {
          "id": "A6TzpvpaIyqf4IKq",
          "name": "Lee C chat GPT account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.2",
          "mode": "list",
          "cachedResultName": "gpt-5.2"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -1248,
        -688
      ],
      "id": "dc0ecc46-d4e6-4422-b715-a4137b94af4a",
      "name": "OpenAI Chat Model10",
      "credentials": {
        "openAiApi": {
          "id": "A6TzpvpaIyqf4IKq",
          "name": "Lee C chat GPT account"
        }
      }
    },
    {
      "parameters": {
        "toRecipients": "=lee@linarconsulting.com",
        "subject": "=***No Email captured during a conversation with Three Things Tina for {{ $('Three Things Tina').item.json.body.data.analysis.data_collection_results.Name.value }}",
        "bodyContent": "=<html>\n  <body style=\"margin:0; padding:0;\">\n    <div style=\"font-family: Arial, Helvetica, sans-serif; font-size:14px; line-height:1.6; color:#000000;\">\n\n      <!-- Header -->\n      <div style=\"margin:0 0 20px 0; padding:0;\">\n        <img src=\"https://raw.githubusercontent.com/LE-LeeC/LINAR/main/Linar-Wordmark-RGB-Red-optimized.png\"\n             alt=\"LINAR logo\"\n             style=\"height:20px; display:block; border:0; outline:none;\">\n      </div>\n\n      <!-- Greeting -->\n      <p style=\"margin:0 0 12px 0; padding:0;\">\n        Hi {{ $('Three Things Tina').item.json.body.data.analysis.data_collection_results.Name.value }}\n      </p>\n\n      <p style=\"margin:0 0 16px 0; padding:0;\">\n        Thanks for speaking to me. I really enjoyed our conversation and have made some recommendations below which I hope are helpful.\n      </p>\n\n      <!-- Challenge -->\n      <h3 style=\"font-size:18px; font-weight:700; color:#b10f2e; margin:30px 0 10px 0; padding:0;\">\n        Your challenge\n      </h3>\n      <p style=\"margin:0 0 16px 0; padding:0;\">\n        {{ $('Identify Challenge1').item.json.output }}\n      </p>\n\n      <!-- Recommendations -->\n      <h3 style=\"font-size:18px; font-weight:700; color:#b10f2e; margin:30px 0 10px 0; padding:0;\">\n        Recommendations\n      </h3>\n      <p style=\"margin:0 0 16px 0; padding:0;\">\n        {{ $('Identify Recommendations1').item.json.output }}\n      </p>     \n\n      <!-- What are you waiting for?! -->\n      <h3 style=\"font-size:18px; font-weight:700; color:#b10f2e; margin:30px 0 10px 0; padding:0;\">\n        What are you waiting for?!\n      </h3>\n      <p style=\"margin:0 0 12px 0; padding:0;\">\n        Based on the above, here are three things (there's always three!) you can do right now to get started:\n      </p>\n      <ul >\n        {{ $('Next Steps HTML Bullets3').item.json.html_bullets }}\n      </ul>\n\n      <!-- Related articles -->\n      <h3 style=\"font-size:18px; font-weight:700; color:#b10f2e; margin:30px 0 10px 0; padding:0;\">\n        Related articles\n      </h3>\n      <div style=\"margin:0; padding:0;\">\n        {{ $json.html_email }}\n      </div>\n\n      <!-- Footer -->\n      <hr style=\"margin:30px 0; border:0; border-top:1px solid #b10f2e;\">\n\n      <p style=\"margin:0 0 16px 0; padding:0;\">\n        You can find all of our Three Things articles\n        <a href=\"https://linarconsulting.com/resources/\" target=\"_blank\" style=\"color:#b10f2e; text-decoration:none;\">here</a>.\n        We also send out a weekly Three Things newsletter direct to your inbox, sign up\n        <a href=\"https://share-eu1.hsforms.com/1TvoeY-xqRLuJ-8TxHvsw_w2db85y\" target=\"_blank\" style=\"color:#b10f2e; text-decoration:none;\">here</a>.\n      </p>\n\n      <p style=\"margin:0; padding:0;\">Kind regards</p>\n      <p style=\"margin:6px 0 0 0; padding:0; font-weight:700;\">Tina</p>\n\n      <!-- Signature -->\n      <div style=\"margin-top:20px;\">\n\n        <p style=\"margin:0;\">Three Things agent</p>\n        <p style=\"margin:0; font-weight:700; color:#C82613;\">LINAR Consulting</p>\n\n        <p style=\"margin:6px 0 0 0;\">\n          <strong>E:</strong>\n          <a href=\"mailto:tina@linarconsulting.com\" style=\"color:#1155cc; text-decoration:none;\">\n            tina@linarconsulting.com\n          </a>\n        </p>\n\n        <p style=\"margin:0;\">\n          <strong>W:</strong>\n          <a href=\"https://linarconsulting.com/\" style=\"color:#1155cc; text-decoration:none;\">\n            www.linarconsulting.com\n          </a>\n        </p>\n\n        <p style=\"margin:12px 0 0 0; font-weight:700;\">\n          P.S. want a weekly sales and BD punch in the face?\n          <a href=\"https://share-eu1.hsforms.com/1TvoeY-xqRLuJ-8TxHvsw_w2db85y\" style=\"color:#1155cc; text-decoration:none;\">\n            Three Things\n          </a>\n          to get you ducking and weaving with your clients.\n        </p>\n\n      </div>\n\n    </div>\n  </body>\n</html>\n",
        "additionalFields": {
          "bccRecipients": "andy@legalengine.co.uk",
          "bodyContentType": "html"
        }
      },
      "type": "n8n-nodes-base.microsoftOutlook",
      "typeVersion": 2,
      "position": [
        1056,
        -880
      ],
      "id": "0c06a7c3-7d51-4e0f-8cb8-48a9caf67293",
      "name": "Tina Email - No email",
      "webhookId": "0a57ad19-7a2b-4e0f-bec4-605fcf511055",
      "credentials": {
        "microsoftOutlookOAuth2Api": {
          "id": "kzkaYt1eDxfbVnWx",
          "name": "Outlook Three Things Tina - 12 Feb 26"
        }
      }
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": "01RDSCPONO2CZT22PORNC3PJQ4CAPNY3TD"
      },
      "type": "n8n-nodes-base.microsoftOneDrive",
      "typeVersion": 1,
      "position": [
        -496,
        -720
      ],
      "id": "6880c9cd-f4c7-4436-a833-52f02e96ce25",
      "name": "Download a file3",
      "credentials": {
        "microsoftOneDriveOAuth2Api": {
          "id": "O6kcuY0URca0xV5I",
          "name": "Lee LINAR - Microsoft Drive account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": "01RDSCPONO2CZT22PORNC3PJQ4CAPNY3TD"
      },
      "type": "n8n-nodes-base.microsoftOneDrive",
      "typeVersion": 1,
      "position": [
        -512,
        -256
      ],
      "id": "2bfc065e-3c97-4343-9079-eca41b0bad4a",
      "name": "Download a file4",
      "credentials": {
        "microsoftOneDriveOAuth2Api": {
          "id": "O6kcuY0URca0xV5I",
          "name": "Lee LINAR - Microsoft Drive account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "// n8n Code node (JavaScript) ES5 safe\n// Input: Agent 2 output string with 3 items separated by literal /n\n// Output: cleaned_text, articles[], html_email, debug\n\nvar input = (items && items[0] && items[0].json) ? items[0].json : {};\n\n// ---------- Helpers ----------\nfunction esc(s) {\n  return String(s === undefined || s === null ? \"\" : s)\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&#39;\");\n}\n\nfunction extractHref(s) {\n  var m = String(s === undefined || s === null ? \"\" : s).match(/href=\"([^\"]+)\"/i);\n  return m ? m[1].trim() : \"\";\n}\n\nfunction splitPipes(line) {\n  return String(line === undefined || line === null ? \"\" : line)\n    .split(/\\s*\\|\\s*/g)\n    .map(function (p) { return p.trim(); });\n}\n\nfunction pickFirstString(obj, keys) {\n  for (var i = 0; i < keys.length; i++) {\n    var k = keys[i];\n    var v = obj[k];\n    if (typeof v === \"string\" && v.trim()) return v.trim();\n  }\n  return \"\";\n}\n\nfunction findLikelyOutputString(obj) {\n  for (var k in obj) {\n    if (!Object.prototype.hasOwnProperty.call(obj, k)) continue;\n    var v = obj[k];\n    if (typeof v !== \"string\") continue;\n    var s = v.trim();\n    if (!s) continue;\n\n    var pipes = s.match(/\\|/g);\n    var pipeCount = pipes ? pipes.length : 0;\n    if (pipeCount >= 4) return s;\n  }\n  return \"\";\n}\n\nfunction collapseWhitespace(s) {\n  return String(s === undefined || s === null ? \"\" : s)\n    .replace(/\\r\\n/g, \"\\n\")\n    .replace(/\\r/g, \"\\n\")\n    .replace(/\\s*\\n\\s*/g, \" \")\n    .replace(/\\s+/g, \" \")\n    .trim();\n}\n\nfunction parseTitleAndDate(titleWithDate) {\n  var s = String(titleWithDate === undefined || titleWithDate === null ? \"\" : titleWithDate).trim();\n  var out = { title: s, date: \"\" };\n  var m = s.match(/^(.*)\\((\\d{2}\\/\\d{2}\\/\\d{2})\\)\\s*$/);\n  if (m) {\n    out.title = (m[1] || \"\").trim();\n    out.date = (m[2] || \"\").trim();\n  }\n  return out;\n}\n\n// ---------- 0) Choose raw input ----------\nvar raw = pickFirstString(input, [\"output\", \"message\", \"text\", \"content\", \"result\", \"response\"]);\nif (!raw) raw = findLikelyOutputString(input);\nif (!raw) raw = \"\";\n\n// ---------- 1) Split into items by literal /n (DO NOT replace /n) ----------\nvar parts = raw.split(\"/n\");\nvar entries = [];\nfor (var i = 0; i < parts.length; i++) {\n  var t = String(parts[i] === undefined || parts[i] === null ? \"\" : parts[i]).trim();\n  if (t) entries.push(t);\n}\nif (entries.length > 3) entries = entries.slice(0, 3);\n\n// Collapse internal newlines and excess spaces per entry\nfor (var e = 0; e < entries.length; e++) {\n  entries[e] = collapseWhitespace(entries[e]);\n}\n\n// ---------- 2) Parse entries ----------\nvar articles = [];\n\nfor (var ei = 0; ei < entries.length; ei++) {\n  var entry = entries[ei];\n  var fields = splitPipes(entry);\n\n  if (fields.length < 5) {\n    var td0 = parseTitleAndDate(fields[0] || \"\");\n    articles.push({ title: td0.title, date: td0.date, h2: fields[1] || \"\", action: \"\", explainer: \"\", url: \"\" });\n    continue;\n  }\n\n  var td = parseTitleAndDate(fields[0] || \"\");\n  var h2 = fields[1] || \"\";\n  var action = fields[2] || \"\";\n\n  // find link field from end\n  var linkIndex = -1;\n  for (var j = fields.length - 1; j >= 0; j--) {\n    if (/href\\s*=/.test(fields[j]) || /^https?:\\/\\//i.test(fields[j])) {\n      linkIndex = j;\n      break;\n    }\n  }\n  if (linkIndex === -1) linkIndex = fields.length - 1;\n\n  var linkPart = fields.slice(linkIndex).join(\" | \");\n  var explainer = fields.slice(3, linkIndex).join(\" | \").trim();\n\n  var url = extractHref(linkPart);\n  if (!url) url = extractHref(entry);\n  if (!url && /^https?:\\/\\//i.test(linkPart)) url = linkPart.trim();\n\n  articles.push({ title: td.title, date: td.date, h2: h2, action: action, explainer: explainer, url: url });\n}\n\n// pad to 3\nwhile (articles.length < 3) {\n  articles.push({ title: \"\", date: \"\", h2: \"\", action: \"\", explainer: \"\", url: \"\" });\n}\narticles.length = 3;\n\n// ---------- 3) cleaned_text ----------\nvar cleaned_text = articles\n  .map(function (a) {\n    var titleWithDate = a.date ? (a.title + \" (\" + a.date + \")\") : a.title;\n    var link = a.url ? '<a href=\"' + a.url + '\">Read article</a>' : \"\";\n    return titleWithDate + \" | \" + a.h2 + \" | \" + a.action + \" | \" + a.explainer + \" | \" + link;\n  })\n  .join(\"\\n\");\n\n// ---------- 4) html_email ----------\nvar cards = articles\n  .map(function (a) {\n    var titleWithDate = a.date ? (a.title + \" (\" + a.date + \")\") : a.title;\n\n    var titleEsc = esc(titleWithDate);\n    var h2Esc = esc(a.h2);\n    var actionEsc = esc(a.action);\n    var explainerEsc = esc(a.explainer);\n    var urlEsc = esc(a.url);\n\n    var linkHtml = a.url\n      ? '<div style=\"margin:0; font-size:14px; line-height:20px;\">' +\n          '<a href=\"' + urlEsc + '\" style=\"color:#1155cc; text-decoration:underline;\">Read article</a>' +\n        \"</div>\"\n      : \"\";\n\n    return (\n      '<div style=\"margin:0 0 14px 0; padding:14px; border:1px solid #e6e6e6; border-radius:10px;\">' +\n        '<div style=\"margin:0 0 6px 0; font-size:14px; line-height:20px; color:#111; font-weight:700;\">' +\n          titleEsc +\n        \"</div>\" +\n        '<div style=\"margin:0 0 8px 0; font-size:14px; line-height:20px; color:#333; font-weight:600;\">' +\n          h2Esc +\n        \"</div>\" +\n        '<div style=\"margin:0 0 10px 0; font-size:14px; line-height:20px; color:#444;\">' +\n          actionEsc +\n        \"</div>\" +\n        '<div style=\"margin:0 0 10px 0; font-size:14px; line-height:20px; color:#444;\">' +\n          explainerEsc +\n        \"</div>\" +\n        linkHtml +\n      \"</div>\"\n    );\n  })\n  .join(\"\\n\");\n\nvar html_email =\n  '<div style=\"font-family: Arial, Helvetica, sans-serif; color:#111; font-size:14px; line-height:20px;\">' +\n    '<p style=\"margin:0 0 12px 0;\">Here are three recommended reads tailored to the challenge.</p>' +\n    cards +\n  \"</div>\";\n\n// ---------- Debug ----------\nvar debug = {\n  raw_preview: String(raw).slice(0, 300),\n  entry_count: entries.length,\n  entries_preview: entries\n};\n\nreturn [{ json: { cleaned_text: cleaned_text, articles: articles, html_email: html_email, debug: debug } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        848,
        160
      ],
      "id": "78e07a1d-552e-496c-8011-2efd8d69b14e",
      "name": "Create Examples HTML - replaced on 12 Feb",
      "disabled": true
    }
  ],
  "connections": {
    "Google Vertex Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "Challenge",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        []
      ]
    },
    "Three Things Tina": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Full Transcript Code Node",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search Website Articles": {
      "main": [
        [
          {
            "node": "Article Selector Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Vertex Chat Model - Article Selector": {
      "ai_languageModel": [
        [
          {
            "node": "Article Selector Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Article Selector Agent",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Article Selector Agent": {
      "main": [
        [
          {
            "node": "Format Article Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Vertex Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Recommendations",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Recommendations": {
      "main": [
        [
          {
            "node": "Email cleanup",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Vertex Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Examples",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Examples": {
      "main": [
        [
          {
            "node": "search linar",
            "type": "main",
            "index": 0
          },
          {
            "node": "Recco email cleanup",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Challenge": {
      "main": [
        [
          {
            "node": "Recommendations",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Challenge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "search linar": {
      "main": [
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Articles",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript2": {
      "main": [
        []
      ]
    },
    "Google Vertex Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "Articles",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Articles": {
      "main": [
        [
          {
            "node": "Code in JavaScript3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript3": {
      "main": [
        [
          {
            "node": "Summary email - INTERNAL1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Summary email - INTERNAL1": {
      "main": [
        []
      ]
    },
    "Email cleanup": {
      "main": [
        [
          {
            "node": "Examples",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download a file": {
      "main": [
        [
          {
            "node": "Extract from File1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get a file": {
      "main": [
        []
      ]
    },
    "Extract from File1": {
      "main": [
        [
          {
            "node": "Articles1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Articles1": {
      "main": [
        [
          {
            "node": "Create Examples HTML",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Articles1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Recco email cleanup": {
      "main": [
        [
          {
            "node": "Summary email - INTERNAL1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Send a message",
            "type": "main",
            "index": 0
          },
          {
            "node": "Download a file",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Examples HTML": {
      "main": [
        [
          {
            "node": "Summary email - INTERNAL",
            "type": "main",
            "index": 0
          },
          {
            "node": "Summary email - INTERNAL2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Identify Challenge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download a file1": {
      "main": [
        [
          {
            "node": "Extract from File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File": {
      "main": [
        [
          {
            "node": "Identify 3 Relevant Three Things Artciles",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Identify 3 Relevant Three Things Artciles",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Full Transcript Code Node": {
      "main": [
        [
          {
            "node": "If email is NOT captured",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Identify Challenge": {
      "main": [
        [
          {
            "node": "Identify Recommendations",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Identify Recommendations": {
      "main": [
        [
          {
            "node": "Recco HTML Bullets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Examples Next Steps": {
      "main": [
        [
          {
            "node": "Next Steps HTML Bullets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Recco HTML Bullets": {
      "main": [
        [
          {
            "node": "Examples Next Steps",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Next Steps HTML Bullets": {
      "main": [
        [
          {
            "node": "Download a file1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Examples HTML List": {
      "main": [
        [
          {
            "node": "Tina Email to User",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Identify 3 Relevant Three Things Artciles": {
      "main": [
        [
          {
            "node": "Format selected Articles",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "Format selected Articles",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Format selected Articles": {
      "main": [
        [
          {
            "node": "Create Examples HTML List",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model5": {
      "ai_languageModel": [
        [
          {
            "node": "Examples Next Steps",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model4": {
      "ai_languageModel": [
        [
          {
            "node": "Identify Recommendations",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "Identify Challenge",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Identify 3 Relevant Three Things Artciles2": {
      "main": [
        [
          {
            "node": "Format selected Articles2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format selected Articles2": {
      "main": [
        [
          {
            "node": "Create Examples HTML List2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tina Email to User": {
      "main": [
        []
      ]
    },
    "If email is null": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        []
      ]
    },
    "If email is NOT captured": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "Identify Challenge1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download a file2": {
      "main": [
        [
          {
            "node": "Extract from File2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File2": {
      "main": [
        [
          {
            "node": "Identify 3 Relevant Three Things Artciles3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model6": {
      "ai_languageModel": [
        [
          {
            "node": "Identify 3 Relevant Three Things Artciles3",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Identify Challenge1": {
      "main": [
        [
          {
            "node": "Identify Recommendations1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Identify Recommendations1": {
      "main": [
        [
          {
            "node": "Recco HTML Bullets2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Examples Next Steps1": {
      "main": [
        [
          {
            "node": "Next Steps HTML Bullets3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Recco HTML Bullets2": {
      "main": [
        [
          {
            "node": "Examples Next Steps1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Next Steps HTML Bullets3": {
      "main": [
        [
          {
            "node": "Download a file2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Examples HTML List3": {
      "main": [
        [
          {
            "node": "Tina Email - No email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Identify 3 Relevant Three Things Artciles3": {
      "main": [
        [
          {
            "node": "Format selected Articles3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model7": {
      "ai_languageModel": [
        [
          {
            "node": "Format selected Articles3",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Format selected Articles3": {
      "main": [
        [
          {
            "node": "Create Examples HTML List3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model8": {
      "ai_languageModel": [
        [
          {
            "node": "Identify Challenge1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model9": {
      "ai_languageModel": [
        [
          {
            "node": "Identify Recommendations1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model10": {
      "ai_languageModel": [
        [
          {
            "node": "Examples Next Steps1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": {
    "node:Microsoft OneDrive Trigger": {
      "LastLink": "https://graph.microsoft.com/v1.0/me/drive/root/delta?token=NDslMjM0OyUyMzE7Mzs4NmQwNjNlOC03OTRlLTQxMDAtOGY0My01ODU3ODRlYjUwMDk7NjM5MDI5ODIyNjY4MTcwMDAwOzYwMjEyODg0OyUyMzslMjM7JTIzMDslMjM",
      "lastTimeChecked": "2026-01-02T20:24:31.611Z"
    }
  },
  "pinData": {
    "Three Things Tina": [
      {
        "json": {
          "headers": {
            "host": "leonard-dev.app.n8n.cloud",
            "user-agent": "ElevenLabs/1.0",
            "content-length": "45016",
            "accept": "*/*",
            "accept-encoding": "gzip, br",
            "cdn-loop": "cloudflare; loops=1; subreqs=1",
            "cf-connecting-ip": "34.77.234.246",
            "cf-ew-via": "15",
            "cf-ipcountry": "BE",
            "cf-ray": "9cca9d5633509ee8-CDG",
            "cf-visitor": "{\"scheme\":\"https\"}",
            "cf-worker": "n8n.cloud",
            "content-type": "application/json",
            "elevenlabs-signature": "t=1770883879,v0=cbc91ec1dbb721a785921256c8c3bd74c62495c19c670412b8eba748e7226cad",
            "x-forwarded-for": "34.77.234.246, 141.101.97.2",
            "x-forwarded-host": "leonard-dev.app.n8n.cloud",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "traefik-prod-users-gwc-52-6c4f4684d5-dxhms",
            "x-is-trusted": "yes",
            "x-real-ip": "34.77.234.246"
          },
          "params": {},
          "query": {},
          "body": {
            "type": "post_call_transcription",
            "event_timestamp": 1770883879,
            "data": {
              "agent_id": "agent_0101kfjpq72afbpt13zwvwb8dz2n",
              "agent_name": "TEST - Tina - Three Things - WhatsApp",
              "status": "done",
              "user_id": null,
              "branch_id": "agtbrch_6401kfjpq79nfy3sfkr7t8w2f2va",
              "version_id": "agtvrsn_1701kftxhe4sfwbawxwnega7h768",
              "transcript": [
                {
                  "role": "user",
                  "agent_metadata": null,
                  "message": "hey tina",
                  "multivoice_message": null,
                  "tool_calls": [],
                  "tool_results": [],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 0,
                  "conversation_turn_metrics": null,
                  "rag_retrieval_info": null,
                  "llm_usage": null,
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": "text"
                },
                {
                  "role": "agent",
                  "agent_metadata": {
                    "agent_id": "agent_0101kfjpq72afbpt13zwvwb8dz2n",
                    "branch_id": "agtbrch_6401kfjpq79nfy3sfkr7t8w2f2va",
                    "workflow_node_id": null
                  },
                  "message": "Hey there! Lovely to hear from you.\n\nSome people like a short written summary with links at the end of these chats. Would that be useful for you?",
                  "multivoice_message": null,
                  "tool_calls": [],
                  "tool_results": [],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 0,
                  "conversation_turn_metrics": {
                    "metrics": {
                      "convai_llm_service_ttf_sentence": {
                        "elapsed_time": 2.0300585119985044
                      },
                      "convai_llm_service_ttfb": {
                        "elapsed_time": 2.0291453629979515
                      },
                      "convai_llm_service_tt_last_sentence": {
                        "elapsed_time": 2.150041011002031
                      }
                    },
                    "convai_asr_provider": null,
                    "convai_tts_model": null
                  },
                  "rag_retrieval_info": {
                    "chunks": [
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "IAAlPqDOA5WFSoGcPs3S",
                        "vector_distance": 0.18451440334320068
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "tpUcP76iqI8EWiTxRrjg",
                        "vector_distance": 0.1854163408279419
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "UFHVselUYxuODPjeupOZ",
                        "vector_distance": 0.1854609251022339
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "uFaOQo34ws65SlvYmaOn",
                        "vector_distance": 0.18740975856781006
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "3WFkgunoU9YtRqXujwiu",
                        "vector_distance": 0.18743550777435303
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "UUVWfOoGGDoVCyyD1r7o",
                        "vector_distance": 0.1877935528755188
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "dQ7QdghhFsRGyOiraoPn",
                        "vector_distance": 0.1881483793258667
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "qpSq3dFsQW0UTM0yfmQ7",
                        "vector_distance": 0.18821728229522705
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "ymI3K25a4xngms8o0vYA",
                        "vector_distance": 0.19083058834075928
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "PcuzMAJkkwg6ybUYfBv9",
                        "vector_distance": 0.19196999073028564
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "DQT0Repwh0jfYClR8cho",
                        "vector_distance": 0.19203907251358032
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "Aqw5fUom4f66azBMxpm0",
                        "vector_distance": 0.19210541248321533
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "uiuz12bfAm4pv8VMcGxO",
                        "vector_distance": 0.1921544075012207
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "Npb11SH4vKjgPntefU3E",
                        "vector_distance": 0.19270706176757812
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "qDee5Figw5Q0YJEgJy8o",
                        "vector_distance": 0.19292980432510376
                      }
                    ],
                    "embedding_model": "e5_mistral_7b_instruct",
                    "retrieval_query": "hi",
                    "rag_latency_secs": 0.31106912300310796
                  },
                  "llm_usage": {
                    "model_usage": {
                      "gemini-2.5-flash": {
                        "input": {
                          "tokens": 15053,
                          "price": 0.00225795
                        },
                        "input_cache_read": {
                          "tokens": 0,
                          "price": 0
                        },
                        "input_cache_write": {
                          "tokens": 0,
                          "price": 0
                        },
                        "output_total": {
                          "tokens": 33,
                          "price": 0.0000198
                        }
                      }
                    }
                  },
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": null
                },
                {
                  "role": "user",
                  "agent_metadata": null,
                  "message": "yes please",
                  "multivoice_message": null,
                  "tool_calls": [],
                  "tool_results": [],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 11,
                  "conversation_turn_metrics": null,
                  "rag_retrieval_info": null,
                  "llm_usage": null,
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": "text"
                },
                {
                  "role": "agent",
                  "agent_metadata": {
                    "agent_id": "agent_0101kfjpq72afbpt13zwvwb8dz2n",
                    "branch_id": "agtbrch_6401kfjpq79nfy3sfkr7t8w2f2va",
                    "workflow_node_id": null
                  },
                  "message": "No problem. If you want to share it now, just drop your email here. It'll only be used to send you a short summary and some relevant Three Things resources.",
                  "multivoice_message": null,
                  "tool_calls": [],
                  "tool_results": [],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 11,
                  "conversation_turn_metrics": {
                    "metrics": {
                      "convai_llm_service_ttf_sentence": {
                        "elapsed_time": 1.3950770649971673
                      },
                      "convai_llm_service_ttfb": {
                        "elapsed_time": 1.2680432699999074
                      },
                      "convai_llm_service_tt_last_sentence": {
                        "elapsed_time": 1.405631943998742
                      }
                    },
                    "convai_asr_provider": null,
                    "convai_tts_model": null
                  },
                  "rag_retrieval_info": {
                    "chunks": [
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "UUVWfOoGGDoVCyyD1r7o",
                        "vector_distance": 0.14513945579528809
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "dQ7QdghhFsRGyOiraoPn",
                        "vector_distance": 0.15105152130126953
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "tpUcP76iqI8EWiTxRrjg",
                        "vector_distance": 0.1518576741218567
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "eDCtVltT99rNRCANmtpu",
                        "vector_distance": 0.15191566944122314
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "uFaOQo34ws65SlvYmaOn",
                        "vector_distance": 0.15194523334503174
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "UFHVselUYxuODPjeupOZ",
                        "vector_distance": 0.154285728931427
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "IAAlPqDOA5WFSoGcPs3S",
                        "vector_distance": 0.1547558307647705
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "Uk2wa8EWrju2OncyPWQw",
                        "vector_distance": 0.15482378005981445
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "bCxAlqG9C0wzL2kreTXY",
                        "vector_distance": 0.15485763549804688
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "3WFkgunoU9YtRqXujwiu",
                        "vector_distance": 0.15637129545211792
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "qDee5Figw5Q0YJEgJy8o",
                        "vector_distance": 0.15647685527801514
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "PVLLSvwCYYN1d1z6vuUH",
                        "vector_distance": 0.15648329257965088
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "9PDWIGzV9Q3h2nkEGDod",
                        "vector_distance": 0.15746068954467773
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "7tLzC35Jb01HLH6RX6an",
                        "vector_distance": 0.15835988521575928
                      }
                    ],
                    "embedding_model": "e5_mistral_7b_instruct",
                    "retrieval_query": "would you like a short summary with links at the end of our chat?",
                    "rag_latency_secs": 0.23368358299921965
                  },
                  "llm_usage": {
                    "model_usage": {
                      "gemini-2.5-flash": {
                        "input": {
                          "tokens": 14403,
                          "price": 0.00216045
                        },
                        "input_cache_read": {
                          "tokens": 0,
                          "price": 0
                        },
                        "input_cache_write": {
                          "tokens": 0,
                          "price": 0
                        },
                        "output_total": {
                          "tokens": 36,
                          "price": 0.000021599999999999996
                        }
                      }
                    }
                  },
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": null
                },
                {
                  "role": "user",
                  "agent_metadata": null,
                  "message": "lee@linarconsulting.com",
                  "multivoice_message": null,
                  "tool_calls": [],
                  "tool_results": [],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 34,
                  "conversation_turn_metrics": null,
                  "rag_retrieval_info": null,
                  "llm_usage": null,
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": "text"
                },
                {
                  "role": "agent",
                  "agent_metadata": {
                    "agent_id": "agent_0101kfjpq72afbpt13zwvwb8dz2n",
                    "branch_id": "agtbrch_6401kfjpq79nfy3sfkr7t8w2f2va",
                    "workflow_node_id": null
                  },
                  "message": "Got it. Thanks, Lee.\n\nSo, what's on your mind today? What's a business development or sales challenge you're grappling with?",
                  "multivoice_message": null,
                  "tool_calls": [],
                  "tool_results": [],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 34,
                  "conversation_turn_metrics": {
                    "metrics": {
                      "convai_llm_service_ttf_sentence": {
                        "elapsed_time": 1.7622576260037022
                      },
                      "convai_llm_service_ttfb": {
                        "elapsed_time": 1.7616916749975644
                      },
                      "convai_llm_service_tt_last_sentence": {
                        "elapsed_time": 1.884638253999583
                      }
                    },
                    "convai_asr_provider": null,
                    "convai_tts_model": null
                  },
                  "rag_retrieval_info": {
                    "chunks": [
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "UUVWfOoGGDoVCyyD1r7o",
                        "vector_distance": 0.14516502618789673
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "gwF7XmxATk0HYwkgDXff",
                        "vector_distance": 0.14627337455749512
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "bCxAlqG9C0wzL2kreTXY",
                        "vector_distance": 0.15099620819091797
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "dQ7QdghhFsRGyOiraoPn",
                        "vector_distance": 0.15170836448669434
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "uFaOQo34ws65SlvYmaOn",
                        "vector_distance": 0.1524287462234497
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "eDCtVltT99rNRCANmtpu",
                        "vector_distance": 0.15283238887786865
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "PcuzMAJkkwg6ybUYfBv9",
                        "vector_distance": 0.15322399139404297
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "tpUcP76iqI8EWiTxRrjg",
                        "vector_distance": 0.15429657697677612
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "7tLzC35Jb01HLH6RX6an",
                        "vector_distance": 0.15444278717041016
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "zoU8WyXq1X3DxTgEoytR",
                        "vector_distance": 0.1548858880996704
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "PVLLSvwCYYN1d1z6vuUH",
                        "vector_distance": 0.15503686666488647
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "qDee5Figw5Q0YJEgJy8o",
                        "vector_distance": 0.155836284160614
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "qpSq3dFsQW0UTM0yfmQ7",
                        "vector_distance": 0.15639996528625488
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "9PDWIGzV9Q3h2nkEGDod",
                        "vector_distance": 0.15829569101333618
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "Uk2wa8EWrju2OncyPWQw",
                        "vector_distance": 0.15842628479003906
                      }
                    ],
                    "embedding_model": "e5_mistral_7b_instruct",
                    "retrieval_query": "do you want a summary with links sent to my email?",
                    "rag_latency_secs": 0.21039094200386899
                  },
                  "llm_usage": {
                    "model_usage": {
                      "gemini-2.5-flash": {
                        "input": {
                          "tokens": 15341,
                          "price": 0.00230115
                        },
                        "input_cache_read": {
                          "tokens": 0,
                          "price": 0
                        },
                        "input_cache_write": {
                          "tokens": 0,
                          "price": 0
                        },
                        "output_total": {
                          "tokens": 33,
                          "price": 0.0000198
                        }
                      }
                    }
                  },
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": null
                },
                {
                  "role": "user",
                  "agent_metadata": null,
                  "message": "Trying to put together a client plan and don't know where to start?",
                  "multivoice_message": null,
                  "tool_calls": [],
                  "tool_results": [],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 56,
                  "conversation_turn_metrics": null,
                  "rag_retrieval_info": null,
                  "llm_usage": null,
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": "text"
                },
                {
                  "role": "agent",
                  "agent_metadata": {
                    "agent_id": "agent_0101kfjpq72afbpt13zwvwb8dz2n",
                    "branch_id": "agtbrch_6401kfjpq79nfy3sfkr7t8w2f2va",
                    "workflow_node_id": null
                  },
                  "message": "Ah, the client plan. That's a classic. It can feel a bit like staring at a blank canvas, can't it?\n\nA great place to start is by looking at your existing clients. It's often the easiest, most secure revenue you'll find.\n\nHave you had a chance to go back over the clients you billed last year and identify anyone you haven't spoken to since? Sometimes just finding a reason to reconnect with them can uncover opportunities you didn't even know were there.",
                  "multivoice_message": null,
                  "tool_calls": [],
                  "tool_results": [],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 56,
                  "conversation_turn_metrics": {
                    "metrics": {
                      "convai_llm_service_ttf_sentence": {
                        "elapsed_time": 3.9644647640016046
                      },
                      "convai_llm_service_ttfb": {
                        "elapsed_time": 3.963836648996221
                      },
                      "convai_llm_service_tt_last_sentence": {
                        "elapsed_time": 4.105326641998545
                      }
                    },
                    "convai_asr_provider": null,
                    "convai_tts_model": null
                  },
                  "rag_retrieval_info": {
                    "chunks": [
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "b5FIbKpvZZyNZvymppjA",
                        "vector_distance": 0.142153799533844
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "2fC2u6RIkwOEAraW2prG",
                        "vector_distance": 0.14279937744140625
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "SkkEPdwh9RDsWuG1iARp",
                        "vector_distance": 0.14346766471862793
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "RVVr3qoblgXG5d2RAhp4",
                        "vector_distance": 0.1437738537788391
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "jxGJ3j0Lscj2xtzVR3rl",
                        "vector_distance": 0.14472365379333496
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "Yn4PL86XNAD05j1kP9RL",
                        "vector_distance": 0.14504468441009521
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "gjDlLRXUWqFc58wwmaM7",
                        "vector_distance": 0.1453801989555359
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "hn039MHXzxy4JCFa6NE1",
                        "vector_distance": 0.14545178413391113
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "eDCtVltT99rNRCANmtpu",
                        "vector_distance": 0.14561623334884644
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "DwgBpagkI8qupj8YY1Lx",
                        "vector_distance": 0.1456717848777771
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "2Qfv8IRoq4suqeZfpRuX",
                        "vector_distance": 0.14776408672332764
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "DQT0Repwh0jfYClR8cho",
                        "vector_distance": 0.14804112911224365
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "wEFGvL1Io3dSPEc1glpk",
                        "vector_distance": 0.14804846048355103
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "s2ceCS70lyRYdaKOftUN",
                        "vector_distance": 0.14845651388168335
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "IAAlPqDOA5WFSoGcPs3S",
                        "vector_distance": 0.14858853816986084
                      }
                    ],
                    "embedding_model": "e5_mistral_7b_instruct",
                    "retrieval_query": "how do i start creating a client plan?",
                    "rag_latency_secs": 0.20826538300025277
                  },
                  "llm_usage": {
                    "model_usage": {
                      "gemini-2.5-flash": {
                        "input": {
                          "tokens": 15140,
                          "price": 0.002271
                        },
                        "input_cache_read": {
                          "tokens": 0,
                          "price": 0
                        },
                        "input_cache_write": {
                          "tokens": 0,
                          "price": 0
                        },
                        "output_total": {
                          "tokens": 106,
                          "price": 0.0000636
                        }
                      }
                    }
                  },
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": null
                },
                {
                  "role": "user",
                  "agent_metadata": null,
                  "message": "Hmmm. Not the answer I was expecting. I have an existing client and a client plan already developed. However, it's looking a bit stale. Any thoughts on how to jazz it up?",
                  "multivoice_message": null,
                  "tool_calls": [],
                  "tool_results": [],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 127,
                  "conversation_turn_metrics": null,
                  "rag_retrieval_info": null,
                  "llm_usage": null,
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": "text"
                },
                {
                  "role": "agent",
                  "agent_metadata": {
                    "agent_id": "agent_0101kfjpq72afbpt13zwvwb8dz2n",
                    "branch_id": "agtbrch_6401kfjpq79nfy3sfkr7t8w2f2va",
                    "workflow_node_id": null
                  },
                  "message": "Ah, \"stale\" client plans – a common affliction! It's easy for them to become a bit of a tick-box exercise. Let's inject some life into it.\n\nHere are a couple of thoughts to make that existing client plan feel fresh and more dynamic:\n\n1.  Go beyond the immediate matter: Instead of just focusing on the current project, try to have conversations about the wider market, their industry, or even their internal strategic challenges. What's keeping them awake at night? What are they hearing about new regulations or economic shifts? These \"non-matter\" conversations can uncover deeper needs and position you as a true compass, not just a service provider.\n\n2.  \"Land, expand – and bring a mate\": If you have a happy client, dig a little deeper. Ask them what else is on their radar, which other teams are involved in their big initiatives, or if there's anything they wish someone could take off their plate. And don't go it alone! Think about who else in your firm offers a complementary service. Bringing a colleague along to a meeting can strengthen the relationship, show your firm's range, and open doors to new opportunities.\n\n3.  Anticipate their needs: Great service isn't just about responding to requests; it's about predicting what they'll need next. Can you give them a heads-up on upcoming regulatory changes, or offer to streamline a process before it becomes a headache? This shows you're always thinking ahead on their behalf and makes them feel truly special.\n\nDoes that resonate, or spark any ideas for how you might refresh your approach?",
                  "multivoice_message": null,
                  "tool_calls": [],
                  "tool_results": [],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 127,
                  "conversation_turn_metrics": {
                    "metrics": {
                      "convai_llm_service_ttf_sentence": {
                        "elapsed_time": 6.7612590470016585
                      },
                      "convai_llm_service_ttfb": {
                        "elapsed_time": 6.760683854998206
                      },
                      "convai_llm_service_tt_last_sentence": {
                        "elapsed_time": 8.110729346997687
                      }
                    },
                    "convai_asr_provider": null,
                    "convai_tts_model": null
                  },
                  "rag_retrieval_info": {
                    "chunks": [
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "dQ7QdghhFsRGyOiraoPn",
                        "vector_distance": 0.12803196907043457
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "wEFGvL1Io3dSPEc1glpk",
                        "vector_distance": 0.13035064935684204
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "eDCtVltT99rNRCANmtpu",
                        "vector_distance": 0.13184434175491333
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "hn039MHXzxy4JCFa6NE1",
                        "vector_distance": 0.13429546356201172
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "SkkEPdwh9RDsWuG1iARp",
                        "vector_distance": 0.13537585735321045
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "gjDlLRXUWqFc58wwmaM7",
                        "vector_distance": 0.1357783079147339
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "RVVr3qoblgXG5d2RAhp4",
                        "vector_distance": 0.13650178909301758
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "uFaOQo34ws65SlvYmaOn",
                        "vector_distance": 0.13715219497680664
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "e4xvUHhP5LAeVRvqj1o4",
                        "vector_distance": 0.13889437913894653
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "kS9WuwzHRwR8hkvwLtoT",
                        "vector_distance": 0.13909673690795898
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "qcRK6qlwrCk4e2b7Ulbx",
                        "vector_distance": 0.13980716466903687
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "AdUrjIOO7QBjSH4nsVJo",
                        "vector_distance": 0.13981473445892334
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "tpUcP76iqI8EWiTxRrjg",
                        "vector_distance": 0.139897882938385
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "2Qfv8IRoq4suqeZfpRuX",
                        "vector_distance": 0.1401044726371765
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "b5FIbKpvZZyNZvymppjA",
                        "vector_distance": 0.14085417985916138
                      }
                    ],
                    "embedding_model": "e5_mistral_7b_instruct",
                    "retrieval_query": "how can i make my client plan more exciting?",
                    "rag_latency_secs": 0.1993887279968476
                  },
                  "llm_usage": {
                    "model_usage": {
                      "gemini-2.5-flash": {
                        "input": {
                          "tokens": 15438,
                          "price": 0.0023157
                        },
                        "input_cache_read": {
                          "tokens": 0,
                          "price": 0
                        },
                        "input_cache_write": {
                          "tokens": 0,
                          "price": 0
                        },
                        "output_total": {
                          "tokens": 344,
                          "price": 0.0002064
                        }
                      }
                    }
                  },
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": null
                },
                {
                  "role": "user",
                  "agent_metadata": null,
                  "message": "it does. Do you have access to a client planning template?",
                  "multivoice_message": null,
                  "tool_calls": [],
                  "tool_results": [],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 174,
                  "conversation_turn_metrics": null,
                  "rag_retrieval_info": null,
                  "llm_usage": null,
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": "text"
                },
                {
                  "role": "agent",
                  "agent_metadata": {
                    "agent_id": "agent_0101kfjpq72afbpt13zwvwb8dz2n",
                    "branch_id": "agtbrch_6401kfjpq79nfy3sfkr7t8w2f2va",
                    "workflow_node_id": null
                  },
                  "message": "That's a great question, and honestly, a common request! While I don't have a single, rigid \"client planning template\" to hand over (because let's face it, every client and every plan is a bit unique, isn't it?), I can certainly give you a practical framework based on what we've seen work well.\n\nThink of it less as a template to fill in, and more as a set of prompts to guide your thinking and actions. This should help you build out or refresh your plan in a way that's genuinely useful and not just a document for the sake of it.\n\nHere’s a simple framework you can adapt:\n\n1.  Client Overview & Relationship Health Check:\n       Who are the key contacts (and their PAs!)?\n       What's their business strategy and what are their current priorities/challenges?\n       What work have we done for them in the last 12-24 months?\n       When was our last meaningful, non-matter-specific conversation?\n       On a scale of 1-10, how \"sticky\" is our relationship? (Be honest!)\n\n2.  Opportunity Mapping (Beyond the Obvious):\n       What other services could we genuinely offer that align with their challenges?\n       Who else in their organisation could benefit from our expertise? (Think \"land and expand\" – which other teams are involved in their big initiatives?)\n       Are there any upcoming market changes or regulations that will impact them, where we could proactively offer support?\n       Who in our firm offers complementary services that we could introduce? (The \"bring a mate\" idea).\n\n3.  Engagement & Action Plan:\n       What's the next specific action you'll take? (e.g., \"Send article on X,\" \"Invite to webinar on Y,\" \"Suggest coffee with colleague Z\").\n       What's the purpose of that action? (e.g., \"Gather intelligence,\" \"Introduce new service,\" \"Deepen relationship\").\n       When will you do it? (Give yourself a deadline!)\n       How will you measure success for this client? (Beyond just revenue – think relationship strength, new introductions, deeper insights).\n\n4.  \"What If\" Scenarios:\n       What if their main contact leaves?\n       What if a competitor makes a move?\n       What if their industry faces a major disruption?\n       How can we be proactive in these situations?\n\nThe key is to keep it alive. It's not a static document; it's a living guide for how you nurture and grow that relationship.\n\nDoes that kind of framework help you get started, or would you like to dive deeper into any of those sections?",
                  "multivoice_message": null,
                  "tool_calls": [],
                  "tool_results": [],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 174,
                  "conversation_turn_metrics": {
                    "metrics": {
                      "convai_llm_service_ttf_sentence": {
                        "elapsed_time": 3.631959704005567
                      },
                      "convai_llm_service_ttfb": {
                        "elapsed_time": 3.631360309002048
                      },
                      "convai_llm_service_tt_last_sentence": {
                        "elapsed_time": 7.868392143005622
                      }
                    },
                    "convai_asr_provider": null,
                    "convai_tts_model": null
                  },
                  "rag_retrieval_info": {
                    "chunks": [
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "eDCtVltT99rNRCANmtpu",
                        "vector_distance": 0.13701117038726807
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "jxGJ3j0Lscj2xtzVR3rl",
                        "vector_distance": 0.14551687240600586
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "dQ7QdghhFsRGyOiraoPn",
                        "vector_distance": 0.1461789608001709
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "hn039MHXzxy4JCFa6NE1",
                        "vector_distance": 0.14686203002929688
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "e4xvUHhP5LAeVRvqj1o4",
                        "vector_distance": 0.14688926935195923
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "IAAlPqDOA5WFSoGcPs3S",
                        "vector_distance": 0.14761078357696533
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "2fC2u6RIkwOEAraW2prG",
                        "vector_distance": 0.1477189064025879
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "gjDlLRXUWqFc58wwmaM7",
                        "vector_distance": 0.1478506326675415
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "RVVr3qoblgXG5d2RAhp4",
                        "vector_distance": 0.14827466011047363
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "b5FIbKpvZZyNZvymppjA",
                        "vector_distance": 0.1485537886619568
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "ymI3K25a4xngms8o0vYA",
                        "vector_distance": 0.14939981698989868
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "zaNCpZIps0xQgruUyXey",
                        "vector_distance": 0.14985477924346924
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "SkkEPdwh9RDsWuG1iARp",
                        "vector_distance": 0.15031838417053223
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "uFaOQo34ws65SlvYmaOn",
                        "vector_distance": 0.15040063858032227
                      }
                    ],
                    "embedding_model": "e5_mistral_7b_instruct",
                    "retrieval_query": "do you have a client planning template i can use?",
                    "rag_latency_secs": 0.19732258500152966
                  },
                  "llm_usage": {
                    "model_usage": {
                      "gemini-2.5-flash": {
                        "input": {
                          "tokens": 15082,
                          "price": 0.0022622999999999996
                        },
                        "input_cache_read": {
                          "tokens": 0,
                          "price": 0
                        },
                        "input_cache_write": {
                          "tokens": 0,
                          "price": 0
                        },
                        "output_total": {
                          "tokens": 610,
                          "price": 0.000366
                        }
                      }
                    }
                  },
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": null
                },
                {
                  "role": "user",
                  "agent_metadata": null,
                  "message": "looks good. Thanks Tina",
                  "multivoice_message": null,
                  "tool_calls": [],
                  "tool_results": [],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 224,
                  "conversation_turn_metrics": null,
                  "rag_retrieval_info": null,
                  "llm_usage": null,
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": "text"
                },
                {
                  "role": "agent",
                  "agent_metadata": {
                    "agent_id": "agent_0101kfjpq72afbpt13zwvwb8dz2n",
                    "branch_id": "agtbrch_6401kfjpq79nfy3sfkr7t8w2f2va",
                    "workflow_node_id": null
                  },
                  "message": "Great! Glad that framework looks helpful, Lee.\n\nSo, just to recap, you were looking for ways to refresh your client plan, and we've talked through a few ideas to make it more dynamic, focusing on going beyond the immediate matter, expanding within the client, and anticipating their needs. We also covered a practical framework to guide your planning.\n\nYou've already given me your email address, so I'll make sure to send you a short written summary with links to some relevant Three Things resources shortly.\n\nThanks for the conversation, Lee. Appreciate you taking the time. Good luck putting those ideas into practice!",
                  "multivoice_message": null,
                  "tool_calls": [],
                  "tool_results": [],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 224,
                  "conversation_turn_metrics": {
                    "metrics": {
                      "convai_llm_service_ttf_sentence": {
                        "elapsed_time": 1.2636919880023925
                      },
                      "convai_llm_service_ttfb": {
                        "elapsed_time": 1.2631572550017154
                      },
                      "convai_llm_service_tt_last_sentence": {
                        "elapsed_time": 1.6236802120038192
                      }
                    },
                    "convai_asr_provider": null,
                    "convai_tts_model": null
                  },
                  "rag_retrieval_info": {
                    "chunks": [
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "eDCtVltT99rNRCANmtpu",
                        "vector_distance": 0.12774640321731567
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "dQ7QdghhFsRGyOiraoPn",
                        "vector_distance": 0.1283508539199829
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "jxGJ3j0Lscj2xtzVR3rl",
                        "vector_distance": 0.13004779815673828
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "hn039MHXzxy4JCFa6NE1",
                        "vector_distance": 0.13052642345428467
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "s2ceCS70lyRYdaKOftUN",
                        "vector_distance": 0.13065874576568604
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "wEFGvL1Io3dSPEc1glpk",
                        "vector_distance": 0.130720853805542
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "RVVr3qoblgXG5d2RAhp4",
                        "vector_distance": 0.13234943151474
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "uFaOQo34ws65SlvYmaOn",
                        "vector_distance": 0.13299381732940674
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "b5FIbKpvZZyNZvymppjA",
                        "vector_distance": 0.1332012414932251
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "2Qfv8IRoq4suqeZfpRuX",
                        "vector_distance": 0.1332772970199585
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "SkkEPdwh9RDsWuG1iARp",
                        "vector_distance": 0.13414990901947021
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "e4xvUHhP5LAeVRvqj1o4",
                        "vector_distance": 0.1348419189453125
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "kS9WuwzHRwR8hkvwLtoT",
                        "vector_distance": 0.13520312309265137
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "PQhSm31Uz1DuJD3yfSpt",
                        "vector_distance": 0.13582634925842285
                      },
                      {
                        "document_id": "NLnYnP4C1xFQ9ZrbUV1E",
                        "chunk_id": "Yn4PL86XNAD05j1kP9RL",
                        "vector_distance": 0.13757562637329102
                      }
                    ],
                    "embedding_model": "e5_mistral_7b_instruct",
                    "retrieval_query": "how can i refresh my stale client plan to make it more dynamic and useful?",
                    "rag_latency_secs": 0.23952762599947164
                  },
                  "llm_usage": null,
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": null
                },
                {
                  "role": "agent",
                  "agent_metadata": {
                    "agent_id": "agent_0101kfjpq72afbpt13zwvwb8dz2n",
                    "branch_id": "agtbrch_6401kfjpq79nfy3sfkr7t8w2f2va",
                    "workflow_node_id": null
                  },
                  "message": null,
                  "multivoice_message": null,
                  "tool_calls": [
                    {
                      "type": "system",
                      "request_id": "end_call_9db7b3521716455fb27ed9f9c8e207f0",
                      "tool_name": "end_call",
                      "params_as_json": "{\"reason\": \"User indicated satisfaction and thanked me. Email captured. Conversation naturally concluded.\", \"system__message_to_speak\": \"Great! Glad that framework looks helpful, Lee. So, just to recap, you were looking for ways to refresh your client plan, and we've talked through a few ideas to make it more dynamic, focusing on going beyond the immediate matter, expanding within the client, and anticipating their needs. We also covered a practical framework to guide your planning. You've already given me your email address, so I'll make sure to send you a short written summary with links to some relevant Three Things resources shortly. Thanks for the conversation, Lee. Appreciate you taking the time. Good luck putting those ideas into practice!\"}",
                      "tool_has_been_called": true,
                      "tool_details": null
                    }
                  ],
                  "tool_results": [],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 226,
                  "conversation_turn_metrics": {
                    "metrics": {
                      "convai_llm_service_ttf_sentence": {
                        "elapsed_time": 1.2636919880023925
                      },
                      "convai_llm_service_ttfb": {
                        "elapsed_time": 1.2631572550017154
                      },
                      "convai_llm_tool_request_generation_latency": {
                        "elapsed_time": 0.43984843399812235
                      },
                      "convai_llm_service_tt_last_sentence": {
                        "elapsed_time": 1.6236802120038192
                      }
                    },
                    "convai_asr_provider": null,
                    "convai_tts_model": null
                  },
                  "rag_retrieval_info": null,
                  "llm_usage": null,
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": null
                },
                {
                  "role": "agent",
                  "agent_metadata": {
                    "agent_id": "agent_0101kfjpq72afbpt13zwvwb8dz2n",
                    "branch_id": "agtbrch_6401kfjpq79nfy3sfkr7t8w2f2va",
                    "workflow_node_id": null
                  },
                  "message": null,
                  "multivoice_message": null,
                  "tool_calls": [],
                  "tool_results": [
                    {
                      "request_id": "end_call_9db7b3521716455fb27ed9f9c8e207f0",
                      "tool_name": "end_call",
                      "result_value": "{\"result_type\":\"end_call_success\",\"status\":\"success\",\"reason\":\"User indicated satisfaction and thanked me. Email captured. Conversation naturally concluded.\",\"message\":null}",
                      "is_error": false,
                      "tool_has_been_called": true,
                      "tool_latency_secs": 0.5028006970023853,
                      "error_type": "",
                      "raw_error_message": "",
                      "dynamic_variable_updates": [],
                      "type": "system",
                      "result": {
                        "result_type": "end_call_success",
                        "status": "success",
                        "reason": "User indicated satisfaction and thanked me. Email captured. Conversation naturally concluded.",
                        "message": null
                      }
                    }
                  ],
                  "feedback": null,
                  "llm_override": null,
                  "time_in_call_secs": 227,
                  "conversation_turn_metrics": null,
                  "rag_retrieval_info": null,
                  "llm_usage": {
                    "model_usage": {
                      "gemini-2.5-flash": {
                        "input": {
                          "tokens": 16271,
                          "price": 0.00244065
                        },
                        "input_cache_read": {
                          "tokens": 0,
                          "price": 0
                        },
                        "input_cache_write": {
                          "tokens": 0,
                          "price": 0
                        },
                        "output_total": {
                          "tokens": 280,
                          "price": 0.000168
                        }
                      }
                    }
                  },
                  "interrupted": false,
                  "original_message": null,
                  "source_medium": null
                }
              ],
              "metadata": {
                "start_time_unix_secs": 1770883640,
                "accepted_time_unix_secs": 1770883640,
                "call_duration_secs": 235,
                "cost": 380,
                "deletion_settings": {
                  "deletion_time_unix_secs": null,
                  "deleted_logs_at_time_unix_secs": null,
                  "deleted_audio_at_time_unix_secs": null,
                  "deleted_transcript_at_time_unix_secs": null,
                  "delete_transcript_and_pii": false,
                  "delete_audio": false
                },
                "feedback": {
                  "type": null,
                  "overall_score": null,
                  "likes": 0,
                  "dislikes": 0,
                  "rating": null,
                  "comment": null
                },
                "authorization_method": "whatsapp",
                "charging": {
                  "dev_discount": false,
                  "is_burst": false,
                  "tier": "enterprise",
                  "llm_usage": {
                    "irreversible_generation": {
                      "model_usage": {
                        "gemini-2.5-flash": {
                          "input": {
                            "tokens": 106728,
                            "price": 0.0160092
                          },
                          "input_cache_read": {
                            "tokens": 0,
                            "price": 0
                          },
                          "input_cache_write": {
                            "tokens": 0,
                            "price": 0
                          },
                          "output_total": {
                            "tokens": 1442,
                            "price": 0.0008652
                          }
                        }
                      }
                    },
                    "initiated_generation": {
                      "model_usage": {
                        "gemini-2.5-flash": {
                          "input": {
                            "tokens": 106728,
                            "price": 0.0160092
                          },
                          "input_cache_read": {
                            "tokens": 0,
                            "price": 0
                          },
                          "input_cache_write": {
                            "tokens": 0,
                            "price": 0
                          },
                          "output_total": {
                            "tokens": 1442,
                            "price": 0.0008652
                          }
                        }
                      }
                    }
                  },
                  "llm_price": 0.0168744,
                  "llm_charge": 170,
                  "call_charge": 210,
                  "free_minutes_consumed": 0,
                  "free_llm_dollars_consumed": 0
                },
                "phone_call": null,
                "batch_call": null,
                "termination_reason": "end_call tool was called.",
                "error": null,
                "warnings": [],
                "main_language": "en",
                "rag_usage": {
                  "usage_count": 7,
                  "embedding_model": "e5_mistral_7b_instruct"
                },
                "text_only": true,
                "features_usage": {
                  "language_detection": {
                    "enabled": false,
                    "used": false
                  },
                  "transfer_to_agent": {
                    "enabled": false,
                    "used": false
                  },
                  "transfer_to_number": {
                    "enabled": false,
                    "used": false
                  },
                  "multivoice": {
                    "enabled": false,
                    "used": false
                  },
                  "dtmf_tones": {
                    "enabled": false,
                    "used": false
                  },
                  "external_mcp_servers": {
                    "enabled": false,
                    "used": false
                  },
                  "pii_zrm_workspace": false,
                  "pii_zrm_agent": false,
                  "tool_dynamic_variable_updates": {
                    "enabled": false,
                    "used": false
                  },
                  "is_livekit": false,
                  "voicemail_detection": {
                    "enabled": false,
                    "used": false
                  },
                  "workflow": {
                    "enabled": false,
                    "tool_node": {
                      "enabled": false,
                      "used": false
                    },
                    "standalone_agent_node": {
                      "enabled": false,
                      "used": false
                    },
                    "phone_number_node": {
                      "enabled": false,
                      "used": false
                    },
                    "end_node": {
                      "enabled": false,
                      "used": false
                    }
                  },
                  "agent_testing": {
                    "enabled": false,
                    "tests_ran_after_last_modification": false,
                    "tests_ran_in_last_7_days": false
                  },
                  "versioning": {
                    "enabled": true,
                    "used": false
                  }
                },
                "eleven_assistant": {
                  "is_eleven_assistant": false
                },
                "initiator_id": null,
                "conversation_initiation_source": "whatsapp",
                "conversation_initiation_source_version": null,
                "timezone": "Europe/London",
                "async_metadata": null,
                "whatsapp": {
                  "direction": "inbound",
                  "whatsapp_phone_number_id": "984896298033377",
                  "whatsapp_user_id": "447889758119",
                  "awaiting_first_user_message": null
                },
                "agent_created_from": "ui",
                "agent_last_updated_from": "ui"
              },
              "analysis": {
                "evaluation_criteria_results": {
                  "name_capture": {
                    "criteria_id": "name_capture",
                    "result": "success",
                    "rationale": "The agent successfully captures the user's name as Lee, as evidenced by the agent addressing the user by name in multiple turns (e.g., \"Got it. Thanks, Lee.\", \"Glad that framework looks helpful, Lee.\", \"Thanks for the conversation, Lee.\")."
                  },
                  "email_capture": {
                    "criteria_id": "email_capture",
                    "result": "success",
                    "rationale": "The agent successfully captures the user's email address as lee@linarconsulting.com, as the user provides this email in response to the agent's request for an email to send a summary."
                  }
                },
                "data_collection_results": {
                  "Name": {
                    "data_collection_id": "Name",
                    "value": "Lee",
                    "json_schema": {
                      "type": "string",
                      "description": "Name of the user",
                      "enum": null,
                      "is_system_provided": false,
                      "dynamic_variable": "",
                      "constant_value": ""
                    },
                    "rationale": "The user's name is mentioned multiple times in the conversation. The agent uses the name \"Lee\" when addressing the user."
                  },
                  "Email address": {
                    "data_collection_id": "Email address",
                    "value": "lee@linarconsulting.com",
                    "json_schema": {
                      "type": "string",
                      "description": "User will input their email address via chat function",
                      "enum": null,
                      "is_system_provided": false,
                      "dynamic_variable": "",
                      "constant_value": ""
                    },
                    "rationale": "The user provided their email address, lee@linarconsulting.com, in response to the agent's request to \"drop your email here\" to receive a summary of the conversation."
                  },
                  "Challenge": {
                    "data_collection_id": "Challenge",
                    "value": "The user is seeking to refresh and improve an existing, but stale, client plan to make it more dynamic and effective.",
                    "json_schema": {
                      "type": "string",
                      "description": "Identify and summarise the problem and/or challenge the user is facing. Describe this in a short summary - maximum 75 words. \n\n",
                      "enum": null,
                      "is_system_provided": false,
                      "dynamic_variable": "",
                      "constant_value": ""
                    },
                    "rationale": "The user initially struggled with creating a client plan but later clarified that they already had one that felt stale. The challenge was to refresh and improve an existing client plan to make it more dynamic and effective."
                  },
                  "Recommendations": {
                    "data_collection_id": "Recommendations",
                    "value": "To refresh a stale client plan, focus on broader industry conversations to uncover deeper needs. \"Land, expand – and bring a mate\" by involving other teams and colleagues. Anticipate client needs by proactively offering support and heads-ups on upcoming changes. This positions you as a valuable partner, not just a service provider.",
                    "json_schema": {
                      "type": "string",
                      "description": "Your task is to provide a succinct **recommendation** on how to address the challenge. \n\nThis recommendation should be maximum 75 words in length. \n\nReturn just the plain-English context — no headings, no extra explanation.\n\nKeep it professional and clear.\n\nPlease make sure that all outputs are in *UK English* not American English, including all spelling and date formats.",
                      "enum": null,
                      "is_system_provided": false,
                      "dynamic_variable": "",
                      "constant_value": ""
                    },
                    "rationale": "The agent provides a few suggestions on how to refresh a stale client plan. These include going beyond the immediate matter, expanding within the client, and anticipating their needs. I have summarised these into a recommendation of under 75 words."
                  },
                  "Examples": {
                    "data_collection_id": "Examples",
                    "value": "Go beyond the immediate matter\nLand, expand – and bring a mate\nAnticipate their needs",
                    "json_schema": {
                      "type": "string",
                      "description": "Your task is to provide a list of **examples** the user could try to remedy their challenge. \n\nEach example should be displayed on a separate line. \n\nThere should be a maximum of three examples.\n\nReturn just the plain-English context — no headings, no extra explanation.\n\nKeep it professional and clear.\n\nPlease make sure that all outputs are in *UK English* not American English, including all spelling and date formats.",
                      "enum": null,
                      "is_system_provided": false,
                      "dynamic_variable": "",
                      "constant_value": ""
                    },
                    "rationale": "The agent provides three examples of how to refresh a client plan in its response at 2026-02-12T08:09:27+00:00. These examples are:\n\n1. Go beyond the immediate matter\n2. Land, expand – and bring a mate\n3. Anticipate their needs\n\nI have extracted these examples and formatted them as a plain-English string, with each example on a new line, as requested."
                  }
                },
                "evaluation_criteria_results_list": [
                  {
                    "criteria_id": "name_capture",
                    "result": "success",
                    "rationale": "The agent successfully captures the user's name as Lee, as evidenced by the agent addressing the user by name in multiple turns (e.g., \"Got it. Thanks, Lee.\", \"Glad that framework looks helpful, Lee.\", \"Thanks for the conversation, Lee.\")."
                  },
                  {
                    "criteria_id": "email_capture",
                    "result": "success",
                    "rationale": "The agent successfully captures the user's email address as lee@linarconsulting.com, as the user provides this email in response to the agent's request for an email to send a summary."
                  }
                ],
                "data_collection_results_list": [
                  {
                    "data_collection_id": "Name",
                    "value": "Lee",
                    "json_schema": {
                      "type": "string",
                      "description": "Name of the user",
                      "enum": null,
                      "is_system_provided": false,
                      "dynamic_variable": "",
                      "constant_value": ""
                    },
                    "rationale": "The user's name is mentioned multiple times in the conversation. The agent uses the name \"Lee\" when addressing the user."
                  },
                  {
                    "data_collection_id": "Email address",
                    "value": "lee@linarconsulting.com",
                    "json_schema": {
                      "type": "string",
                      "description": "User will input their email address via chat function",
                      "enum": null,
                      "is_system_provided": false,
                      "dynamic_variable": "",
                      "constant_value": ""
                    },
                    "rationale": "The user provided their email address, lee@linarconsulting.com, in response to the agent's request to \"drop your email here\" to receive a summary of the conversation."
                  },
                  {
                    "data_collection_id": "Challenge",
                    "value": "The user is seeking to refresh and improve an existing, but stale, client plan to make it more dynamic and effective.",
                    "json_schema": {
                      "type": "string",
                      "description": "Identify and summarise the problem and/or challenge the user is facing. Describe this in a short summary - maximum 75 words. \n\n",
                      "enum": null,
                      "is_system_provided": false,
                      "dynamic_variable": "",
                      "constant_value": ""
                    },
                    "rationale": "The user initially struggled with creating a client plan but later clarified that they already had one that felt stale. The challenge was to refresh and improve an existing client plan to make it more dynamic and effective."
                  },
                  {
                    "data_collection_id": "Recommendations",
                    "value": "To refresh a stale client plan, focus on broader industry conversations to uncover deeper needs. \"Land, expand – and bring a mate\" by involving other teams and colleagues. Anticipate client needs by proactively offering support and heads-ups on upcoming changes. This positions you as a valuable partner, not just a service provider.",
                    "json_schema": {
                      "type": "string",
                      "description": "Your task is to provide a succinct **recommendation** on how to address the challenge. \n\nThis recommendation should be maximum 75 words in length. \n\nReturn just the plain-English context — no headings, no extra explanation.\n\nKeep it professional and clear.\n\nPlease make sure that all outputs are in *UK English* not American English, including all spelling and date formats.",
                      "enum": null,
                      "is_system_provided": false,
                      "dynamic_variable": "",
                      "constant_value": ""
                    },
                    "rationale": "The agent provides a few suggestions on how to refresh a stale client plan. These include going beyond the immediate matter, expanding within the client, and anticipating their needs. I have summarised these into a recommendation of under 75 words."
                  },
                  {
                    "data_collection_id": "Examples",
                    "value": "Go beyond the immediate matter\nLand, expand – and bring a mate\nAnticipate their needs",
                    "json_schema": {
                      "type": "string",
                      "description": "Your task is to provide a list of **examples** the user could try to remedy their challenge. \n\nEach example should be displayed on a separate line. \n\nThere should be a maximum of three examples.\n\nReturn just the plain-English context — no headings, no extra explanation.\n\nKeep it professional and clear.\n\nPlease make sure that all outputs are in *UK English* not American English, including all spelling and date formats.",
                      "enum": null,
                      "is_system_provided": false,
                      "dynamic_variable": "",
                      "constant_value": ""
                    },
                    "rationale": "The agent provides three examples of how to refresh a client plan in its response at 2026-02-12T08:09:27+00:00. These examples are:\n\n1. Go beyond the immediate matter\n2. Land, expand – and bring a mate\n3. Anticipate their needs\n\nI have extracted these examples and formatted them as a plain-English string, with each example on a new line, as requested."
                  }
                ],
                "call_successful": "success",
                "transcript_summary": "Lee asked Tina for help refreshing a stale client plan. Tina provided advice on expanding the client relationship, anticipating needs, and having broader conversations. Tina then shared a framework for client planning, including relationship health checks, opportunity mapping, and action planning. Lee found the framework helpful. Tina will send a summary and resources to Lee's email.\n",
                "call_summary_title": "Refreshing Client Plan"
              },
              "conversation_initiation_client_data": {
                "conversation_config_override": {
                  "turn": null,
                  "tts": null,
                  "conversation": {
                    "text_only": true
                  },
                  "agent": {
                    "first_message": "",
                    "language": "en",
                    "prompt": {
                      "prompt": "",
                      "llm": "gemini-2.5-flash",
                      "native_mcp_server_ids": []
                    }
                  }
                },
                "custom_llm_extra_body": {},
                "user_id": null,
                "source_info": {
                  "source": null,
                  "version": null
                },
                "dynamic_variables": {
                  "system__agent_id": "agent_0101kfjpq72afbpt13zwvwb8dz2n",
                  "system__agent_turns": 7,
                  "system__current_agent_turns": 7,
                  "system__current_subagent_turns": 7,
                  "system__current_agent_id": "agent_0101kfjpq72afbpt13zwvwb8dz2n",
                  "system__conversation_id": "conv_4501kh8e7v3pfd8ax9jd6z35z0wr",
                  "system__call_duration_secs": 234,
                  "system__time_utc": "2026-02-12T08:11:15.133316+00:00",
                  "system__time": "Thursday, 08:11 12 February 2026",
                  "system__timezone": "Europe/London",
                  "system__caller_id": "447889758119",
                  "system__called_number": "984896298033377",
                  "system__call_sid": null
                }
              },
              "conversation_id": "conv_4501kh8e7v3pfd8ax9jd6z35z0wr"
            }
          },
          "webhookUrl": "https://leonard-dev.app.n8n.cloud/webhook/threethingstina",
          "executionMode": "production"
        }
      }
    ]
  },
  "triggerCount": 1,
  "meta": {
    "templateCredsSetupCompleted": true
  }
}